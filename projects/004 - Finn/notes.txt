Cohort matching
-- Extracted in a reusable file in shared folder.
-- Uses #Patients to get sex and dob
-- Outputs #Patients2 -- cant use same temp twice. 


Patient demographics
-- Takes around 1 hour to run 
-- cohort matching is shared reusable queries. 


Covid-information
-- There are patients who died within28days of positive test but without having any records of a positive test in RLS.vw_COVID19. 

select *
FROM RLS.vw_COVID19 
where 
Not ((GroupDescription = 'Confirmed' OR (GroupDescription = 'Tested' AND SubGroupDescription = 'Positive')))
and	DeathWithin28Days != 'N'
-- 20,085 rows


-- when checking for covid positive test include both confirmed and (tested and positive)

-- No of events cohort size = 1000 
c	CovidEvent
11.829	Death Within 28 Days
147	High Clinical Vulnerability
52	Positive Test
11	Moderate Clinical Vulnerability


Cancer information
-- return SuppliedCode 
most used supplied code is 8BAV. which is a cancer-related code but is not in our initial clinical codeset 

PK_Reference_Coding_ID	Reference_Coding_ID	CreateDate	ModifDate	LoadID	Deleted	HDMModifDate	MainCode	CodingType	ActiveStartDate	ActiveEndDate	Term30	Term60	Term198	ICD9Code	ICD9Def	ICD10Code	ICD10Def	OPCS	OPCSDef	SpecFlags	DiscFlags	LangCode	SnomedCT_ConceptID	FK_Reference_SnomedCT_ID	Term	FullDescription
666445	8BAV._00	2020-10-27 12:38:45.8700000	2021-05-18 11:50:39.6860000	698866	N	2021-05-18 11:50:39.6860000	8BAV.	ReadCodeV2	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	NULL	720006006	424792	00	Cancer care review




Comorbidities
-- First and last diagnosis date. 


Still TODO:
-- Check and finalise hospital admissions and medication extract files.
-- Check documentation
-- Find cancer clinical codes prvalence
-- Check for comorbidities first and last diagnosis date