--┌─────────────┐
--│ Medications │
--└─────────────┘

------------------- RDE CHECK ----------------------
-- RDE Name: George Tilston, Date of check: 06/05/21

-- All prescriptions of: methotrexate, sulfasalazine, leflunomide, hydroxychloroquine
-- and the glucocorticoids predisolone and predisone.

-- OUTPUT: Data with the following fields
-- 	- PatientId (int)
--	-	GPPracticeCode
--	-	MedicationDate (YYYY-MM-DD)
--	-	SuppliedCode
--	-	MedicationDescription
--	-	DrugType (one of: 'hydroxychloroquine','leflunomide','methotrexate','prednisolone-oral','prednisone' or 'sulfasalazine')
--	-	Quantity
--	-	Dosage
--	-	Units
--	-	RepeatMedicationFlag

--Just want the output, not the messages
SET NOCOUNT ON;

-- For now let's use the in-built QOF rule for the RA cohort. We can refine this over time
--┌──────────────────────────────────────────────────────┐
--│ Create a cohort of patients based on QOF definitions │
--└──────────────────────────────────────────────────────┘

-- OBJECTIVE: To obtain a cohort of patients defined by a particular QOF condition.

-- INPUT: Takes two parameters
--  - condition: string - the name of the QOF condition as recorded in the SharedCare.Cohort_Category table
--  - outputtable: string - the name of the temp table that will be created to store the cohort

-- OUTPUT: A temp table as follows:
-- #[outputtable] (FK_Patient_Link_ID)
--  - FK_Patient_Link_ID - unique patient id for cohort patient

IF OBJECT_ID('tempdb..#Patients') IS NOT NULL DROP TABLE #Patients;
SELECT DISTINCT FK_Patient_Link_ID
INTO #Patients
FROM [RLS].[vw_Cohort_Patient_Registers]
WHERE FK_Cohort_Register_ID IN (
	SELECT PK_Cohort_Register_ID FROM SharedCare.Cohort_Register
	WHERE FK_Cohort_Category_ID IN (
		SELECT PK_Cohort_Category_ID FROM SharedCare.Cohort_Category
		WHERE CategoryName = 'Rheumatoid Arthritis'
	)
);

-- >>> Codesets required... Inserting the code set code
--
--┌────────────────────┐
--│ Clinical code sets │
--└────────────────────┘

-- OBJECTIVE: To populate temporary tables with the existing clinical code sets.
--            See the [SQL-generation-process.md](SQL-generation-process.md) for more details.

-- INPUT: No pre-requisites

-- OUTPUT: Five temp tables as follows:
--  #AllCodes (Concept, Version, Code)
--  #CodeSets (FK_Reference_Coding_ID, Concept)
--  #SnomedSets (FK_Reference_SnomedCT_ID, FK_SNOMED_ID)
--  #VersionedCodeSets (FK_Reference_Coding_ID, Concept, Version)
--  #VersionedSnomedSets (FK_Reference_SnomedCT_ID, Version, FK_SNOMED_ID)

--!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
--!!! DO NOT EDIT THIS FILE MANUALLY !!!
--!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

IF OBJECT_ID('tempdb..#AllCodes') IS NOT NULL DROP TABLE #AllCodes;
CREATE TABLE #AllCodes (
  [Concept] [varchar](255) NOT NULL,
  [Version] INT NOT NULL,
  [Code] [varchar](20) COLLATE Latin1_General_CS_AS NOT NULL
);

IF OBJECT_ID('tempdb..#codesreadv2') IS NOT NULL DROP TABLE #codesreadv2;
CREATE TABLE #codesreadv2 (
  [concept] [varchar](255) NOT NULL,
  [version] INT NOT NULL,
	[code] [varchar](20) COLLATE Latin1_General_CS_AS NOT NULL,
	[description] [varchar](255) NULL
) ON [PRIMARY];

INSERT INTO #codesreadv2
VALUES ('hydroxychloroquine',1,'j54..00','HYDROXYCHLOROQUINE SULFATE [ANTI-RHEUMATIC]'),('hydroxychloroquine',1,'j54..','HYDROXYCHLOROQUINE SULFATE [ANTI-RHEUMATIC]'),('hydroxychloroquine',1,'j54..11','HYDROXYCHLOROQUINE SULPHATE [ANTI-RHEUMATIC]'),('hydroxychloroquine',1,'j54..','HYDROXYCHLOROQUINE SULPHATE [ANTI-RHEUMATIC]'),('hydroxychloroquine',1,'j54z.00','HYDROXYCHLOROQUINE SULFATE 200mg tablets'),('hydroxychloroquine',1,'j54z.','HYDROXYCHLOROQUINE SULFATE 200mg tablets'),('hydroxychloroquine',1,'j54z.11','HYDROXYCHLOROQUINE SULPHATE 200mg tablets'),('hydroxychloroquine',1,'j54z.','HYDROXYCHLOROQUINE SULPHATE 200mg tablets'),('hydroxychloroquine',1,'j541.00','PLAQUENIL 200mg tablets'),('hydroxychloroquine',1,'j541.','PLAQUENIL 200mg tablets'),('hydroxychloroquine',1,'j542.00','QUINORIC 200mg tablets'),('hydroxychloroquine',1,'j542.','QUINORIC 200mg tablets'),('hydroxychloroquine',1,'ej3..00','HYDROXYCHLOROQUINE SULFATE [ANTI MALARIAL]'),('hydroxychloroquine',1,'ej3..','HYDROXYCHLOROQUINE SULFATE [ANTI MALARIAL]'),('hydroxychloroquine',1,'ej3..11','HYDROXYCHLOROQUINE SULPHATE [ANTI MALARIAL]'),('hydroxychloroquine',1,'ej3..','HYDROXYCHLOROQUINE SULPHATE [ANTI MALARIAL]'),('hydroxychloroquine',1,'ej3z.00','HYDROCHLOROQUINE SULPHATE 200mg tablets'),('hydroxychloroquine',1,'ej3z.','HYDROCHLOROQUINE SULPHATE 200mg tablets'),('hydroxychloroquine',1,'ej31.00','*PLAQUENIL 200mg tablets'),('hydroxychloroquine',1,'ej31.','*PLAQUENIL 200mg tablets');
INSERT INTO #codesreadv2
VALUES ('leflunomide',1,'j59..00','LEFLUNOMIDE'),('leflunomide',1,'j59..','LEFLUNOMIDE'),('leflunomide',1,'j59z.00','LEFLUNOMIDE 100mg tablets'),('leflunomide',1,'j59z.','LEFLUNOMIDE 100mg tablets'),('leflunomide',1,'j59y.00','LEFLUNOMIDE 20mg tablets'),('leflunomide',1,'j59y.','LEFLUNOMIDE 20mg tablets'),('leflunomide',1,'j59x.00','LEFLUNOMIDE 10mg tablets'),('leflunomide',1,'j59x.','LEFLUNOMIDE 10mg tablets'),('leflunomide',1,'j59w.00','LEFLUNOMIDE 15mg tablets'),('leflunomide',1,'j59w.','LEFLUNOMIDE 15mg tablets'),('leflunomide',1,'j593.00','ARAVA 100mg tablets'),('leflunomide',1,'j593.','ARAVA 100mg tablets'),('leflunomide',1,'j592.00','ARAVA 20mg tablets'),('leflunomide',1,'j592.','ARAVA 20mg tablets'),('leflunomide',1,'j591.00','ARAVA 10mg tablets'),('leflunomide',1,'j591.','ARAVA 10mg tablets');
INSERT INTO #codesreadv2
VALUES ('methotrexate',1,'h34..','METHOTREXATE'),('methotrexate',1,'h34..00','METHOTREXATE'),('methotrexate',1,'h341.','METHOTREXATE 2.5mg tablets'),('methotrexate',1,'h341.00','METHOTREXATE 2.5mg tablets'),('methotrexate',1,'h342.','METHOTREXATE 10mg tablets'),('methotrexate',1,'h342.00','METHOTREXATE 10mg tablets'),('methotrexate',1,'h34d.','*EMTEXATE 10mg tablets'),('methotrexate',1,'h34d.00','*EMTEXATE 10mg tablets'),('methotrexate',1,'h34p.','MAXTREX 2.5mg tablets'),('methotrexate',1,'h34p.00','MAXTREX 2.5mg tablets'),('methotrexate',1,'h34q.','MAXTREX 10mg tablets'),('methotrexate',1,'h34q.00','MAXTREX 10mg tablets'),('methotrexate',1,'h343.','*METHOTREXATE 2.5mg/1mL inj'),('methotrexate',1,'h343.00','*METHOTREXATE 2.5mg/1mL inj'),('methotrexate',1,'h345.','*METHOTREXATE 25mg/1mL inj'),('methotrexate',1,'h345.00','*METHOTREXATE 25mg/1mL inj'),('methotrexate',1,'h346.','METHOTREXATE 50mg/2mL inj soln'),('methotrexate',1,'h346.00','METHOTREXATE 50mg/2mL inj soln'),('methotrexate',1,'h347.','*METHOTREXATE 100mg/4mL inj'),('methotrexate',1,'h347.00','*METHOTREXATE 100mg/4mL inj'),('methotrexate',1,'h348.','*METHOTREXTE 200mg/8mL inj sol'),('methotrexate',1,'h348.00','*METHOTREXTE 200mg/8mL inj sol'),('methotrexate',1,'h349.','METHOTREXATE 500mg/20mL inj'),('methotrexate',1,'h349.00','METHOTREXATE 500mg/20mL inj'),('methotrexate',1,'h34A.','*METHOTREXATE 15mg/1.5mL pfs'),('methotrexate',1,'h34A.00','*METHOTREXATE 15mg/1.5mL pfs'),('methotrexate',1,'h34E.','*METOJECT 10mg/1mL syringe'),('methotrexate',1,'h34E.00','*METOJECT 10mg/1mL syringe'),('methotrexate',1,'h34F.','*METOJECT 15mg/1.5mL p/f syrg'),('methotrexate',1,'h34F.00','*METOJECT 15mg/1.5mL p/f syrg'),('methotrexate',1,'h34G.','*METOJECT 20mg/2mL p/f syringe'),('methotrexate',1,'h34G.00','*METOJECT 20mg/2mL p/f syringe'),('methotrexate',1,'h34H.','*METOJECT 25mg/2.5mL p/f syrng'),('methotrexate',1,'h34H.00','*METOJECT 25mg/2.5mL p/f syrng'),('methotrexate',1,'h34L.','*METOJECT 7.5mg/0.15mL inj pfs'),('methotrexate',1,'h34L.00','*METOJECT 7.5mg/0.15mL inj pfs'),('methotrexate',1,'h34N.','*METOJECT 10mg/0.2mL inj pfs'),('methotrexate',1,'h34N.00','*METOJECT 10mg/0.2mL inj pfs'),('methotrexate',1,'h34O.','*METHOTREXATE 10mg/0.2mL inj'),('methotrexate',1,'h34O.00','*METHOTREXATE 10mg/0.2mL inj'),('methotrexate',1,'h34R.','*METOJECT 20mg/0.4mL inj pfs'),('methotrexate',1,'h34R.00','*METOJECT 20mg/0.4mL inj pfs'),('methotrexate',1,'h34T.','*METOJECT 25mg/0.5mL inj pfs'),('methotrexate',1,'h34T.00','*METOJECT 25mg/0.5mL inj pfs'),('methotrexate',1,'h34U.','*METHOTREXATE 25mg/0.5mL inj'),('methotrexate',1,'h34U.00','*METHOTREXATE 25mg/0.5mL inj'),('methotrexate',1,'h34V.','*METOJECT 30mg/0.6mL inj pfs'),('methotrexate',1,'h34V.00','*METOJECT 30mg/0.6mL inj pfs'),('methotrexate',1,'h34W.','*METHOTREXATE 30mg/0.6mL inj'),('methotrexate',1,'h34W.00','*METHOTREXATE 30mg/0.6mL inj'),('methotrexate',1,'h34X.','*EBETREX 7.5mg/0.75mL inj pfs'),('methotrexate',1,'h34X.00','*EBETREX 7.5mg/0.75mL inj pfs'),('methotrexate',1,'h34Y.','*EBETREX 10mg/1mL inj pfs'),('methotrexate',1,'h34Y.00','*EBETREX 10mg/1mL inj pfs'),('methotrexate',1,'h34a.','*METHOTREXATE 1g/40mL inj soln'),('methotrexate',1,'h34a.00','*METHOTREXATE 1g/40mL inj soln'),('methotrexate',1,'h34e.','*EMTEXATE 5mg/2mL inj soln'),('methotrexate',1,'h34e.00','*EMTEXATE 5mg/2mL inj soln'),('methotrexate',1,'h34f.','*EMTEXATE 50mg/2mL inj soln'),('methotrexate',1,'h34f.00','*EMTEXATE 50mg/2mL inj soln'),('methotrexate',1,'h34g.','*EMTEXATE 250mg/10mL inj soln'),('methotrexate',1,'h34g.00','*EMTEXATE 250mg/10mL inj soln'),('methotrexate',1,'h34h.','*EMTEXATE 500mg/20mL inj soln'),('methotrexate',1,'h34h.00','*EMTEXATE 500mg/20mL inj soln'),('methotrexate',1,'h34i.','*EMTEXATE 1g/40mL inj soln'),('methotrexate',1,'h34i.00','*EMTEXATE 1g/40mL inj soln'),('methotrexate',1,'h34j.','*EMTEXATE 5g/200mL inj soln'),('methotrexate',1,'h34j.00','*EMTEXATE 5g/200mL inj soln'),('methotrexate',1,'h34k.','*EMTEXATE 1g/10mL inj soln'),('methotrexate',1,'h34k.00','*EMTEXATE 1g/10mL inj soln'),('methotrexate',1,'h34l.','*EMTEXATE 5g/50mL inj soln'),('methotrexate',1,'h34l.00','*EMTEXATE 5g/50mL inj soln'),('methotrexate',1,'h34n.','*EMTEXATE 1g inj pdr'),('methotrexate',1,'h34n.00','*EMTEXATE 1g inj pdr'),('methotrexate',1,'h34o.','*EMTEXATE 5g inj pdr'),('methotrexate',1,'h34o.00','*EMTEXATE 5g inj pdr'),('methotrexate',1,'h34r.','*MAXTREX 5mg/2mL inj soln'),('methotrexate',1,'h34r.00','*MAXTREX 5mg/2mL inj soln'),('methotrexate',1,'h34t.','*MAXTREX 500mg/20mL inj soln'),('methotrexate',1,'h34t.00','*MAXTREX 500mg/20mL inj soln'),('methotrexate',1,'h34u.','*MAXTREX 1g/40mL inj soln'),('methotrexate',1,'h34u.00','*MAXTREX 1g/40mL inj soln'),('methotrexate',1,'h34v.','*MAXTREX 5g/200mL inj soln'),('methotrexate',1,'h34v.00','*MAXTREX 5g/200mL inj soln'),('methotrexate',1,'h34w.','METHOTREXATE 1g/10mL injection'),('methotrexate',1,'h34w.00','METHOTREXATE 1g/10mL injection'),('methotrexate',1,'h34x.','METHOTREXATE 5g/50mL injection'),('methotrexate',1,'h34x.00','METHOTREXATE 5g/50mL injection'),('methotrexate',1,'h34y.','*METHOTREXATE 7.5mg/0.75mL pfs'),('methotrexate',1,'h34y.00','*METHOTREXATE 7.5mg/0.75mL pfs'),('methotrexate',1,'h3G..','METHOTREXATE(2)'),('methotrexate',1,'h3G..00','METHOTREXATE(2)'),('methotrexate',1,'h3G1.','*EBETREX 20mg/1mL inj pfs'),('methotrexate',1,'h3G1.00','*EBETREX 20mg/1mL inj pfs'),('methotrexate',1,'h3G2.','*EBETREX 25mg/1.25mL inj pfs'),('methotrexate',1,'h3G2.00','*EBETREX 25mg/1.25mL inj pfs'),('methotrexate',1,'h3G3.','*EBETREX 30mg/1.5mL inj pfs'),('methotrexate',1,'h3G3.00','*EBETREX 30mg/1.5mL inj pfs'),('methotrexate',1,'h3G4.','*METHOTREXATE 20mg/1mL inj pfs'),('methotrexate',1,'h3G4.00','*METHOTREXATE 20mg/1mL inj pfs'),('methotrexate',1,'h3G5.','*METHOTREXATE 25mg/1.25mL pfs'),('methotrexate',1,'h3G5.00','*METHOTREXATE 25mg/1.25mL pfs'),('methotrexate',1,'h3G6.','*METHOTREXATE 30mg/1.5mL pfs'),('methotrexate',1,'h3G6.00','*METHOTREXATE 30mg/1.5mL pfs'),('methotrexate',1,'h3G7.','*METOJCT 12.5mg/0.25mL inj pfs'),('methotrexate',1,'h3G7.00','*METOJCT 12.5mg/0.25mL inj pfs'),('methotrexate',1,'h3G9.','*METOJCT 17.5mg/0.35mL inj pfs'),('methotrexate',1,'h3G9.00','*METOJCT 17.5mg/0.35mL inj pfs'),('methotrexate',1,'h3GB.','*METOJCT 22.5mg/0.45mL inj pfs'),('methotrexate',1,'h3GB.00','*METOJCT 22.5mg/0.45mL inj pfs'),('methotrexate',1,'h3GC.','*METHOTRXATE 22.5mg/0.45mL inj'),('methotrexate',1,'h3GC.00','*METHOTRXATE 22.5mg/0.45mL inj'),('methotrexate',1,'h3GD.','*METOJCT 27.5mg/0.55mL inj pfs'),('methotrexate',1,'h3GD.00','*METOJCT 27.5mg/0.55mL inj pfs'),('methotrexate',1,'h3GE.','*METHOTRXATE 27.5mg/0.55mL inj'),('methotrexate',1,'h3GE.00','*METHOTRXATE 27.5mg/0.55mL inj'),('methotrexate',1,'h3GF.','METOJECT PEN 7.5mg/0.15mL inj'),('methotrexate',1,'h3GF.00','METOJECT PEN 7.5mg/0.15mL inj'),('methotrexate',1,'h3GG.','METHOTREXATE 7.5mg/0.15mL pen'),('methotrexate',1,'h3GG.00','METHOTREXATE 7.5mg/0.15mL pen'),('methotrexate',1,'h3GH.','METOJECT PEN 10mg/0.2mL inj'),('methotrexate',1,'h3GH.00','METOJECT PEN 10mg/0.2mL inj'),('methotrexate',1,'h3GJ.','METOJECT PEN 12.5mg/0.25mL inj'),('methotrexate',1,'h3GJ.00','METOJECT PEN 12.5mg/0.25mL inj'),('methotrexate',1,'h3GK.','METHOTREXATE 12.5mg/0.25mL pen'),('methotrexate',1,'h3GK.00','METHOTREXATE 12.5mg/0.25mL pen'),('methotrexate',1,'h3GL.','METOJECT PEN 15mg/0.3mL inj'),('methotrexate',1,'h3GL.00','METOJECT PEN 15mg/0.3mL inj'),('methotrexate',1,'h3GM.','METHOTREXATE 15mg/0.3mL pen'),('methotrexate',1,'h3GM.00','METHOTREXATE 15mg/0.3mL pen'),('methotrexate',1,'h3GN.','METOJECT PEN 17.5mg/0.35mL inj'),('methotrexate',1,'h3GN.00','METOJECT PEN 17.5mg/0.35mL inj'),('methotrexate',1,'h3GP.','METOJECT PEN 20mg/0.4mL inj'),('methotrexate',1,'h3GP.00','METOJECT PEN 20mg/0.4mL inj'),('methotrexate',1,'h3GR.','METOJECT PEN 22.5mg/0.45mL inj'),('methotrexate',1,'h3GR.00','METOJECT PEN 22.5mg/0.45mL inj'),('methotrexate',1,'h3GT.','METOJECT PEN 25mg/0.5mL inj'),('methotrexate',1,'h3GT.00','METOJECT PEN 25mg/0.5mL inj'),('methotrexate',1,'h3GV.','METOJECT PEN 27.5mg/0.55mL inj'),('methotrexate',1,'h3GV.00','METOJECT PEN 27.5mg/0.55mL inj'),('methotrexate',1,'h3GW.','METHOTREXATE 27.5mg/0.55mL pen'),('methotrexate',1,'h3GW.00','METHOTREXATE 27.5mg/0.55mL pen'),('methotrexate',1,'h3GX.','METOJECT PEN 30mg/0.6mL inj'),('methotrexate',1,'h3GX.00','METOJECT PEN 30mg/0.6mL inj'),('methotrexate',1,'h3GY.','METHOTREXATE 30mg/0.6mL pen'),('methotrexate',1,'h3GY.00','METHOTREXATE 30mg/0.6mL pen'),('methotrexate',1,'h3GZ.','METHOTREXATE 2mg/mL oral soln'),('methotrexate',1,'h3GZ.00','METHOTREXATE 2mg/mL oral soln'),('methotrexate',1,'h24B.','METHOTREXATE inj 20mg/2ml'),('methotrexate',1,'h24B.00','METHOTREXATE inj 20mg/2ml'),('methotrexate',1,'h344.','METHOTREXATE 5MG/2ML INJ'),('methotrexate',1,'h344.00','METHOTREXATE 5MG/2ML INJ'),('methotrexate',1,'h34b.','METHOTREXATE 25MG/1M INJ'),('methotrexate',1,'h34b.00','METHOTREXATE 25MG/1M INJ'),('methotrexate',1,'h34B.','*METHOTREXATE 20mg/2mL pfs'),('methotrexate',1,'h34B.00','*METHOTREXATE 20mg/2mL pfs'),('methotrexate',1,'h34D.','*METOJECT 7.5mg/0.75mL pfs'),('methotrexate',1,'h34D.00','*METOJECT 7.5mg/0.75mL pfs'),('methotrexate',1,'h34P.','*METOJECT 15mg/0.3mL inj pfs'),('methotrexate',1,'h34P.00','*METOJECT 15mg/0.3mL inj pfs'),('methotrexate',1,'h34Z.','*EBETREX 15mg/1.5mL inj pfs'),('methotrexate',1,'h34Z.00','*EBETREX 15mg/1.5mL inj pfs'),('methotrexate',1,'h34c.','*METHOTREXATE 500mg inj pdr'),('methotrexate',1,'h34c.00','*METHOTREXATE 500mg inj pdr'),('methotrexate',1,'h34m.','*EMTEXATE 0.5g inj pdr'),('methotrexate',1,'h34m.00','*EMTEXATE 0.5g inj pdr'),('methotrexate',1,'h34s.','*MAXTREX 50mg/2mL inj soln'),('methotrexate',1,'h34s.00','*MAXTREX 50mg/2mL inj soln'),('methotrexate',1,'h34C.','METHOTREXATE inj 25mg/2.5ml'),('methotrexate',1,'h34C.00','METHOTREXATE inj 25mg/2.5ml'),('methotrexate',1,'h34M.','METHOTREXATE inj 7.5mg/0.15ml'),
('methotrexate',1,'h34M.00','METHOTREXATE inj 7.5mg/0.15ml'),('methotrexate',1,'h34Q.','Methotrexate 15mg/0.3ml solution for injection pre-filled...'),('methotrexate',1,'h34Q.00','Methotrexate 15mg/0.3ml solution for injection pre-filled...'),('methotrexate',1,'h34S.','METHOTREXATE inj 20mg/0.4ml'),('methotrexate',1,'h34S.00','METHOTREXATE inj 20mg/0.4ml'),('methotrexate',1,'h34z.','METHOTREXATE inj 10mg/1ml'),('methotrexate',1,'h34z.00','METHOTREXATE inj 10mg/1ml'),('methotrexate',1,'h3G8.','Methotrexate 12.5mg/0.25ml solution for injection pre-fil...'),('methotrexate',1,'h3G8.00','Methotrexate 12.5mg/0.25ml solution for injection pre-fil...'),('methotrexate',1,'h3GA.','Methotrexate 17.5mg/0.35ml solution for injection pre-fil...'),('methotrexate',1,'h3GA.00','Methotrexate 17.5mg/0.35ml solution for injection pre-fil...'),('methotrexate',1,'h3GI.','Methotrexate 10mg/0.2ml solution for injection pre-filled...'),('methotrexate',1,'h3GI.00','Methotrexate 10mg/0.2ml solution for injection pre-filled...'),('methotrexate',1,'h3GO.','Methotrexate 17.5mg/0.35ml solution for injection pre-fil...'),('methotrexate',1,'h3GO.00','Methotrexate 17.5mg/0.35ml solution for injection pre-fil...'),('methotrexate',1,'h3GQ.','Methotrexate 20mg/0.4ml solution for injection pre-filled...'),('methotrexate',1,'h3GQ.00','Methotrexate 20mg/0.4ml solution for injection pre-filled...'),('methotrexate',1,'h3GS.','Methotrexate 22.5mg/0.45ml solution for injection pre-fil...'),('methotrexate',1,'h3GS.00','Methotrexate 22.5mg/0.45ml solution for injection pre-fil...'),('methotrexate',1,'h3GU.','Methotrexate 25mg/0.5ml solution for injection pre-filled...'),('methotrexate',1,'h3GU.00','Methotrexate 25mg/0.5ml solution for injection pre-filled...');
INSERT INTO #codesreadv2
VALUES ('prednisolone-oral',1,'fe6..00','PREDNISOLONE [ENDOCRINE]'),('prednisolone-oral',1,'fe6..','PREDNISOLONE [ENDOCRINE]'),('prednisolone-oral',1,'fe6z.00','PREDNISOLONE 25mg tablets'),('prednisolone-oral',1,'fe6z.','PREDNISOLONE 25mg tablets'),('prednisolone-oral',1,'fe6w.00','*PREDNISOLONE 2.5mg tablets'),('prednisolone-oral',1,'fe6w.','*PREDNISOLONE 2.5mg tablets'),('prednisolone-oral',1,'fe6v.00','PREDNISOLONE 2.5mg tablets'),('prednisolone-oral',1,'fe6v.','PREDNISOLONE 2.5mg tablets'),('prednisolone-oral',1,'fe6t.00','PREDNISOLONE 10mg tablets'),('prednisolone-oral',1,'fe6t.','PREDNISOLONE 10mg tablets'),('prednisolone-oral',1,'fe6s.00','PREDNISOLONE 20mg tablets'),('prednisolone-oral',1,'fe6s.','PREDNISOLONE 20mg tablets'),('prednisolone-oral',1,'fe6k.00','PREDNISOLONE 50mg tablets'),('prednisolone-oral',1,'fe6k.','PREDNISOLONE 50mg tablets'),('prednisolone-oral',1,'fe6j.00','PREDNISOLONE 5mg soluble tablets'),('prednisolone-oral',1,'fe6j.','PREDNISOLONE 5mg soluble tablets'),('prednisolone-oral',1,'fe6i.00','PREDNISOLONE 5mg e/c tablets'),('prednisolone-oral',1,'fe6i.','PREDNISOLONE 5mg e/c tablets'),('prednisolone-oral',1,'fe6h.00','PREDNISOLONE 2.5mg e/c tablets'),('prednisolone-oral',1,'fe6h.','PREDNISOLONE 2.5mg e/c tablets'),('prednisolone-oral',1,'fe62.00','PREDNISOLONE 5mg tablets'),('prednisolone-oral',1,'fe62.','PREDNISOLONE 5mg tablets'),('prednisolone-oral',1,'fe61.00','PREDNISOLONE 1mg tablets'),('prednisolone-oral',1,'fe61.','PREDNISOLONE 1mg tablets'),('prednisolone-oral',1,'fe6r.00','PEVANTI 20mg tablets'),('prednisolone-oral',1,'fe6r.','PEVANTI 20mg tablets'),('prednisolone-oral',1,'fe6q.00','PEVANTI 10mg tablets'),('prednisolone-oral',1,'fe6q.','PEVANTI 10mg tablets'),('prednisolone-oral',1,'fe6p.00','PEVANTI 5mg tablets'),('prednisolone-oral',1,'fe6p.','PEVANTI 5mg tablets'),('prednisolone-oral',1,'fe6o.00','PEVANTI 25mg tablets'),('prednisolone-oral',1,'fe6o.','PEVANTI 25mg tablets'),('prednisolone-oral',1,'fe6n.00','PEVANTI 2.5mg tablets'),('prednisolone-oral',1,'fe6n.','PEVANTI 2.5mg tablets'),('prednisolone-oral',1,'fe6m.00','DILACORT 2.5mg gastro-resistant tablets'),('prednisolone-oral',1,'fe6m.','DILACORT 2.5mg gastro-resistant tablets'),('prednisolone-oral',1,'fe6l.00','DILACORT 5mg gastro-resistant tablets'),('prednisolone-oral',1,'fe6l.','DILACORT 5mg gastro-resistant tablets'),('prednisolone-oral',1,'fe6g.00','*SINTISONE 5mg tablets'),('prednisolone-oral',1,'fe6g.','*SINTISONE 5mg tablets'),('prednisolone-oral',1,'fe6f.00','*PREDNESOL 5mg tablets'),('prednisolone-oral',1,'fe6f.','*PREDNESOL 5mg tablets'),('prednisolone-oral',1,'fe6e.00','PRECORTISYL FORTE 25mg tablets'),('prednisolone-oral',1,'fe6e.','PRECORTISYL FORTE 25mg tablets'),('prednisolone-oral',1,'fe6d.00','*PRECORTISYL 5mg tablets'),('prednisolone-oral',1,'fe6d.','*PRECORTISYL 5mg tablets'),('prednisolone-oral',1,'fe6c.00','*PRECORTISYL 1mg tablets'),('prednisolone-oral',1,'fe6c.','*PRECORTISYL 1mg tablets'),('prednisolone-oral',1,'fe6a.00','*DELTASTAB 5mg tablets'),('prednisolone-oral',1,'fe6a.','*DELTASTAB 5mg tablets'),('prednisolone-oral',1,'fe69.00','*DELTASTAB 1mg tablets'),('prednisolone-oral',1,'fe69.','*DELTASTAB 1mg tablets'),('prednisolone-oral',1,'fe68.00','*DELTALONE 5mg tablets'),('prednisolone-oral',1,'fe68.','*DELTALONE 5mg tablets'),('prednisolone-oral',1,'fe67.00','*DELTALONE 1mg tablets'),('prednisolone-oral',1,'fe67.','*DELTALONE 1mg tablets'),('prednisolone-oral',1,'fe66.00','DELTACORTRIL ENTERIC 5mg tablets'),('prednisolone-oral',1,'fe66.','DELTACORTRIL ENTERIC 5mg tablets'),('prednisolone-oral',1,'fe66.11','DELTACORTRIL GASTRO-RESISTANT 5mg tablets'),('prednisolone-oral',1,'fe66.','DELTACORTRIL GASTRO-RESISTANT 5mg tablets'),('prednisolone-oral',1,'fe65.00','DELTACORTRIL ENTERIC 2.5mg tablets'),('prednisolone-oral',1,'fe65.','DELTACORTRIL ENTERIC 2.5mg tablets'),('prednisolone-oral',1,'fe65.11','DELTACORTRIL GASTRO-RESISTANT 2.5mg tablets'),('prednisolone-oral',1,'fe65.','DELTACORTRIL GASTRO-RESISTANT 2.5mg tablets'),('prednisolone-oral',1,'fe64.00','*DELTA-PHORICOL 5mg tablets'),('prednisolone-oral',1,'fe64.','*DELTA-PHORICOL 5mg tablets'),('prednisolone-oral',1,'j45..00','PREDNISOLONE SOD PHOS [MUSC-SK]'),('prednisolone-oral',1,'j45..','PREDNISOLONE SOD PHOS [MUSC-SK]'),('prednisolone-oral',1,'j44..00','PREDNISOLONE ACETATE [MUSCULOSKELETAL USE]'),('prednisolone-oral',1,'j44..','PREDNISOLONE ACETATE [MUSCULOSKELETAL USE]');
INSERT INTO #codesreadv2
VALUES ('prednisone',1,'fe7..00','PREDNISONE'),('prednisone',1,'fe7..','PREDNISONE'),('prednisone',1,'fe7z.00','PREDNISONE 1mg m/r tablets'),('prednisone',1,'fe7z.','PREDNISONE 1mg m/r tablets'),('prednisone',1,'fe7y.00','PREDNISONE 2mg m/r tablets'),('prednisone',1,'fe7y.','PREDNISONE 2mg m/r tablets'),('prednisone',1,'fe7x.00','PREDNISONE 5mg m/r tablets'),('prednisone',1,'fe7x.','PREDNISONE 5mg m/r tablets'),('prednisone',1,'fe72.00','*PREDNISONE 5mg tablets'),('prednisone',1,'fe72.','*PREDNISONE 5mg tablets'),('prednisone',1,'fe71.00','*PREDNISONE 1mg tablets'),('prednisone',1,'fe71.','*PREDNISONE 1mg tablets'),('prednisone',1,'fe79.00','LODOTRA 1mg m/r tablets'),('prednisone',1,'fe79.','LODOTRA 1mg m/r tablets'),('prednisone',1,'fe78.00','LODOTRA 5mg m/r tablets'),('prednisone',1,'fe78.','LODOTRA 5mg m/r tablets'),('prednisone',1,'fe77.00','LODOTRA 2mg m/r tablets'),('prednisone',1,'fe77.','LODOTRA 2mg m/r tablets'),('prednisone',1,'fe75.00','*ECONOSONE 5mg tablets'),('prednisone',1,'fe75.','*ECONOSONE 5mg tablets'),('prednisone',1,'fe74.00','*ECONOSONE 1mg tablets'),('prednisone',1,'fe74.','*ECONOSONE 1mg tablets'),('prednisone',1,'fe73.00','*DECORTISYL 5mg tablets'),('prednisone',1,'fe73.','*DECORTISYL 5mg tablets'),('prednisone',1,'fe76.00','Prednisone 20mg tablet'),('prednisone',1,'fe76.','Prednisone 20mg tablet');
INSERT INTO #codesreadv2
VALUES ('sulfasalazine',1,'aa6..11','SULPHASALAZINE [GASTRO-INTESTINAL USE]'),('sulfasalazine',1,'aa6..','SULPHASALAZINE [GASTRO-INTESTINAL USE]'),('sulfasalazine',1,'aa6..00','SULFASALAZINE [GASTRO-INTESTINAL USE]'),('sulfasalazine',1,'aa6..','SULFASALAZINE [GASTRO-INTESTINAL USE]'),('sulfasalazine',1,'aa6t.00','SULFASALAZINE 250mg/5mL sugar free suspension'),('sulfasalazine',1,'aa6t.','SULFASALAZINE 250mg/5mL sugar free suspension'),('sulfasalazine',1,'aa6z.11','*SULPHASALAZINE 3g/100mL enema'),('sulfasalazine',1,'aa6z.','*SULPHASALAZINE 3g/100mL enema'),('sulfasalazine',1,'aa6z.00','*SULFASALAZINE 3g/100mL enema'),('sulfasalazine',1,'aa6z.','*SULFASALAZINE 3g/100mL enema'),('sulfasalazine',1,'aa6y.11','SULPHASALAZINE 500mg suppositories'),('sulfasalazine',1,'aa6y.','SULPHASALAZINE 500mg suppositories'),('sulfasalazine',1,'aa6y.00','SULFASALAZINE 500mg suppositories'),('sulfasalazine',1,'aa6y.','SULFASALAZINE 500mg suppositories'),('sulfasalazine',1,'aa6v.11','SULPHASALAZINE 500mg tablets'),('sulfasalazine',1,'aa6v.','SULPHASALAZINE 500mg tablets'),('sulfasalazine',1,'aa6v.00','SULFASALAZINE 500mg tablets'),('sulfasalazine',1,'aa6v.','SULFASALAZINE 500mg tablets'),('sulfasalazine',1,'aa6u.11','SULPHASALAZINE 250mg/5mL suspension'),('sulfasalazine',1,'aa6u.','SULPHASALAZINE 250mg/5mL suspension'),('sulfasalazine',1,'aa6u.00','SULFASALAZINE 250mg/5mL suspension'),('sulfasalazine',1,'aa6u.','SULFASALAZINE 250mg/5mL suspension'),('sulfasalazine',1,'aa67.00','*UCINE 500mg tablets'),('sulfasalazine',1,'aa67.','*UCINE 500mg tablets'),('sulfasalazine',1,'aa66.11','SULPHASALAZINE 500mg e/c tablets'),('sulfasalazine',1,'aa66.','SULPHASALAZINE 500mg e/c tablets'),('sulfasalazine',1,'aa66.00','SULFASALAZINE 500mg e/c tablets'),('sulfasalazine',1,'aa66.','SULFASALAZINE 500mg e/c tablets'),('sulfasalazine',1,'aa65.00','SALAZOPYRIN 250mg/5mL suspension'),('sulfasalazine',1,'aa65.','SALAZOPYRIN 250mg/5mL suspension'),('sulfasalazine',1,'aa64.00','*SALAZOPYRIN 3g/100mL enema'),('sulfasalazine',1,'aa64.','*SALAZOPYRIN 3g/100mL enema'),('sulfasalazine',1,'aa63.00','SALAZOPYRIN 500mg suppositories'),('sulfasalazine',1,'aa63.','SALAZOPYRIN 500mg suppositories'),('sulfasalazine',1,'aa62.00','SALAZOPYRIN-EN 500mg e/c tablets'),('sulfasalazine',1,'aa62.','SALAZOPYRIN-EN 500mg e/c tablets'),('sulfasalazine',1,'aa61.00','SALAZOPYRIN 500mg tablets'),('sulfasalazine',1,'aa61.','SALAZOPYRIN 500mg tablets'),('sulfasalazine',1,'j55..11','SULPHASALAZINE [MUSCULO-SKELETAL USE]'),('sulfasalazine',1,'j55..','SULPHASALAZINE [MUSCULO-SKELETAL USE]'),('sulfasalazine',1,'j55..00','SULFASALAZINE [MUSCULOSKELETAL USE]'),('sulfasalazine',1,'j55..','SULFASALAZINE [MUSCULOSKELETAL USE]'),('sulfasalazine',1,'j55z.11','SULPHASALAZINE 500mg e/c tablets'),('sulfasalazine',1,'j55z.','SULPHASALAZINE 500mg e/c tablets'),('sulfasalazine',1,'j55z.00','SULFASALAZINE 500mg e/c tablets'),('sulfasalazine',1,'j55z.','SULFASALAZINE 500mg e/c tablets'),('sulfasalazine',1,'j552.00','SULAZINE EC 500mg e/c tablets'),('sulfasalazine',1,'j552.','SULAZINE EC 500mg e/c tablets'),('sulfasalazine',1,'j551.00','SALAZOPYRIN EN 500mg e/c tablets'),('sulfasalazine',1,'j551.','SALAZOPYRIN EN 500mg e/c tablets')

INSERT INTO #AllCodes
SELECT [concept], [version], [code] from #codesreadv2;

IF OBJECT_ID('tempdb..#codesctv3') IS NOT NULL DROP TABLE #codesctv3;
CREATE TABLE #codesctv3 (
  [concept] [varchar](255) NOT NULL,
  [version] INT NOT NULL,
	[code] [varchar](20) COLLATE Latin1_General_CS_AS NOT NULL,
	[description] [varchar](255) NULL
) ON [PRIMARY];

INSERT INTO #codesctv3
VALUES ('hydroxychloroquine',1,'x01J9','Hydroxychloroquine'),('hydroxychloroquine',1,'j54..','HYDROXYCHLOROQUINE SULFATE [ANTI-RHEUMATIC]'),('hydroxychloroquine',1,'j54..','HYDROXYCHLOROQUINE SULPHATE [ANTI-RHEUMATIC]'),('hydroxychloroquine',1,'j54z.','HYDROXYCHLOROQUINE SULFATE 200mg tablets'),('hydroxychloroquine',1,'j54z.','HYDROXYCHLOROQUINE SULPHATE 200mg tablets'),('hydroxychloroquine',1,'j541.','PLAQUENIL 200mg tablets'),('hydroxychloroquine',1,'j542.','QUINORIC 200mg tablets'),('hydroxychloroquine',1,'ej3..','HYDROXYCHLOROQUINE SULFATE [ANTI MALARIAL]'),('hydroxychloroquine',1,'ej3..','HYDROXYCHLOROQUINE SULPHATE [ANTI MALARIAL]'),('hydroxychloroquine',1,'ej3z.','HYDROCHLOROQUINE SULPHATE 200mg tablets'),('hydroxychloroquine',1,'ej31.','*PLAQUENIL 200mg tablets');
INSERT INTO #codesctv3
VALUES ('leflunomide',1,'j59..','LEFLUNOMIDE'),('leflunomide',1,'j59z.','LEFLUNOMIDE 100mg tablets'),('leflunomide',1,'j59y.','LEFLUNOMIDE 20mg tablets'),('leflunomide',1,'j59x.','LEFLUNOMIDE 10mg tablets'),('leflunomide',1,'j59w.','LEFLUNOMIDE 15mg tablets'),('leflunomide',1,'j593.','ARAVA 100mg tablets'),('leflunomide',1,'j592.','ARAVA 20mg tablets'),('leflunomide',1,'j591.','ARAVA 10mg tablets');
INSERT INTO #codesctv3
VALUES ('methotrexate',1,'h34..','Methotrexate'),('methotrexate',1,'h341.','Methotrexate 2.5mg tablet'),('methotrexate',1,'h342.','Methotrexate 10mg tablet'),('methotrexate',1,'h343.','Methotrexate 2.5mg/1mL injection solution'),('methotrexate',1,'h344.','Methotrexate 5mg/2mL injection'),('methotrexate',1,'h345.','Methotrexate 25mg/1mL injection'),('methotrexate',1,'h346.','Methotrexate 50mg/2mL injection'),('methotrexate',1,'h347.','Methotrexate 100mg/4mL injection'),('methotrexate',1,'h348.','Methotrexate 200mg/8mL injection'),('methotrexate',1,'h349.','Methotrexate 500mg/20mL injection'),('methotrexate',1,'h34A.','METHOTREXATE 15mg/1.5mL solution for injection p/f syringe'),('methotrexate',1,'h34a.','Methotrexate 1g/40mL injection'),('methotrexate',1,'h34B.','METHOTREXATE 20mg/2mL solution for injection p/f syringe'),('methotrexate',1,'h34b.','Methotrexate 5g/200mL injection'),('methotrexate',1,'h34C.','METHOTREXATE 25mg/2.5mL solution for injection p/f syringe'),('methotrexate',1,'h34c.','Methotrexate 500mg injection (pdr for recon)'),('methotrexate',1,'h34d.','Emtexate 10mg tablet'),('methotrexate',1,'h34D.','METOJECT 7.5mg/0.75mL solution for injection p/f syringe'),('methotrexate',1,'h34e.','Emtexate 5mg/2mL injection solution'),('methotrexate',1,'h34E.','METOJECT 10mg/1mL solution for injection prefilled syringe'),('methotrexate',1,'h34f.','Emtexate 50mg/2mL injection solution'),('methotrexate',1,'h34F.','METOJECT 15mg/1.5mL solution for injection prefilled syringe'),('methotrexate',1,'h34g.','Emtexate 250mg/10mL injection solution'),('methotrexate',1,'h34G.','METOJECT 20mg/2mL solution for injection prefilled syringe'),('methotrexate',1,'h34h.','Emtexate 500mg/20mL injection solution'),('methotrexate',1,'h34H.','METOJECT 25mg/2.5mL solution for injection prefilled syringe'),('methotrexate',1,'h34i.','Emtexate 1g/40mL injection solution'),('methotrexate',1,'h34j.','Emtexate 5g/200mL injection solution'),('methotrexate',1,'h34k.','Emtexate 1g/10mL injection solution'),('methotrexate',1,'h34l.','Emtexate 5g/50mL injection solution'),('methotrexate',1,'h34L.','METOJECT 7.5mg/0.15mL solution for injection pfs'),('methotrexate',1,'h34m.','Emtexate 0.5g injection (pdr for recon)'),('methotrexate',1,'h34M.','METHOTREXATE 7.5mg/0.15mL solution for injection pfs'),('methotrexate',1,'h34n.','Emtexate 1g injection (pdr for recon)'),('methotrexate',1,'h34N.','METOJECT 10mg/0.2mL solution for injection prefilled syringe'),('methotrexate',1,'h34o.','Emtexate 5g injection (pdr for recon)'),('methotrexate',1,'h34O.','METHOTREXATE 10mg/0.2mL solution for injection pfs'),('methotrexate',1,'h34p.','Maxtrex 2.5mg tablet'),('methotrexate',1,'h34P.','METOJECT 15mg/0.3mL solution for injection prefilled syringe'),('methotrexate',1,'h34q.','Maxtrex 10mg tablet'),('methotrexate',1,'h34Q.','METHOTREXATE 15mg/0.3mL solution for injection pfs'),('methotrexate',1,'h34r.','Maxtrex 5mg/2mL injection solution'),('methotrexate',1,'h34R.','METOJECT 20mg/0.4mL solution for injection prefilled syringe'),('methotrexate',1,'h34s.','Maxtrex 50mg/2mL injection solution'),('methotrexate',1,'h34S.','METHOTREXATE 20mg/0.4mL solution for injection pfs'),('methotrexate',1,'h34t.','Maxtrex 500mg/20mL injection solution'),('methotrexate',1,'h34T.','METOJECT 25mg/0.5mL solution for injection prefilled syringe'),('methotrexate',1,'h34u.','Maxtrex 1g/40mL injection solution'),('methotrexate',1,'h34U.','METHOTREXATE 25mg/0.5mL solution for injection pfs'),('methotrexate',1,'h34v.','Maxtrex 5g/200mL injection solution'),('methotrexate',1,'h34V.','METOJECT 30mg/0.6mL solution for injection prefilled syringe'),('methotrexate',1,'h34w.','Methotrexate 1g/10mL injection'),('methotrexate',1,'h34W.','METHOTREXATE 30mg/0.6mL solution for injection pfs'),('methotrexate',1,'h34X.','EBETREX 7.5mg/0.75mL soln for injection prefilled syringe'),('methotrexate',1,'h34x.','Methotrexate 5g/50mL injection'),('methotrexate',1,'h34Y.','EBETREX 10mg/1mL solution for injection prefilled syringe'),('methotrexate',1,'h34y.','METHOTREXATE 7.5mg/0.75mL solution for injection p/f syringe'),('methotrexate',1,'h34Z.','EBETREX 15mg/1.5mL solution for injection prefilled syringe'),('methotrexate',1,'h34z.','METHOTREXATE 10mg/1mL solution for injection p/f syringe'),('methotrexate',1,'h3G..%','METHOTREXATE(2)'),('methotrexate',1,'h3G1.','EBETREX 20mg/1mL solution for injection prefilled syringe'),('methotrexate',1,'h3G2.','EBETREX 25mg/1.25mL solution for injection prefilled syringe'),('methotrexate',1,'h3G3.','EBETREX 30mg/1.5mL solution for injection prefilled syringe'),('methotrexate',1,'h3G4.','METHOTREXATE 20mg/1mL solution for injection p/f syringe'),('methotrexate',1,'h3G5.','METHOTREXATE 25mg/1.25mL solution for injection p/f syringe'),('methotrexate',1,'h3G6.','METHOTREXATE 30mg/1.5mL solution for injection p/f syringe'),('methotrexate',1,'h3G7.','METOJECT 12.5mg/0.25mL soln for injection prefilled syringe'),('methotrexate',1,'h3G8.','METHOTREXATE 12.5mg/0.25mL solution for injection pfs'),('methotrexate',1,'h3G9.','METOJECT 17.5mg/0.35mL soln for injection prefilled syringe'),('methotrexate',1,'h3GA.','METHOTREXATE 17.5mg/0.35mL solution for injection pfs'),('methotrexate',1,'h3GB.','METOJECT 22.5mg/0.45mL soln for injection prefilled syringe'),('methotrexate',1,'h3GC.','METHOTREXATE 22.5mg/0.45mL solution for injection pfs'),('methotrexate',1,'h3GD.','METOJECT 27.5mg/0.55mL soln for injection prefilled syringe'),('methotrexate',1,'h3GE.','METHOTREXATE 27.5mg/0.55mL solution for injection pfs'),('methotrexate',1,'h3GF.','METOJECT PEN 7.5mg/0.15mL soln for injection prefilled pen'),('methotrexate',1,'h3GG.','METHOTREXATE 7.5mg/0.15mL soln for injection prefilled pen'),('methotrexate',1,'h3GH.','METOJECT PEN 10mg/0.2mL solution for injection prefilled pen'),('methotrexate',1,'h3GI.','METHOTREXATE 10mg/0.2mL solution for injection prefilled pen'),('methotrexate',1,'h3GJ.','METOJECT PEN 12.5mg/0.25mL soln for injection prefilled pen'),('methotrexate',1,'h3GK.','METHOTREXATE 12.5mg/0.25mL soln for injection prefilled pen'),('methotrexate',1,'h3GL.','METOJECT PEN 15mg/0.3mL solution for injection prefilled pen'),('methotrexate',1,'h3GM.','METHOTREXATE 15mg/0.3mL solution for injection prefilled pen'),('methotrexate',1,'h3GN.','METOJECT PEN 17.5mg/0.35mL soln for injection prefilled pen'),('methotrexate',1,'h3GO.','METHOTREXATE 17.5mg/0.35mL soln for injection prefilled pen'),('methotrexate',1,'h3GP.','METOJECT PEN 20mg/0.4mL solution for injection prefilled pen'),('methotrexate',1,'h3GQ.','METHOTREXATE 20mg/0.4mL solution for injection prefilled pen'),('methotrexate',1,'h3GR.','METOJECT PEN 22.5mg/0.45mL soln for injection prefilled pen'),('methotrexate',1,'h3GS.','METHOTREXATE 22.5mg/0.45mL soln for injection prefilled pen'),('methotrexate',1,'h3GT.','METOJECT PEN 25mg/0.5mL solution for injection prefilled pen'),('methotrexate',1,'h3GU.','METHOTREXATE 25mg/0.5mL solution for injection prefilled pen'),('methotrexate',1,'h3GV.','METOJECT PEN 27.5mg/0.55mL soln for injection prefilled pen'),('methotrexate',1,'h3GW.','METHOTREXATE 27.5mg/0.55mL soln for injection prefilled pen'),('methotrexate',1,'h3GX.','METOJECT PEN 30mg/0.6mL solution for injection prefilled pen'),('methotrexate',1,'h3GY.','METHOTREXATE 30mg/0.6mL solution for injection prefilled pen'),('methotrexate',1,'h3GZ.','METHOTREXATE 2mg/mL oral solution'),('methotrexate',1,'x00Oq','Methotrexate 375mg/30mL infusion'),('methotrexate',1,'x00Or','Methotrexate 750mg/60mL infusion');
INSERT INTO #codesctv3
VALUES ('prednisolone-oral',1,'x00yP','Oral prednisolone'),('prednisolone-oral',1,'fe6..','PREDNISOLONE [ENDOCRINE]'),('prednisolone-oral',1,'fe6z.','PREDNISOLONE 25mg tablets'),('prednisolone-oral',1,'fe6w.','*PREDNISOLONE 2.5mg tablets'),('prednisolone-oral',1,'fe6v.','PREDNISOLONE 2.5mg tablets'),('prednisolone-oral',1,'fe6t.','PREDNISOLONE 10mg tablets'),('prednisolone-oral',1,'fe6s.','PREDNISOLONE 20mg tablets'),('prednisolone-oral',1,'fe6k.','PREDNISOLONE 50mg tablets'),('prednisolone-oral',1,'fe6j.','PREDNISOLONE 5mg soluble tablets'),('prednisolone-oral',1,'fe6i.','PREDNISOLONE 5mg e/c tablets'),('prednisolone-oral',1,'fe6h.','PREDNISOLONE 2.5mg e/c tablets'),('prednisolone-oral',1,'fe62.','PREDNISOLONE 5mg tablets'),('prednisolone-oral',1,'fe61.','PREDNISOLONE 1mg tablets'),('prednisolone-oral',1,'fe6r.','PEVANTI 20mg tablets'),('prednisolone-oral',1,'fe6q.','PEVANTI 10mg tablets'),('prednisolone-oral',1,'fe6p.','PEVANTI 5mg tablets'),('prednisolone-oral',1,'fe6o.','PEVANTI 25mg tablets'),('prednisolone-oral',1,'fe6n.','PEVANTI 2.5mg tablets'),('prednisolone-oral',1,'fe6m.','DILACORT 2.5mg gastro-resistant tablets'),('prednisolone-oral',1,'fe6l.','DILACORT 5mg gastro-resistant tablets'),('prednisolone-oral',1,'fe6g.','*SINTISONE 5mg tablets'),('prednisolone-oral',1,'fe6f.','*PREDNESOL 5mg tablets'),('prednisolone-oral',1,'fe6e.','PRECORTISYL FORTE 25mg tablets'),('prednisolone-oral',1,'fe6d.','*PRECORTISYL 5mg tablets'),('prednisolone-oral',1,'fe6c.','*PRECORTISYL 1mg tablets'),('prednisolone-oral',1,'fe6a.','*DELTASTAB 5mg tablets'),('prednisolone-oral',1,'fe69.','*DELTASTAB 1mg tablets'),('prednisolone-oral',1,'fe68.','*DELTALONE 5mg tablets'),('prednisolone-oral',1,'fe67.','*DELTALONE 1mg tablets'),('prednisolone-oral',1,'fe66.','DELTACORTRIL ENTERIC 5mg tablets'),('prednisolone-oral',1,'fe66.','DELTACORTRIL GASTRO-RESISTANT 5mg tablets'),('prednisolone-oral',1,'fe65.','DELTACORTRIL ENTERIC 2.5mg tablets'),('prednisolone-oral',1,'fe65.','DELTACORTRIL GASTRO-RESISTANT 2.5mg tablets'),('prednisolone-oral',1,'fe64.','*DELTA-PHORICOL 5mg tablets'),('prednisolone-oral',1,'j45..','PREDNISOLONE SOD PHOS [MUSC-SK]'),('prednisolone-oral',1,'j44..','PREDNISOLONE ACETATE [MUSCULOSKELETAL USE]');
INSERT INTO #codesctv3
VALUES ('prednisone',1,'fe7..','PREDNISONE'),('prednisone',1,'fe7z.','PREDNISONE 1mg m/r tablets'),('prednisone',1,'fe7y.','PREDNISONE 2mg m/r tablets'),('prednisone',1,'fe7x.','PREDNISONE 5mg m/r tablets'),('prednisone',1,'fe72.','*PREDNISONE 5mg tablets'),('prednisone',1,'fe71.','*PREDNISONE 1mg tablets'),('prednisone',1,'fe79.','LODOTRA 1mg m/r tablets'),('prednisone',1,'fe78.','LODOTRA 5mg m/r tablets'),('prednisone',1,'fe77.','LODOTRA 2mg m/r tablets'),('prednisone',1,'fe75.','*ECONOSONE 5mg tablets'),('prednisone',1,'fe74.','*ECONOSONE 1mg tablets'),('prednisone',1,'fe73.','*DECORTISYL 5mg tablets'),('prednisone',1,'fe76.','Prednisone 20mg tablet'),('prednisone',1,'x02Ys','Decortisyl');
INSERT INTO #codesctv3
VALUES ('sulfasalazine',1,'x019y','Oral sulphasalazine'),('sulfasalazine',1,'x019z','Rectal sulphasalazine'),('sulfasalazine',1,'aa6..','SULPHASALAZINE [GASTRO-INTESTINAL USE]'),('sulfasalazine',1,'aa6..','SULFASALAZINE [GASTRO-INTESTINAL USE]'),('sulfasalazine',1,'aa6t.','SULFASALAZINE 250mg/5mL sugar free suspension'),('sulfasalazine',1,'aa6z.','*SULPHASALAZINE 3g/100mL enema'),('sulfasalazine',1,'aa6z.','*SULFASALAZINE 3g/100mL enema'),('sulfasalazine',1,'aa6y.','SULPHASALAZINE 500mg suppositories'),('sulfasalazine',1,'aa6y.','SULFASALAZINE 500mg suppositories'),('sulfasalazine',1,'aa6v.','SULPHASALAZINE 500mg tablets'),('sulfasalazine',1,'aa6v.','SULFASALAZINE 500mg tablets'),('sulfasalazine',1,'aa6u.','SULPHASALAZINE 250mg/5mL suspension'),('sulfasalazine',1,'aa6u.','SULFASALAZINE 250mg/5mL suspension'),('sulfasalazine',1,'aa67.','*UCINE 500mg tablets'),('sulfasalazine',1,'aa66.','SULPHASALAZINE 500mg e/c tablets'),('sulfasalazine',1,'aa66.','SULFASALAZINE 500mg e/c tablets'),('sulfasalazine',1,'aa65.','SALAZOPYRIN 250mg/5mL suspension'),('sulfasalazine',1,'aa64.','*SALAZOPYRIN 3g/100mL enema'),('sulfasalazine',1,'aa63.','SALAZOPYRIN 500mg suppositories'),('sulfasalazine',1,'aa62.','SALAZOPYRIN-EN 500mg e/c tablets'),('sulfasalazine',1,'aa61.','SALAZOPYRIN 500mg tablets'),('sulfasalazine',1,'j55..','SULPHASALAZINE [MUSCULO-SKELETAL USE]'),('sulfasalazine',1,'j55..','SULFASALAZINE [MUSCULOSKELETAL USE]'),('sulfasalazine',1,'j55z.','SULPHASALAZINE 500mg e/c tablets'),('sulfasalazine',1,'j55z.','SULFASALAZINE 500mg e/c tablets'),('sulfasalazine',1,'j552.','SULAZINE EC 500mg e/c tablets'),('sulfasalazine',1,'j551.','SALAZOPYRIN EN 500mg e/c tablets')

INSERT INTO #AllCodes
SELECT [concept], [version], [code] from #codesctv3;

IF OBJECT_ID('tempdb..#codessnomed') IS NOT NULL DROP TABLE #codessnomed;
CREATE TABLE #codessnomed (
  [concept] [varchar](255) NOT NULL,
  [version] INT NOT NULL,
	[code] [varchar](20) COLLATE Latin1_General_CS_AS NOT NULL,
	[description] [varchar](255) NULL
) ON [PRIMARY];

INSERT INTO #codessnomed
VALUES ('hydroxychloroquine',1,'83490000','Hydroxychloroquine product'),('hydroxychloroquine',1,'330037008','Product containing precisely hydroxychloroquine sulfate 200 milligram/1 each conventional release oral tablet'),('hydroxychloroquine',1,'714618006','Hydroxychloroquine in oral dosage form'),('hydroxychloroquine',1,'13502005','Hydroxychloroquine sulfate (substance)'),('hydroxychloroquine',1,'373540008','Hydroxychloroquine');
INSERT INTO #codessnomed
VALUES ('leflunomide',1,'109143003','Leflunomide product'),('leflunomide',1,'330057007','Product containing precisely leflunomide 10 milligram/1 each conventional release oral tablet'),('leflunomide',1,'330058002','Product containing precisely leflunomide 20 milligram/1 each conventional release oral tablet'),('leflunomide',1,'330059005','Product containing precisely leflunomide 100 milligram/1 each conventional release oral tablet'),('leflunomide',1,'386981009','Leflunomide');
INSERT INTO #codessnomed
VALUES ('methotrexate',1,'19954111000001103','Ebetrex 10mg/1ml solution for injection pre-filled syringes (Sandoz Ltd)'),('methotrexate',1,'19954411000001108','Ebetrex 15mg/1.5ml solution for injection pre-filled syringes (Sandoz Ltd)'),('methotrexate',1,'19956011000001109','Ebetrex 20mg/1ml solution for injection pre-filled syringes (Sandoz Ltd)'),('methotrexate',1,'19955711000001103','Ebetrex 25mg/1.25ml solution for injection pre-filled syringes (Sandoz Ltd)'),('methotrexate',1,'19972411000001103','Ebetrex 30mg/1.5ml solution for injection pre-filled syringes (Sandoz Ltd)'),('methotrexate',1,'19953911000001102','Ebetrex 7.5mg/0.75ml solution for injection pre-filled syringes (Sandoz Ltd)'),('methotrexate',1,'34871011000001105','Jylamvo 2mg/ml oral solution (Intrapharm Laboratories Ltd)'),('methotrexate',1,'322011000001106','Maxtrex 10mg tablets (Pfizer Ltd)'),('methotrexate',1,'644711000001108','Maxtrex 2.5mg tablets (Pfizer Ltd)'),('methotrexate',1,'34776911000001102','Methofill 10mg/0.2ml solution for injection pre-filled injector (Accord Healthcare Ltd)'),('methotrexate',1,'34777311000001100','Methofill 12.5mg/0.25ml solution for injection pre-filled injector (Accord Healthcare Ltd)'),('methotrexate',1,'34777111000001102','Methofill 15mg/0.3ml solution for injection pre-filled injector (Accord Healthcare Ltd)'),('methotrexate',1,'34777611000001105','Methofill 17.5mg/0.35ml solution for injection pre-filled injector (Accord Healthcare Ltd)'),('methotrexate',1,'34777811000001109','Methofill 20mg/0.4ml solution for injection pre-filled injector (Accord Healthcare Ltd)'),('methotrexate',1,'34778011000001102','Methofill 22.5mg/0.45ml solution for injection pre-filled injector (Accord Healthcare Ltd)'),('methotrexate',1,'34778211000001107','Methofill 25mg/0.5ml solution for injection pre-filled injector (Accord Healthcare Ltd)'),('methotrexate',1,'34778411000001106','Methofill 27.5mg/0.55ml solution for injection pre-filled injector (Accord Healthcare Ltd)'),('methotrexate',1,'34778611000001109','Methofill 30mg/0.6ml solution for injection pre-filled injector (Accord Healthcare Ltd)'),('methotrexate',1,'34776411000001105','Methofill 7.5mg/0.15ml solution for injection pre-filled injector (Accord Healthcare Ltd)'),('methotrexate',1,'68887009','Methotrexate'),('methotrexate',1,'769892005','Methotrexate (as methotrexate sodium) 1 g/10 mL solution for injection vial'),('methotrexate',1,'769898009','Methotrexate (as methotrexate sodium) 1 g/40 mL solution for injection vial'),('methotrexate',1,'769899001','Methotrexate (as methotrexate sodium) 200 mg/8 mL solution for injection vial'),('methotrexate',1,'769895007','Methotrexate (as methotrexate sodium) 5 g/200 mL solution for injection vial'),('methotrexate',1,'769893000','Methotrexate (as methotrexate sodium) 5 g/50 mL solution for injection vial'),('methotrexate',1,'769894006','Methotrexate (as methotrexate sodium) 5 mg/2 mL solution for injection vial'),('methotrexate',1,'769897004','Methotrexate (as methotrexate sodium) 50 mg/2 mL solution for injection vial'),('methotrexate',1,'769896008','Methotrexate (as methotrexate sodium) 500 mg/20 mL solution for injection vial'),('methotrexate',1,'326875008','Methotrexate 10mg tablets'),('methotrexate',1,'928011000001103','Methotrexate 10mg tablets (A A H Pharmaceuticals Ltd)'),('methotrexate',1,'136411000001105','Methotrexate 10mg tablets (Alliance Healthcare (Distribution) Ltd)'),('methotrexate',1,'24381411000001107','Methotrexate 10mg tablets (DE Pharmaceuticals)'),('methotrexate',1,'24135711000001100','Methotrexate 10mg tablets (Morningside Healthcare Ltd)'),('methotrexate',1,'14963911000001107','Methotrexate 10mg tablets (Orion Pharma (UK) Ltd)'),('methotrexate',1,'191111000001100','Methotrexate 10mg tablets (Pfizer Ltd)'),('methotrexate',1,'20310811000001101','Methotrexate 10mg tablets (Sandoz Ltd)'),('methotrexate',1,'15109411000001107','Methotrexate 10mg tablets (Sigma Pharmaceuticals Plc)'),('methotrexate',1,'22222111000001103','Methotrexate 10mg tablets (Teva UK Ltd)'),('methotrexate',1,'21796511000001106','Methotrexate 10mg tablets (Waymade Healthcare Plc)'),('methotrexate',1,'11026611000001103','Methotrexate 10mg tablets (Wockhardt UK Ltd)'),('methotrexate',1,'24594311000001100','Methotrexate 10mg/0.2ml solution for injection pre-filled disposable devices'),('methotrexate',1,'15517911000001104','Methotrexate 10mg/0.2ml solution for injection pre-filled syringes'),('methotrexate',1,'34167711000001101','Methotrexate 10mg/0.4ml solution for injection pre-filled disposable devices'),('methotrexate',1,'9468211000001108','Methotrexate 10mg/0.4ml solution for injection pre-filled syringes'),('methotrexate',1,'9455911000001104','Methotrexate 10mg/0.4ml solution for injection pre-filled syringes (Special Order)'),('methotrexate',1,'10675611000001107','Methotrexate 10mg/1ml solution for injection pre-filled syringes'),('methotrexate',1,'8664911000001105','Methotrexate 10mg/5ml oral solution'),('methotrexate',1,'8618111000001102','Methotrexate 10mg/5ml oral solution (Special Order)'),('methotrexate',1,'8665011000001105','Methotrexate 10mg/5ml oral suspension'),('methotrexate',1,'8618811000001109','Methotrexate 10mg/5ml oral suspension (Special Order)'),('methotrexate',1,'24594411000001107','Methotrexate 12.5mg/0.25ml solution for injection pre-filled disposable devices'),('methotrexate',1,'19231311000001104','Methotrexate 12.5mg/0.25ml solution for injection pre-filled syringes'),('methotrexate',1,'34167811000001109','Methotrexate 12.5mg/0.5ml solution for injection pre-filled disposable devices'),('methotrexate',1,'9468311000001100','Methotrexate 12.5mg/0.5ml solution for injection pre-filled syringes'),('methotrexate',1,'9455211000001108','Methotrexate 12.5mg/0.5ml solution for injection pre-filled syringes (Special Order)'),('methotrexate',1,'8665111000001106','Methotrexate 12.5mg/5ml oral solution'),('methotrexate',1,'8619311000001106','Methotrexate 12.5mg/5ml oral solution (Special Order)'),('methotrexate',1,'8665211000001100','Methotrexate 12.5mg/5ml oral suspension'),('methotrexate',1,'8619611000001101','Methotrexate 12.5mg/5ml oral suspension (Special Order)'),('methotrexate',1,'12813911000001109','Methotrexate 12mg/5ml oral solution'),('methotrexate',1,'12794011000001105','Methotrexate 12mg/5ml oral solution (Special Order)'),('methotrexate',1,'12814011000001107','Methotrexate 12mg/5ml oral suspension'),('methotrexate',1,'12793711000001105','Methotrexate 12mg/5ml oral suspension (Special Order)'),('methotrexate',1,'374444008','Methotrexate 15 mg oral tablet'),('methotrexate',1,'24594511000001106','Methotrexate 15mg/0.3ml solution for injection pre-filled disposable devices'),('methotrexate',1,'15518011000001102','Methotrexate 15mg/0.3ml solution for injection pre-filled syringes'),('methotrexate',1,'34167911000001104','Methotrexate 15mg/0.6ml solution for injection pre-filled disposable devices'),('methotrexate',1,'9468411000001107','Methotrexate 15mg/0.6ml solution for injection pre-filled syringes'),('methotrexate',1,'9454211000001107','Methotrexate 15mg/0.6ml solution for injection pre-filled syringes (Special Order)'),('methotrexate',1,'10675711000001103','Methotrexate 15mg/1.5ml solution for injection pre-filled syringes'),('methotrexate',1,'8665311000001108','Methotrexate 15mg/5ml oral solution'),('methotrexate',1,'8619911000001107','Methotrexate 15mg/5ml oral solution (Special Order)'),('methotrexate',1,'8665411000001101','Methotrexate 15mg/5ml oral suspension'),('methotrexate',1,'8620311000001107','Methotrexate 15mg/5ml oral suspension (Special Order)'),('methotrexate',1,'24594611000001105','Methotrexate 17.5mg/0.35ml solution for injection pre-filled disposable devices'),('methotrexate',1,'19231411000001106','Methotrexate 17.5mg/0.35ml solution for injection pre-filled syringes'),('methotrexate',1,'34168011000001102','Methotrexate 17.5mg/0.7ml solution for injection pre-filled disposable devices'),('methotrexate',1,'9468511000001106','Methotrexate 17.5mg/0.7ml solution for injection pre-filled syringes'),('methotrexate',1,'9453611000001106','Methotrexate 17.5mg/0.7ml solution for injection pre-filled syringes (Special Order)'),('methotrexate',1,'12814111000001108','Methotrexate 17.5mg/5ml oral solution'),('methotrexate',1,'12794611000001103','Methotrexate 17.5mg/5ml oral solution (Special Order)'),('methotrexate',1,'12814211000001102','Methotrexate 17.5mg/5ml oral suspension'),('methotrexate',1,'12794311000001108','Methotrexate 17.5mg/5ml oral suspension (Special Order)'),('methotrexate',1,'12814311000001105','Methotrexate 18mg/5ml oral solution'),('methotrexate',1,'12796111000001104','Methotrexate 18mg/5ml oral solution (Special Order)'),('methotrexate',1,'12814411000001103','Methotrexate 18mg/5ml oral suspension'),('methotrexate',1,'12795811000001103','Methotrexate 18mg/5ml oral suspension (Special Order)'),('methotrexate',1,'36032911000001108','Methotrexate 1g/10ml solution for injection vials'),('methotrexate',1,'3618611000001106','Methotrexate 1g/10ml solution for injection vials (A A H Pharmaceuticals Ltd)'),('methotrexate',1,'3619511000001101','Methotrexate 1g/10ml solution for injection vials (Alliance Healthcare (Distribution) Ltd)'),('methotrexate',1,'3619211000001104','Methotrexate 1g/10ml solution for injection vials (Pfizer Ltd)'),('methotrexate',1,'9561911000001100','Methotrexate 1g/10ml solution for injection vials (Wockhardt UK Ltd)'),('methotrexate',1,'36033011000001100','Methotrexate 1g/40ml solution for injection vials'),('methotrexate',1,'3624511000001106','Methotrexate 1g/40ml solution for injection vials (A A H Pharmaceuticals Ltd)'),('methotrexate',1,'27951711000001108','Methotrexate 1g/40ml solution for injection vials (Accord Healthcare Ltd)'),('methotrexate',1,'3625011000001104','Methotrexate 1g/40ml solution for injection vials (Advanz Pharma)'),('methotrexate',1,'3624711000001101','Methotrexate 1g/40ml solution for injection vials (Alliance Healthcare (Distribution) Ltd)'),
('methotrexate',1,'11091011000001108','Methotrexate 1g/40ml solution for injection vials (Teva UK Ltd)'),('methotrexate',1,'12814511000001104','Methotrexate 1mg/5ml oral solution'),('methotrexate',1,'12796711000001103','Methotrexate 1mg/5ml oral solution (Special Order)'),('methotrexate',1,'12814611000001100','Methotrexate 1mg/5ml oral suspension'),('methotrexate',1,'12796411000001109','Methotrexate 1mg/5ml oral suspension (Special Order)'),('methotrexate',1,'326874007','Methotrexate 2.5mg tablets'),('methotrexate',1,'201811000001107','Methotrexate 2.5mg tablets (A A H Pharmaceuticals Ltd)'),('methotrexate',1,'683611000001105','Methotrexate 2.5mg tablets (Advanz Pharma)'),('methotrexate',1,'706911000001103','Methotrexate 2.5mg tablets (Alliance Healthcare (Distribution) Ltd)'),('methotrexate',1,'34956611000001101','Methotrexate 2.5mg tablets (Almus Pharmaceuticals Ltd)'),('methotrexate',1,'24381611000001105','Methotrexate 2.5mg tablets (DE Pharmaceuticals)'),('methotrexate',1,'167911000001107','Methotrexate 2.5mg tablets (Kent Pharmaceuticals Ltd)'),('methotrexate',1,'24136011000001106','Methotrexate 2.5mg tablets (Morningside Healthcare Ltd)'),('methotrexate',1,'14962511000001107','Methotrexate 2.5mg tablets (Orion Pharma (UK) Ltd)'),('methotrexate',1,'383711000001107','Methotrexate 2.5mg tablets (Pfizer Ltd)'),('methotrexate',1,'20310611000001100','Methotrexate 2.5mg tablets (Sandoz Ltd)'),('methotrexate',1,'14709211000001105','Methotrexate 2.5mg tablets (Sigma Pharmaceuticals Plc)'),('methotrexate',1,'29918911000001101','Methotrexate 2.5mg tablets (Sigma Pharmaceuticals Plc)'),('methotrexate',1,'22222311000001101','Methotrexate 2.5mg tablets (Teva UK Ltd)'),('methotrexate',1,'14946711000001105','Methotrexate 2.5mg tablets (Waymade Healthcare Plc)'),('methotrexate',1,'21796211000001108','Methotrexate 2.5mg tablets (Waymade Healthcare Plc)'),('methotrexate',1,'11026411000001101','Methotrexate 2.5mg tablets (Wockhardt UK Ltd)'),('methotrexate',1,'8665611000001103','Methotrexate 2.5mg/5ml oral solution'),('methotrexate',1,'8622711000001105','Methotrexate 2.5mg/5ml oral solution (Special Order)'),('methotrexate',1,'8665711000001107','Methotrexate 2.5mg/5ml oral suspension'),('methotrexate',1,'8624211000001107','Methotrexate 2.5mg/5ml oral suspension (Special Order)'),('methotrexate',1,'36033111000001104','Methotrexate 200mg/8ml solution for injection vials'),('methotrexate',1,'3621611000001108','Methotrexate 200mg/8ml solution for injection vials (A A H Pharmaceuticals Ltd)'),('methotrexate',1,'3621811000001107','Methotrexate 200mg/8ml solution for injection vials (Advanz Pharma)'),('methotrexate',1,'3622011000001109','Methotrexate 200mg/8ml solution for injection vials (Alliance Healthcare (Distribution) Ltd)'),('methotrexate',1,'24594711000001101','Methotrexate 20mg/0.4ml solution for injection pre-filled disposable devices'),('methotrexate',1,'15518111000001101','Methotrexate 20mg/0.4ml solution for injection pre-filled syringes'),('methotrexate',1,'34168111000001101','Methotrexate 20mg/0.8ml solution for injection pre-filled disposable devices'),('methotrexate',1,'9468611000001105','Methotrexate 20mg/0.8ml solution for injection pre-filled syringes'),('methotrexate',1,'9453111000001103','Methotrexate 20mg/0.8ml solution for injection pre-filled syringes (Special Order)'),('methotrexate',1,'19976011000001106','Methotrexate 20mg/1ml solution for injection pre-filled syringes'),('methotrexate',1,'10675811000001106','Methotrexate 20mg/2ml solution for injection pre-filled syringes'),('methotrexate',1,'12814711000001109','Methotrexate 20mg/5ml oral solution'),('methotrexate',1,'12798611000001108','Methotrexate 20mg/5ml oral solution (Special Order)'),('methotrexate',1,'12814811000001101','Methotrexate 20mg/5ml oral suspension'),('methotrexate',1,'12798211000001106','Methotrexate 20mg/5ml oral suspension (Special Order)'),('methotrexate',1,'24594811000001109','Methotrexate 22.5mg/0.45ml solution for injection pre-filled disposable devices'),('methotrexate',1,'19231511000001105','Methotrexate 22.5mg/0.45ml solution for injection pre-filled syringes'),('methotrexate',1,'34168211000001107','Methotrexate 22.5mg/0.9ml solution for injection pre-filled disposable devices'),('methotrexate',1,'9468711000001101','Methotrexate 22.5mg/0.9ml solution for injection pre-filled syringes'),('methotrexate',1,'9452811000001102','Methotrexate 22.5mg/0.9ml solution for injection pre-filled syringes (Special Order)'),('methotrexate',1,'12814911000001106','Methotrexate 22.5mg/5ml oral solution'),('methotrexate',1,'12800111000001102','Methotrexate 22.5mg/5ml oral solution (Special Order)'),('methotrexate',1,'12815011000001106','Methotrexate 22.5mg/5ml oral suspension'),('methotrexate',1,'12799711000001108','Methotrexate 22.5mg/5ml oral suspension (Special Order)'),('methotrexate',1,'24594911000001104','Methotrexate 25mg/0.5ml solution for injection pre-filled disposable devices'),('methotrexate',1,'15518211000001107','Methotrexate 25mg/0.5ml solution for injection pre-filled syringes'),('methotrexate',1,'19976111000001107','Methotrexate 25mg/1.25ml solution for injection pre-filled syringes'),('methotrexate',1,'34168311000001104','Methotrexate 25mg/1ml solution for injection pre-filled disposable devices'),('methotrexate',1,'9468811000001109','Methotrexate 25mg/1ml solution for injection pre-filled syringes'),('methotrexate',1,'9452311000001106','Methotrexate 25mg/1ml solution for injection pre-filled syringes (Special Order)'),('methotrexate',1,'10675911000001101','Methotrexate 25mg/2.5ml solution for injection pre-filled syringes'),('methotrexate',1,'14967911000001103','Methotrexate 25mg/3ml solution for injection pre-filled syringes'),('methotrexate',1,'14966611000001107','Methotrexate 25mg/3ml solution for injection pre-filled syringes (Special Order)'),('methotrexate',1,'12816911000001103','Methotrexate 25mg/5ml oral solution'),('methotrexate',1,'12800911000001104','Methotrexate 25mg/5ml oral solution (Special Order)'),('methotrexate',1,'12817011000001104','Methotrexate 25mg/5ml oral suspension'),('methotrexate',1,'12800611000001105','Methotrexate 25mg/5ml oral suspension (Special Order)'),('methotrexate',1,'766413008','Methotrexate 25mg/mL conventional release solution for injection'),('methotrexate',1,'24595011000001104','Methotrexate 27.5mg/0.55ml solution for injection pre-filled disposable devices'),('methotrexate',1,'19231611000001109','Methotrexate 27.5mg/0.55ml solution for injection pre-filled syringes'),('methotrexate',1,'9468911000001104','Methotrexate 27.5mg/1.1ml solution for injection pre-filled syringes'),('methotrexate',1,'9451611000001107','Methotrexate 27.5mg/1.1ml solution for injection pre-filled syringes (Special Order)'),('methotrexate',1,'30799911000001104','Methotrexate 2mg/ml oral solution sugar free'),('methotrexate',1,'31065011000001106','Methotrexate 2mg/ml oral solution sugar free (A A H Pharmaceuticals Ltd)'),('methotrexate',1,'30985211000001103','Methotrexate 2mg/ml oral solution sugar free (Alliance Healthcare (Distribution) Ltd)'),('methotrexate',1,'30595111000001100','Methotrexate 2mg/ml oral solution sugar free (Rosemont Pharmaceuticals Ltd)'),('methotrexate',1,'12817111000001103','Methotrexate 3.75mg/5ml oral solution'),('methotrexate',1,'12801511000001104','Methotrexate 3.75mg/5ml oral solution (Special Order)'),('methotrexate',1,'12817211000001109','Methotrexate 3.75mg/5ml oral suspension'),('methotrexate',1,'12801211000001102','Methotrexate 3.75mg/5ml oral suspension (Special Order)'),('methotrexate',1,'24595111000001103','Methotrexate 30mg/0.6ml solution for injection pre-filled disposable devices'),('methotrexate',1,'18245711000001104','Methotrexate 30mg/0.6ml solution for injection pre-filled syringes'),('methotrexate',1,'9469011000001108','Methotrexate 30mg/1.2ml solution for injection pre-filled syringes'),('methotrexate',1,'9450111000001105','Methotrexate 30mg/1.2ml solution for injection pre-filled syringes (Special Order)'),('methotrexate',1,'19976211000001101','Methotrexate 30mg/1.5ml solution for injection pre-filled syringes'),('methotrexate',1,'9469111000001109','Methotrexate 32.5mg/1.3ml solution for injection pre-filled syringes'),('methotrexate',1,'9449511000001107','Methotrexate 32.5mg/1.3ml solution for injection pre-filled syringes (Special Order)'),('methotrexate',1,'9469211000001103','Methotrexate 35mg/1.4ml solution for injection pre-filled syringes'),('methotrexate',1,'9448511000001101','Methotrexate 35mg/1.4ml solution for injection pre-filled syringes (Special Order)'),('methotrexate',1,'12817311000001101','Methotrexate 4mg/5ml oral solution'),('methotrexate',1,'12802211000001109','Methotrexate 4mg/5ml oral solution (Special Order)'),('methotrexate',1,'12817411000001108','Methotrexate 4mg/5ml oral suspension'),('methotrexate',1,'12801911000001106','Methotrexate 4mg/5ml oral suspension (Special Order)'),('methotrexate',1,'374442007','Methotrexate 5 mg oral tablet'),('methotrexate',1,'36033211000001105','Methotrexate 500mg/20ml solution for injection vials'),('methotrexate',1,'3622611000001102','Methotrexate 500mg/20ml solution for injection vials (A A H Pharmaceuticals Ltd)'),('methotrexate',1,'27952411000001107','Methotrexate 500mg/20ml solution for injection vials (Accord Healthcare Ltd)'),('methotrexate',1,'3623611000001107','Methotrexate 500mg/20ml solution for injection vials (Advanz Pharma)'),('methotrexate',1,'3623211000001105','Methotrexate 500mg/20ml solution for injection vials (Alliance Healthcare (Distribution) Ltd)'),('methotrexate',1,'14966811000001106','Methotrexate 500mg/20ml solution for injection vials (Hameln Pharmaceuticals Ltd)'),('methotrexate',1,'3622911000001108','Methotrexate 500mg/20ml solution for injection vials (Pfizer Ltd)'),('methotrexate',1,'10988211000001107','Methotrexate 500mg/20ml solution for injection vials (Teva UK Ltd)'),('methotrexate',1,'9469311000001106','Methotrexate 50mg/2ml solution for injection pre-filled syringes'),
('methotrexate',1,'9448011000001109','Methotrexate 50mg/2ml solution for injection pre-filled syringes (Special Order)'),('methotrexate',1,'36033311000001102','Methotrexate 50mg/2ml solution for injection vials'),('methotrexate',1,'3610011000001101','Methotrexate 50mg/2ml solution for injection vials (A A H Pharmaceuticals Ltd)'),('methotrexate',1,'28991611000001102','Methotrexate 50mg/2ml solution for injection vials (Accord Healthcare Ltd)'),('methotrexate',1,'3615611000001100','Methotrexate 50mg/2ml solution for injection vials (Advanz Pharma)'),('methotrexate',1,'3613311000001109','Methotrexate 50mg/2ml solution for injection vials (Alliance Healthcare (Distribution) Ltd)'),('methotrexate',1,'15138411000001109','Methotrexate 50mg/2ml solution for injection vials (Hameln Pharmaceuticals Ltd)'),('methotrexate',1,'3612811000001108','Methotrexate 50mg/2ml solution for injection vials (Pfizer Ltd)'),('methotrexate',1,'10988011000001102','Methotrexate 50mg/2ml solution for injection vials (Teva UK Ltd)'),('methotrexate',1,'12817511000001107','Methotrexate 50mg/5ml oral solution'),('methotrexate',1,'12803011000001108','Methotrexate 50mg/5ml oral solution (Special Order)'),('methotrexate',1,'12815111000001107','Methotrexate 50mg/5ml oral suspension'),('methotrexate',1,'12802611000001106','Methotrexate 50mg/5ml oral suspension (Special Order)'),('methotrexate',1,'36033411000001109','Methotrexate 5g/200ml solution for infusion vials'),('methotrexate',1,'3620611000001103','Methotrexate 5g/200ml solution for infusion vials (A A H Pharmaceuticals Ltd)'),('methotrexate',1,'3621111000001100','Methotrexate 5g/200ml solution for infusion vials (Advanz Pharma)'),('methotrexate',1,'3620811000001104','Methotrexate 5g/200ml solution for infusion vials (Alliance Healthcare (Distribution) Ltd)'),('methotrexate',1,'36033511000001108','Methotrexate 5g/50ml solution for infusion vials'),('methotrexate',1,'3615811000001101','Methotrexate 5g/50ml solution for infusion vials (A A H Pharmaceuticals Ltd)'),('methotrexate',1,'3616911000001104','Methotrexate 5g/50ml solution for infusion vials (Alliance Healthcare (Distribution) Ltd)'),('methotrexate',1,'3616411000001107','Methotrexate 5g/50ml solution for infusion vials (Pfizer Ltd)'),('methotrexate',1,'9562111000001108','Methotrexate 5g/50ml solution for infusion vials (Wockhardt UK Ltd)'),('methotrexate',1,'9469411000001104','Methotrexate 5mg/0.2ml solution for injection pre-filled syringes'),('methotrexate',1,'9457411000001101','Methotrexate 5mg/0.2ml solution for injection pre-filled syringes (Special Order)'),('methotrexate',1,'36033611000001107','Methotrexate 5mg/2ml solution for injection vials'),('methotrexate',1,'3612511000001105','Methotrexate 5mg/2ml solution for injection vials (A A H Pharmaceuticals Ltd)'),('methotrexate',1,'3614911000001107','Methotrexate 5mg/2ml solution for injection vials (Alliance Healthcare (Distribution) Ltd)'),('methotrexate',1,'3614611000001101','Methotrexate 5mg/2ml solution for injection vials (Pfizer Ltd)'),('methotrexate',1,'8665811000001104','Methotrexate 5mg/5ml oral solution'),('methotrexate',1,'8625911000001104','Methotrexate 5mg/5ml oral solution (Special Order)'),('methotrexate',1,'8665911000001109','Methotrexate 5mg/5ml oral suspension'),('methotrexate',1,'8626511000001104','Methotrexate 5mg/5ml oral suspension (Special Order)'),('methotrexate',1,'12815211000001101','Methotrexate 6mg/5ml oral solution'),('methotrexate',1,'12803611000001101','Methotrexate 6mg/5ml oral solution (Special Order)'),('methotrexate',1,'12815311000001109','Methotrexate 6mg/5ml oral suspension'),('methotrexate',1,'12803311000001106','Methotrexate 6mg/5ml oral suspension (Special Order)'),('methotrexate',1,'374443002','Methotrexate 7.5 mg oral tablet'),('methotrexate',1,'24595211000001109','Methotrexate 7.5mg/0.15ml solution for injection pre-filled disposable devices'),('methotrexate',1,'15518311000001104','Methotrexate 7.5mg/0.15ml solution for injection pre-filled syringes'),('methotrexate',1,'34168411000001106','Methotrexate 7.5mg/0.3ml solution for injection pre-filled disposable devices'),('methotrexate',1,'9469511000001100','Methotrexate 7.5mg/0.3ml solution for injection pre-filled syringes'),('methotrexate',1,'9456611000001100','Methotrexate 7.5mg/0.3ml solution for injection pre-filled syringes (Special Order)'),('methotrexate',1,'10676011000001109','Methotrexate 7.5mg/0.75ml solution for injection pre-filled syringes'),('methotrexate',1,'8666011000001101','Methotrexate 7.5mg/5ml oral solution'),('methotrexate',1,'8625811000001109','Methotrexate 7.5mg/5ml oral solution (Special Order)'),('methotrexate',1,'8666111000001100','Methotrexate 7.5mg/5ml oral suspension'),('methotrexate',1,'8626411000001103','Methotrexate 7.5mg/5ml oral suspension (Special Order)'),('methotrexate',1,'12815411000001102','Methotrexate 750micrograms/5ml oral solution'),('methotrexate',1,'12804611000001103','Methotrexate 750micrograms/5ml oral solution (Special Order)'),('methotrexate',1,'12815511000001103','Methotrexate 750micrograms/5ml oral suspension'),('methotrexate',1,'12804011000001105','Methotrexate 750micrograms/5ml oral suspension (Special Order)'),('methotrexate',1,'12815611000001104','Methotrexate 7mg/5ml oral solution'),('methotrexate',1,'12805711000001106','Methotrexate 7mg/5ml oral solution (Special Order)'),('methotrexate',1,'12815711000001108','Methotrexate 7mg/5ml oral suspension'),('methotrexate',1,'12805111000001105','Methotrexate 7mg/5ml oral suspension (Special Order)'),('methotrexate',1,'12815811000001100','Methotrexate 8mg/5ml oral solution'),('methotrexate',1,'12806611000001107','Methotrexate 8mg/5ml oral solution (Special Order)'),('methotrexate',1,'12815911000001105','Methotrexate 8mg/5ml oral suspension'),('methotrexate',1,'12806311000001102','Methotrexate 8mg/5ml oral suspension (Special Order)'),('methotrexate',1,'714206006','Methotrexate in oral dosage form'),('methotrexate',1,'714204009','Methotrexate in parenteral dosage form'),('methotrexate',1,'15513411000001100','Metoject 10mg/0.2ml solution for injection pre-filled syringes (medac UK)'),('methotrexate',1,'10672911000001109','Metoject 10mg/1ml solution for injection pre-filled syringes (medac UK)'),('methotrexate',1,'19224611000001108','Metoject 12.5mg/0.25ml solution for injection pre-filled syringes (medac UK)'),('methotrexate',1,'15513711000001106','Metoject 15mg/0.3ml solution for injection pre-filled syringes (medac UK)'),('methotrexate',1,'10673211000001106','Metoject 15mg/1.5ml solution for injection pre-filled syringes (medac UK)'),('methotrexate',1,'19225111000001101','Metoject 17.5mg/0.35ml solution for injection pre-filled syringes (medac UK)'),('methotrexate',1,'15514311000001109','Metoject 20mg/0.4ml solution for injection pre-filled syringes (medac UK)'),('methotrexate',1,'10673511000001109','Metoject 20mg/2ml solution for injection pre-filled syringes (medac UK)'),('methotrexate',1,'19225411000001106','Metoject 22.5mg/0.45ml solution for injection pre-filled syringes (medac UK)'),('methotrexate',1,'15514011000001106','Metoject 25mg/0.5ml solution for injection pre-filled syringes (medac UK)'),('methotrexate',1,'10674011000001104','Metoject 25mg/2.5ml solution for injection pre-filled syringes (medac UK)'),('methotrexate',1,'19225811000001108','Metoject 27.5mg/0.55ml solution for injection pre-filled syringes (medac UK)'),('methotrexate',1,'18208411000001106','Metoject 30mg/0.6ml solution for injection pre-filled syringes (medac UK)'),('methotrexate',1,'15513111000001105','Metoject 7.5mg/0.15ml solution for injection pre-filled syringes (medac UK)'),('methotrexate',1,'10672611000001103','Metoject 7.5mg/0.75ml solution for injection pre-filled syringes (medac UK)'),('methotrexate',1,'24590211000001100','Metoject PEN 10mg/0.2ml solution for injection pre-filled pen (medac UK)'),('methotrexate',1,'24589911000001102','Metoject PEN 12.5mg/0.25ml solution for injection pre-filled pen (medac UK)'),('methotrexate',1,'24589611000001108','Metoject PEN 15mg/0.3ml solution for injection pre-filled pen (medac UK)'),('methotrexate',1,'24591111000001100','Metoject PEN 17.5mg/0.35ml solution for injection pre-filled pen (medac UK)'),('methotrexate',1,'24590811000001104','Metoject PEN 20mg/0.4ml solution for injection pre-filled pen (medac UK)'),('methotrexate',1,'24590411000001101','Metoject PEN 22.5mg/0.45ml solution for injection pre-filled pen (medac UK)'),('methotrexate',1,'24589311000001103','Metoject PEN 25mg/0.5ml solution for injection pre-filled pen (medac UK)'),('methotrexate',1,'24589011000001101','Metoject PEN 27.5mg/0.55ml solution for injection pre-filled pen (medac UK)'),('methotrexate',1,'24588711000001108','Metoject PEN 30mg/0.6ml solution for injection pre-filled pen (medac UK)'),('methotrexate',1,'24588411000001102','Metoject PEN 7.5mg/0.15ml solution for injection pre-filled pen (medac UK)'),('methotrexate',1,'34162611000001107','Nordimet 10mg/0.4ml solution for injection pre-filled pens (Nordic Pharma Ltd)'),('methotrexate',1,'34162911000001101','Nordimet 12.5mg/0.5ml solution for injection pre-filled pens (Nordic Pharma Ltd)'),('methotrexate',1,'34163211000001104','Nordimet 15mg/0.6ml solution for injection pre-filled pens (Nordic Pharma Ltd)'),('methotrexate',1,'34163511000001101','Nordimet 17.5mg/0.7ml solution for injection pre-filled pens (Nordic Pharma Ltd)'),('methotrexate',1,'34163811000001103','Nordimet 20mg/0.8ml solution for injection pre-filled pens (Nordic Pharma Ltd)'),('methotrexate',1,'34164111000001107','Nordimet 22.5mg/0.9ml solution for injection pre-filled pens (Nordic Pharma Ltd)'),('methotrexate',1,'34164411000001102','Nordimet 25mg/1ml solution for injection pre-filled pens (Nordic Pharma Ltd)'),('methotrexate',1,'34161711000001105','Nordimet 7.5mg/0.3ml solution for injection pre-filled pens (Nordic Pharma Ltd)'),('methotrexate',1,'31407911000001106','Zlatal 10mg/0.4ml solution for injection pre-filled syringes (Nordic Pharma Ltd)'),
('methotrexate',1,'31409011000001103','Zlatal 12.5mg/0.5ml solution for injection pre-filled syringes (Nordic Pharma Ltd)'),('methotrexate',1,'31409611000001105','Zlatal 15mg/0.6ml solution for injection pre-filled syringes (Nordic Pharma Ltd)'),('methotrexate',1,'31410211000001104','Zlatal 17.5mg/0.7ml solution for injection pre-filled syringes (Nordic Pharma Ltd)'),('methotrexate',1,'31406711000001106','Zlatal 20mg/0.8ml solution for injection pre-filled syringes (Nordic Pharma Ltd)'),('methotrexate',1,'31407211000001102','Zlatal 22.5mg/0.9ml solution for injection pre-filled syringes (Nordic Pharma Ltd)'),('methotrexate',1,'31407411000001103','Zlatal 25mg/1ml solution for injection pre-filled syringes (Nordic Pharma Ltd)'),('methotrexate',1,'31408511000001100','Zlatal 7.5mg/0.3ml solution for injection pre-filled syringes (Nordic Pharma Ltd)');
INSERT INTO #codessnomed
VALUES ('prednisolone-oral',1,'52388000','Product containing prednisolone'),('prednisolone-oral',1,'325426006','Product containing precisely prednisolone 1 milligram/1 each conventional release oral tablet (clinical drug)'),('prednisolone-oral',1,'325427002','Product containing precisely prednisolone 5 milligram/1 each conventional release oral tablet (clinical drug)'),('prednisolone-oral',1,'325442004','Product containing precisely prednisolone 2.5 milligram/1 each gastro-resistant oral tablet'),('prednisolone-oral',1,'325443009','Prednisolone 5 mg gastro-resistant oral tablet'),('prednisolone-oral',1,'325444003','Prednisolone 5mg soluble tablet (product)'),('prednisolone-oral',1,'325445002','Product containing precisely prednisolone 50 milligram/1 each conventional release oral tablet (clinical drug)'),('prednisolone-oral',1,'325450008','Product containing precisely prednisolone 25 milligram/1 each conventional release oral tablet (clinical drug)'),('prednisolone-oral',1,'349354003','Product containing prednisolone in oral dosage form'),('prednisolone-oral',1,'350459005','Product containing prednisolone in parenteral dosage form'),('prednisolone-oral',1,'374290002','Prednisolone 15mg/5mL syrup'),('prednisolone-oral',1,'374291003','Prednisolone 5mg/5mL syrup'),('prednisolone-oral',1,'374333004','Prednisolone acetate 25mg/mL suspension'),('prednisolone-oral',1,'374731004','Prednisolone acetate 0.125% suspension'),('prednisolone-oral',1,'374732006','Prednisolone acetate 1% suspension'),('prednisolone-oral',1,'374948001','Prednisolone acetate 0.12% suspension'),('prednisolone-oral',1,'375101009','Prednisolone sodium phosphate 1% solution'),('prednisolone-oral',1,'375850000','Prednisolone sodium phosphate 1/8% solution'),('prednisolone-oral',1,'398708002','Neomycin sulfate and polymyxin B sulfate and prednisolone acetate product'),('prednisolone-oral',1,'416533002','Product containing precisely prednisolone 3 milligram/1 milliliter conventional release oral solution (clinical drug)'),('prednisolone-oral',1,'416646003','Prednisolone 5mg/mL oral solution'),('prednisolone-oral',1,'422072007','Cinchocaine and prednisolone product'),('prednisolone-oral',1,'422606008','Neomycin and prednisolone product'),('prednisolone-oral',1,'424688005','Prednisolone 10mg orally disintegrating tablet'),('prednisolone-oral',1,'424869000','Prednisolone 15mg orally disintegrating tablet'),('prednisolone-oral',1,'425057000','Prednisolone 30mg orally disintegrating tablet'),('prednisolone-oral',1,'429995001','Prednisolone 2 mg/mL oral solution'),('prednisolone-oral',1,'432224007','Prednisolone 1 mg/mL oral suspension'),('prednisolone-oral',1,'432225008','Prednisolone 3 mg/mL oral suspension'),('prednisolone-oral',1,'764596001','Gentamicin and prednisolone product'),('prednisolone-oral',1,'96334000','Prednisolone acetate (substance)'),('prednisolone-oral',1,'96335004','Prednisolone sodium phosphate (substance)'),('prednisolone-oral',1,'96336003','Prednisolone tertiary butylacetate (substance)'),('prednisolone-oral',1,'116601002','Prednisolone (substance)'),('prednisolone-oral',1,'438443002','Prednisolone hexanoate'),('prednisolone-oral',1,'441522005','Prednisolone methylsulfobenzoate (substance)'),('prednisolone-oral',1,'735165003','Prednisolone caproate');
INSERT INTO #codessnomed
VALUES ('prednisone',1,'10312003','Prednisone product'),('prednisone',1,'325456002','Product containing precisely prednisone 20 milligram/1 each conventional release oral tablet (clinical drug)'),('prednisone',1,'373989007','Product containing precisely prednisone 2.5 milligram/1 each conventional release oral tablet'),('prednisone',1,'373994007','Product containing precisely prednisone 5 milligram/1 each conventional release oral tablet'),('prednisone',1,'374058000','Product containing precisely prednisone 10 milligram/1 each conventional release oral tablet (clinical drug)'),('prednisone',1,'374072009','Product containing precisely prednisone 50 milligram/1 each conventional release oral tablet (clinical drug)'),('prednisone',1,'418349006','Product containing precisely prednisone 1 milligram/1 each conventional release oral tablet (clinical drug)'),('prednisone',1,'768296006','Product containing prednisone in oral dosage form (medicinal product form)'),('prednisone',1,'116602009','Prednisone (substance)');
INSERT INTO #codessnomed
VALUES ('sulfasalazine',1,'45844004','Sulfasalazine product'),('sulfasalazine',1,'317430009','Product containing precisely sulfasalazine 50 milligram/1 milliliter conventional release oral suspension (clinical drug)'),('sulfasalazine',1,'317431008','Product containing precisely sulfasalazine 500 milligram/1 each conventional release oral tablet'),('sulfasalazine',1,'317432001','Sulfasalazine 500 mg rectal suppository'),('sulfasalazine',1,'317433006','Sulfasalazine 3g/100mL retention enema (product)'),('sulfasalazine',1,'330040008','Product containing precisely sulfasalazine 500 milligram/1 each gastro-resistant oral tablet (clinical drug)'),('sulfasalazine',1,'349822001','Product containing sulfasalazine in oral dosage form'),('sulfasalazine',1,'349823006','Product containing sulfasalazine in rectal dosage form'),('sulfasalazine',1,'765595005','Sulfasalazine 500mg gastro-resistant oral tablet (product)'),('sulfasalazine',1,'387248006','Salicylazosulfapyridine')

INSERT INTO #AllCodes
SELECT [concept], [version], [code] from #codessnomed;

IF OBJECT_ID('tempdb..#codesemis') IS NOT NULL DROP TABLE #codesemis;
CREATE TABLE #codesemis (
  [concept] [varchar](255) NOT NULL,
  [version] INT NOT NULL,
	[code] [varchar](20) COLLATE Latin1_General_CS_AS NOT NULL,
	[description] [varchar](255) NULL
) ON [PRIMARY];

INSERT INTO #codesemis
VALUES ('hydroxychloroquine',1,'HYTA5012','Hydroxychloroquine Sulfate  Tablets  200 mg'),('hydroxychloroquine',1,'PLTA2289','Plaquenil  Tablets  200 mg'),('hydroxychloroquine',1,'PLTA2289','Plaquenil  Tablets  200 mg'),('hydroxychloroquine',1,'QUTA40431NEMIS','Quinoric  Tablets  200 mg'),('hydroxychloroquine',1,'HYOR34435NEMIS','Hydroxychloroquine  Oral suspension  400 mg/5 ml'),('hydroxychloroquine',1,'HYOR46475NEMIS','Hydroxychloroquine  Oral suspension  200 mg/5 ml'),('hydroxychloroquine',1,'HYOR46474NEMIS','Hydroxychloroquine  Oral solution  200 mg/5 ml'),('hydroxychloroquine',1,'HYOR77631NEMIS','Hydroxychloroquine  Oral suspension  100 mg/5 ml');
INSERT INTO #codesemis
VALUES ('leflunomide',1,'LETA1669NEMIS','Leflunomide  Tablets  100 mg'),('leflunomide',1,'LETA1666NEMIS','Leflunomide  Tablets  10 mg'),('leflunomide',1,'LETA1668NEMIS','Leflunomide  Tablets  20 mg'),('leflunomide',1,'LETA89217NEMIS','Leflunomide  Tablets  15 mg'),('leflunomide',1,'ARTA1672NEMIS','Arava  Tablets  100 mg'),('leflunomide',1,'ARTA1670NEMIS','Arava  Tablets  10 mg'),('leflunomide',1,'ARTA1671NEMIS','Arava  Tablets  20 mg');
INSERT INTO #codesemis
VALUES ('methotrexate',1,'EMTA3515','Emtexate  Tablets  10 mg'),('methotrexate',1,'MATA3882','Maxtrex  Tablets  10 mg'),('methotrexate',1,'MATA3883','Maxtrex  Tablets  2.5 mg'),('methotrexate',1,'META3900','Methotrexate  Tablets  2.5 mg'),('methotrexate',1,'META5136','Methotrexate  Tablets  10 mg'),('methotrexate',1,'MEIN18088EMIS','Methotrexate  Injection  5 grams/200 ml vial'),('methotrexate',1,'MEIN18089EMIS','Methotrexate  Injection  5 mg/2 ml vial'),('methotrexate',1,'MEIN18090EMIS','Methotrexate  Injection  50 mg/2 ml vial'),('methotrexate',1,'MEIN21800NEMIS','Methotrexate 15mg/1.5ml solution for injection pre-filled syringes'),('methotrexate',1,'MEIN21802NEMIS','Methotrexate 25mg/2.5ml solution for injection pre-filled syringes'),('methotrexate',1,'MEIN22304NEMIS','Methotrexate 15mg/0.6ml solution for injection pre-filled syringes'),('methotrexate',1,'MEIN3551NEMIS','Methotrexate 1g/10ml solution for injection vials'),('methotrexate',1,'MEIN36535NEMIS','Methotrexate 15mg/0.3ml solution for injection pre-filled syringes'),('methotrexate',1,'MEIN51051NEMIS','Methotrexate 12.5mg/0.25ml solution for injection pre-filled syringes'),('methotrexate',1,'MEIN90725NEMIS','Methotrexate 12.5mg/0.25ml solution for injection pre-filled disposable devices'),('methotrexate',1,'MEIN90728NEMIS','Methotrexate 20mg/0.4ml solution for injection pre-filled disposable devices'),('methotrexate',1,'MEOR12018NEMIS','Methotrexate  Oral Suspension  2.5 mg/5 ml'),('methotrexate',1,'MEOR14798NEMIS','Methotrexate 15mg/5ml oral solution'),('methotrexate',1,'MEOR15494NEMIS','Methotrexate 10mg/5ml oral solution');
INSERT INTO #codesemis
VALUES ('prednisolone-oral',1,'PRTA100618NEMIS','Prednisolone  Tablets  10 mg'),('prednisolone-oral',1,'DETA3396','Delta-Phoricol  Tablets  5 mg'),('prednisolone-oral',1,'PETA100627NEMIS','Pevanti  Tablets  20 mg'),('prednisolone-oral',1,'PETA100628NEMIS','Pevanti  Tablets  25 mg'),('prednisolone-oral',1,'DIGA81516NEMIS','Dilacort  Gastro-resistant Tablets  2.5 mg'),('prednisolone-oral',1,'PRTA4196','Precortisyl  Tablets  5 mg'),('prednisolone-oral',1,'PRTA4200','Prednesol  Soluble tablets  5 mg'),('prednisolone-oral',1,'DETA3400','Deltastab  Tablets  5 mg'),('prednisolone-oral',1,'PRTA18432EMIS','Prednisolone  Tablets  25 mg'),('prednisolone-oral',1,'PETA100622NEMIS','Pevanti  Tablets  2.5 mg'),('prednisolone-oral',1,'DETA828','Deltacortril Enteric  E/c tablets  5 mg'),('prednisolone-oral',1,'PRTA4197','Precortisyl Forte  Tablets  25 mg'),('prednisolone-oral',1,'PREN8411EGTON','Prednisolone  E/c tablets  2.5 mg'),('prednisolone-oral',1,'PETA100624NEMIS','Pevanti  Tablets  5 mg'),('prednisolone-oral',1,'PRTA100619NEMIS','Prednisolone  Tablets  20 mg'),('prednisolone-oral',1,'DETA3399','Deltastab  Tablets  1 mg'),('prednisolone-oral',1,'PREN8412EGTON','Prednisolone  E/c tablets  5 mg'),('prednisolone-oral',1,'PRTA4195','Precortisyl  Tablets  1 mg'),('prednisolone-oral',1,'PETA100625NEMIS','Pevanti  Tablets  10 mg'),('prednisolone-oral',1,'PRTA2326','Prednisolone  Tablets  1 mg'),('prednisolone-oral',1,'PRTA2327','Prednisolone  Tablets  2.5 mg'),('prednisolone-oral',1,'PRTA2328','Prednisolone  Tablets  5 mg'),('prednisolone-oral',1,'DETA827','Deltacortril Enteric  E/c tablets  2.5 mg'),('prednisolone-oral',1,'PRSO10225BRIDL','Prednisolone  Soluble tablets  5 mg'),('prednisolone-oral',1,'DIGA81517NEMIS','Dilacort  Gastro-resistant Tablets  5 mg'),('prednisolone-oral',1,'PRE/36621MGEMIS','Prednisolone  E/c tablets  2.5 mg (Alpharma)'),('prednisolone-oral',1,'PRTA36682MGEMIS','Prednisolone  Tablets  1 mg (Alpharma)'),('prednisolone-oral',1,'PRTA116231NEMIS','Prednisolone  Tablets  30 mg'),('prednisolone-oral',1,'PRSO36635MGEMIS','Prednisolone  Soluble tablets  5 mg (A.A.H. Pharm)'),('prednisolone-oral',1,'PRTA36689MGEMIS','Prednisolone  Tablets  5 mg (Teva UK)'),('prednisolone-oral',1,'PRGA114530NEMIS','Prednisolone  Gastro-resistant Tablets  1 mg'),('prednisolone-oral',1,'PRTA36687MGEMIS','Prednisolone  Tablets  5 mg (Alpharma)'),('prednisolone-oral',1,'PRE/36622MGEMIS','Prednisolone  E/c tablets  2.5 mg (Kent Pharm)'),('prednisolone-oral',1,'PRE/36623MGEMIS','Prednisolone  E/c tablets  2.5 mg (Unichem)'),('prednisolone-oral',1,'PRTA36688MGEMIS','Prednisolone  Tablets  5 mg (The Boots Company)'),('prednisolone-oral',1,'PRTA36692MGEMIS','Prednisolone  Tablets  5 mg (A.A.H. Pharm)'),('prednisolone-oral',1,'PRTA36684MGEMIS','Prednisolone  Tablets  1 mg (Kent Pharm)'),('prednisolone-oral',1,'PRTA36667MGEMIS','Prednisolone  Tablets  25 mg (Sanofi-Aventis)'),('prednisolone-oral',1,'PRSO36634MGEMIS','Prednisolone  Soluble tablets  5 mg (Unichem)'),('prednisolone-oral',1,'PRTA36693MGEMIS','Prednisolone  Tablets  5 mg (Wockhardt UK)'),('prednisolone-oral',1,'PRE/36628MGEMIS','Prednisolone  E/c tablets  5 mg (A.A.H. Pharm)'),('prednisolone-oral',1,'PRE/36624MGEMIS','Prednisolone  E/c tablets  2.5 mg (A.A.H. Pharm)'),('prednisolone-oral',1,'PRTA36683MGEMIS','Prednisolone  Tablets  1 mg (A.A.H. Pharm)'),('prednisolone-oral',1,'PRTA36681MGEMIS','Prednisolone  Tablets  1 mg (Teva UK)'),('prednisolone-oral',1,'PRE/36625MGEMIS','Prednisolone  E/c tablets  5 mg (Unichem)'),('prednisolone-oral',1,'PRTA36690MGEMIS','Prednisolone  Tablets  5 mg (Kent Pharm)'),('prednisolone-oral',1,'PRTA36685MGEMIS','Prednisolone  Tablets  1 mg (The Boots Company)'),('prednisolone-oral',1,'PRTA36686MGEMIS','Prednisolone  Tablets  1 mg (Wockhardt UK)'),('prednisolone-oral',1,'PRTA36691MGEMIS','Prednisolone  Tablets  5 mg (Unichem)'),('prednisolone-oral',1,'PRTA36666MGEMIS','Prednisolone  Tablets  25 mg (A.A.H. Pharm)'),('prednisolone-oral',1,'PRE/36626MGEMIS','Prednisolone  E/c tablets  5 mg (Kent Pharm)'),('prednisolone-oral',1,'PRE/36627MGEMIS','Prednisolone  E/c tablets  5 mg (Alpharma)'),('prednisolone-oral',1,'PRSO36636MGEMIS','Prednisolone  Soluble tablets  5 mg (Sovereign)'),('prednisolone-oral',1,'PRTA36680MGEMIS','Prednisolone  Tablets  1 mg (Unichem)'),('prednisolone-oral',1,'PRTA36665MGEMIS','Prednisolone  Tablets  25 mg (Unichem)');
INSERT INTO #codesemis
VALUES ('prednisone',1,'PRM/46706NEMIS','Prednisone  M/R tablets  1 mg'),('prednisone',1,'PRM/46707NEMIS','Prednisone  M/R tablets  2 mg'),('prednisone',1,'LOM/46714NEMIS','Lodotra  M/R tablets  5 mg'),('prednisone',1,'LOM/46712NEMIS','Lodotra  M/R tablets  1 mg'),('prednisone',1,'PRTA2329','Prednisone  Tablets  1 mg'),('prednisone',1,'DETA3394','Decortisyl  Tablets  5 mg'),('prednisone',1,'PRM/46708NEMIS','Prednisone  M/R tablets  5 mg'),('prednisone',1,'PRTA2330','Prednisone  Tablets  5 mg'),('prednisone',1,'LOM/46713NEMIS','Lodotra  M/R tablets  2 mg');
INSERT INTO #codesemis
VALUES ('sulfasalazine',1,'SASU10642BRIDL','Salazopyrin 250mg/5ml oral suspension (Pfizer Ltd)'),('sulfasalazine',1,'SASU4298','Salazopyrin 500mg suppositories (Pfizer Ltd)'),('sulfasalazine',1,'SATA2478','Salazopyrin 500mg tablets (Pfizer Ltd)'),('sulfasalazine',1,'SUE/17828NEMIS','Sulfasalazine 500mg gastro-resistant tablets'),('sulfasalazine',1,'SUE/896NEMIS','Sulphasalazine E/C Tablets 500 mg'),('sulfasalazine',1,'SUOR45683NEMIS','Sulfasalazine 250mg/5ml oral suspension sugar free'),('sulfasalazine',1,'SUSU17835NEMIS','Sulfasalazine 250mg/5ml oral suspension'),('sulfasalazine',1,'SUTA17836NEMIS','Sulfasalazine 500mg tablets'),('sulfasalazine',1,'SARE8978EGTON','Salazopyrin  Retention enema  3 g/enema'),('sulfasalazine',1,'SUTA2732','Sulphasalazine  Tablets  500 mg'),('sulfasalazine',1,'SUEN2731','Sulphasalazine  En-tablets  500 mg'),('sulfasalazine',1,'UCTA32637EMIS','Ucine  Tablets  500 mg'),('sulfasalazine',1,'SAEN2477','Salazopyrin  En-tablets  500 mg'),('sulfasalazine',1,'SUGA78926NEMIS','Sulazine Ec  Gastro-resistant Tablets  500 mg'),('sulfasalazine',1,'SUSU17832NEMIS','Sulfasalazine  Suppositories  500 mg'),('sulfasalazine',1,'SUSU10709BRIDL','Sulphasalazine  Suspension  250mg/5 ml'),('sulfasalazine',1,'SUSU5409','Sulphasalazine  Suppositories  500 mg'),('sulfasalazine',1,'SURE10711BRIDL','Sulphasalazine  Retention enema  3g in 100 ml'),('sulfasalazine',1,'SUE/38259MGEMIS','Sulfasalazine  E/c tablets  500 mg (A.A.H. Pharm)'),('sulfasalazine',1,'SUTA38268MGEMIS','Sulfasalazine  Tablets  500 mg (Unichem)'),('sulfasalazine',1,'SUTA38266MGEMIS','Sulfasalazine  Tablets  500 mg (Kent Pharm)'),('sulfasalazine',1,'SUE/38261MGEMIS','Sulfasalazine  E/c tablets  500 mg (Alpharma)'),('sulfasalazine',1,'SUE/38260MGEMIS','Sulfasalazine  E/c tablets  500 mg (Kent Pharm)'),('sulfasalazine',1,'SUTA38267MGEMIS','Sulfasalazine  Tablets  500 mg (Alpharma)'),('sulfasalazine',1,'SUTA38264MGEMIS','Sulfasalazine  Tablets  500 mg (A.A.H. Pharm)'),('sulfasalazine',1,'SUTA38269MGEMIS','Sulfasalazine  Tablets  500 mg (Ivax Pharmaceuticals)'),('sulfasalazine',1,'EMISNQRH11','Rheumatology drug monitoring - Sulfasalazine'),('sulfasalazine',1,'SUE/38263MGEMIS','Sulfasalazine  E/c tablets  500 mg (Generics (UK))'),('sulfasalazine',1,'SUE/38262MGEMIS','Sulfasalazine  E/c tablets  500 mg (Unichem)'),('sulfasalazine',1,'SUTA38265MGEMIS','Sulfasalazine  Tablets  500 mg (Generics (UK))')

INSERT INTO #AllCodes
SELECT [concept], [version], [code] from #codesemis;


IF OBJECT_ID('tempdb..#TempRefCodes') IS NOT NULL DROP TABLE #TempRefCodes;
CREATE TABLE #TempRefCodes (FK_Reference_Coding_ID BIGINT NOT NULL, concept VARCHAR(255) NOT NULL, version INT NOT NULL);

-- Read v2 codes
INSERT INTO #TempRefCodes
SELECT PK_Reference_Coding_ID, dcr.concept, dcr.[version]
FROM [SharedCare].[Reference_Coding] rc
INNER JOIN #codesreadv2 dcr on dcr.code = rc.MainCode
WHERE CodingType='ReadCodeV2'
and PK_Reference_Coding_ID != -1;

-- CTV3 codes
INSERT INTO #TempRefCodes
SELECT PK_Reference_Coding_ID, dcc.concept, dcc.[version]
FROM [SharedCare].[Reference_Coding] rc
INNER JOIN #codesctv3 dcc on dcc.code = rc.MainCode
WHERE CodingType='CTV3'
and PK_Reference_Coding_ID != -1;

-- EMIS codes with a FK Reference Coding ID
INSERT INTO #TempRefCodes
SELECT FK_Reference_Coding_ID, ce.concept, ce.[version]
FROM [SharedCare].[Reference_Local_Code] rlc
INNER JOIN #codesemis ce on ce.code = rlc.LocalCode
WHERE FK_Reference_Coding_ID != -1;

IF OBJECT_ID('tempdb..#TempSNOMEDRefCodes') IS NOT NULL DROP TABLE #TempSNOMEDRefCodes;
CREATE TABLE #TempSNOMEDRefCodes (FK_Reference_SnomedCT_ID BIGINT NOT NULL, concept VARCHAR(255) NOT NULL, [version] INT NOT NULL);

-- SNOMED codes
INSERT INTO #TempSNOMEDRefCodes
SELECT PK_Reference_SnomedCT_ID, dcs.concept, dcs.[version]
FROM SharedCare.Reference_SnomedCT rs
INNER JOIN #codessnomed dcs on dcs.code = rs.ConceptID;

-- EMIS codes with a FK SNOMED ID but without a FK Reference Coding ID
INSERT INTO #TempSNOMEDRefCodes
SELECT FK_Reference_SnomedCT_ID, ce.concept, ce.[version]
FROM [SharedCare].[Reference_Local_Code] rlc
INNER JOIN #codesemis ce on ce.code = rlc.LocalCode
WHERE FK_Reference_Coding_ID = -1
AND FK_Reference_SnomedCT_ID != -1;

-- De-duped tables
IF OBJECT_ID('tempdb..#CodeSets') IS NOT NULL DROP TABLE #CodeSets;
CREATE TABLE #CodeSets (FK_Reference_Coding_ID BIGINT NOT NULL, concept VARCHAR(255) NOT NULL);

IF OBJECT_ID('tempdb..#SnomedSets') IS NOT NULL DROP TABLE #SnomedSets;
CREATE TABLE #SnomedSets (FK_Reference_SnomedCT_ID BIGINT NOT NULL, concept VARCHAR(255) NOT NULL);

IF OBJECT_ID('tempdb..#VersionedCodeSets') IS NOT NULL DROP TABLE #VersionedCodeSets;
CREATE TABLE #VersionedCodeSets (FK_Reference_Coding_ID BIGINT NOT NULL, Concept VARCHAR(255), [Version] INT);

IF OBJECT_ID('tempdb..#VersionedSnomedSets') IS NOT NULL DROP TABLE #VersionedSnomedSets;
CREATE TABLE #VersionedSnomedSets (FK_Reference_SnomedCT_ID BIGINT NOT NULL, Concept VARCHAR(255), [Version] INT);

INSERT INTO #VersionedCodeSets
SELECT DISTINCT * FROM #TempRefCodes;

INSERT INTO #VersionedSnomedSets
SELECT DISTINCT * FROM #TempSNOMEDRefCodes;

INSERT INTO #CodeSets
SELECT FK_Reference_Coding_ID, c.concept
FROM #VersionedCodeSets c
INNER JOIN (
  SELECT concept, MAX(version) AS maxVersion FROM #VersionedCodeSets
  GROUP BY concept)
sub ON sub.concept = c.concept AND c.version = sub.maxVersion;

INSERT INTO #SnomedSets
SELECT FK_Reference_SnomedCT_ID, c.concept
FROM #VersionedSnomedSets c
INNER JOIN (
  SELECT concept, MAX(version) AS maxVersion FROM #VersionedSnomedSets
  GROUP BY concept)
sub ON sub.concept = c.concept AND c.version = sub.maxVersion;

-- >>> Following codesets injected: hydroxychloroquine/leflunomide/methotrexate/prednisolone-oral/prednisone/sulfasalazine
SELECT 
	FK_Patient_Link_ID AS PatientId,
	GPPracticeCode,
	CAST(MedicationDate AS DATE) AS MedicationDate,
	SuppliedCode,
	MedicationDescription,
	CASE WHEN s.Concept IS NULL THEN c.Concept ELSE s.Concept END AS DrugType,
	Quantity,
	Dosage,
	Units,
	RepeatMedicationFlag
FROM RLS.vw_GP_Medications m
LEFT OUTER JOIN #VersionedSnomedSets s ON s.FK_Reference_SnomedCT_ID = m.FK_Reference_SnomedCT_ID
LEFT OUTER JOIN #VersionedCodeSets c ON c.FK_Reference_Coding_ID = m.FK_Reference_Coding_ID
WHERE FK_Patient_Link_ID IN (SELECT FK_Patient_Link_ID FROM #Patients)
AND (
	FK_Reference_SnomedCT_ID IN (SELECT FK_Reference_SnomedCT_ID FROM #VersionedSnomedSets WHERE Concept IN ('hydroxychloroquine','leflunomide','methotrexate','prednisolone-oral','prednisone','sulfasalazine') AND [Version]=1) OR
  FK_Reference_Coding_ID IN (SELECT FK_Reference_Coding_ID FROM #VersionedCodeSets WHERE Concept IN ('hydroxychloroquine','leflunomide','methotrexate','prednisolone-oral','prednisone','sulfasalazine') AND [Version]=1)
);
