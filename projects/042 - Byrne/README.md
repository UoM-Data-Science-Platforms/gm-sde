_This file is autogenerated. Please do not edit._

# What can GMCR tell us about attendance and prescription patterns for dental problems seen in primary medical care before and during covid?

## Summary

Six GP consultations per 1000 patient-years in the UK from 2016-2019 were for dental problems. The COVID-19
pandemic has resulted in 68.7% fewer courses of NHS dental treatment in 2020-2021 , this lack of access to dental
care may have led patients to seek care from GPs instead. GPs cannot properly diagnose dental disease and, before
COVID, 57.1% of consultations with a GP for dental problems resulted in an antibiotic prescription. Treating dental
conditions is outside of the scope of GPs as dental problems require dental procedures rather than prescriptions. GPs
seeing people with dental problems is, therefore, an inefficient use of time and resources, and raises concerns
surrounding antibiotic resistance which is driven by inappropriate use of antibiotics.

Greater Manchester (GM) has some of the poorest dental health in England and is a good test case to assess changes
in attendance patterns in GP and onward prescriptions. At present, there are no data available relating to GP
consultations for dental problems in GM, nor the outcomes of those consultations. The GMCR provides a key
opportunity to explore this issue within GM and factors that may be associated with it.

## Table of contents

- [Introduction](#introduction)
- [Methodology](#methodology)
- [Reusable queries](#reusable-queries)
- [Clinical code sets](#clinical-code-sets)

## Introduction

The aim of this document is to provide full transparency for all parts of the data extraction process.
This includes:

- The methodology around how the data extraction process is managed and quality is maintained.
- A full list of all queries used in the extraction, and their associated objectives and assumptions.
- A full list of all clinical codes used for the extraction.

## Methodology

After each proposal is approved, a Research Data Engineer (RDE) works closely with the research team to establish precisely what data they require and in what format.
The RDE has access to the entire de-identified database and so builds up an expertise as to which projects are feasible and how best to extract the relevant data.
The RDE has access to a library of resusable SQL queries for common tasks, and sets of clinical codes for different phenotypes, built up from previous studies.
Prior to data extraction, the code is checked and signed off by another RDE.

## Reusable queries
  
This project required the following reusable queries:

- GET practice and ccg for each patient
- CCG lookup table
- Lower level super output area
- Sex
- Year of birth
- Patient GP encounters

Further details for each query can be found below.

### GET practice and ccg for each patient
For each patient to get the practice id that they are registered to, and the CCG name that the practice belongs to.

_Input_
```
Assumes there exists a temp table as follows:
 #Patients (FK_Patient_Link_ID)
  A distinct list of FK_Patient_Link_IDs for each patient in the cohort
```

_Output_
```
Two temp tables as follows:
 #PatientPractice (FK_Patient_Link_ID, GPPracticeCode)
	- FK_Patient_Link_ID - unique patient id
	- GPPracticeCode - the nationally recognised practice id for the patient
 #PatientPracticeAndCCG (FK_Patient_Link_ID, GPPracticeCode, CCG)
	- FK_Patient_Link_ID - unique patient id
	- GPPracticeCode - the nationally recognised practice id for the patient
	- CCG - the name of the patient's CCG
```
_File_: `query-patient-practice-and-ccg.sql`

_Link_: [https://github.com/rw251/.../query-patient-practice-and-ccg.sql](https://github.com/rw251/gm-idcr/tree/master/shared/Reusable%20queries%20for%20data%20extraction/query-patient-practice-and-ccg.sql)

---
### CCG lookup table
To provide lookup table for CCG names. The GMCR provides the CCG id (e.g. '00T', '01G') but not the CCG name. This table can be used in other queries when the output is required to be a ccg name rather than an id.

_Input_
```
No pre-requisites
```

_Output_
```
A temp table as follows:
 #CCGLookup (CcgId, CcgName)
 	- CcgId - Nationally recognised ccg id
	- CcgName - Bolton, Stockport etc..
```
_File_: `query-ccg-lookup.sql`

_Link_: [https://github.com/rw251/.../query-ccg-lookup.sql](https://github.com/rw251/gm-idcr/tree/master/shared/Reusable%20queries%20for%20data%20extraction/query-ccg-lookup.sql)

---
### Lower level super output area
To get the LSOA for each patient.

_Assumptions_

- Patient data is obtained from multiple sources. Where patients have multiple LSOAs we determine the LSOA as follows:
- If the patients has an LSOA in their primary care data feed we use that as most likely to be up to date
- If every LSOA for a paitent is the same, then we use that
- If there is a single most recently updated LSOA in the database then we use that
- Otherwise the patient's LSOA is considered unknown

_Input_
```
Assumes there exists a temp table as follows:
 #Patients (FK_Patient_Link_ID)
  A distinct list of FK_Patient_Link_IDs for each patient in the cohort
```

_Output_
```
A temp table as follows:
 #PatientLSOA (FK_Patient_Link_ID, LSOA)
 	- FK_Patient_Link_ID - unique patient id
	- LSOA_Code - nationally recognised LSOA identifier
```
_File_: `query-patient-lsoa.sql`

_Link_: [https://github.com/rw251/.../query-patient-lsoa.sql](https://github.com/rw251/gm-idcr/tree/master/shared/Reusable%20queries%20for%20data%20extraction/query-patient-lsoa.sql)

---
### Sex
To get the Sex for each patient.

_Assumptions_

- Patient data is obtained from multiple sources. Where patients have multiple sexes we determine the sex as follows:
- If the patients has a sex in their primary care data feed we use that as most likely to be up to date
- If every sex for a patient is the same, then we use that
- If there is a single most recently updated sex in the database then we use that
- Otherwise the patient's sex is considered unknown

_Input_
```
Assumes there exists a temp table as follows:
 #Patients (FK_Patient_Link_ID)
  A distinct list of FK_Patient_Link_IDs for each patient in the cohort
```

_Output_
```
A temp table as follows:
 #PatientSex (FK_Patient_Link_ID, Sex)
 	- FK_Patient_Link_ID - unique patient id
	- Sex - M/F
```
_File_: `query-patient-sex.sql`

_Link_: [https://github.com/rw251/.../query-patient-sex.sql](https://github.com/rw251/gm-idcr/tree/master/shared/Reusable%20queries%20for%20data%20extraction/query-patient-sex.sql)

---
### Year of birth
To get the year of birth for each patient.

_Assumptions_

- Patient data is obtained from multiple sources. Where patients have multiple YOBs we determine the YOB as follows:
- If the patients has a YOB in their primary care data feed we use that as most likely to be up to date
- If every YOB for a patient is the same, then we use that
- If there is a single most recently updated YOB in the database then we use that
- Otherwise we take the highest YOB for the patient that is not in the future

_Input_
```
Assumes there exists a temp table as follows:
 #Patients (FK_Patient_Link_ID)
  A distinct list of FK_Patient_Link_IDs for each patient in the cohort
```

_Output_
```
A temp table as follows:
 #PatientYearOfBirth (FK_Patient_Link_ID, YearOfBirth)
 	- FK_Patient_Link_ID - unique patient id
	- YearOfBirth - INT
```
_File_: `query-patient-year-of-birth.sql`

_Link_: [https://github.com/rw251/.../query-patient-year-of-birth.sql](https://github.com/rw251/gm-idcr/tree/master/shared/Reusable%20queries%20for%20data%20extraction/query-patient-year-of-birth.sql)

---
### Patient GP encounters
To produce a table of GP encounters for a list of patients. This script uses many codes related to observations (e.g. blood pressure), symptoms, and diagnoses, to infer when GP encounters occured. This script includes face to face and telephone encounters - it will need copying and editing if you don't require both.

_Assumptions_

- multiple codes on the same day will be classed as one encounter (so max daily encounters per patient is 1)

_Input_
```
Assumes there exists a temp table as follows:
 #Patients (FK_Patient_Link_ID)
  A distinct list of FK_Patient_Link_IDs for each patient in the cohort
```

_Output_
```
A temp table as follows:
 #GPEncounters (FK_Patient_Link_ID, EncounterDate)
	- FK_Patient_Link_ID - unique patient id
	- EncounterDate - date the patient had a GP encounter
```
_File_: `query-patient-gp-encounters.sql`

_Link_: [https://github.com/rw251/.../query-patient-gp-encounters.sql](https://github.com/rw251/gm-idcr/tree/master/shared/Reusable%20queries%20for%20data%20extraction/query-patient-gp-encounters.sql)
## Clinical code sets

This project required the following clinical code sets:

- dental-problem v1
- antibacterial-drugs v1
- non-opioid-analgesics v1
- opioid-analgesics v1
- benzodiazepines v1
- diabetes-type-i v1
- diabetes-type-ii v1
- cancer v1
- coronary-heart-disease v1

Further details for each code set can be found below.

### Dental problem

Any code indicating a dental diagnosis or dental issue. This code set is likely only useful for RQ042 as it is not very specific and includes everything from dental diagnoses, to symptoms such as tooth ache, to issues with dental restoration work.
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `5.00% - 6.22%` when searching by ID and `6.04% - 6.96%` when searching by code, suggests that this code set is well defined.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2021-10-13 | EMIS            | 2664831    |   158024 (5.93%) |    160906 (6.04%) |
| 2021-10-13 | TPP             | 212907     |    10646 (5.00%) |     14828 (6.96%) |
| 2021-10-13 | Vision          | 343146     |    21349 (6.22%) |     21487 (6.26%) |

LINK: [https://github.com/rw251/.../patient/dental-problem/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/patient/dental-problem/1)

### Antibacterial drugs

A prescription of any antibacterial drug.
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range from the code is `72.0% - 78.9%` suggests that this code set is well defined.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2022-07-05 | EMIS            | 2664831    |  1722381 (64.6%) |   1918924 (72.0%) |
| 2022-07-05 | TPP             | 212907     |   166955 (78.4%) |    167967 (78.9%) |
| 2022-07-05 | Vision          | 343146     |   233074 (67.9%) |    250909 (73.1%) |

LINK: [https://github.com/rw251/.../medications/antibacterial-drugs/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/medications/antibacterial-drugs/1)

### Non-opioid analgesics

A prescription of any non-opioid analgesics.
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range from the code is `44.5% - 48.7%` suggests that this code set is well defined.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2022-07-05 | EMIS            | 2664831    | 1170294 (43.9 %) |   1298809 (48.7%) |
| 2022-07-05 | TPP             | 212907     |  101749 (47.8 %) |    103079 (48.4%) |
| 2022-07-05 | Vision          | 343146     |  142177 (41.4 %) |    152719 (44.5%) |

LINK: [https://github.com/rw251/.../medications/non-opioid-analgesics/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/medications/non-opioid-analgesics/1)

### Opioid analgesics

A prescription of any opioid analgesics.
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range from the code is `15.7% - 19.1%` suggests that this code set is well defined.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2022-07-05 | EMIS            | 2664831    |   410584 (15.4%) |    429274 (16.1%) |
| 2022-07-05 | TPP             | 212907     |    39459 (18.5%) |     40687 (19.1%) |
| 2022-07-05 | Vision          | 343146     |    52274 (15.2%) |     53983 (15.7%) |

LINK: [https://github.com/rw251/.../medications/opioid-analgesics/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/medications/opioid-analgesics/1)

### Benzodiazepines

A prescription of any benzodiazepine.
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range from the code is `10.1% - 11.5%` suggests that this code set is well defined.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2022-07-05 | EMIS            | 2664831    |   259586 (9.74%) |    269596 (10.1%) |
| 2022-07-05 | TPP             | 212907     |    23908 (11.2%) |     24427 (11.5%) |
| 2022-07-05 | Vision          | 343146     |    35370 (10.3%) |     36514 (10.6%) |

LINK: [https://github.com/rw251/.../medications/benzodiazepines/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/medications/benzodiazepines/1)

### Diabetes mellitus type 1

Any diagnosis of T1DM. A super set of the QOF business rule.

Developed from https://getset.ga.
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `0.42% - 0.48%` suggests that this code set is well defined.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2021-05-07 | EMIS            | 2605681    |    11381 (0.44%) |     11381 (0.44%) |
| 2021-05-07 | TPP             | 210817     |      887 (0.42%) |       887 (0.42%) |
| 2021-05-07 | Vision          | 334632     |     1607 (0.48%) |      1607 (0.48%) |

LINK: [https://github.com/rw251/.../conditions/diabetes-type-i/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/conditions/diabetes-type-i/1)

### Diabetes mellitus type 2

Any diagnosis of T2DM. A super set of the QOF business rule. Includes "adult onset" diabetes, but DOES NOT include "maturity onset" diabetes.

Developed from https://getset.ga.
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `5.06% - 5.20%` suggests that this code set is well defined.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2021-05-07 | EMIS            | 2605681    |   133938 (5.14%) |    133938 (5.14%) |
| 2021-05-07 | TPP             | 210817     |    10954 (5.20%) |     10954 (5.20%) |
| 2021-05-07 | Vision          | 334632     |    16936 (5.06%) |     16933 (5.06%) |

LINK: [https://github.com/rw251/.../conditions/diabetes-type-ii/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/conditions/diabetes-type-ii/1)

### Cancer
Readv2 codes from code sets published by in:

Zhu Y, Edwards D, Mant J, Payne RA, Kiddle S. Characteristics, service use and mortality of clusters of multimorbid patients in England: A population-based study. BMC Med [Internet]. 2020 Apr 10 [cited 2021 Apr 14];18(1):78. Available from: https://bmcmedicine.biomedcentral.com/articles/10.1186/s12916-020-01543-8

The above paper used the definition of LTCs as first determined in:

Barnett K, Mercer SW, Norbury M, Watt G, Wyke S, Guthrie B. Epidemiology of multimorbidity and implications for health care, research, and medical education: A cross-sectional study. Lancet [Internet]. 2012 Jul 7 [cited 2021 Apr 14];380(9836):37â€“43. Available from: www.thelancet.com

CTV3 and SNOMED code sets from OpenSafely.

ICD10 codes have been provided and verified by the Christie team (004). 
#### Prevalence log
By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set, as of 19th July 2021.

| Concept | Version   | System    | Patients | PatientsWithConcept | PatientsWithConceptFromCode | PercentageOfPatients | PercentageOfPatientsFromCode |
| :-----: | :-------: | :-------: | :------: | :-----------------: | :-------------------------: | :------------------: | :--------------------------: |
| cancer  | 1         | EMIS      | 2615750  | 118723              | 78901                       | 4.53877473000096     | 3.01638153493262             |
| cancer  | 1         | TPP       | 211345   | 9607	               | 7280                        | 4.5456481109087      | 3.44460479311079             |
| cancer  | 1         | Vision    | 336528   | 16642               | 11427                       | 4.94520515380592     | 3.39555698188561             |


LINK: [https://github.com/rw251/.../conditions/cancer/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/conditions/cancer/1)

### Coronary heart disease

This code set was developed from https://www.phpc.cam.ac.uk/pcu/research/research-groups/crmh/cprd_cam/codelists/v11/. Codes indicate a diagnosis of CHD.
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `2.75% - 3.09%` suggests that this code set is well defined.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2021-05-18 | EMIS            | 2662570    |   73153 (2.75%)  |    73156 (2.75%)  |
| 2021-05-18 | TPP             | 212696     |    6550 (3.08%)  |     6576 (3.09%)  |
| 2021-05-18 | Vision          | 342344     |   10209 (2.98%)  |    10209 (2.98%)  |

LINK: [https://github.com/rw251/.../conditions/coronary-heart-disease/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/conditions/coronary-heart-disease/1)
# Clinical code sets

All code sets required for this analysis are available here: [https://github.com/rw251/.../042 - Byrne/clinical-code-sets.csv](https://github.com/rw251/gm-idcr/tree/master/projects/042%20-%20Byrne/clinical-code-sets.csv). Individual lists for each concept can also be found by using the links above.