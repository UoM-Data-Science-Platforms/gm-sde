_This file is autogenerated. Please do not edit._

# _TODO_ - project title

## Summary

**TODO** edit `about.md` to insert a brief lay summary of the work.

## Table of contents

- [Introduction](#introduction)
- [Methodology](#methodology)
- [Reusable queries](#reusable-queries)
- [Clinical code sets](#clinical-code-sets)

## Introduction

The aim of this document is to provide full transparency for all parts of the data extraction process.
This includes:

- The methodology around how the data extraction process is managed and quality is maintained.
- A full list of all queries used in the extraction, and their associated objectives and assumptions.
- A full list of all clinical codes used for the extraction.

## Methodology

After each proposal is approved, a Research Data Engineer (RDE) works closely with the research team to establish precisely what data they require and in what format.
The RDE has access to the entire de-identified database and so builds up an expertise as to which projects are feasible and how best to extract the relevant data.
The RDE has access to a library of resusable SQL queries for common tasks, and sets of clinical codes for different phenotypes, built up from previous studies.
Prior to data extraction, the code is checked and signed off by another RDE.

## Reusable queries
  
This project required the following reusable queries:

- GET No. LTCS per patient
- Long-term conditions and comorbidities
- Year of birth
- Index Multiple Deprivation
- Sex

Further details for each query can be found below.

### GET No. LTCS per patient
To get the number of long-term conditions for each patient.

_Input_
```
Assumes there exists a temp table as follows:
 #PatientsWithLTCs (FK_Patient_Link_ID, LTC)
 Therefore this is run after query-patient-ltcs.sql
```

_Output_
```
A temp table with a row for each patient with the number of LTCs they have
 #NumLTCs (FK_Patient_Link_ID, NumberOfLTCs)
```
_File_: `query-patient-ltcs-number-of.sql`

_Link_: [https://github.com/rw251/.../query-patient-ltcs-number-of.sql](https://github.com/rw251/gm-idcr/tree/master/shared/Reusable%20queries%20for%20data%20extraction/query-patient-ltcs-number-of.sql)

---
### Long-term conditions and comorbidities
To get long-term conditions for each patient within a date range.

_Input_
```
Assumes there exists a temp table as follows:
 #Patients (FK_Patient_Link_ID)
 A distinct list of FK_Patient_Link_IDs for each patient in the cohort
 @IndexDate - The index date of the study
 @MinDate - The minimum date that the study has access from
```

_Output_
```
A temp table with a row for each patient and ltc combo
 #PatientsWithLTCs
   FK_Patient_Link_ID,
   Condition,
   FirstDate,
   LastDate,
   NoInLastYear,number of times mentioned in year prior to index date
   LTCflag, flag to indicate whether is a long condition (Y) or not (N) - see comments on code for defining long term conditions.
```
_File_: `query-patient-ltcs-date-range.sql`

_Link_: [https://github.com/rw251/.../query-patient-ltcs-date-range.sql](https://github.com/rw251/gm-idcr/tree/master/shared/Reusable%20queries%20for%20data%20extraction/query-patient-ltcs-date-range.sql)

---
### Year of birth
To get the year of birth for each patient.

_Assumptions_

- Patient data is obtained from multiple sources. Where patients have multiple YOBs we determine the YOB as follows:
- If the patients has a YOB in their primary care data feed we use that as most likely to be up to date
- If every YOB for a patient is the same, then we use that
- If there is a single most recently updated YOB in the database then we use that
- Otherwise we take the highest YOB for the patient that is not in the future

_Input_
```
Assumes there exists a temp table as follows:
 #Patients (FK_Patient_Link_ID)
  A distinct list of FK_Patient_Link_IDs for each patient in the cohort
```

_Output_
```
A temp table as follows:
 #PatientYearOfBirth (FK_Patient_Link_ID, YearOfBirth)
 	- FK_Patient_Link_ID - unique patient id
	- YearOfBirth - INT
```
_File_: `query-patient-year-of-birth.sql`

_Link_: [https://github.com/rw251/.../query-patient-year-of-birth.sql](https://github.com/rw251/gm-idcr/tree/master/shared/Reusable%20queries%20for%20data%20extraction/query-patient-year-of-birth.sql)

---
### Index Multiple Deprivation
To get the 2019 Index of Multiple Deprivation (IMD) decile for each patient.

_Input_
```
Assumes there exists a temp table as follows:
 #Patients (FK_Patient_Link_ID)
  A distinct list of FK_Patient_Link_IDs for each patient in the cohort
```

_Output_
```
A temp table as follows:
 #PatientIMDDecile (FK_Patient_Link_ID, IMD2019Decile1IsMostDeprived10IsLeastDeprived)
 	- FK_Patient_Link_ID - unique patient id
	- IMD2019Decile1IsMostDeprived10IsLeastDeprived - number 1 to 10 inclusive
```
_File_: `query-patient-imd.sql`

_Link_: [https://github.com/rw251/.../query-patient-imd.sql](https://github.com/rw251/gm-idcr/tree/master/shared/Reusable%20queries%20for%20data%20extraction/query-patient-imd.sql)

---
### Sex
To get the Sex for each patient.

_Assumptions_

- Patient data is obtained from multiple sources. Where patients have multiple sexes we determine the sex as follows:
- If the patients has a sex in their primary care data feed we use that as most likely to be up to date
- If every sex for a patient is the same, then we use that
- If there is a single most recently updated sex in the database then we use that
- Otherwise the patient's sex is considered unknown

_Input_
```
Assumes there exists a temp table as follows:
 #Patients (FK_Patient_Link_ID)
  A distinct list of FK_Patient_Link_IDs for each patient in the cohort
```

_Output_
```
A temp table as follows:
 #PatientSex (FK_Patient_Link_ID, Sex)
 	- FK_Patient_Link_ID - unique patient id
	- Sex - M/F
```
_File_: `query-patient-sex.sql`

_Link_: [https://github.com/rw251/.../query-patient-sex.sql](https://github.com/rw251/gm-idcr/tree/master/shared/Reusable%20queries%20for%20data%20extraction/query-patient-sex.sql)
## Clinical code sets

This project did not require any clinical code sets.
# Clinical code sets

All code sets required for this analysis are listed here. Individual lists for each concept can also be found by using the links above.

| Clinical concept | Terminology | Code | Description |
| ---------------- | ----------- | ---- | ----------- |