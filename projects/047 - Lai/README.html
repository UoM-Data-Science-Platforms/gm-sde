<style>@page {
  margin: 1.5cm;
  size: A4 portrait;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Helvetica, Arial, sans-serif,
    Apple Color Emoji, Segoe UI Emoji;
  font-size: 16px;
  line-height: 1.5;
  word-wrap: break-word;
  margin-bottom: 0;
}

body > :last-child {
  margin-bottom: -1px;
  overflow: hidden;
}

h1 {
  font-size: 2em;
}

h2 {
  font-size: 1.5em;
}

h3 {
  font-size: 1.25em;
}

h4 {
  font-size: 1em;
}

h1,
h2,
h3,
h4 {
  margin-top: 24px;
  margin-bottom: 16px;
  font-weight: 600;
  line-height: 1.25;
}

b,
strong {
  font-weight: 600;
}

p {
  text-align: justify;
}

table {
  break-inside: avoid;
  table-layout: auto;
  border-collapse: collapse;
  text-indent: 0;
  border-color: inherit;
  width: 100%;
}

th {
  background: #f3f4f4;
}

th,
td {
  padding: 5px;
  border: 1px solid black;
}

code {
  padding: 0.2em 0.4em;
  margin: 0;
  font-family: ui-monospace, SFMono-Regular, SF Mono, Consolas, Liberation Mono, Menlo, monospace;
  font-size: 85%;
  background-color: #f3f4f4;
  border-radius: 6px;
  white-space: nowrap;
}

pre {
  padding: 16px;
  overflow: auto;
  font-size: 85%;
  line-height: 1.45;
  background-color: #f6f8fa;
  border-radius: 6px;
}

pre > code {
  word-wrap: normal;
  white-space: pre-wrap;
  background-color: #f6f8fa;
}
</style><p><em>This file is autogenerated. Please do not edit.</em></p>
<h1><em>TODO</em> - project title</h1>
<h2>Summary</h2>
<p><strong>TODO</strong> edit <code>about.md</code> to insert a brief lay summary of the work.</p>
<h2>Table of contents</h2>
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#methodology">Methodology</a></li>
<li><a href="#reusable-queries">Reusable queries</a></li>
<li><a href="#clinical-code-sets">Clinical code sets</a></li>
</ul>
<h2>Introduction</h2>
<p>The aim of this document is to provide full transparency for all parts of the data extraction process.
This includes:</p>
<ul>
<li>The methodology around how the data extraction process is managed and quality is maintained.</li>
<li>A full list of all queries used in the extraction, and their associated objectives and assumptions.</li>
<li>A full list of all clinical codes used for the extraction.</li>
</ul>
<h2>Methodology</h2>
<p>After each proposal is approved, a Research Data Engineer (RDE) works closely with the research team to establish precisely what data they require and in what format.
The RDE has access to the entire de-identified database and so builds up an expertise as to which projects are feasible and how best to extract the relevant data.
The RDE has access to a library of resusable SQL queries for common tasks, and sets of clinical codes for different phenotypes, built up from previous studies.
Prior to data extraction, the code is checked and signed off by another RDE.</p>
<h2>Reusable queries</h2>
<p>This project required the following reusable queries:</p>
<ul>
<li>Lower level super output area</li>
<li>GET practice and ccg for each patient</li>
<li>CCG lookup table</li>
<li>Year of birth</li>
<li>Index Multiple Deprivation</li>
<li>Sex</li>
</ul>
<p>Further details for each query can be found below.</p>
<h3>Lower level super output area</h3>
<p>To get the LSOA for each patient.</p>
<p><em>Assumptions</em></p>
<ul>
<li>Patient data is obtained from multiple sources. Where patients have multiple LSOAs we determine the LSOA as follows:</li>
<li>If the patients has an LSOA in their primary care data feed we use that as most likely to be up to date</li>
<li>If every LSOA for a paitent is the same, then we use that</li>
<li>If there is a single most recently updated LSOA in the database then we use that</li>
<li>Otherwise the patient's LSOA is considered unknown</li>
</ul>
<p><em>Input</em></p>
<pre><code>Assumes there exists a temp table as follows:
 #Patients (FK_Patient_Link_ID)
  A distinct list of FK_Patient_Link_IDs for each patient in the cohort
</code></pre>
<p><em>Output</em></p>
<pre><code>A temp table as follows:
 #PatientLSOA (FK_Patient_Link_ID, LSOA)
 	- FK_Patient_Link_ID - unique patient id
	- LSOA_Code - nationally recognised LSOA identifier
</code></pre>
<p><em>File</em>: <code>query-patient-lsoa.sql</code></p>
<p><em>Link</em>: <a href="https://github.com/rw251/gm-idcr/tree/master/shared/Reusable%20queries%20for%20data%20extraction/query-patient-lsoa.sql">https://github.com/rw251/.../query-patient-lsoa.sql</a></p>
<hr>
<h3>GET practice and ccg for each patient</h3>
<p>For each patient to get the practice id that they are registered to, and the CCG name that the practice belongs to.</p>
<p><em>Input</em></p>
<pre><code>Assumes there exists a temp table as follows:
 #Patients (FK_Patient_Link_ID)
  A distinct list of FK_Patient_Link_IDs for each patient in the cohort
</code></pre>
<p><em>Output</em></p>
<pre><code>Two temp tables as follows:
 #PatientPractice (FK_Patient_Link_ID, GPPracticeCode)
	- FK_Patient_Link_ID - unique patient id
	- GPPracticeCode - the nationally recognised practice id for the patient
 #PatientPracticeAndCCG (FK_Patient_Link_ID, GPPracticeCode, CCG)
	- FK_Patient_Link_ID - unique patient id
	- GPPracticeCode - the nationally recognised practice id for the patient
	- CCG - the name of the patient's CCG
</code></pre>
<p><em>File</em>: <code>query-patient-practice-and-ccg.sql</code></p>
<p><em>Link</em>: <a href="https://github.com/rw251/gm-idcr/tree/master/shared/Reusable%20queries%20for%20data%20extraction/query-patient-practice-and-ccg.sql">https://github.com/rw251/.../query-patient-practice-and-ccg.sql</a></p>
<hr>
<h3>CCG lookup table</h3>
<p>To provide lookup table for CCG names. The GMCR provides the CCG id (e.g. '00T', '01G') but not the CCG name. This table can be used in other queries when the output is required to be a ccg name rather than an id.</p>
<p><em>Input</em></p>
<pre><code>No pre-requisites
</code></pre>
<p><em>Output</em></p>
<pre><code>A temp table as follows:
 #CCGLookup (CcgId, CcgName)
 	- CcgId - Nationally recognised ccg id
	- CcgName - Bolton, Stockport etc..
</code></pre>
<p><em>File</em>: <code>query-ccg-lookup.sql</code></p>
<p><em>Link</em>: <a href="https://github.com/rw251/gm-idcr/tree/master/shared/Reusable%20queries%20for%20data%20extraction/query-ccg-lookup.sql">https://github.com/rw251/.../query-ccg-lookup.sql</a></p>
<hr>
<h3>Year of birth</h3>
<p>To get the year of birth for each patient.</p>
<p><em>Assumptions</em></p>
<ul>
<li>Patient data is obtained from multiple sources. Where patients have multiple YOBs we determine the YOB as follows:</li>
<li>If the patients has a YOB in their primary care data feed we use that as most likely to be up to date</li>
<li>If every YOB for a patient is the same, then we use that</li>
<li>If there is a single most recently updated YOB in the database then we use that</li>
<li>Otherwise we take the highest YOB for the patient that is not in the future</li>
</ul>
<p><em>Input</em></p>
<pre><code>Assumes there exists a temp table as follows:
 #Patients (FK_Patient_Link_ID)
  A distinct list of FK_Patient_Link_IDs for each patient in the cohort
</code></pre>
<p><em>Output</em></p>
<pre><code>A temp table as follows:
 #PatientYearOfBirth (FK_Patient_Link_ID, YearOfBirth)
 	- FK_Patient_Link_ID - unique patient id
	- YearOfBirth - INT
</code></pre>
<p><em>File</em>: <code>query-patient-year-of-birth.sql</code></p>
<p><em>Link</em>: <a href="https://github.com/rw251/gm-idcr/tree/master/shared/Reusable%20queries%20for%20data%20extraction/query-patient-year-of-birth.sql">https://github.com/rw251/.../query-patient-year-of-birth.sql</a></p>
<hr>
<h3>Index Multiple Deprivation</h3>
<p>To get the 2019 Index of Multiple Deprivation (IMD) decile for each patient.</p>
<p><em>Input</em></p>
<pre><code>Assumes there exists a temp table as follows:
 #Patients (FK_Patient_Link_ID)
  A distinct list of FK_Patient_Link_IDs for each patient in the cohort
</code></pre>
<p><em>Output</em></p>
<pre><code>A temp table as follows:
 #PatientIMDDecile (FK_Patient_Link_ID, IMD2019Decile1IsMostDeprived10IsLeastDeprived)
 	- FK_Patient_Link_ID - unique patient id
	- IMD2019Decile1IsMostDeprived10IsLeastDeprived - number 1 to 10 inclusive
</code></pre>
<p><em>File</em>: <code>query-patient-imd.sql</code></p>
<p><em>Link</em>: <a href="https://github.com/rw251/gm-idcr/tree/master/shared/Reusable%20queries%20for%20data%20extraction/query-patient-imd.sql">https://github.com/rw251/.../query-patient-imd.sql</a></p>
<hr>
<h3>Sex</h3>
<p>To get the Sex for each patient.</p>
<p><em>Assumptions</em></p>
<ul>
<li>Patient data is obtained from multiple sources. Where patients have multiple sexes we determine the sex as follows:</li>
<li>If the patients has a sex in their primary care data feed we use that as most likely to be up to date</li>
<li>If every sex for a patient is the same, then we use that</li>
<li>If there is a single most recently updated sex in the database then we use that</li>
<li>Otherwise the patient's sex is considered unknown</li>
</ul>
<p><em>Input</em></p>
<pre><code>Assumes there exists a temp table as follows:
 #Patients (FK_Patient_Link_ID)
  A distinct list of FK_Patient_Link_IDs for each patient in the cohort
</code></pre>
<p><em>Output</em></p>
<pre><code>A temp table as follows:
 #PatientSex (FK_Patient_Link_ID, Sex)
 	- FK_Patient_Link_ID - unique patient id
	- Sex - M/F
</code></pre>
<p><em>File</em>: <code>query-patient-sex.sql</code></p>
<p><em>Link</em>: <a href="https://github.com/rw251/gm-idcr/tree/master/shared/Reusable%20queries%20for%20data%20extraction/query-patient-sex.sql">https://github.com/rw251/.../query-patient-sex.sql</a></p>
<h2>Clinical code sets</h2>
<p>This project required the following clinical code sets:</p>
<ul>
<li>skin-cancer v1</li>
<li>gynaecological-cancer v1</li>
</ul>
<p>Further details for each code set can be found below.</p>
<h3>Skin cancer related codes</h3>
<p>Developed from https://getset.ga.</p>
<p>Please note that these codes are not stricly about skin cancer diagnosis but any codes related to skin cancer.</p>
<p>This list was reviewed by RQ047 team.</p>
<h4>Prevalence log</h4>
<p>By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range <code>10.9% - 15.2%</code> suggests that this code set is well defined.</p>
<table>
<thead>
<tr>
<th>Date</th>
<th>Practice system</th>
<th>Population</th>
<th style="text-align:right">Patients from ID</th>
<th style="text-align:right">Patient from code</th>
</tr>
</thead>
<tbody>
<tr>
<td>2022-11-29</td>
<td>EMIS</td>
<td>2435334</td>
<td style="text-align:right">400305 (16.4%)</td>
<td style="text-align:right">266578 (10.9%)</td>
</tr>
<tr>
<td>2022-11-29</td>
<td>TPP</td>
<td>198557</td>
<td style="text-align:right">30248 (15.2%)</td>
<td style="text-align:right">20248 (10.1%)</td>
</tr>
<tr>
<td>2022-11-29</td>
<td>Vision</td>
<td>326778</td>
<td style="text-align:right">61828 (18.9%)</td>
<td style="text-align:right">49780 (15.2%)</td>
</tr>
<tr>
<td>LINK: <a href="https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/conditions/skin-cancer/1">https://github.com/rw251/.../conditions/skin-cancer/1</a></td>
<td></td>
<td></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
</tbody>
</table>
<h3>Gynaecological cancer related codes</h3>
<p>Developed from https://getset.ga.</p>
<p>Please note that these codes are not stricly about gynaecological cancer diagnosis but any codes related to gynaecological cancer.</p>
<p>This list was reviewed by RQ047 team.</p>
<h4>Prevalence log</h4>
<p>By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range <code>8.2% - 14.6%</code> suggests that this code set is well defined.</p>
<table>
<thead>
<tr>
<th>Date</th>
<th>Practice system</th>
<th>Population</th>
<th style="text-align:right">Patients from ID</th>
<th style="text-align:right">Patient from code</th>
</tr>
</thead>
<tbody>
<tr>
<td>2022-11-29</td>
<td>EMIS</td>
<td>2435334</td>
<td style="text-align:right">260581 (10.7%)</td>
<td style="text-align:right">253827 (10.4%)</td>
</tr>
<tr>
<td>2022-11-29</td>
<td>TPP</td>
<td>198557</td>
<td style="text-align:right">25985 (13.1%)</td>
<td style="text-align:right">29003 (14.6%)</td>
</tr>
<tr>
<td>2022-11-29</td>
<td>Vision</td>
<td>326778</td>
<td style="text-align:right">27188 (8.3%)</td>
<td style="text-align:right">27005 (8.2%)</td>
</tr>
<tr>
<td>LINK: <a href="https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/conditions/gynaecological-cancer/1">https://github.com/rw251/.../conditions/gynaecological-cancer/1</a></td>
<td></td>
<td></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
</tr>
</tbody>
</table>
<h1>Clinical code sets</h1>
<p>All code sets required for this analysis are available here: <a href="https://github.com/rw251/gm-idcr/tree/master/projects/047%20-%20Lai/clinical-code-sets.csv">https://github.com/rw251/.../047 - Lai/clinical-code-sets.csv</a>. Individual lists for each concept can also be found by using the links above.</p>
