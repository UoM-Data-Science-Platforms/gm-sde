_This file is autogenerated. Please do not edit._

# _TODO_ - project title

## Summary

**TODO** edit `about.md` to insert a brief lay summary of the work.

## Table of contents

- [Introduction](#introduction)
- [Methodology](#methodology)
- [Reusable queries](#reusable-queries)
- [Clinical code sets](#clinical-code-sets)

## Introduction

The aim of this document is to provide full transparency for all parts of the data extraction process.
This includes:

- The methodology around how the data extraction process is managed and quality is maintained.
- A full list of all queries used in the extraction, and their associated objectives and assumptions.
- A full list of all clinical codes used for the extraction.

## Methodology

After each proposal is approved, a Research Data Engineer (RDE) works closely with the research team to establish precisely what data they require and in what format.
The RDE has access to the entire de-identified database and so builds up an expertise as to which projects are feasible and how best to extract the relevant data.
The RDE has access to a library of resusable SQL queries for common tasks, and sets of clinical codes for different phenotypes, built up from previous studies.
Prior to data extraction, the code is checked and signed off by another RDE.

## Reusable queries
  
This project required the following reusable queries:

- Lower level super output area
- GET practice and ccg for each patient
- CCG lookup table
- Year, month, week, and day of birth
- Index Multiple Deprivation
- Sex

Further details for each query can be found below.

### Lower level super output area
To get the LSOA for each patient.

_Assumptions_

- Patient data is obtained from multiple sources. Where patients have multiple LSOAs we determine the LSOA as follows:
- If the patients has an LSOA in their primary care data feed we use that as most likely to be up to date
- If every LSOA for a paitent is the same, then we use that
- If there is a single most recently updated LSOA in the database then we use that
- Otherwise the patient's LSOA is considered unknown

_Input_
```
Assumes there exists a temp table as follows:
 #Patients (FK_Patient_Link_ID)
  A distinct list of FK_Patient_Link_IDs for each patient in the cohort
```

_Output_
```
A temp table as follows:
 #PatientLSOA (FK_Patient_Link_ID, LSOA)
 	- FK_Patient_Link_ID - unique patient id
	- LSOA_Code - nationally recognised LSOA identifier
```
_File_: `query-patient-lsoa.sql`

_Link_: [https://github.com/rw251/.../query-patient-lsoa.sql](https://github.com/rw251/gm-idcr/tree/master/shared/Reusable%20queries%20for%20data%20extraction/query-patient-lsoa.sql)

---
### GET practice and ccg for each patient
For each patient to get the practice id that they are registered to, and the CCG name that the practice belongs to.

_Input_
```
Assumes there exists a temp table as follows:
 #Patients (FK_Patient_Link_ID)
  A distinct list of FK_Patient_Link_IDs for each patient in the cohort
```

_Output_
```
Two temp tables as follows:
 #PatientPractice (FK_Patient_Link_ID, GPPracticeCode)
	- FK_Patient_Link_ID - unique patient id
	- GPPracticeCode - the nationally recognised practice id for the patient
 #PatientPracticeAndCCG (FK_Patient_Link_ID, GPPracticeCode, CCG)
	- FK_Patient_Link_ID - unique patient id
	- GPPracticeCode - the nationally recognised practice id for the patient
	- CCG - the name of the patient's CCG
```
_File_: `query-patient-practice-and-ccg.sql`

_Link_: [https://github.com/rw251/.../query-patient-practice-and-ccg.sql](https://github.com/rw251/gm-idcr/tree/master/shared/Reusable%20queries%20for%20data%20extraction/query-patient-practice-and-ccg.sql)

---
### CCG lookup table
To provide lookup table for CCG names. The GMCR provides the CCG id (e.g. '00T', '01G') but not the CCG name. This table can be used in other queries when the output is required to be a ccg name rather than an id.

_Input_
```
No pre-requisites
```

_Output_
```
A temp table as follows:
 #CCGLookup (CcgId, CcgName)
 	- CcgId - Nationally recognised ccg id
	- CcgName - Bolton, Stockport etc..
```
_File_: `query-ccg-lookup.sql`

_Link_: [https://github.com/rw251/.../query-ccg-lookup.sql](https://github.com/rw251/gm-idcr/tree/master/shared/Reusable%20queries%20for%20data%20extraction/query-ccg-lookup.sql)

---
### Year, month, week, and day of birth
To get the date of birth for each patient, in various formats.

_Assumptions_

- Patient data is obtained from multiple sources. Where patients have multiple DateOfBirths we determine the DateOfBirth as follows:
- If the patients has a DateOfBirth in their primary care data feed we use that as most likely to be up to date
- If every DateOfBirth for a patient is the same, then we use that
- If there is a single most recently updated DateOfBirth in the database then we use that
- Otherwise we take the highest DateOfBirth for the patient that is not in the future

_Input_
```
Assumes there exists a temp table as follows:
 #Patients (FK_Patient_Link_ID)
  A distinct list of FK_Patient_Link_IDs for each patient in the cohort
```

_Output_
```
A temp table as follows:
 #PatientWeekOfBirth (FK_Patient_Link_ID, WeekOfBirth)
 	- FK_Patient_Link_ID - unique patient id
  - DateOfBirthPID (yyyy-mm-dd)  **not to be provided to study teams
  - DayOfBirth (dd) (1 to 31)
	- WeekOfBirth (ww) (1 to 52)
  - MonthOfBirth (mm) (1 to 12)
  - YearOfBirth (yyyy)
```
_File_: `query-patient-date-of-birth.sql`

_Link_: [https://github.com/rw251/.../query-patient-date-of-birth.sql](https://github.com/rw251/gm-idcr/tree/master/shared/Reusable%20queries%20for%20data%20extraction/query-patient-date-of-birth.sql)

---
### Index Multiple Deprivation
To get the 2019 Index of Multiple Deprivation (IMD) decile for each patient.

_Input_
```
Assumes there exists a temp table as follows:
 #Patients (FK_Patient_Link_ID)
  A distinct list of FK_Patient_Link_IDs for each patient in the cohort
```

_Output_
```
A temp table as follows:
 #PatientIMDDecile (FK_Patient_Link_ID, IMD2019Decile1IsMostDeprived10IsLeastDeprived)
 	- FK_Patient_Link_ID - unique patient id
	- IMD2019Decile1IsMostDeprived10IsLeastDeprived - number 1 to 10 inclusive
```
_File_: `query-patient-imd.sql`

_Link_: [https://github.com/rw251/.../query-patient-imd.sql](https://github.com/rw251/gm-idcr/tree/master/shared/Reusable%20queries%20for%20data%20extraction/query-patient-imd.sql)

---
### Sex
To get the Sex for each patient.

_Assumptions_

- Patient data is obtained from multiple sources. Where patients have multiple sexes we determine the sex as follows:
- If the patients has a sex in their primary care data feed we use that as most likely to be up to date
- If every sex for a patient is the same, then we use that
- If there is a single most recently updated sex in the database then we use that
- Otherwise the patient's sex is considered unknown

_Input_
```
Assumes there exists a temp table as follows:
 #Patients (FK_Patient_Link_ID)
  A distinct list of FK_Patient_Link_IDs for each patient in the cohort
```

_Output_
```
A temp table as follows:
 #PatientSex (FK_Patient_Link_ID, Sex)
 	- FK_Patient_Link_ID - unique patient id
	- Sex - M/F
```
_File_: `query-patient-sex.sql`

_Link_: [https://github.com/rw251/.../query-patient-sex.sql](https://github.com/rw251/gm-idcr/tree/master/shared/Reusable%20queries%20for%20data%20extraction/query-patient-sex.sql)
## Clinical code sets

This project required the following clinical code sets:

- skin-cancer v1
- gynaecological-cancer v1
- immunosuppression v1
- hiv v1
- hydrochlorothiazide v1
- diabetes v1
- cervical-smear v1
- contraceptives-combined-hormonal v1
- contraceptives-devices v1
- contraceptives-progesterone-only v1
- polycystic-ovarian-syndrome v1
- hormone-replacement-therapy-meds v1
- subcutaneous-squamous-cell-carcinoma v1
- basal-cell-carcinoma v1
- malignant-melanoma v1
- smoking-status-current v1
- smoking-status-currently-not v1
- smoking-status-ex v1
- smoking-status-ex-trivial v1
- smoking-status-never v1
- smoking-status-passive v1
- smoking-status-trivial v1
- bmi v2
- alcohol-non-drinker v1
- alcohol-light-drinker v1
- alcohol-moderate-drinker v1
- alcohol-heavy-drinker v1
- alcohol-weekly-intake v1

Further details for each code set can be found below.

### Skin cancer related codes

Developed from https://getset.ga.

Please note that these codes are not stricly about skin cancer diagnosis but any codes related to skin cancer. 

This list was reviewed by RQ047 team.
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `10.9% - 15.2%` suggests that this code set is well defined.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2022-11-29 | EMIS            | 2435334    |  400305 (16.4%)  |  266578 (10.9%)   |
| 2022-11-29 | TPP             | 198557     |   30248 (15.2%)  |   20248 (10.1%)   |
| 2022-11-29 | Vision          | 326778     |   61828 (18.9%)  |   49780 (15.2%)   |
| 2023-10-09 | EMIS            | 2464992    |  421529 (17.1%)  |  414325 (16.8%)   |
| 2023-10-09 | TPP             | 200426     |   32335 (16.1%)  |    18717 (9.3%)   |
| 2023-10-09 | Vision          | 331938     |   64774 (19.5%)  |   64270 (19.4%)   |
LINK: [https://github.com/rw251/.../conditions/skin-cancer/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/conditions/skin-cancer/1)

### Gynaecological cancer related codes

Developed from https://getset.ga and https://www.bgcs.org.uk/wp-content/uploads/2019/05/BAGP-SNOMED-CT-all-code-list-for-gynaecological-neoplasms.pdf

#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `0.7% - 1.8%` suggests that this code set is well defined.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2023-10-12 | EMIS            | 2470460    |    48650 (1.9%)  |    18311 (0.7%)   |
| 2023-10-12 | TPP             | 200512     |     5555 (2.7%)  |     3714 (1.8%)   |
| 2023-10-12 | Vision          | 332318     |     6337 (1.9%)  |     2612 (0.8%)   |
LINK: [https://github.com/rw251/.../conditions/gynaecological-cancer/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/conditions/gynaecological-cancer/1)

### Immunosuppression

Codes that indicate a patient has a diagnosis of temporary or permanent immunosuppression, excluding HIV. SNOMED and CTV3 codelist are from the OpenSAFELY team (see below for links). The Read 2 codelist is from the LSHTM Data Compass.

- [Immunosuppression - permanent (CTV3)](https://codelists.opensafely.org/codelist/opensafely/permanent-immunosuppression/2020-06-02/)
- [Immunosuppression - temporary (CTV3)](https://codelists.opensafely.org/codelist/opensafely/temporary-immunosuppression/2020-04-24/)
- [Immunosuppression - permanent (SNOMED)](https://codelists.opensafely.org/codelist/opensafely/permanent-immunosuppression-snomed/2020-06-02/)
- [Immunosuppression - temporary (SNOMED)](https://codelists.opensafely.org/codelist/opensafely/temporary-immunosuppression-snomed/2020-04-24/)
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set.

The discrepancy between the patients counted when using the IDs vs using the clinical codes is due to these being new codes which haven't all filtered through to the main Graphnet dictionary. The prevalence range `0.30% - 0.50%` is sufficiently narrow that this code set is likely well defined.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2021-03-11 | EMIS            | 2600658    |    11815 (0.45%) |     11453 (0.44%) |
| 2021-03-11 | TPP             | 210333     |      625 (0.30%) |       625 (0.30%) |
| 2021-03-11 | Vision          | 333251     |     1766 (0.53%) |      1667 (0.50%) |

LINK: [https://github.com/rw251/.../conditions/immunosuppression/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/conditions/immunosuppression/1)

### HIV

Codes indicating a diagnosis of HIV. Snomed and CTV3 codelist are from the [OpenSafely project](https://codelists.opensafely.org/codelist/opensafely/hiv/2020-07-13/#full-list). The Read 2 codelist is from the LSHTM Data Compass.
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `0.010% - 0.029%` is perhaps a bit wide, but as the numbers are so low it is likely well-defined.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2021-03-11 | EMIS            | 2600658    |     760 (0.029%) |      760 (0.029%) |
| 2021-03-11 | TPP             | 210333     |      39 (0.019%) |       39 (0.019%) |
| 2021-03-11 | Vision          | 333251     |      34 (0.010%) |       34 (0.010%) |

LINK: [https://github.com/rw251/.../conditions/hiv/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/conditions/hiv/1)

### Hydrochlorothiazide
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `0.71% - 1.35%` suggests that this code set is well defined. Though the Vision practices are perhaps slighly on the low side, though this could be due to the small numbers.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2022-08-18 | EMIS            | 2493056    |    19537 (0.78%) |     19564 (0.78%) |
| 2022-08-18 | TPP             | 198292     |     2558 (1.29%) |      2692 (1.35%) |
| 2022-08-18 | Vision          | 327521     |     2329 (0.71%) |      2329 (0.71%) |
LINK: [https://github.com/rw251/.../medications/hydrochlorothiazide/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/medications/hydrochlorothiazide/1)

### Diabetes mellitus

Code set for any diagnosis of diabetes mellitus (type I/type II/other).

Developed from https://getset.ga.
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `5.96% - 6.05%` suggests that this code set is well defined.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2021-05-07 | EMIS            | 2605681    |   155421 (5.96%) |    155398 (5.96%) |
| 2021-05-07 | TPP             | 210817     |    12743 (6.04%) |     12745 (6.05%) |
| 2021-05-07 | Vision          | 334632     |    20145 (6.02%) |     20145 (6.02%) |
| 2023-09-15 | EMIS            | 2463856    |    162625 (6.6%) |    148520 (6.03%) |
| 2023-09-15 | TPP             | 200590     |    15745 (7.85%) |     15685 (7.82%) |
| 2023-09-15 | Vision          | 332095     |    21031 (6.33%) |     18869 (5.68%) |

LINK: [https://github.com/rw251/.../conditions/diabetes/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/conditions/diabetes/1)

### Cervical smear

This set was created from getset.ga. These codes indicate patients who had cervical smear test (for example; cervical smear test result - negative), not the actual test event.
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set.

The discrepancy between the patients counted when using the IDs vs using the clinical codes is due to these being new codes which haven't all filtered through to the main Graphnet dictionary. The prevalence range `29.2% - 32.2%` is sufficiently narrow that this code set is likely well defined.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2022-09-12 | EMIS            | 2448237    |   718053 (29.3%) |    714376 (29.2%) |
| 2022-09-12 | TPP             | 198144     |    63989 (32.2%) |     89284 (45.0%) |
| 2022-09-12 | Vision          | 325732     |    95292 (29.2%) |     94454 (28.9%) |

LINK: [https://github.com/rw251/.../procedures/cervical-smear/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/procedures/cervical-smear/1)

### Contraceptives - combined hormonal

This code set was created from BNF codes (mapped to SNOMED) starting with 070301 (following same process as https://arro.anglia.ac.uk/id/eprint/707403/4/Walker_2022.pdf)
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `12.29% - 13.25%` suggests that this code set is well defined.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2022-05-05 | EMIS            | 2662112    |  332656 (12.50%) |      8254 (0.31%) |
| 2022-05-05 | TPP             |  212726    |   28179 (13.25%) |    26386 (12.40%) |
| 2022-05-05 | Vision          |  342310    |   42059 (12.29%) |     20642 (6.03%) |

LINK: [https://github.com/rw251/.../medications/contraceptives-combined-hormonal/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/medications/contraceptives-combined-hormonal/1)

### Contraceptives - devices

This code set was based on BNF codes (mapped to SNOMED) starting with '210400', following the approach in this paper: https://arro.anglia.ac.uk/id/eprint/707403/4/Walker_2022.pdf.
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `1.27% - 1.86%` suggests potential underreporting for TPP practices.


| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2022-05-04 | EMIS            | 2662112    |   48059 (1.81%)  |    48418 (1.82%)  |
| 2022-05-04 | TPP             |  212726    |     280 (0.13%)  |     2701 (1.27%)  |
| 2022-05-04 | Vision          |  342310    |    6374 (1.86%)  |     6379 (1.86%)  |
LINK: [https://github.com/rw251/.../medications/contraceptives-devices/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/medications/contraceptives-devices/1)

### Contraceptives - progesterone only

This code set was based on BNF codes (mapped to SNOMED) starting with 070302, following the approach used in https://arro.anglia.ac.uk/id/eprint/707403/4/Walker_2022.pdf
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `10.44% - 11.18%` suggests that this code set is well defined.


| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2022-05-04 | EMIS            | 2662112    |  288196 (10.83%) |      6054 (0.23%) |
| 2022-05-04 | TPP             |  212726    |   22204 (10.44%) |     20441 (9.61%) |
| 2022-05-04 | Vision          |  342310    |   38274 (11.18%) |     18983 (5.55%) |

LINK: [https://github.com/rw251/.../medications/contraceptives-progesterone-only/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/medications/contraceptives-progesterone-only/1)

### Polycystic Ovarian Syndrome 

Any diagnosis of polycystic ovarian syndrome.
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `1.1% - 1.4%` suggests that this code set is well defined.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2021-10-13 | EMIS            | 2629848    |    37029 (1.41%) |     37029 (1.41%) |
| 2021-10-13 | TPP             | 211812     |     2348 (1.11%) |      2348 (1.11%) |
| 2021-10-13 | Vision          | 338205     |     3829 (1.13%) |      3829 (1.13%) |
| 2023-10-09 | EMIS            | 2470638    |    31614 (1.28%) |     31493 (1.27%) |
| 2023-10-09 | TPP             | 200543     |     2577 (1.28%) |      2575 (1.28%) |
| 2023-10-09 | Vision          | 332371     |     3502 (1.05%) |      3471 (1.04%) |

LINK: [https://github.com/rw251/.../conditions/polycystic-ovarian-syndrome/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/conditions/polycystic-ovarian-syndrome/1)

### Hormone replacement therapy medications

This code set was created from BNF codes starting with 060401. A mapping from prod codes to BNF was used.
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `9.73% - 12.27%` suggests that this code set is well defined.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2022-06-28 | EMIS            | 2664831    |   259198 (9.73%) |  269103 (10.10%)  |
| 2022-06-28 | TPP             | 212907     |   26115 (12.27%) |    20152 (9.47%)  |
| 2022-06-28 | Vision          | 343146     |   34874 (10.16%) |    33414 (9.74%)  |
LINK: [https://github.com/rw251/.../medications/hormone-replacement-therapy-meds/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/medications/hormone-replacement-therapy-meds/1)

### Subcutaneous squamous cell carcinoma

Code set for patients with a diagnosis of SCC.

SNOMED codes provided by RQ047 (Lai)
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions.
Here is a log for this code set. The prevalence range (% - %)

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------- | ----------------- |
| 2024-04-08 | EMIS | 2528955 | 8532 (0.337%) | 8532 (0.337%) | 
| 2024-04-08 | TPP | 201791 | 636 (0.315%) | 636 (0.315%) | 
| 2024-04-08 | Vision | 335318 | 1039 (0.31%) | 1038 (0.31%) | 
LINK: [https://github.com/rw251/.../conditions/subcutaneous-squamous-cell-carcinoma/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/conditions/subcutaneous-squamous-cell-carcinoma/1)

### Basal cell carcinoma

Code set for patients with a diagnosis of BCC.

Codes retrieved manually from GMCR using any mention of 'basal cell carcinoma'
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions.
Here is a log for this code set. The prevalence range (1.41% - 1.79%)

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------- | ----------------- |
| 2024-04-19 | EMIS | 2529782 | 35602 (1.41%) | 35601 (1.41%) | 
| 2024-04-19 | TPP | 201840 | 3623 (1.79%) | 3623 (1.79%) | 
| 2024-04-19 | Vision | 335411 | 4917 (1.47%) | 4880 (1.45%) | 
LINK: [https://github.com/rw251/.../conditions/basal-cell-carcinoma/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/conditions/basal-cell-carcinoma/1)

### Malignant melanoma

This code set was created manually via the reference coding table in the GMCR, from all IDC10 codes beginning with 'C43'. The SNOMED term browser was also used to find the main term and all of its children.
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `0.25% - 0.28%` suggests that this code set is well defined.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2024-04-19 | EMIS | 2529782 | 6390 (0.253%) | 6389 (0.253%) | 
| 2024-04-19 | TPP | 201840 | 555 (0.275%) | 555 (0.275%) | 
| 2024-04-19 | Vision | 335411 | 893 (0.266%) | 893 (0.266%) | 
LINK: [https://github.com/rw251/.../conditions/malignant-melanoma/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/conditions/malignant-melanoma/1)

### Smoking status current

Any code suggestive that a patient is a current smoker.
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `22% - 27%` is sufficiently narrow that this code set is likely well defined.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2024-01-19 | EMIS            | 2519438    |   613314 (24.3%) |    607924 (24.1%) |
| 2024-01-19 | TPP             | 201469     |    53798 (26.7%) |     53814 (26.7%) |
| 2024-01-19 | Vision          | 334528     |    74805 (22.4%) |     74677 (22.3%) |
#### Audit log

- Find_missing_codes last run 2024-01-17

LINK: [https://github.com/rw251/.../patient/smoking-status-current/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/patient/smoking-status-current/1)

### Smoking status currently not

Any code suggestive that a patient is currently a non-smoker. This is different to the "never smoked" code set.
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `17% - 21%` is sufficiently narrow that this code set is likely well defined.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2024-01-19 | EMIS            | 2519438    |   521439 (20.7%) |    521519 (20.7%) |
| 2024-01-19 | TPP             | 201469     |    37505 (18.6%) |     37506 (18.6%) |
| 2024-01-19 | Vision          | 334528     |    57671 (17.2%) |     57505 (17.2%) |
#### Audit log

- Find_missing_codes last run 2024-01-17

LINK: [https://github.com/rw251/.../patient/smoking-status-currently-not/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/patient/smoking-status-currently-not/1)

### Smoking status ex

Any code suggestive that a patient is an ex-smoker.
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `24% - 29%` is sufficiently narrow that this code set is likely well defined.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2024-01-19 | EMIS            | 2519438    |   596405 (23.7%) |    596734 (23.7%) |
| 2024-01-19 | TPP             | 201469     |    57707 (28.6%) |     57720 (28.6%) |
| 2024-01-19 | Vision          | 334528     |    80560 (24.1%) |     80597 (24.1%) |
#### Audit log

- Find_missing_codes last run 2024-01-17

LINK: [https://github.com/rw251/.../patient/smoking-status-ex/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/patient/smoking-status-ex/1)

### Smoking status ex trivial

Codes showing a patient is currently a non smoker but has been a trivial smoker in the past.
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `0.3% - 1.0%` is sufficiently narrow that this code set is likely well defined.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2024-01-19 | EMIS            | 2519438    |   24616 (0.977%) |    24630 (0.978%) |
| 2024-01-19 | TPP             | 201469     |     1632 (0.81%) |     1633 (0.811%) |
| 2024-01-19 | Vision          | 334528     |    1076 (0.322%) |     1076 (0.322%) |
#### Audit log

- Find_missing_codes last run 2024-01-17

LINK: [https://github.com/rw251/.../patient/smoking-status-ex-trivial/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/patient/smoking-status-ex-trivial/1)

### Smoking status never

Any code suggestive that a patient has never smoked. This is different to the "currently not" code set.
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `51% - 55%` is sufficiently narrow that this code set is likely well defined.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2024-01-19 | EMIS            | 2519438    |  1392255 (55.3%) |   1353278 (53.7%) |
| 2024-01-19 | TPP             | 201469     |   110979 (55.1%) |      110723 (55%) |
| 2024-01-19 | Vision          | 334528     |   176702 (52.8%) |    172037 (51.4%) |
#### Audit log

- Find_missing_codes last run 2024-01-17

LINK: [https://github.com/rw251/.../patient/smoking-status-never/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/patient/smoking-status-never/1)

### Passive smoker

Any code suggesting the patient has been exposed to cigarette smoke passively.
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `1.2% - 1.5%` is sufficiently narrow that this code set is likely well defined.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2024-01-19 | EMIS            | 2519438    |    29106 (1.16%) |     29111 (1.16%) |
| 2024-01-19 | TPP             | 201469     |     2404 (1.19%) |      2404 (1.19%) |
| 2024-01-19 | Vision          | 334528     |     4931 (1.47%) |      4931 (1.47%) |
#### Audit log

- Find_missing_codes last run 2024-01-17

LINK: [https://github.com/rw251/.../patient/smoking-status-passive/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/patient/smoking-status-passive/1)

### Smoking status trivial

Any code suggesting the patient is currently smoking a trivial amount (on average less than 1 per day).
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `1.2% - 1.7%` is sufficiently narrow that this code set is likely well defined.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2024-01-19 | EMIS            | 2519438    |    38988 (1.55%) |     38950 (1.55%) |
| 2024-01-19 | TPP             | 201469     |     2919 (1.45%) |       2426 (1.2%) |
| 2024-01-19 | Vision          | 334528     |     5709 (1.71%) |      5708 (1.71%) |
#### Audit log

- Find_missing_codes last run 2024-01-17

LINK: [https://github.com/rw251/.../patient/smoking-status-trivial/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/patient/smoking-status-trivial/1)

### Body Mass Index (BMI)

A patient's BMI as recorded via clinical code and value. This code set only includes codes that are accompanied by a value (`22K.. - Body Mass Index`). It does not include codes that indicate a patient's BMI (`22K6. - Body mass index less than 20`) without giving the actual value.

**NB: This code set is intended to indicate a patient's BMI. If you need to know whether a BMI was recorded then please use v1 of the code set.**
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `63.96% - 79.69%` suggests that this code set is perhaps not well defined. However, as EMIS (80% of practices) and TPP (10% of practices) are close, it could simply be down to Vision automatically recording BMIs and therefore increasing the prevalence there.

**UPDATE** By looking at the prevalence of patients with a BMI code that also has a non-zero value the range becomes `62.48% - 64.93%` which suggests that this code set is well defined.

_Update **2023/11/01**: prevalence now `61.2% - 65.7%` for EMIS and VISION. TPP higher at 73%._

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2021-05-07 | EMIS            | 2605681    | 1709250 (65.60%) |  1709224 (65.60%) |
| 2021-05-07 | TPP             | 210817     |  134841 (63.96%) |   134835 (63.96%) |
| 2021-05-07 | Vision          | 334632     |  266612 (79.67%) |   266612 (79.67%) |
| 2021-05-11 | EMIS            | 2606497    | 1692442 (64.93%) |  1692422 (64.93%) |
| 2021-05-11 | TPP             | 210810     |  134652 (63.87%) |   134646 (63.87%) |
| 2021-05-11 | Vision          | 334784     |  209175 (62.48%) |   209175 (62.48%) |
| 2023-11-01 | EMIS            | 2472595    |  1624196 (65.7%) |   1624289 (65.7%) |
| 2023-11-01 | TPP             | 200603     |     146449 (73%) |      146448 (73%) |
| 2023-11-01 | Vision          | 332447     |   203333 (61.2%) |    203347 (61.2%) |
#### Audit log

- Find_missing_codes last run 2023-11-01

LINK: [https://github.com/rw251/.../patient/bmi/2](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/patient/bmi/2)

### Alcohol non drinker

Any code suggestive that a patient is a non-drinker.

LINK: [https://github.com/rw251/.../patient/alcohol-non-drinker/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/patient/alcohol-non-drinker/1)

### Alcohol light drinker

Any code suggestive that a patient is a light drinker.

LINK: [https://github.com/rw251/.../patient/alcohol-light-drinker/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/patient/alcohol-light-drinker/1)

### Alcohol moderate drinker

Any code suggestive that a patient is a moderate drinker.

LINK: [https://github.com/rw251/.../patient/alcohol-moderate-drinker/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/patient/alcohol-moderate-drinker/1)

### Alcohol heavy drinker

Any code suggestive that a patient is a heavy drinker.

LINK: [https://github.com/rw251/.../patient/alcohol-heavy-drinker/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/patient/alcohol-heavy-drinker/1)

### Alcohol intake per week

Any code indicative of a patient's alcohol intake per week.
LINK: [https://github.com/rw251/.../patient/alcohol-weekly-intake/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/patient/alcohol-weekly-intake/1)
# Clinical code sets

All code sets required for this analysis are available here: [https://github.com/rw251/.../047 - Lai/clinical-code-sets.csv](https://github.com/rw251/gm-idcr/tree/master/projects/047%20-%20Lai/clinical-code-sets.csv). Individual lists for each concept can also be found by using the links above.