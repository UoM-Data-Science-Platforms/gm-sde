--+--------------------------------------------------------------------------------+
--¦ Cervical screening longitudinal information (gynae cohort)                     ¦
--+--------------------------------------------------------------------------------+

-------- RESEARCH DATA ENGINEER CHECK ---------

-- OUTPUT: Data with the following fields
-- PatientId
-- EventDate (YYYY-MM-DD)


-- >>> Codesets required... Inserting the code set code
--
--┌────────────────────┐
--│ Clinical code sets │
--└────────────────────┘

-- OBJECTIVE: To populate temporary tables with the existing clinical code sets.
--            See the [SQL-generation-process.md](SQL-generation-process.md) for more details.

-- INPUT: No pre-requisites

-- OUTPUT: Five temp tables as follows:
--  #AllCodes (Concept, Version, Code)
--  #CodeSets (FK_Reference_Coding_ID, Concept)
--  #SnomedSets (FK_Reference_SnomedCT_ID, FK_SNOMED_ID)
--  #VersionedCodeSets (FK_Reference_Coding_ID, Concept, Version)
--  #VersionedSnomedSets (FK_Reference_SnomedCT_ID, Version, FK_SNOMED_ID)

--!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
--!!! DO NOT EDIT THIS FILE MANUALLY !!!
--!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

--#region Clinical code sets

IF OBJECT_ID('tempdb..#AllCodes') IS NOT NULL DROP TABLE #AllCodes;
CREATE TABLE #AllCodes (
  [Concept] [varchar](255) NOT NULL,
  [Version] INT NOT NULL,
  [Code] [varchar](20) COLLATE Latin1_General_CS_AS NOT NULL,
  [description] [varchar] (255) NULL 
);

IF OBJECT_ID('tempdb..#codesreadv2') IS NOT NULL DROP TABLE #codesreadv2;
CREATE TABLE #codesreadv2 (
  [concept] [varchar](255) NOT NULL,
  [version] INT NOT NULL,
	[code] [varchar](20) COLLATE Latin1_General_CS_AS NOT NULL,
	[term] [varchar](20) COLLATE Latin1_General_CS_AS NULL,
	[description] [varchar](255) NULL
) ON [PRIMARY];

INSERT INTO #codesreadv2
VALUES ('gynaecological-cancer',1,'B44..',NULL,'Malignant neoplasm of ovary and other uterine adnexa'),('gynaecological-cancer',1,'B44..00',NULL,'Malignant neoplasm of ovary and other uterine adnexa'),('gynaecological-cancer',1,'B44z.',NULL,'Malignant neoplasm of uterine adnexa NOS'),('gynaecological-cancer',1,'B44z.00',NULL,'Malignant neoplasm of uterine adnexa NOS'),('gynaecological-cancer',1,'B44y.',NULL,'Malignant neoplasm of other site of uterine adnexa'),('gynaecological-cancer',1,'B44y.00',NULL,'Malignant neoplasm of other site of uterine adnexa'),('gynaecological-cancer',1,'B440.',NULL,'Malignant neoplasm of ovary'),('gynaecological-cancer',1,'B440.00',NULL,'Malignant neoplasm of ovary'),('gynaecological-cancer',1,'1J06.',NULL,'Suspected cervical cancer'),('gynaecological-cancer',1,'1J06.00',NULL,'Suspected cervical cancer'),('gynaecological-cancer',1,'1J07.',NULL,'Suspected endometrial cancer'),('gynaecological-cancer',1,'1J07.00',NULL,'Suspected endometrial cancer'),('gynaecological-cancer',1,'1J0J.',NULL,'Suspected gynaecological cancer'),('gynaecological-cancer',1,'1J0J.00',NULL,'Suspected gynaecological cancer'),('gynaecological-cancer',1,'38GT9',NULL,'QCancer cervical cancer risk'),('gynaecological-cancer',1,'38GT900',NULL,'QCancer cervical cancer risk'),('gynaecological-cancer',1,'38GT8',NULL,'QCancer endometrial cancer risk'),('gynaecological-cancer',1,'38GT800',NULL,'QCancer endometrial cancer risk'),('gynaecological-cancer',1,'K5E..',NULL,'Other abnormal uterine and vaginal bleeding'),('gynaecological-cancer',1,'K5E..00',NULL,'Other abnormal uterine and vaginal bleeding'),('gynaecological-cancer',1,'K5Ez.',NULL,'Abnormal uterine and vaginal bleeding, unspecified'),('gynaecological-cancer',1,'K5Ez.00',NULL,'Abnormal uterine and vaginal bleeding, unspecified'),('gynaecological-cancer',1,'K5E2.',NULL,'Abnormal vaginal bleeding, unspecified'),('gynaecological-cancer',1,'K5E2.00',NULL,'Abnormal vaginal bleeding, unspecified'),('gynaecological-cancer',1,'8Hn1.',NULL,'Fast track referral for suspected gynaecological cancer'),('gynaecological-cancer',1,'8Hn1.00',NULL,'Fast track referral for suspected gynaecological cancer'),('gynaecological-cancer',1,'9Np4.',NULL,'Seen in fast track suspected gynaecological cancer clinic'),('gynaecological-cancer',1,'9Np4.00',NULL,'Seen in fast track suspected gynaecological cancer clinic'),('gynaecological-cancer',1,'Byu70',NULL,'[X]Malignant neoplasm of uterine adnexa, unspecified'),('gynaecological-cancer',1,'Byu7000',NULL,'[X]Malignant neoplasm of uterine adnexa, unspecified'),('gynaecological-cancer',1,'B4302',NULL,'Malignant neoplasm of endometrium of corpus uteri'),('gynaecological-cancer',1,'B430200',NULL,'Malignant neoplasm of endometrium of corpus uteri'),('gynaecological-cancer',1,'B7A..',NULL,'Benign neoplasm of ovary'),('gynaecological-cancer',1,'B7A..00',NULL,'Benign neoplasm of ovary'),('gynaecological-cancer',1,'B586.',NULL,'Secondary malignant neoplasm of ovary'),('gynaecological-cancer',1,'B586.00',NULL,'Secondary malignant neoplasm of ovary'),('gynaecological-cancer',1,'B912.',NULL,'Neoplasm of uncertain behaviour of ovary'),('gynaecological-cancer',1,'B912.00',NULL,'Neoplasm of uncertain behaviour of ovary'),('gynaecological-cancer',1,'Kyu9D',NULL,'[X]Other specified abnormal uterine and vaginal bleeding'),('gynaecological-cancer',1,'Kyu9D00',NULL,'[X]Other specified abnormal uterine and vaginal bleeding'),('gynaecological-cancer',1,'K59B.',NULL,'Postmenopausal postcoital bleeding'),('gynaecological-cancer',1,'K59B.00',NULL,'Postmenopausal postcoital bleeding'),('gynaecological-cancer',1,'K5A1.',NULL,'Postmenopausal bleeding'),('gynaecological-cancer',1,'K5A1.00',NULL,'Postmenopausal bleeding'),('gynaecological-cancer',1,'8H4V.',NULL,'Referral to gynaecology special interest general practitioner'),('gynaecological-cancer',1,'8H4V.00',NULL,'Referral to gynaecology special interest general practitioner'),('gynaecological-cancer',1,'8Hku.',NULL,'Referral to community gynaecology service'),('gynaecological-cancer',1,'8Hku.00',NULL,'Referral to community gynaecology service'),('gynaecological-cancer',1,'8T0B.',NULL,'Referral to paediatric gynaecology service'),('gynaecological-cancer',1,'8T0B.00',NULL,'Referral to paediatric gynaecology service'),('gynaecological-cancer',1,'8H58.',NULL,'Gynaecological referral'),('gynaecological-cancer',1,'8H58.00',NULL,'Gynaecological referral'),('gynaecological-cancer',1,'8HJ6.',NULL,'Gynaecological self-referral'),('gynaecological-cancer',1,'8HJ6.00',NULL,'Gynaecological self-referral'),('gynaecological-cancer',1,'8HV7.',NULL,'Private referral to gynaecologist'),('gynaecological-cancer',1,'8HV7.00',NULL,'Private referral to gynaecologist'),('gynaecological-cancer',1,'38GT4',NULL,'QCancer ovarian cancer risk calculator'),('gynaecological-cancer',1,'38GT400',NULL,'QCancer ovarian cancer risk calculator'),('gynaecological-cancer',1,'B41..',NULL,'Malignant neoplasm of cervix uteri'),('gynaecological-cancer',1,'B41..00',NULL,'Malignant neoplasm of cervix uteri'),('gynaecological-cancer',1,'B41y.',NULL,'Malignant neoplasm of other site of cervix'),('gynaecological-cancer',1,'B41y.00',NULL,'Malignant neoplasm of other site of cervix'),('gynaecological-cancer',1,'B41yz',NULL,'Malignant neoplasm of other site of cervix NOS'),('gynaecological-cancer',1,'B41yz00',NULL,'Malignant neoplasm of other site of cervix NOS'),('gynaecological-cancer',1,'B41z.',NULL,'Malignant neoplasm of cervix uteri NOS'),('gynaecological-cancer',1,'B41z.00',NULL,'Malignant neoplasm of cervix uteri NOS'),('gynaecological-cancer',1,'B45..',NULL,'Malignant neoplasm of other and unspecified female genital organs'),('gynaecological-cancer',1,'B45..00',NULL,'Malignant neoplasm of other and unspecified female genital organs'),('gynaecological-cancer',1,'B45y.',NULL,'Malignant neoplasm of other specified female genital organ'),('gynaecological-cancer',1,'B45y.00',NULL,'Malignant neoplasm of other specified female genital organ'),('gynaecological-cancer',1,'B45z.',NULL,'Malignant neoplasm of female genital organ NOS'),('gynaecological-cancer',1,'B45z.00',NULL,'Malignant neoplasm of female genital organ NOS'),('gynaecological-cancer',1,'B58y2',NULL,'Secondary malignant neoplasm of cervix uteri'),('gynaecological-cancer',1,'B58y200',NULL,'Secondary malignant neoplasm of cervix uteri'),('gynaecological-cancer',1,'B790.',NULL,'Benign neoplasm of cervix uteri NEC'),('gynaecological-cancer',1,'B790.00',NULL,'Benign neoplasm of cervix uteri NEC'),('gynaecological-cancer',1,'B7A2.',NULL,'Benign teratoma of ovary'),('gynaecological-cancer',1,'B7A2.00',NULL,'Benign teratoma of ovary'),('gynaecological-cancer',1,'Byu7.',NULL,'[X]Malignant neoplasm of female genital organs'),('gynaecological-cancer',1,'Byu7.00',NULL,'[X]Malignant neoplasm of female genital organs'),('gynaecological-cancer',1,'Byu71',NULL,'[X]Malignant neoplasm of other specified female genital organs'),('gynaecological-cancer',1,'Byu7100',NULL,'[X]Malignant neoplasm of other specified female genital organs'),('gynaecological-cancer',1,'Byu73',NULL,'[X]Malignant neoplasm of female genital organ, unspecified'),('gynaecological-cancer',1,'Byu7300',NULL,'[X]Malignant neoplasm of female genital organ, unspecified'),('gynaecological-cancer',1,'K5E0.',NULL,'Abnormal uterine bleeding unrelated to menstrual cycle'),('gynaecological-cancer',1,'K5E0.00',NULL,'Abnormal uterine bleeding unrelated to menstrual cycle'),('gynaecological-cancer',1,'R0934',NULL,'[D]Pelvic mass'),('gynaecological-cancer',1,'R093400',NULL,'[D]Pelvic mass'),('gynaecological-cancer',1,'R0935',NULL,'[D]Pelvic lump'),('gynaecological-cancer',1,'R093500',NULL,'[D]Pelvic lump');
INSERT INTO #codesreadv2
VALUES ('cervical-smear',1,'4K4..',NULL,'Cervical smear - action needed'),('cervical-smear',1,'4K4..00',NULL,'Cervical smear - action needed'),('cervical-smear',1,'4K4Z.',NULL,'Cervical smear action NOS'),('cervical-smear',1,'4K4Z.00',NULL,'Cervical smear action NOS'),('cervical-smear',1,'4K4E.',NULL,'Cervical smear repeat at 24 months'),('cervical-smear',1,'4K4E.00',NULL,'Cervical smear repeat at 24 months'),('cervical-smear',1,'4K4D.',NULL,'Cervical smear repeat at 48 months'),('cervical-smear',1,'4K4D.00',NULL,'Cervical smear repeat at 48 months'),('cervical-smear',1,'4K4C.',NULL,'Cervical smear repeat at 60 months'),('cervical-smear',1,'4K4C.00',NULL,'Cervical smear repeat at 60 months'),('cervical-smear',1,'4K4B.',NULL,'Cervical smear repeat at 36 months'),('cervical-smear',1,'4K4B.00',NULL,'Cervical smear repeat at 36 months'),('cervical-smear',1,'4K49.',NULL,'Cx. smear:cervical biopsy need'),('cervical-smear',1,'4K49.00',NULL,'Cx. smear:cervical biopsy need'),('cervical-smear',1,'4K3..',NULL,'Cervical smear - inflam.change'),('cervical-smear',1,'4K3..00',NULL,'Cervical smear - inflam.change'),('cervical-smear',1,'4K3Z.',NULL,'Cervical smear - inflam. NOS'),('cervical-smear',1,'4K3Z.00',NULL,'Cervical smear - inflam. NOS'),('cervical-smear',1,'4K3C.',NULL,'Cervical smear - moderate inflammation'),('cervical-smear',1,'4K3C.00',NULL,'Cervical smear - moderate inflammation'),('cervical-smear',1,'4K3B.',NULL,'Cervical smear - mild inflammation'),('cervical-smear',1,'4K3B.00',NULL,'Cervical smear - mild inflammation'),('cervical-smear',1,'4K3A.',NULL,'Cervical smear: koilocytosis'),('cervical-smear',1,'4K3A.00',NULL,'Cervical smear: koilocytosis'),('cervical-smear',1,'4K39.',NULL,'Cervical smear - gardnerella'),('cervical-smear',1,'4K39.00',NULL,'Cervical smear - gardnerella'),('cervical-smear',1,'4K38.',NULL,'Cervical smear - actinomyces'),('cervical-smear',1,'4K38.00',NULL,'Cervical smear - actinomyces'),('cervical-smear',1,'4K37.',NULL,'Cervical smear - herpes'),('cervical-smear',1,'4K37.00',NULL,'Cervical smear - herpes'),('cervical-smear',1,'4K36.',NULL,'Cervical smear - wart virus'),('cervical-smear',1,'4K36.00',NULL,'Cervical smear - wart virus'),('cervical-smear',1,'4K34.',NULL,'Cervical smear - candida'),('cervical-smear',1,'4K34.00',NULL,'Cervical smear - candida'),('cervical-smear',1,'4K33.',NULL,'Cervical smear - trichomonas'),('cervical-smear',1,'4K33.00',NULL,'Cervical smear - trichomonas'),('cervical-smear',1,'4K32.',NULL,'Cervical smear-severe inflamm.'),('cervical-smear',1,'4K32.00',NULL,'Cervical smear-severe inflamm.'),('cervical-smear',1,'4K31.',NULL,'Cervical smear-no inflammation'),('cervical-smear',1,'4K31.00',NULL,'Cervical smear-no inflammation'),('cervical-smear',1,'4K2..',NULL,'Cervical smear result'),('cervical-smear',1,'4K2..00',NULL,'Cervical smear result'),('cervical-smear',1,'4K2R.',NULL,'Cervical smear - human papillomavirus positive'),('cervical-smear',1,'4K2R.00',NULL,'Cervical smear - human papillomavirus positive'),('cervical-smear',1,'4K2Q.',NULL,'Cervical smear - human papillomavirus negative'),('cervical-smear',1,'4K2Q.00',NULL,'Cervical smear - human papillomavirus negative'),('cervical-smear',1,'4K2P.',NULL,'Cervical smear - features of non-cervical type glandular neoplasia'),('cervical-smear',1,'4K2P.00',NULL,'Cervical smear - features of non-cervical type glandular neoplasia'),('cervical-smear',1,'4K2N.',NULL,'Cervical smear - features of endocervical type glandular neoplasia'),('cervical-smear',1,'4K2N.00',NULL,'Cervical smear - features of endocervical type glandular neoplasia'),('cervical-smear',1,'4K2M.',NULL,'Cervical smear - high grade dyskaryosis with features of invasive squamous carcinoma'),('cervical-smear',1,'4K2M.00',NULL,'Cervical smear - high grade dyskaryosis with features of invasive squamous carcinoma'),('cervical-smear',1,'4K2L.',NULL,'Cervical smear - high grade dyskaryosis (severe)'),('cervical-smear',1,'4K2L.00',NULL,'Cervical smear - high grade dyskaryosis (severe)'),('cervical-smear',1,'4K2K.',NULL,'Cervical smear - high grade dyskaryosis (moderate)'),('cervical-smear',1,'4K2K.00',NULL,'Cervical smear - high grade dyskaryosis (moderate)'),('cervical-smear',1,'4K2J.',NULL,'Cervical smear - low grade dyskaryosis'),('cervical-smear',1,'4K2J.00',NULL,'Cervical smear - low grade dyskaryosis'),('cervical-smear',1,'4K2H.',NULL,'Cervical smear epithelial cells absent'),('cervical-smear',1,'4K2H.00',NULL,'Cervical smear epithelial cells absent'),('cervical-smear',1,'4K2G.',NULL,'Cervical smear red blood cells present'),('cervical-smear',1,'4K2G.00',NULL,'Cervical smear red blood cells present'),('cervical-smear',1,'4K2F.',NULL,'Cervical smear pus cells present'),('cervical-smear',1,'4K2F.00',NULL,'Cervical smear pus cells present'),('cervical-smear',1,'4K2E.',NULL,'Cervical smear transformation zone cells absent'),('cervical-smear',1,'4K2E.00',NULL,'Cervical smear transformation zone cells absent'),('cervical-smear',1,'4K2D.',NULL,'Cervical smear transformation zone cells present'),('cervical-smear',1,'4K2D.00',NULL,'Cervical smear transformation zone cells present'),('cervical-smear',1,'4K2B.',NULL,'Cervical smear endocervical cells absent'),('cervical-smear',1,'4K2B.00',NULL,'Cervical smear endocervical cells absent'),('cervical-smear',1,'4K2A.',NULL,'Cervical smear endocervical cells present'),('cervical-smear',1,'4K2A.00',NULL,'Cervical smear endocervical cells present'),('cervical-smear',1,'4K26.',NULL,'Cervical smear: ? gland neopl.'),('cervical-smear',1,'4K26.00',NULL,'Cervical smear: ? gland neopl.'),('cervical-smear',1,'4K21.',NULL,'Cervical smear:inadequate spec'),('cervical-smear',1,'4K21.00',NULL,'Cervical smear:inadequate spec'),('cervical-smear',1,'4K2Z.',NULL,'Cervical smear result NOS'),('cervical-smear',1,'4K2Z.00',NULL,'Cervical smear result NOS'),('cervical-smear',1,'4K291',NULL,'Cervical smear - borderline change in endocervical cells'),('cervical-smear',1,'4K29100',NULL,'Cervical smear - borderline change in endocervical cells'),('cervical-smear',1,'4K290',NULL,'Cervical smear - borderline change in squamous cells'),('cervical-smear',1,'4K29000',NULL,'Cervical smear - borderline change in squamous cells'),('cervical-smear',1,'4K27.',NULL,'Cervical smear:atrophic change'),('cervical-smear',1,'4K27.00',NULL,'Cervical smear:atrophic change'),('cervical-smear',1,'4K22.',NULL,'Cervical smear: negative'),('cervical-smear',1,'4K22.00',NULL,'Cervical smear: negative'),('cervical-smear',1,'685..',NULL,'Cervical neoplasia screening'),('cervical-smear',1,'685..00',NULL,'Cervical neoplasia screening'),('cervical-smear',1,'685M.',NULL,'Cervical smear overdue'),('cervical-smear',1,'685M.00',NULL,'Cervical smear overdue'),('cervical-smear',1,'685L.',NULL,'Cervical smear refused'),('cervical-smear',1,'685L.00',NULL,'Cervical smear refused'),('cervical-smear',1,'685F.',NULL,'Cervical smear due'),('cervical-smear',1,'685F.00',NULL,'Cervical smear due'),('cervical-smear',1,'685E.',NULL,'Cervical smear status unknown'),('cervical-smear',1,'685E.00',NULL,'Cervical smear status unknown'),('cervical-smear',1,'685R.',NULL,'Liquid based cervical cytology screening'),('cervical-smear',1,'685R.00',NULL,'Liquid based cervical cytology screening'),('cervical-smear',1,'6857.','11','Cervical smear non-responder'),('cervical-smear',1,'6857.','11','Cervical smear non-responder'),('cervical-smear',1,'R150.',NULL,'[D]Nonspecific abnormal Papanicolaou cervical smear'),('cervical-smear',1,'R150.00',NULL,'[D]Nonspecific abnormal Papanicolaou cervical smear'),('cervical-smear',1,'R150z',NULL,'[D]Nonspecific abnormal Papanicolaou cervical smear NOS'),('cervical-smear',1,'R150z00',NULL,'[D]Nonspecific abnormal Papanicolaou cervical smear NOS'),('cervical-smear',1,'R1501',NULL,'[D] Koilocytosis - cervical smear'),('cervical-smear',1,'R150100',NULL,'[D] Koilocytosis - cervical smear'),('cervical-smear',1,'R1500',NULL,'[D]Dyskaryotic cervical smear'),('cervical-smear',1,'R150000',NULL,'[D]Dyskaryotic cervical smear'),('cervical-smear',1,'7E2A2','11','Cervical smear NEC'),('cervical-smear',1,'7E2A2','11','Cervical smear NEC'),('cervical-smear',1,'981..','11','Cervical smear - fee claim'),('cervical-smear',1,'981..','11','Cervical smear - fee claim'),('cervical-smear',1,'ZV762','12','[V]Routine cervical smear'),('cervical-smear',1,'ZV762','12','[V]Routine cervical smear'),('cervical-smear',1,'14l..',NULL,'H/O abnormal cervical smear'),('cervical-smear',1,'14l..00',NULL,'H/O abnormal cervical smear'),('cervical-smear',1,'8CEA.',NULL,'Cervical smear information leaflet given'),('cervical-smear',1,'8CEA.00',NULL,'Cervical smear information leaflet given'),('cervical-smear',1,'8I6K.',NULL,'Cervical smear not indicated'),('cervical-smear',1,'8I6K.00',NULL,'Cervical smear not indicated'),('cervical-smear',1,'9EVC.',NULL,'Cervical smear report received'),('cervical-smear',1,'9EVC.00',NULL,'Cervical smear report received'),('cervical-smear',1,'9Ndx.',NULL,'Informed consent for cervical smear given'),('cervical-smear',1,'9Ndx.00',NULL,'Informed consent for cervical smear given'),('cervical-smear',1,'4JRL.',NULL,'Cervical cytology screening test'),('cervical-smear',1,'4JRL.00',NULL,'Cervical cytology screening test'),('cervical-smear',1,'67DA.',NULL,'Provision of information about cervical screening programme'),('cervical-smear',1,'67DA.00',NULL,'Provision of information about cervical screening programme'),('cervical-smear',1,'4K23.',NULL,'Cerv.smear: mild dyskaryosis'),('cervical-smear',1,'4K23.00',NULL,'Cerv.smear: mild dyskaryosis'),('cervical-smear',1,'4K24.',NULL,'Cerv.smear: severe dyskaryosis'),('cervical-smear',1,'4K24.00',NULL,'Cerv.smear: severe dyskaryosis'),('cervical-smear',1,'4K25.',NULL,'Cerv.smear:severe dysk.?inv.ca'),('cervical-smear',1,'4K25.00',NULL,'Cerv.smear:severe dysk.?inv.ca'),('cervical-smear',1,'4K28.',NULL,'Cerv.smear: mod.dyskaryosis'),('cervical-smear',1,'4K28.00',NULL,'Cerv.smear: mod.dyskaryosis'),
('cervical-smear',1,'4K29.',NULL,'Cerv.smear: borderline changes'),('cervical-smear',1,'4K29.00',NULL,'Cerv.smear: borderline changes'),('cervical-smear',1,'4K2C.',NULL,'Smear NAD - no endocervical cells'),('cervical-smear',1,'4K2C.00',NULL,'Smear NAD - no endocervical cells'),('cervical-smear',1,'4K35.',NULL,'Cerv.smear - viral infl.unsp.'),('cervical-smear',1,'4K35.00',NULL,'Cerv.smear - viral infl.unsp.'),('cervical-smear',1,'4K41.',NULL,'Cx. smear: repeat after treat.'),('cervical-smear',1,'4K41.00',NULL,'Cx. smear: repeat after treat.'),('cervical-smear',1,'4K42.',NULL,'Cx. smear: repeat 1 month'),('cervical-smear',1,'4K42.00',NULL,'Cx. smear: repeat 1 month'),('cervical-smear',1,'4K43.',NULL,'Cx. smear: repeat 3 months'),('cervical-smear',1,'4K43.00',NULL,'Cx. smear: repeat 3 months'),('cervical-smear',1,'4K44.',NULL,'Cx. smear: repeat 4 months'),('cervical-smear',1,'4K44.00',NULL,'Cx. smear: repeat 4 months'),('cervical-smear',1,'4K45.',NULL,'Cx. smear: repeat 6 months'),('cervical-smear',1,'4K45.00',NULL,'Cx. smear: repeat 6 months'),('cervical-smear',1,'4K46.',NULL,'Cx. smear: repeat 9 months'),('cervical-smear',1,'4K46.00',NULL,'Cx. smear: repeat 9 months'),('cervical-smear',1,'4K47.',NULL,'Cx. smear: repeat 12 months'),('cervical-smear',1,'4K47.00',NULL,'Cx. smear: repeat 12 months'),('cervical-smear',1,'4K48.',NULL,'Cx. smear: colposcopy needed'),('cervical-smear',1,'4K48.00',NULL,'Cx. smear: colposcopy needed'),('cervical-smear',1,'4K4A.',NULL,'Cx. smear: uterine curet. need'),('cervical-smear',1,'4K4A.00',NULL,'Cx. smear: uterine curet. need'),('cervical-smear',1,'6852.',NULL,'Ca cervix screen - offered'),('cervical-smear',1,'6852.00',NULL,'Ca cervix screen - offered'),('cervical-smear',1,'6859.','11','Cervical cytology examination'),('cervical-smear',1,'6859.','11','Cervical cytology examination'),('cervical-smear',1,'6859.','11','Cervical cytology examination'),('cervical-smear',1,'6859.','11','Cervical cytology examination'),('cervical-smear',1,'6859.','11','Cervical cytology examination'),('cervical-smear',1,'6859.','11','Cervical cytology examination'),('cervical-smear',1,'6859.','11','Cervical cytology examination'),('cervical-smear',1,'6859.','11','Cervical cytology examination'),('cervical-smear',1,'9O8Q.',NULL,'Cerv.smear disclaimer received'),('cervical-smear',1,'9O8Q.00',NULL,'Cerv.smear disclaimer received'),('cervical-smear',1,'R151.',NULL,'[D]Nonspecific abnormal Papanicolaou smear of other origin'),('cervical-smear',1,'R151.00',NULL,'[D]Nonspecific abnormal Papanicolaou smear of other origin'),('cervical-smear',1,'4K55.',NULL,'Cervical cytology test'),('cervical-smear',1,'4K55.00',NULL,'Cervical cytology test'),('cervical-smear',1,'K5513',NULL,'Mild cervical dysplasia'),('cervical-smear',1,'K551300',NULL,'Mild cervical dysplasia'),('cervical-smear',1,'K5514',NULL,'Moderate cervical dysplasia'),('cervical-smear',1,'K551400',NULL,'Moderate cervical dysplasia'),('cervical-smear',1,'ZV13E',NULL,'[V]Personal history of cervical intraepithelial neoplasia, grade III'),('cervical-smear',1,'ZV13E00',NULL,'[V]Personal history of cervical intraepithelial neoplasia, grade III')

INSERT INTO #AllCodes
SELECT [concept], [version], [code], [description] from #codesreadv2;

IF OBJECT_ID('tempdb..#codesctv3') IS NOT NULL DROP TABLE #codesctv3;
CREATE TABLE #codesctv3 (
  [concept] [varchar](255) NOT NULL,
  [version] INT NOT NULL,
	[code] [varchar](20) COLLATE Latin1_General_CS_AS NOT NULL,
	[term] [varchar](20) COLLATE Latin1_General_CS_AS NULL,
	[description] [varchar](255) NULL
) ON [PRIMARY];

INSERT INTO #codesctv3
VALUES ('gynaecological-cancer',1,'X78iC',NULL,'Malignant tumour of female genital organ'),('gynaecological-cancer',1,'B44..',NULL,'Malignant neoplasm of ovary and other uterine adnexa'),('gynaecological-cancer',1,'B440.',NULL,'Malignant neoplasm of ovary'),('gynaecological-cancer',1,'B44y.',NULL,'Malignant neoplasm of other site of uterine adnexa'),('gynaecological-cancer',1,'B44z.',NULL,'Malignant neoplasm of uterine adnexa NOS'),('gynaecological-cancer',1,'Byu70',NULL,'[X]Malignant neoplasm of uterine adnexa, unspecified'),('gynaecological-cancer',1,'XaFrN',NULL,'Local recurrence of malignant tumour of cervix'),('gynaecological-cancer',1,'XE1w9',NULL,'Benign neoplasm of ovary'),('gynaecological-cancer',1,'B7A..',NULL,'Benign neoplasm of ovary'),('gynaecological-cancer',1,'XaKzK',NULL,'Suspected gynaecological cancer'),('gynaecological-cancer',1,'XaFwn',NULL,'Suspected endometrial cancer'),('gynaecological-cancer',1,'XaFwm',NULL,'Suspected cervical cancer'),('gynaecological-cancer',1,'XaaIN',NULL,'QCancer endometrial cancer risk'),('gynaecological-cancer',1,'XaZev',NULL,'QCancer ovarian cancer risk'),('gynaecological-cancer',1,'XaaIO',NULL,'QCancer cervical cancer risk'),('gynaecological-cancer',1,'XaE6w',NULL,'Other abnormal uterine and vaginal bleeding'),('gynaecological-cancer',1,'XaE6z',NULL,'Abnormal vaginal bleeding, unspecified'),('gynaecological-cancer',1,'XaE70',NULL,'Abnormal uterine and vaginal bleeding, unspecified'),('gynaecological-cancer',1,'XaXsb',NULL,'Referral to community gynaecology service'),('gynaecological-cancer',1,'8H58.',NULL,'Gynaecological referral'),('gynaecological-cancer',1,'8HJ6.',NULL,'Gynaecological self-referral'),('gynaecological-cancer',1,'8HV7.',NULL,'Private referral to gynaecologist'),('gynaecological-cancer',1,'XaBTf',NULL,'Referral to gynaecologist'),('gynaecological-cancer',1,'XaAgH',NULL,'Referral to obstetrician and gynaecologist'),('gynaecological-cancer',1,'XaMeB',NULL,'Fast track referral for suspected gynaecological cancer'),('gynaecological-cancer',1,'XaPyV',NULL,'Seen in fast track suspected gynaecological cancer clinic'),('gynaecological-cancer',1,'XaFri',NULL,'Metastasis from malignant tumour of cervix'),('gynaecological-cancer',1,'B912.',NULL,'Neoplasm of uncertain behaviour of ovary'),('gynaecological-cancer',1,'Kyu9D',NULL,'[X]Other specified abnormal uterine and vaginal bleeding'),('gynaecological-cancer',1,'Xa86A',NULL,'Abnormal vaginal bleeding'),('gynaecological-cancer',1,'XaKJm',NULL,'Postmenopausal postcoital bleeding'),('gynaecological-cancer',1,'XaAct',NULL,'Referral to obstetrics and gynaecology service'),('gynaecological-cancer',1,'XaMA6',NULL,'Referral to gynaecology special interest general practitioner'),('gynaecological-cancer',1,'Xaack',NULL,'Referral to paediatric gynaecology service'),('gynaecological-cancer',1,'B41..',NULL,'Cervical carcinoma (uterus)'),('gynaecological-cancer',1,'B41..',NULL,'Malignant neoplasm of cervix uteri'),('gynaecological-cancer',1,'B41y.',NULL,'Malignant neoplasm of other site of cervix'),('gynaecological-cancer',1,'B41y.',NULL,'Malignant neoplasm of other site of cervix'),('gynaecological-cancer',1,'B41yz',NULL,'Malignant neoplasm of other site of cervix NOS'),('gynaecological-cancer',1,'B41yz',NULL,'Malignant neoplasm of other site of cervix NOS'),('gynaecological-cancer',1,'B41z.',NULL,'Malignant neoplasm of cervix uteri NOS'),('gynaecological-cancer',1,'B41z.',NULL,'Malignant neoplasm of cervix uteri NOS'),('gynaecological-cancer',1,'B4302',NULL,'Malignant neoplasm of endometrium'),('gynaecological-cancer',1,'B4302',NULL,'Malignant neoplasm of endometrium of corpus uteri'),('gynaecological-cancer',1,'B4302',NULL,'Malignant neoplasm of endometrium of corpus uteri'),('gynaecological-cancer',1,'B45..',NULL,'Malignant neoplasm of other and unspecified female genital organs'),('gynaecological-cancer',1,'B45..',NULL,'Malignant neoplasm of other and unspecified female genital organs'),('gynaecological-cancer',1,'B45y.',NULL,'Malignant neoplasm of other specified female genital organ'),('gynaecological-cancer',1,'B45y.',NULL,'Malignant neoplasm of other specified female genital organ'),('gynaecological-cancer',1,'B45z.',NULL,'Malignant neoplasm of female genital organ NOS'),('gynaecological-cancer',1,'B45z.',NULL,'Malignant neoplasm of female genital organ NOS'),('gynaecological-cancer',1,'B586.',NULL,'Krukenburg tumour'),('gynaecological-cancer',1,'B586.',NULL,'Metastasis to ovary'),('gynaecological-cancer',1,'B586.',NULL,'Metastasis to ovary'),('gynaecological-cancer',1,'B586.',NULL,'Ovarian metastasis'),('gynaecological-cancer',1,'B586.',NULL,'Secondary cancer of ovary'),('gynaecological-cancer',1,'B586.',NULL,'Secondary malignant neoplasm of ovary'),('gynaecological-cancer',1,'B586.',NULL,'Secondary tumour to ovary'),('gynaecological-cancer',1,'B58y2',NULL,'Secondary cancer of the cervix'),('gynaecological-cancer',1,'B58y2',NULL,'Secondary malignant neoplasm of cervix uteri'),('gynaecological-cancer',1,'B58y2',NULL,'Secondary malignant neoplasm of cervix uteri'),('gynaecological-cancer',1,'B790.',NULL,'Benign neoplasm of cervix uteri NEC'),('gynaecological-cancer',1,'Byu7.',NULL,'[X]Malignant neoplasm of female genital organs'),('gynaecological-cancer',1,'Byu7.',NULL,'[X]Malignant neoplasm of female genital organs'),('gynaecological-cancer',1,'Byu71',NULL,'[X]Malignant neoplasm of other specified female genital organs'),('gynaecological-cancer',1,'Byu71',NULL,'[X]Malignant neoplasm of other specified female genital organs'),('gynaecological-cancer',1,'Byu73',NULL,'[X]Malignant neoplasm of female genital organ, unspecified'),('gynaecological-cancer',1,'Byu73',NULL,'[X]Malignant neoplasm of female genital organ, unspecified'),('gynaecological-cancer',1,'K5A1.',NULL,'Bleeding after menopause'),('gynaecological-cancer',1,'K5A1.',NULL,'PMB - Postmenopausal bleeding'),('gynaecological-cancer',1,'K5A1.',NULL,'Postmenopausal bleeding'),('gynaecological-cancer',1,'K5A1.',NULL,'Postmenopausal bleeding'),('gynaecological-cancer',1,'R0934',NULL,'[D]Pelvic mass'),('gynaecological-cancer',1,'R0934',NULL,'[D]Pelvic mass'),('gynaecological-cancer',1,'R0935',NULL,'[D]Pelvic lump'),('gynaecological-cancer',1,'R0935',NULL,'[D]Pelvic lump'),('gynaecological-cancer',1,'X407e',NULL,'Tumour of cervix'),('gynaecological-cancer',1,'X407e',NULL,'Tumour of cervix'),('gynaecological-cancer',1,'X78Wf',NULL,'Ovarian tumour'),('gynaecological-cancer',1,'X78Wf',NULL,'Tumour of ovary'),('gynaecological-cancer',1,'X78Wf',NULL,'Tumour of ovary'),('gynaecological-cancer',1,'X78Wl',NULL,'Clear cell tumour of ovary'),('gynaecological-cancer',1,'X78Wl',NULL,'Clear cell tumour of ovary'),('gynaecological-cancer',1,'X78Wl',NULL,'Mesonephroid tumour of ovary'),('gynaecological-cancer',1,'X78Wm',NULL,'Borderline epithelial tumour'),('gynaecological-cancer',1,'X78Wm',NULL,'Borderline epithelial tumour'),('gynaecological-cancer',1,'X78Wo',NULL,'Undifferentiated carcinoma of ovary'),('gynaecological-cancer',1,'X78Wo',NULL,'Undifferentiated carcinoma of ovary'),('gynaecological-cancer',1,'X78XE',NULL,'Benign teratoma of ovary'),('gynaecological-cancer',1,'X78XE',NULL,'Benign teratoma of ovary'),('gynaecological-cancer',1,'X78XF',NULL,'Dermoid cyst of ovary'),('gynaecological-cancer',1,'X78XF',NULL,'Dermoid cyst of ovary'),('gynaecological-cancer',1,'X78XF',NULL,'Mature cystic teratoma of ovary'),('gynaecological-cancer',1,'X78Xl',NULL,'Benign tumour of cervix'),('gynaecological-cancer',1,'X78Xl',NULL,'Benign tumour of cervix'),('gynaecological-cancer',1,'XaE6x',NULL,'Abnormal uterine bleeding unrelated to menstrual cycle'),('gynaecological-cancer',1,'XaE6x',NULL,'Abnormal uterine bleeding unrelated to menstrual cycle'),('gynaecological-cancer',1,'XE1vi',NULL,'Ca cervix'),('gynaecological-cancer',1,'XE1vi',NULL,'Cancer of cervix'),('gynaecological-cancer',1,'XE1vi',NULL,'Malignant neoplasm of cervix'),('gynaecological-cancer',1,'XE1vi',NULL,'Malignant neoplasm of cervix uteri'),('gynaecological-cancer',1,'XE1vi',NULL,'Malignant tumour of cervix'),('gynaecological-cancer',1,'XE1vi',NULL,'Malignant tumour of cervix'),('gynaecological-cancer',1,'XE1w8',NULL,'Benign neoplasm of cervix uteri NEC'),('gynaecological-cancer',1,'XE1w8',NULL,'Benign neoplasm of cervix uteri NEC'),('gynaecological-cancer',1,'XE1zN',NULL,'Adenocarcinoma cervix uteri'),('gynaecological-cancer',1,'XE1zN',NULL,'Carcinoma cervix uteri'),('gynaecological-cancer',1,'XE1zN',NULL,'Carcinoma cervix uteri: [adenocarcinoma] or [invasive]'),('gynaecological-cancer',1,'XE1zN',NULL,'Cervical carcinoma, invasive'),('gynaecological-cancer',1,'XE1zT',NULL,'Ca cervix uteri NOS'),('gynaecological-cancer',1,'XE1zT',NULL,'Ca cervix uteri NOS'),('gynaecological-cancer',1,'XE1zX',NULL,'Ca ovary/other uterine adnexa'),('gynaecological-cancer',1,'XE1zX',NULL,'Ca ovary/other uterine adnexa'),('gynaecological-cancer',1,'XE1zZ',NULL,'Ca ovary/uterine adnexa NOS'),('gynaecological-cancer',1,'XM1Ca',NULL,'Pelvic mass'),('gynaecological-cancer',1,'XM1Ca',NULL,'Pelvic mass'),('gynaecological-cancer',1,'XM1CZ',NULL,'Pelvic lump'),('gynaecological-cancer',1,'XM1CZ',NULL,'Pelvic lump');
INSERT INTO #codesctv3
VALUES ('cervical-smear',1,'4K2..',NULL,'Smear result - cervical'),('cervical-smear',1,'4K21.',NULL,'Cervical smear - inadequate specimen'),('cervical-smear',1,'4K25.',NULL,'Cervical smear - severe dyskaryosis ? invasive carcinoma'),('cervical-smear',1,'4K26.',NULL,'Cervical smear - ? glandular neoplasia'),('cervical-smear',1,'4K27.',NULL,'Cervical smear - atrophic changes'),('cervical-smear',1,'4K3..',NULL,'Cervical smear - inflammatory change'),('cervical-smear',1,'4K31.',NULL,'Cervical smear - no inflammation'),('cervical-smear',1,'X76zx',NULL,'Dyskaryosis on cervical smear'),('cervical-smear',1,'XE277',NULL,'Cervical smear result'),('cervical-smear',1,'XE279',NULL,'Cervical smear - mild dyskaryosis'),('cervical-smear',1,'XE27A',NULL,'Cervical smear - severe dyskaryosis'),('cervical-smear',1,'XE27B',NULL,'Cervical smear - moderate dyskaryosis'),('cervical-smear',1,'XE27C',NULL,'Cervical smear result NOS'),('cervical-smear',1,'XM1C9',NULL,'Dyskaryotic cervical smear'),('cervical-smear',1,'XM1Vt',NULL,'Viral changes on cervical smear'),('cervical-smear',1,'XaagX',NULL,'Cervical smear - human papillomavirus negative'),('cervical-smear',1,'XaagY',NULL,'Cervical smear - human papillomavirus positive'),('cervical-smear',1,'4K32.',NULL,'Cervical smear - severe inflammation'),('cervical-smear',1,'4K33.',NULL,'Cervical smear - trichomonas'),('cervical-smear',1,'4K34.',NULL,'Cervical smear - candida'),('cervical-smear',1,'4K36.',NULL,'Wart virus: cervical smear'),('cervical-smear',1,'4K37.',NULL,'Cervical smear - herpes'),('cervical-smear',1,'4K38.',NULL,'Cervical smear - actinomyces'),('cervical-smear',1,'4K39.',NULL,'Cervical smear - gardnerella'),('cervical-smear',1,'4K3A.',NULL,'Cervical smear - koilocytosis'),('cervical-smear',1,'4K3Z.',NULL,'Cervical smear - inflammation NOS'),('cervical-smear',1,'X76zy',NULL,'Dysplasia (dyskaryosis) on cervical smear'),('cervical-smear',1,'XE27D',NULL,'Cervical smear - viral inflammation unspecified'),('cervical-smear',1,'XE27E',NULL,'Cervical smear - wart virus'),('cervical-smear',1,'XaClI',NULL,'Cervical smear - mild inflammation'),('cervical-smear',1,'XaClJ',NULL,'Cervical smear - moderate inflammation'),('cervical-smear',1,'XaaU7',NULL,'Cervical smear - low grade dyskaryosis'),('cervical-smear',1,'Xaafi',NULL,'Cervical smear - high grade dyskaryosis (moderate)'),('cervical-smear',1,'Xaafj',NULL,'Cervical smear - high grade dyskaryosis (severe)'),('cervical-smear',1,'Xaafk',NULL,'Cervical smear - high grade dyskaryosis with features of invasive squamous carcinoma'),('cervical-smear',1,'Xaafo',NULL,'Cervical smear - features of endocervical type glandular neoplasia'),('cervical-smear',1,'Xaafp',NULL,'Cervical smear - features of non-cervical type glandular neoplasia'),('cervical-smear',1,'XaBSM',NULL,'Cervical smear status'),('cervical-smear',1,'XaKRa',NULL,'Cervical smear to continue post hysterectomy'),('cervical-smear',1,'XaKb9',NULL,'Cervical smear - suspend recall'),('cervical-smear',1,'XaKbV',NULL,'No cervical smear required - no uterus'),('cervical-smear',1,'XaKbW',NULL,'Cervical smear every 12 months for life'),('cervical-smear',1,'XaKuB',NULL,'Cervical smear disclaimer sent'),('cervical-smear',1,'XaQGE',NULL,'Annual cervical smear required'),('cervical-smear',1,'XaQic',NULL,'Never had cervical smear'),('cervical-smear',1,'4K4..',NULL,'Cervical smear - action needed'),('cervical-smear',1,'4K41.',NULL,'Cervical smear: repeat after treatment'),('cervical-smear',1,'4K49.',NULL,'Cervical smear - cervical biopsy needed'),('cervical-smear',1,'4K4A.',NULL,'Cervical smear: uterine curettage needed'),('cervical-smear',1,'4K4Z.',NULL,'Cervical smear action NOS'),('cervical-smear',1,'XM153',NULL,'Cervical smear: action'),('cervical-smear',1,'XaLql',NULL,'Cervical smear repeat at 36 months'),('cervical-smear',1,'XaLqm',NULL,'Cervical smear repeat at 60 months'),('cervical-smear',1,'XaYWm',NULL,'Cervical smear repeat at 48 months'),('cervical-smear',1,'XaaMr',NULL,'Cervical smear repeat at 24 months'),('cervical-smear',1,'XaIR2',NULL,'Place cervical smear taken'),('cervical-smear',1,'4K2A.',NULL,'Cervical smear - endocervical cells present'),('cervical-smear',1,'XaJcW',NULL,'Cervical smear transformation zone cells present'),('cervical-smear',1,'XaYc0',NULL,'Cervical smear pus cells present'),('cervical-smear',1,'XaYc1',NULL,'Cervical smear red blood cells present'),('cervical-smear',1,'4K29.',NULL,'Cervical smear - borderline changes'),('cervical-smear',1,'XaaU5',NULL,'Cervical smear - borderline change in squamous cells'),('cervical-smear',1,'XaaU6',NULL,'Cervical smear - borderline change in endocervical cells'),('cervical-smear',1,'7E2A2',NULL,'Cervical smear NEC (& Papanicolau)'),('cervical-smear',1,'XM1Kg',NULL,'Cervical smear NEC'),('cervical-smear',1,'XaLQI',NULL,'Cervical smear using spatula'),('cervical-smear',1,'R1500',NULL,'[D]Dyskaryotic cervical smear'),('cervical-smear',1,'R1501',NULL,'[D] Koilocytosis - cervical smear'),('cervical-smear',1,'R150z',NULL,'[D]Nonspecific abnormal Papanicolaou cervical smear NOS'),('cervical-smear',1,'685..',NULL,'Cervical neoplasia screening'),('cervical-smear',1,'XaKTi',NULL,'Liquid based cervical cytology screening'),('cervical-smear',1,'XaCOf',NULL,'Neoplasm screening excluding cervical'),('cervical-smear',1,'4K2B.',NULL,'Cervical smear - endocervical cells absent'),('cervical-smear',1,'XaJcX',NULL,'Cervical smear transformation zone cells absent'),('cervical-smear',1,'981..',NULL,'Cervical smear - fee claim'),('cervical-smear',1,'XaBHn',NULL,'Cervical smear - fee claim'),('cervical-smear',1,'XE278',NULL,'Cervical smear - negative'),('cervical-smear',1,'XM1Ym',NULL,'Cervical smear non-responder'),('cervical-smear',1,'Xa05k',NULL,'Cervical smear sample'),('cervical-smear',1,'XaBYv',NULL,'Cervical smear biopsy taken'),('cervical-smear',1,'XaBj3',NULL,'Abnormal cervical smear'),('cervical-smear',1,'XaK29',NULL,'Cervical smear not indicated'),('cervical-smear',1,'XaLHO',NULL,'Cervical smear information leaflet given'),('cervical-smear',1,'XaLMV',NULL,'Informed consent for cervical smear given'),('cervical-smear',1,'XaYWX',NULL,'Cervical smear test indicated but not done'),('cervical-smear',1,'XaYeu',NULL,'Cervical smear epithelial cells absent'),('cervical-smear',1,'XaaZX',NULL,'H/O abnormal cervical smear'),('cervical-smear',1,'XabOR',NULL,'Cervical smear report received'),('cervical-smear',1,'XaMDf',NULL,'Cervical cytology screening test'),('cervical-smear',1,'XaZiD',NULL,'Provision of information about cervical screening programme'),('cervical-smear',1,'4K22.',NULL,'Cervical smear - negative'),('cervical-smear',1,'4K22.',NULL,'Cervical smear: negative'),('cervical-smear',1,'4K22.',NULL,'Smear NAD - no endocervical cells'),('cervical-smear',1,'4K22.',NULL,'Smear NAD: no endocervic cells'),('cervical-smear',1,'4K23.',NULL,'Cerv.smear: mild dyskaryosis'),('cervical-smear',1,'4K23.',NULL,'Cervical smear - mild dyskaryosis'),('cervical-smear',1,'4K24.',NULL,'Cerv smear severe dyskaryosis: (& CIN III)'),('cervical-smear',1,'4K24.',NULL,'Cerv.smear: severe dyskaryosis'),('cervical-smear',1,'4K24.',NULL,'Cervical smear - severe dyskaryosis'),('cervical-smear',1,'4K28.',NULL,'Cerv.smear: mod.dyskaryosis'),('cervical-smear',1,'4K28.',NULL,'Cervical smear - moderate dyskaryosis'),('cervical-smear',1,'4K2Z.',NULL,'Cervical smear result NOS'),('cervical-smear',1,'4K2Z.',NULL,'Nuclear abnormality on smear'),('cervical-smear',1,'4K35.',NULL,'Cerv.smear - viral infl.unsp.'),('cervical-smear',1,'4K35.',NULL,'Viral changes on cerv. smear'),('cervical-smear',1,'4K35.',NULL,'Viral changes on cervical smear'),('cervical-smear',1,'4K42.',NULL,'Cx. smear: repeat 1 month'),('cervical-smear',1,'4K42.',NULL,'Cx. smear: repeat 1 month'),('cervical-smear',1,'4K43.',NULL,'Cx. smear: repeat 3 months'),('cervical-smear',1,'4K43.',NULL,'Cx. smear: repeat 3 months'),('cervical-smear',1,'4K44.',NULL,'Cx. smear: repeat 4 months'),('cervical-smear',1,'4K44.',NULL,'Cx. smear: repeat 4 months'),('cervical-smear',1,'4K45.',NULL,'Cx. smear: repeat 6 months'),('cervical-smear',1,'4K45.',NULL,'Cx. smear: repeat 6 months'),('cervical-smear',1,'4K46.',NULL,'Cx. smear: repeat 9 months'),('cervical-smear',1,'4K46.',NULL,'Cx. smear: repeat 9 months'),('cervical-smear',1,'4K47.',NULL,'Cx. smear: repeat 12 months'),('cervical-smear',1,'4K47.',NULL,'Cx. smear: repeat 12 months'),('cervical-smear',1,'4K48.',NULL,'Cx. smear: colposcopy needed'),('cervical-smear',1,'4K48.',NULL,'Cx. smear: colposcopy needed'),('cervical-smear',1,'6852.',NULL,'Ca cervix screening - offered'),('cervical-smear',1,'6852.',NULL,'Ca cervix screening - offered'),('cervical-smear',1,'6857.',NULL,'Cervical smear non-responder'),('cervical-smear',1,'6859.',NULL,'Cervical cytology examination'),('cervical-smear',1,'R150.',NULL,'[D]Cervical smear - nonspecific abnormality'),('cervical-smear',1,'R150.',NULL,'[D]Nonspecific abnormal Papanicolaou cervical smear'),('cervical-smear',1,'R150.',NULL,'[D]Nonspecific abnormal Papanicolaou cervical smear'),('cervical-smear',1,'R150.',NULL,'[D]Papanicolaou smear - nonspecific abnormality'),('cervical-smear',1,'R151.',NULL,'[D]Nonspecific abnormal Papanicolaou smear of other origin'),('cervical-smear',1,'R151.',NULL,'[D]Nonspecific abnormal Papanicolaou smear of other origin'),('cervical-smear',1,'Xa1di',NULL,'Smear NAD - no endocervical cells'),('cervical-smear',1,'Xa1di',NULL,'Smear NAD - no endocervical cells'),('cervical-smear',1,'Xa8Pl',NULL,'Cervical smear'),('cervical-smear',1,'XE078',NULL,'Papanicolau smear NEC'),('cervical-smear',1,'XE078',NULL,'Papanicolau smear NEC'),('cervical-smear',1,'XE2JY',NULL,'FP74 - cervical cytology claim'),('cervical-smear',1,'XE2JY',NULL,'FP74 - cervical cytology claim'),('cervical-smear',1,'XM1Vr',NULL,'Nuclear abnormality on smear'),('cervical-smear',1,'XM1Vr',NULL,'Nuclear abnormality on smear'),('cervical-smear',1,'ZV762',NULL,'[V]Routine cervical smear'),
('cervical-smear',1,'ZV762',NULL,'[V]Screening for malignant neoplasm of cervix'),('cervical-smear',1,'XaKd4',NULL,'Cervical cytology test'),('cervical-smear',1,'XaKd4',NULL,'Cervical cytology test'),('cervical-smear',1,'X77n4',NULL,'Cervical intraepithelial neoplasia grade III with severe dysplasia'),('cervical-smear',1,'X77n4',NULL,'Cervical intraepithelial neoplasia grade III with severe dysplasia'),('cervical-smear',1,'X77n4',NULL,'CIN III - Cervical intraepithelial neoplasia grade III with severe dysplasia'),('cervical-smear',1,'Xa3HD',NULL,'Cervical intraepithelial neoplasia grade 1'),('cervical-smear',1,'Xa3HD',NULL,'Cervical intraepithelial neoplasia grade 1'),('cervical-smear',1,'Xa3HD',NULL,'Cervical intraepithelial neoplasia grade I'),('cervical-smear',1,'Xa3HD',NULL,'CIN I - Cervical intraepithelial neoplasia 1'),('cervical-smear',1,'Xa3HD',NULL,'Mild cervical dysplasia'),('cervical-smear',1,'Xa3HD',NULL,'Mild dysplasia of cervix'),('cervical-smear',1,'Xa3HF',NULL,'Cervical intraepithelial neoplasia grade 2'),('cervical-smear',1,'Xa3HF',NULL,'Cervical intraepithelial neoplasia grade 2'),('cervical-smear',1,'Xa3HF',NULL,'Cervical intraepithelial neoplasia grade II'),('cervical-smear',1,'Xa3HF',NULL,'CIN 2 - Cervical intraepithelial neoplasia 2'),('cervical-smear',1,'Xa3HF',NULL,'Moderate cervical dysplasia'),('cervical-smear',1,'Xa3HF',NULL,'Moderate dysplasia of cervix'),('cervical-smear',1,'XaFs3',NULL,'Cervical smear refused'),('cervical-smear',1,'XaFs3',NULL,'Cervical smear refused'),('cervical-smear',1,'XaIRD',NULL,'Cervical smear overdue'),('cervical-smear',1,'XaIRD',NULL,'Cervical smear overdue'),('cervical-smear',1,'XaIyN',NULL,'[V]Personal history of cervical intraepithelial neoplasia, grade III'),('cervical-smear',1,'XaIyN',NULL,'[V]Personal history of cervical intraepithelial neoplasia, grade III'),('cervical-smear',1,'XE1TU',NULL,'Ca cervix - screening done'),('cervical-smear',1,'XE1TU',NULL,'Ca cervix - screening done')

INSERT INTO #AllCodes
SELECT [concept], [version], [code], [description] from #codesctv3;

IF OBJECT_ID('tempdb..#codessnomed') IS NOT NULL DROP TABLE #codessnomed;
CREATE TABLE #codessnomed (
  [concept] [varchar](255) NOT NULL,
  [version] INT NOT NULL,
	[code] [varchar](20) COLLATE Latin1_General_CS_AS NOT NULL,
	[term] [varchar](20) COLLATE Latin1_General_CS_AS NULL,
	[description] [varchar](255) NULL
) ON [PRIMARY];

INSERT INTO #codessnomed
VALUES ('gynaecological-cancer',1,'74285003',NULL,'Mass of pelvic structure'),('gynaecological-cancer',1,'92056006',NULL,'Benign tumor of cervix'),('gynaecological-cancer',1,'92260003',NULL,'Benign ovarian tumor'),('gynaecological-cancer',1,'93934004',NULL,'Primary malignant neoplasm of ovary (disorder)'),('gynaecological-cancer',1,'94126000',NULL,'Primary malignant neoplasm of uterine adnexa (disorder)'),('gynaecological-cancer',1,'94455000',NULL,'Cancer metastatic to ovary'),('gynaecological-cancer',1,'94664002',NULL,'Secondary malignant neoplasm of uterine adnexa (disorder)'),('gynaecological-cancer',1,'94792004',NULL,'Neoplasm of uncertain behavior of uterine cervix (disorder)'),('gynaecological-cancer',1,'94974001',NULL,'Neoplasm of uncertain behavior of ovary (disorder)'),('gynaecological-cancer',1,'109880006',NULL,'Overlapping malignant neoplasm of uterine cervix (disorder)'),('gynaecological-cancer',1,'123841004',NULL,'Tumor of cervix'),('gynaecological-cancer',1,'123843001',NULL,'Tumor of ovary'),('gynaecological-cancer',1,'188192002',NULL,'Malignant neoplasm of endometrium of corpus uteri (disorder)'),('gynaecological-cancer',1,'188469005',NULL,'Cancer metastatic to cervix'),('gynaecological-cancer',1,'254856004',NULL,'Undifferentiated ovarian cancer'),('gynaecological-cancer',1,'314970000',NULL,'Local recurrence of malignant tumor of cervix (disorder)'),('gynaecological-cancer',1,'314992001',NULL,'Metastasis from malignant tumor of cervix (disorder)'),('gynaecological-cancer',1,'363354003',NULL,'Cervical cancer'),('gynaecological-cancer',1,'363443007',NULL,'Ovarian cancer'),('gynaecological-cancer',1,'363514001',NULL,'Malignant tumor of female genital organ (disorder)'),('gynaecological-cancer',1,'369522002',NULL,'Primary malignant neoplasm of left ovary (disorder)'),('gynaecological-cancer',1,'369523007',NULL,'Cancer metastatic to left ovary'),('gynaecological-cancer',1,'369529006',NULL,'Primary malignant neoplasm of right ovary (disorder)'),('gynaecological-cancer',1,'369530001',NULL,'Cancer metastatic to right ovary'),('gynaecological-cancer',1,'372024009',NULL,'Primary malignant neoplasm of uterine cervix'),('gynaecological-cancer',1,'416712009',NULL,'Clear cell (mesonephric) neoplasm of ovary'),('gynaecological-cancer',1,'422782004',NULL,'Primary malignant neoplasm of ovary, with widespread metastatic disease'),('gynaecological-cancer',1,'423274005',NULL,'Ovarian cancer stage 4'),('gynaecological-cancer',1,'423480004',NULL,'Cancer of ovary, stage 3'),('gynaecological-cancer',1,'423973006',NULL,'Invasive cervical cancer'),('gynaecological-cancer',1,'424486004',NULL,'Cancer of ovary, stage 2'),('gynaecological-cancer',1,'424600001',NULL,'Ovarian cancer stage 1'),('gynaecological-cancer',1,'428322007',NULL,'Malignant neoplasm of uterine adnexa'),('gynaecological-cancer',1,'716855006',NULL,'Theca steroid producing cell malignant tumour of ovary'),('gynaecological-cancer',1,'718220008',NULL,'Hereditary breast and ovarian cancer syndrome'),('gynaecological-cancer',1,'764791008',NULL,'Borderline epithelial neoplasm of ovary (disorder)'),('gynaecological-cancer',1,'33521000119105',NULL,'Neoplasm of low malignant potential behavior of ovary (disorder)'),('gynaecological-cancer',1,'15540006',NULL,'International Federation of Gynaecology and Obstetrics cervical cancer (FIGO CC) stage I'),('gynaecological-cancer',1,'25654007',NULL,'FIGO CC stage Ib'),('gynaecological-cancer',1,'49219005',NULL,'International Federation of Gynecology and Obstetrics cervical cancer stage Ia'),('gynaecological-cancer',1,'52708004',NULL,'International Federation of Gynecology and Obstetrics cervical cancer stage III (finding)'),('gynaecological-cancer',1,'68240008',NULL,'International Federation of Gynecology and Obstetrics cervical cancer stage II (finding)'),('gynaecological-cancer',1,'81822003',NULL,'International Federation of Gynecology and Obstetrics cervical cancer stage IV (finding)'),('gynaecological-cancer',1,'87977001',NULL,'International Federation of Gynaecology and Obstetrics cervical cancer (FIGO CC) stage Ib occ'),('gynaecological-cancer',1,'708327004',NULL,'International Federation of Gynecology and Obstetrics cervical cancer (FIGO CC) stage IA1 (finding)'),('gynaecological-cancer',1,'708331005',NULL,'International Federation of Gynecology and Obstetrics cervical cancer (FIGO CC) stage IA2 (finding)'),('gynaecological-cancer',1,'708340009',NULL,'International Federation of Gynecology and Obstetrics cervical cancer (FIGO CC) stage IB1 (finding)'),('gynaecological-cancer',1,'708368008',NULL,'International Federation of Gynecology and Obstetrics cervical cancer (FIGO CC) stage IB2 (finding)'),('gynaecological-cancer',1,'708381001',NULL,'International Federation of Gynecology and Obstetrics cervical cancer (FIGO CC) stage IIA1 (finding)'),('gynaecological-cancer',1,'708383003',NULL,'International Federation of Gynecology and Obstetrics cervical cancer (FIGO CC) stage IIA2 (finding)'),('gynaecological-cancer',1,'708387002',NULL,'International Federation of Gynecology and Obstetrics cervical cancer (FIGO CC) stage IIB (finding)'),('gynaecological-cancer',1,'708393005',NULL,'International Federation of Gynecology and Obstetrics cervical cancer (FIGO CC) stage IIIA (finding)'),('gynaecological-cancer',1,'708395003',NULL,'International Federation of Gynecology and Obstetrics cervical cancer (FIGO CC) stage IIIB (finding)'),('gynaecological-cancer',1,'708400002',NULL,'International Federation of Gynecology and Obstetrics cervical cancer (FIGO CC) stage IVA (finding)'),('gynaecological-cancer',1,'708404006',NULL,'International Federation of Gynecology and Obstetrics cervical cancer (FIGO CC) stage IVB (finding)'),('gynaecological-cancer',1,'315266007',NULL,'Suspected cervical cancer (situation)'),('gynaecological-cancer',1,'315267003',NULL,'Suspected endometrial cancer (situation)'),('gynaecological-cancer',1,'397682005',NULL,'Suspected gynecological cancer (situation)'),('gynaecological-cancer',1,'725275004',NULL,'Subject refused referral to gynaecologist'),('gynaecological-cancer',1,'762997004',NULL,'Suspected ovarian cancer'),('gynaecological-cancer',1,'4461000175108',NULL,'Screening for malignant neoplasm of cervix not done'),('gynaecological-cancer',1,'112241000119107',NULL,'Cervical cancer Papanicolaou smear screening declined'),('gynaecological-cancer',1,'30382004',NULL,'International Federation of Gynecology and Obstetrics endometrial cancer stage II'),('gynaecological-cancer',1,'34537009',NULL,'International Federation of Gynecology and Obstetrics endometrial cancer stage IV'),('gynaecological-cancer',1,'46756001',NULL,'International Federation of Gynecology and Obstetrics endometrial cancer stage I A'),('gynaecological-cancer',1,'50237009',NULL,'International Federation of Gynecology and Obstetrics endometrial cancer stage I'),('gynaecological-cancer',1,'60275007',NULL,'International Federation of Gynecology and Obstetrics endometrial cancer stage I B (finding)'),('gynaecological-cancer',1,'80975007',NULL,'International Federation of Gynecology and Obstetrics endometrial cancer stage III (finding)'),('gynaecological-cancer',1,'708415001',NULL,'International Federation of Gynaecology and Obstetrics endometrial cancer stage IIIB'),('gynaecological-cancer',1,'708432002',NULL,'International Federation of Gynaecology and Obstetrics endometrial cancer stage IIIC1'),('gynaecological-cancer',1,'708435000',NULL,'International Federation of Gynecology and Obstetrics endometrial cancer stage IIIC2'),('gynaecological-cancer',1,'708443005',NULL,'International Federation of Gynecology and Obstetrics endometrial cancer (FIGO EC) stage IVA (finding)'),('gynaecological-cancer',1,'708446002',NULL,'International Federation of Gynecology and Obstetrics endometrial cancer (FIGO EC) stage IVB (finding)'),('gynaecological-cancer',1,'708533009',NULL,'International Federation of Gynecology and Obstetrics endometrial cancer (FIGO EC) stage IIIA'),('gynaecological-cancer',1,'785781000000101',NULL,'Referral to community gynaecology service'),('gynaecological-cancer',1,'76742009',NULL,'Postmenopausal bleeding (finding)'),('gynaecological-cancer',1,'301822002',NULL,'Abnormal vaginal bleeding (finding)'),('gynaecological-cancer',1,'415149004',NULL,'Postmenopausal postcoital bleeding'),('gynaecological-cancer',1,'874231000000101',NULL,'QCancer endometrial cancer risk'),('gynaecological-cancer',1,'848891000000105',NULL,'QCancer ovarian cancer risk (observable entity)'),('gynaecological-cancer',1,'874251000000108',NULL,'QCancer cervical cancer risk'),('gynaecological-cancer',1,'369814002',NULL,'T3 (III): Endometrial tumor with local and/or regional spread as specified in T3a, b, N1 and FIGO IIIA, B, and C below or adnexa (direct extension or metastasis) and/or cancer cells in ascites or peritoneal washings (finding)'),('gynaecological-cancer',1,'446526009',NULL,'Debulking of neoplasm of ovary'),('gynaecological-cancer',1,'473239006',NULL,'Bilateral oophorectomy for malignant tumour of ovary'),('gynaecological-cancer',1,'94397007',NULL,'Cancer metastatic to neck lymph nodes'),('gynaecological-cancer',1,'700125004',NULL,'Referral to paediatric gynaecology service'),('gynaecological-cancer',1,'432519008',NULL,'Elevated cancer antigen 125'),('gynaecological-cancer',1,'276311000000101',NULL,'Fast track referral for suspected gynaecological cancer'),('gynaecological-cancer',1,'382511000000105',NULL,'Seen in fast track suspected gynaecological cancer clinic'),('gynaecological-cancer',1,'249011000000106',NULL,'Referral to gynaecology special interest general practitioner'),('gynaecological-cancer',1,'119423009',NULL,'Benign teratoma of ovary (disorder)'),('gynaecological-cancer',1,'189116006',NULL,'Benign neoplasm of ovary (& dermoid cyst)'),('gynaecological-cancer',1,'312984006',NULL,'Abnormal uterine bleeding unrelated to menstrual cycle (disorder)');
INSERT INTO #codessnomed
VALUES ('cervical-smear',1,'1020451000000104',NULL,'Cervical cytology test (observable entity)'),('cervical-smear',1,'104651000119104',NULL,'Sampling of vagina for Papanicolaou smear after hysterectomy for dysplasia of cervix done (situation)'),('cervical-smear',1,'10738891000119107',NULL,'History of total hysterectomy without abnormal cervical Papanicolaou smear (situation)'),('cervical-smear',1,'1104601000000107',NULL,'Cervical smear screening done by other healthcare provider (situation)'),('cervical-smear',1,'1104621000000103',NULL,'Cervical cancer screening offered (situation)'),('cervical-smear',1,'1104671000000104',NULL,'Cervical cancer screening not offered (situation)'),('cervical-smear',1,'1109911000000100',NULL,'Excepted from cervical screening quality indicators - no response to three invitations (finding)'),('cervical-smear',1,'1110801000000101',NULL,'Exception reporting - cervical screening quality indicators (finding)'),('cervical-smear',1,'112241000119107',NULL,'Cervical cancer Papanicolaou smear screening declined (situation)'),('cervical-smear',1,'1128121000000109',NULL,'Cervical human papillomavirus screening test technical failure (finding)'),('cervical-smear',1,'168401004',NULL,'Cervical smear result (& [dyskaryosis] or [dysplasia])'),('cervical-smear',1,'168402006',NULL,'Cervical smear - inadequate specimen (finding)'),('cervical-smear',1,'168403001',NULL,'Cervical smear: negative (& no endocervic cells)'),('cervical-smear',1,'168404007',NULL,'Cerv smear mild dyskaryosis: (& CIN I)'),('cervical-smear',1,'168406009',NULL,'Cervical smear - severe dyskaryosis ? invasive carcinoma (finding)'),('cervical-smear',1,'168407000',NULL,'Cervical smear - ? glandular neoplasia (finding)'),('cervical-smear',1,'168408005',NULL,'Cervical smear - atrophic changes (finding)'),('cervical-smear',1,'168409002',NULL,'Cerv smear moderate dyskaryosis: (& CIN II)'),('cervical-smear',1,'168410007',NULL,'Cervical smear - borderline changes (finding)'),('cervical-smear',1,'168411006',NULL,'Cervical smear - endocervical cells present (finding)'),('cervical-smear',1,'168413009',NULL,'Smear: [cervical result NOS] or [nuclear abnormality]'),('cervical-smear',1,'168414003',NULL,'Cervical smear - inflammatory change (finding)'),('cervical-smear',1,'168415002',NULL,'Cervical smear - no inflammation (finding)'),('cervical-smear',1,'168416001',NULL,'Cervical smear - severe inflammation (finding)'),('cervical-smear',1,'168417005',NULL,'Cervical smear - trichomonas (finding)'),('cervical-smear',1,'168418000',NULL,'Cervical smear - candida (finding)'),('cervical-smear',1,'168419008',NULL,'Cerv smear - viral changes (& infl unsp)'),('cervical-smear',1,'168420002',NULL,'Cervical smear: [wart virus] or [herpes]'),('cervical-smear',1,'168421003',NULL,'Cervical smear - herpes (finding)'),('cervical-smear',1,'168422005',NULL,'Cervical smear - actinomyces (finding)'),('cervical-smear',1,'168423000',NULL,'Cervical smear - gardnerella (finding)'),('cervical-smear',1,'168424006',NULL,'Cervical smear - koilocytosis (finding)'),('cervical-smear',1,'168428009',NULL,'Cervical smear - action needed (context-dependent category)'),('cervical-smear',1,'168429001',NULL,'Cervical smear: repeat after treatment (context-dependent category)'),('cervical-smear',1,'168430006',NULL,'Cervical smear: repeat 1 month (context-dependent category)'),('cervical-smear',1,'168431005',NULL,'Cervical smear: repeat 3 months (context-dependent category)'),('cervical-smear',1,'168432003',NULL,'Cervical smear: repeat 4 months (context-dependent category)'),('cervical-smear',1,'168433008',NULL,'Cervical smear: repeat 6 months (context-dependent category)'),('cervical-smear',1,'168434002',NULL,'Cervical smear: repeat 9 months (context-dependent category)'),('cervical-smear',1,'168435001',NULL,'Cervical smear: repeat 12 months (context-dependent category)'),('cervical-smear',1,'168436000',NULL,'Cervical smear: colposcopy needed (context-dependent category)'),('cervical-smear',1,'168437009',NULL,'Cervical smear - cervical biopsy needed (context-dependent category)'),('cervical-smear',1,'168438004',NULL,'Cervical smear: uterine curettage needed (context-dependent category)'),('cervical-smear',1,'171149006',NULL,'Cervical neoplasia screening (procedure)'),('cervical-smear',1,'171156000',NULL,'(Ca cervix screen - not attended) or (cervical smear non-responder)'),('cervical-smear',1,'171158004',NULL,'(Cervical cytology examination) or (Ca cervix - screen done)'),('cervical-smear',1,'171163000',NULL,'Cervical smear status unknown (finding)'),('cervical-smear',1,'171164006',NULL,'Cervical smear due (finding)'),('cervical-smear',1,'177074001',NULL,'Cervical smear NEC (& Papanicolau)'),('cervical-smear',1,'18361000000103',NULL,'Cervical cytology claim (procedure)'),('cervical-smear',1,'185625009',NULL,'Cervical smear disclaimer received (finding)'),('cervical-smear',1,'198351000000105',NULL,'Cervical smear disclaimer sent (finding)'),('cervical-smear',1,'200511000000101',NULL,'Cervical smear information leaflet given (procedure)'),('cervical-smear',1,'206231000000105',NULL,'Informed consent for cervical smear given (finding)'),('cervical-smear',1,'2081000000105',NULL,'Histopathology report received (finding)'),('cervical-smear',1,'247571000000100',NULL,'Cervical smear repeat at 36 months (context-dependent category)'),('cervical-smear',1,'247581000000103',NULL,'Cervical smear repeat at 60 months (context-dependent category)'),('cervical-smear',1,'250538001',NULL,'Dyskaryosis on cervical smear (finding)'),('cervical-smear',1,'252991009',NULL,'Cervical intraepithelial neoplasia grade III with severe dysplasia (disorder)'),('cervical-smear',1,'268542002',NULL,'Ca cervix screening - not attended (finding)'),('cervical-smear',1,'268543007',NULL,'Ca cervix - screening done (finding)'),('cervical-smear',1,'269957009',NULL,'Cervical smear result (finding)'),('cervical-smear',1,'269958004',NULL,'Cervical smear - negative (finding)'),('cervical-smear',1,'269959007',NULL,'Cervical smear - mild dyskaryosis (finding)'),('cervical-smear',1,'269960002',NULL,'Cervical smear - severe dyskaryosis (finding)'),('cervical-smear',1,'269961003',NULL,'Cervical smear - moderate dyskaryosis (finding)'),('cervical-smear',1,'269963000',NULL,'Cervical smear - viral inflammation unspecified (finding)'),('cervical-smear',1,'269964006',NULL,'Cervical smear - wart virus (finding)'),('cervical-smear',1,'274402003',NULL,'Cervical smear: action (context-dependent category)'),('cervical-smear',1,'275803005',NULL,'Nuclear abnormality on smear (finding)'),('cervical-smear',1,'275805003',NULL,'Viral changes on cervical smear (finding)'),('cervical-smear',1,'275982002',NULL,'Cervical smear non-responder (finding)'),('cervical-smear',1,'276446009',NULL,'Cervical smear sample (specimen)'),('cervical-smear',1,'281101005',NULL,'Smear NAD - no endocervical cells (finding)'),('cervical-smear',1,'285836003',NULL,'Cervical intraepithelial neoplasia grade 1 (disorder)'),('cervical-smear',1,'285838002',NULL,'Cervical intraepithelial neoplasia grade 2 (disorder)'),('cervical-smear',1,'308418005',NULL,'Cervical smear status (finding)'),('cervical-smear',1,'309081009',NULL,'Abnormal cervical smear (finding)'),('cervical-smear',1,'310788006',NULL,'Neoplasm screening excluding cervical (procedure)'),('cervical-smear',1,'310841002',NULL,'Cervical smear - mild inflammation (finding)'),('cervical-smear',1,'310842009',NULL,'Cervical smear - moderate inflammation (finding)'),('cervical-smear',1,'390920000',NULL,'Place cervical smear taken (finding)'),('cervical-smear',1,'390930009',NULL,'Cervical smear overdue (finding)'),('cervical-smear',1,'412715009',NULL,'Cervical smear transformation zone cells present (finding)'),('cervical-smear',1,'412716005',NULL,'Cervical smear transformation zone cells absent (context-dependent category)'),('cervical-smear',1,'413812009',NULL,'Cervical smear not indicated (context-dependent category)'),('cervical-smear',1,'416099005',NULL,'No cervical smear required - no uterus (finding)'),('cervical-smear',1,'416419004',NULL,'Cervical smear to continue post hysterectomy (finding)'),('cervical-smear',1,'416480007',NULL,'Cervical smear - suspend recall (finding)'),('cervical-smear',1,'416755008',NULL,'Cervical smear every 12 months for life (finding)'),('cervical-smear',1,'417036008',NULL,'Liquid based cervical cytology screening (procedure)'),('cervical-smear',1,'439074000',NULL,'Dysplasia on cervical smear (finding)'),('cervical-smear',1,'439776006',NULL,'Cervical Papanicolaou smear positive for malignant neoplasm (finding)'),('cervical-smear',1,'439888000',NULL,'Abnormal cervical Papanicolaou smear (finding)'),('cervical-smear',1,'439956007',NULL,'History of abnormal cervical Papanicolaou smear (situation)'),('cervical-smear',1,'439958008',NULL,'Sampling of cervix for Papanicolaou smear (procedure)'),('cervical-smear',1,'440623000',NULL,'Microscopic examination of cervical Papanicolaou smear (procedure)'),('cervical-smear',1,'441087007',NULL,'Atypical squamous cells of undetermined significance on cervical Papanicolaou smear (finding)'),('cervical-smear',1,'441088002',NULL,'Atypical squamous cells on cervical Papanicolaou smear cannot exclude high grade squamous intraepithelial lesion (finding)'),('cervical-smear',1,'441094005',NULL,'Atypical endocervical cells on cervical Papanicolaou smear (finding)'),('cervical-smear',1,'441219009',NULL,'Atypical glandular cells on cervical Papanicolaou smear (finding)'),('cervical-smear',1,'441667007',NULL,'Abnormal cervical Papanicolaou smear with positive human papillomavirus deoxyribonucleic acid test (finding)'),('cervical-smear',1,'4461000175108',NULL,'Cervical cancer screening not done (situation)'),('cervical-smear',1,'494911000000104',NULL,'Annual cervical smear required (finding)'),('cervical-smear',1,'50110003',NULL,'Cervical smear - endocervical cells absent (finding)'),
('cervical-smear',1,'512121000000106',NULL,'Never had cervical smear (finding)'),('cervical-smear',1,'62051000119105',NULL,'Low grade squamous intraepithelial lesion on cervical Papanicolaou smear (finding)'),('cervical-smear',1,'62061000119107',NULL,'High grade squamous intraepithelial lesion on cervical Papanicolaou smear (finding)'),('cervical-smear',1,'700399008',NULL,'Cervical smear - borderline change in squamous cells (finding)'),('cervical-smear',1,'700400001',NULL,'Cervical smear - borderline change in endocervical cells (finding)'),('cervical-smear',1,'736595007',NULL,'Screening for malignant neoplasm of cervix declined (situation)'),('cervical-smear',1,'767357000',NULL,'Sampling of cervix for Papanicolaou smear done (situation)'),('cervical-smear',1,'804681000000109',NULL,'Cervical smear test due date (observable entity)'),('cervical-smear',1,'809431000000109',NULL,'Cervical smear test indicated but not done (situation)'),('cervical-smear',1,'809621000000109',NULL,'Cervical smear repeat at 48 months (situation)'),('cervical-smear',1,'812331000000105',NULL,'Cervical smear pus cells present (finding)'),('cervical-smear',1,'812351000000103',NULL,'Cervical smear red blood cells present (finding)'),('cervical-smear',1,'813711000000108',NULL,'Cervical smear epithelial cells absent (situation)'),('cervical-smear',1,'82991000119104',NULL,'History of negative cervical Papanicolaou smear performed within last 12 months (situation)'),('cervical-smear',1,'838031000000102',NULL,'Provision of written information about cervical smear test (procedure)'),('cervical-smear',1,'851141000000101',NULL,'Provision of information about cervical screening programme (procedure)'),('cervical-smear',1,'877711000000109',NULL,'Cervical smear repeat at 24 months (situation)'),('cervical-smear',1,'880941000000101',NULL,'Cervical smear - low grade dyskaryosis (finding)'),('cervical-smear',1,'883351000000105',NULL,'History of abnormal cervical smear (situation)'),('cervical-smear',1,'887481000000104',NULL,'Cervical smear - high grade dyskaryosis (moderate) (finding)'),('cervical-smear',1,'887501000000108',NULL,'Cervical smear - high grade dyskaryosis (severe) (finding)'),('cervical-smear',1,'887521000000104',NULL,'Cervical smear - high grade dyskaryosis with features of invasive squamous carcinoma (finding)'),('cervical-smear',1,'887601000000107',NULL,'Cervical smear - features of endocervical type glandular neoplasia (finding)'),('cervical-smear',1,'887621000000103',NULL,'Cervical smear - features of non-cervical type glandular neoplasia (finding)'),('cervical-smear',1,'888091000000108',NULL,'Cervical smear - human papillomavirus negative (finding)'),('cervical-smear',1,'888111000000103',NULL,'Cervical smear - human papillomavirus positive (finding)'),('cervical-smear',1,'90226004',NULL,'Cytopathology procedure, preparation of smear, genital source (procedure)'),('cervical-smear',1,'918571000000107',NULL,'Cervical smear report received (finding)'),('cervical-smear',1,'98791000119102',NULL,'Cytological evidence of malignancy on cervical Papanicolaou smear (finding)'),('cervical-smear',1,'996261000000103',NULL,'Cervical cytology screening test (observable entity)')

INSERT INTO #AllCodes
SELECT [concept], [version], [code], [description] from #codessnomed;

IF OBJECT_ID('tempdb..#codesemis') IS NOT NULL DROP TABLE #codesemis;
CREATE TABLE #codesemis (
  [concept] [varchar](255) NOT NULL,
  [version] INT NOT NULL,
	[code] [varchar](20) COLLATE Latin1_General_CS_AS NOT NULL,
	[term] [varchar](20) COLLATE Latin1_General_CS_AS NULL,
	[description] [varchar](255) NULL
) ON [PRIMARY];

INSERT INTO #codesemis
VALUES ('gynaecological-cancer',1,'^ESCT1199845',NULL,'Suspected ovarian cancer'),('gynaecological-cancer',1,'^ESCT1202154',NULL,'Borderline epithelial tumour of ovary'),('gynaecological-cancer',1,'^ESCT1202155',NULL,'Borderline ovarian epithelial tumor'),('gynaecological-cancer',1,'^ESCT1202156',NULL,'Borderline ovarian epithelial tumour'),('gynaecological-cancer',1,'^ESCT1202157',NULL,'Borderline epithelial tumor of ovary'),('gynaecological-cancer',1,'^ESCT1202158',NULL,'Borderline epithelial neoplasm of ovary'),('gynaecological-cancer',1,'^ESCT1247309',NULL,'Malignant tumor of female genital organ'),('gynaecological-cancer',1,'^ESCTBE399649',NULL,'Benign neoplasm of uterine cervix'),('gynaecological-cancer',1,'^ESCTBE399650',NULL,'Benign neoplasm of cervix uteri'),('gynaecological-cancer',1,'^ESCTBE399651',NULL,'Benign tumour of cervix'),('gynaecological-cancer',1,'^ESCTBE399652',NULL,'Benign tumor of cervix'),('gynaecological-cancer',1,'^ESCTBE400041',NULL,'Benign ovarian tumor'),('gynaecological-cancer',1,'^ESCTBI748490',NULL,'Bilateral oophorectomy for malignant neoplasm of ovary'),('gynaecological-cancer',1,'^ESCTBI748491',NULL,'Bilateral oophorectomy for ovarian malignancy'),('gynaecological-cancer',1,'^ESCTBI748492',NULL,'Bilateral oophorectomy for malignant tumor of ovary'),('gynaecological-cancer',1,'^ESCTBI748493',NULL,'Bilateral oophorectomy for malignant tumour of ovary'),('gynaecological-cancer',1,'^ESCTBL374815',NULL,'Bleeding after menopause'),('gynaecological-cancer',1,'^ESCTCA403543',NULL,'Cancer metastatic to neck lymph nodes'),('gynaecological-cancer',1,'^ESCTCA403692',NULL,'Cancer metastatic to ovary'),('gynaecological-cancer',1,'^ESCTCA475133',NULL,'Cancer metastatic to cervix'),('gynaecological-cancer',1,'^ESCTCA624310',NULL,'Cancer of cervix'),('gynaecological-cancer',1,'^ESCTCA624313',NULL,'Cancer of the uterine cervix'),('gynaecological-cancer',1,'^ESCTCA624613',NULL,'CA - Cancer of ovary'),('gynaecological-cancer',1,'^ESCTCA632597',NULL,'Cancer metastatic to left ovary'),('gynaecological-cancer',1,'^ESCTCA632610',NULL,'Cancer metastatic to right ovary'),('gynaecological-cancer',1,'^ESCTCA700461',NULL,'Carcinoma of ovary, stage 4'),('gynaecological-cancer',1,'^ESCTCA700462',NULL,'Cancer of ovary, stage 4'),('gynaecological-cancer',1,'^ESCTCA700824',NULL,'Carcinoma of ovary, stage 3'),('gynaecological-cancer',1,'^ESCTCA700826',NULL,'Cancer of ovary, stage 3'),('gynaecological-cancer',1,'^ESCTCA701746',NULL,'Carcinoma of uterine cervix, invasive'),('gynaecological-cancer',1,'^ESCTCA701747',NULL,'Cancer of uterine cervix, invasive'),('gynaecological-cancer',1,'^ESCTCA702727',NULL,'Carcinoma of ovary, stage 2'),('gynaecological-cancer',1,'^ESCTCA702729',NULL,'Cancer of ovary, stage 2'),('gynaecological-cancer',1,'^ESCTCA702949',NULL,'Carcinoma of ovary, stage 1'),('gynaecological-cancer',1,'^ESCTCA702950',NULL,'Cancer of ovary, stage 1'),('gynaecological-cancer',1,'^ESCTCE624314',NULL,'Cervical cancer'),('gynaecological-cancer',1,'^ESCTCE797918',NULL,'Cervical cancer screening not done'),('gynaecological-cancer',1,'^ESCTCE803550',NULL,'Cervical cancer Papanicolaou smear screening declined'),('gynaecological-cancer',1,'^ESCTCL689609',NULL,'Clear cell (mesonephric) neoplasm of ovary'),('gynaecological-cancer',1,'^ESCTDE732582',NULL,'Debulking of neoplasm of ovary'),('gynaecological-cancer',1,'^ESCTEL716188',NULL,'Elevated cancer antigen 125'),('gynaecological-cancer',1,'^ESCTFI274652',NULL,'FIGO CC stage I'),('gynaecological-cancer',1,'^ESCTFI291047',NULL,'FIGO CC stage Ib'),('gynaecological-cancer',1,'^ESCTFI298928',NULL,'FIGO EC stage II'),('gynaecological-cancer',1,'^ESCTFI305606',NULL,'FIGO EC stage IV'),('gynaecological-cancer',1,'^ESCTFI325560',NULL,'FIGO EC stage I A'),('gynaecological-cancer',1,'^ESCTFI329633',NULL,'FIGO CC stage Ia'),('gynaecological-cancer',1,'^ESCTFI331374',NULL,'FIGO EC stage I'),('gynaecological-cancer',1,'^ESCTFI335459',NULL,'FIGO CC stage III'),('gynaecological-cancer',1,'^ESCTFI347892',NULL,'FIGO EC stage I B'),('gynaecological-cancer',1,'^ESCTFI361021',NULL,'FIGO CC stage II'),('gynaecological-cancer',1,'^ESCTFI381706',NULL,'FIGO EC stage III'),('gynaecological-cancer',1,'^ESCTFI383047',NULL,'FIGO CC stage IV'),('gynaecological-cancer',1,'^ESCTFI392953',NULL,'FIGO CC stage Ib occ'),('gynaecological-cancer',1,'^ESCTFI763214',NULL,'FIGO CC stage IA1'),('gynaecological-cancer',1,'^ESCTFI763222',NULL,'FIGO CC stage IA2'),('gynaecological-cancer',1,'^ESCTFI763240',NULL,'FIGO CC stage IB1'),('gynaecological-cancer',1,'^ESCTFI763270',NULL,'FIGO CC stage IB2'),('gynaecological-cancer',1,'^ESCTFI763288',NULL,'FIGO CC stage IIA1'),('gynaecological-cancer',1,'^ESCTFI763293',NULL,'FIGO CC stage IIA2'),('gynaecological-cancer',1,'^ESCTFI763301',NULL,'FIGO CC stage IIB'),('gynaecological-cancer',1,'^ESCTFI763311',NULL,'FIGO CC stage IIIA'),('gynaecological-cancer',1,'^ESCTFI763317',NULL,'FIGO CC stage IIIB'),('gynaecological-cancer',1,'^ESCTFI763327',NULL,'FIGO CC stage IVA'),('gynaecological-cancer',1,'^ESCTFI763336',NULL,'FIGO CC stage IVB'),('gynaecological-cancer',1,'^ESCTFI763356',NULL,'FIGO EC stage IIIB'),('gynaecological-cancer',1,'^ESCTFI763390',NULL,'FIGO EC stage IIIC1'),('gynaecological-cancer',1,'^ESCTFI763398',NULL,'FIGO EC stage IIIC2'),('gynaecological-cancer',1,'^ESCTFI763414',NULL,'FIGO EC stage IVA'),('gynaecological-cancer',1,'^ESCTFI763420',NULL,'FIGO EC stage IVB'),('gynaecological-cancer',1,'^ESCTFI763570',NULL,'FIGO EC stage IIIA'),('gynaecological-cancer',1,'^ESCTGY472470',NULL,'Gynecological referral'),('gynaecological-cancer',1,'^ESCTGY472575',NULL,'Gynecological self-referral'),('gynaecological-cancer',1,'^ESCTHE776943',NULL,'Hereditary breast and ovarian cancer syndrome'),('gynaecological-cancer',1,'^ESCTIN274653',NULL,'International Federation of Gynecology and Obstetrics cervical cancer (FIGO CC) stage I'),('gynaecological-cancer',1,'^ESCTIN274654',NULL,'International Federation of Gynecology and Obstetrics cervical cancer stage I'),('gynaecological-cancer',1,'^ESCTIN274655',NULL,'International Federation of Gynaecology and Obstetrics cervical cancer (FIGO CC) stage I'),('gynaecological-cancer',1,'^ESCTIN291043',NULL,'International Federation of Gynaecology and Obstetrics cervical cancer stage Ib'),('gynaecological-cancer',1,'^ESCTIN291044',NULL,'International Federation of Gynecology and Obstetrics cervical cancer (FIGO CC) stage Ib'),('gynaecological-cancer',1,'^ESCTIN291045',NULL,'International Federation of Gynecology and Obstetrics cervical cancer stage Ib'),('gynaecological-cancer',1,'^ESCTIN291046',NULL,'International Federation of Gynaecology and Obstetrics cervical cancer (FIGO CC) stage Ib'),('gynaecological-cancer',1,'^ESCTIN298929',NULL,'International Federation of Gynecology and Obstetrics endometrial cancer (FIGO EC) stage II'),('gynaecological-cancer',1,'^ESCTIN298930',NULL,'International Federation of Gynaecology and Obstetrics endometrial cancer (FIGO EC) stage II'),('gynaecological-cancer',1,'^ESCTIN298931',NULL,'International Federation of Gynaecology and Obstetrics endometrial cancer stage II'),('gynaecological-cancer',1,'^ESCTIN298932',NULL,'International Federation of Gynecology and Obstetrics endometrial cancer stage II'),('gynaecological-cancer',1,'^ESCTIN305607',NULL,'International Federation of Gynaecology and Obstetrics endometrial cancer (FIGO EC) stage IV'),('gynaecological-cancer',1,'^ESCTIN305608',NULL,'International Federation of Gynecology and Obstetrics endometrial cancer (FIGO EC) stage IV'),('gynaecological-cancer',1,'^ESCTIN305609',NULL,'International Federation of Gynecology and Obstetrics endometrial cancer stage IV'),('gynaecological-cancer',1,'^ESCTIN325561',NULL,'International Federation of Gynaecology and Obstetrics endometrial cancer (FIGO EC) stage I A'),('gynaecological-cancer',1,'^ESCTIN325562',NULL,'International Federation of Gynecology and Obstetrics endometrial cancer (FIGO EC) stage I A'),('gynaecological-cancer',1,'^ESCTIN325563',NULL,'International Federation of Gynecology and Obstetrics endometrial cancer stage I A'),('gynaecological-cancer',1,'^ESCTIN329631',NULL,'International Federation of Gynaecology and Obstetrics cervical cancer (FIGO CC) stage Ia'),('gynaecological-cancer',1,'^ESCTIN329632',NULL,'International Federation of Gynecology and Obstetrics cervical cancer (FIGO CC) stage Ia'),('gynaecological-cancer',1,'^ESCTIN329634',NULL,'International Federation of Gynecology and Obstetrics cervical cancer stage Ia'),('gynaecological-cancer',1,'^ESCTIN331375',NULL,'International Federation of Gynecology and Obstetrics endometrial cancer (FIGO EC) stage I'),('gynaecological-cancer',1,'^ESCTIN331376',NULL,'International Federation of Gynaecology and Obstetrics endometrial cancer (FIGO EC) stage I'),('gynaecological-cancer',1,'^ESCTIN331377',NULL,'International Federation of Gynecology and Obstetrics endometrial cancer stage I'),('gynaecological-cancer',1,'^ESCTIN335460',NULL,'International Federation of Gynecology and Obstetrics cervical cancer (FIGO CC) stage III'),('gynaecological-cancer',1,'^ESCTIN335461',NULL,'International Federation of Gynaecology and Obstetrics cervical cancer (FIGO CC) stage III'),('gynaecological-cancer',1,'^ESCTIN335462',NULL,'International Federation of Gynecology and Obstetrics cervical cancer stage III'),('gynaecological-cancer',1,'^ESCTIN347893',NULL,'International Federation of Gynaecology and Obstetrics endometrial cancer (FIGO EC) stage I B'),('gynaecological-cancer',1,'^ESCTIN347894',NULL,'International Federation of Gynecology and Obstetrics endometrial cancer (FIGO EC) stage I B'),('gynaecological-cancer',1,'^ESCTIN347895',NULL,'International Federation of Gynecology and Obstetrics endometrial cancer stage I B'),('gynaecological-cancer',1,'^ESCTIN361022',NULL,'International Federation of Gynaecology and Obstetrics cervical cancer (FIGO CC) stage II'),
('gynaecological-cancer',1,'^ESCTIN361023',NULL,'International Federation of Gynecology and Obstetrics cervical cancer (FIGO CC) stage II'),('gynaecological-cancer',1,'^ESCTIN361024',NULL,'International Federation of Gynecology and Obstetrics cervical cancer stage II'),('gynaecological-cancer',1,'^ESCTIN381707',NULL,'International Federation of Gynaecology and Obstetrics endometrial cancer (FIGO EC) stage III'),('gynaecological-cancer',1,'^ESCTIN381708',NULL,'International Federation of Gynecology and Obstetrics endometrial cancer (FIGO EC) stage III'),('gynaecological-cancer',1,'^ESCTIN381709',NULL,'International Federation of Gynecology and Obstetrics endometrial cancer stage III'),('gynaecological-cancer',1,'^ESCTIN383048',NULL,'International Federation of Gynecology and Obstetrics cervical cancer (FIGO CC) stage IV'),('gynaecological-cancer',1,'^ESCTIN383049',NULL,'International Federation of Gynaecology and Obstetrics cervical cancer (FIGO CC) stage IV'),('gynaecological-cancer',1,'^ESCTIN383050',NULL,'International Federation of Gynecology and Obstetrics cervical cancer stage IV'),('gynaecological-cancer',1,'^ESCTIN392954',NULL,'International Federation of Gynecology and Obstetrics cervical cancer stage Ib occ'),('gynaecological-cancer',1,'^ESCTIN392955',NULL,'International Federation of Gynecology and Obstetrics cervical cancer (FIGO CC) stage Ib occ'),('gynaecological-cancer',1,'^ESCTIN392956',NULL,'International Federation of Gynaecology and Obstetrics cervical cancer stage Ib occ'),('gynaecological-cancer',1,'^ESCTIN392957',NULL,'International Federation of Gynaecology and Obstetrics cervical cancer (FIGO CC) stage Ib occ'),('gynaecological-cancer',1,'^ESCTIN701748',NULL,'Invasive cervical cancer'),('gynaecological-cancer',1,'^ESCTIN716186',NULL,'Increased cancer antigen 125'),('gynaecological-cancer',1,'^ESCTIN763215',NULL,'International Federation of Gynaecology and Obstetrics cervical cancer (FIGO CC) stage IA1'),('gynaecological-cancer',1,'^ESCTIN763216',NULL,'International Federation of Gynecology and Obstetrics cervical cancer (FIGO CC) stage IA1'),('gynaecological-cancer',1,'^ESCTIN763223',NULL,'International Federation of Gynecology and Obstetrics cervical cancer (FIGO CC) stage IA2'),('gynaecological-cancer',1,'^ESCTIN763224',NULL,'International Federation of Gynaecology and Obstetrics cervical cancer (FIGO CC) stage IA2'),('gynaecological-cancer',1,'^ESCTIN763241',NULL,'International Federation of Gynecology and Obstetrics cervical cancer (FIGO CC) stage IB1'),('gynaecological-cancer',1,'^ESCTIN763242',NULL,'International Federation of Gynaecology and Obstetrics cervical cancer (FIGO CC) stage IB1'),('gynaecological-cancer',1,'^ESCTIN763271',NULL,'International Federation of Gynecology and Obstetrics cervical cancer (FIGO CC) stage IB2'),('gynaecological-cancer',1,'^ESCTIN763272',NULL,'International Federation of Gynaecology and Obstetrics cervical cancer (FIGO CC) stage IB2'),('gynaecological-cancer',1,'^ESCTIN763289',NULL,'International Federation of Gynaecology and Obstetrics cervical cancer (FIGO CC) stage IIA1'),('gynaecological-cancer',1,'^ESCTIN763290',NULL,'International Federation of Gynecology and Obstetrics cervical cancer (FIGO CC) stage IIA1'),('gynaecological-cancer',1,'^ESCTIN763294',NULL,'International Federation of Gynecology and Obstetrics cervical cancer (FIGO CC) stage IIA2'),('gynaecological-cancer',1,'^ESCTIN763295',NULL,'International Federation of Gynaecology and Obstetrics cervical cancer (FIGO CC) stage IIA2'),('gynaecological-cancer',1,'^ESCTIN763302',NULL,'International Federation of Gynaecology and Obstetrics cervical cancer (FIGO CC) stage IIB'),('gynaecological-cancer',1,'^ESCTIN763303',NULL,'International Federation of Gynecology and Obstetrics cervical cancer (FIGO CC) stage IIB'),('gynaecological-cancer',1,'^ESCTIN763312',NULL,'International Federation of Gynecology and Obstetrics cervical cancer (FIGO CC) stage IIIA'),('gynaecological-cancer',1,'^ESCTIN763313',NULL,'International Federation of Gynaecology and Obstetrics cervical cancer (FIGO CC) stage IIIA'),('gynaecological-cancer',1,'^ESCTIN763318',NULL,'International Federation of Gynaecology and Obstetrics cervical cancer (FIGO CC) stage IIIB'),('gynaecological-cancer',1,'^ESCTIN763319',NULL,'International Federation of Gynecology and Obstetrics cervical cancer (FIGO CC) stage IIIB'),('gynaecological-cancer',1,'^ESCTIN763328',NULL,'International Federation of Gynaecology and Obstetrics cervical cancer (FIGO CC) stage IVA'),('gynaecological-cancer',1,'^ESCTIN763329',NULL,'International Federation of Gynecology and Obstetrics cervical cancer (FIGO CC) stage IVA'),('gynaecological-cancer',1,'^ESCTIN763337',NULL,'International Federation of Gynecology and Obstetrics cervical cancer (FIGO CC) stage IVB'),('gynaecological-cancer',1,'^ESCTIN763338',NULL,'International Federation of Gynaecology and Obstetrics cervical cancer (FIGO CC) stage IVB'),('gynaecological-cancer',1,'^ESCTIN763357',NULL,'International Federation of Gynaecology and Obstetrics endometrial cancer (FIGO EC) stage IIIB'),('gynaecological-cancer',1,'^ESCTIN763358',NULL,'International Federation of Gynecology and Obstetrics endometrial cancer (FIGO EC) stage IIIB'),('gynaecological-cancer',1,'^ESCTIN763359',NULL,'International Federation of Gynecology and Obstetrics endometrial cancer stage IIIB'),('gynaecological-cancer',1,'^ESCTIN763360',NULL,'International Federation of Gynaecology and Obstetrics endometrial cancer stage IIIB'),('gynaecological-cancer',1,'^ESCTIN763391',NULL,'International Federation of Gynecology and Obstetrics endometrial cancer (FIGO EC) stage IIIC1'),('gynaecological-cancer',1,'^ESCTIN763392',NULL,'International Federation of Gynaecology and Obstetrics endometrial cancer (FIGO EC) stage IIIC1'),('gynaecological-cancer',1,'^ESCTIN763393',NULL,'International Federation of Gynecology and Obstetrics endometrial cancer stage IIIC1'),('gynaecological-cancer',1,'^ESCTIN763394',NULL,'International Federation of Gynaecology and Obstetrics endometrial cancer stage IIIC1'),('gynaecological-cancer',1,'^ESCTIN763399',NULL,'International Federation of Gynecology and Obstetrics endometrial cancer (FIGO EC) stage IIIC2'),('gynaecological-cancer',1,'^ESCTIN763400',NULL,'International Federation of Gynaecology and Obstetrics endometrial cancer (FIGO EC) stage IIIC2'),('gynaecological-cancer',1,'^ESCTIN763401',NULL,'International Federation of Gynaecology and Obstetrics endometrial cancer stage IIIC2'),('gynaecological-cancer',1,'^ESCTIN763402',NULL,'International Federation of Gynecology and Obstetrics endometrial cancer stage IIIC2'),('gynaecological-cancer',1,'^ESCTIN763415',NULL,'International Federation of Gynaecology and Obstetrics endometrial cancer (FIGO EC) stage IVA'),('gynaecological-cancer',1,'^ESCTIN763416',NULL,'International Federation of Gynecology and Obstetrics endometrial cancer (FIGO EC) stage IVA'),('gynaecological-cancer',1,'^ESCTIN763421',NULL,'International Federation of Gynecology and Obstetrics endometrial cancer (FIGO EC) stage IVB'),('gynaecological-cancer',1,'^ESCTIN763422',NULL,'International Federation of Gynaecology and Obstetrics endometrial cancer (FIGO EC) stage IVB'),('gynaecological-cancer',1,'^ESCTIN763569',NULL,'International Federation of Gynaecology and Obstetrics endometrial cancer (FIGO EC) stage IIIA'),('gynaecological-cancer',1,'^ESCTIN763571',NULL,'International Federation of Gynecology and Obstetrics endometrial cancer (FIGO EC) stage IIIA'),('gynaecological-cancer',1,'^ESCTKR403685',NULL,'Krukenburg tumor'),('gynaecological-cancer',1,'^ESCTKR403691',NULL,'Krukenburg tumour'),('gynaecological-cancer',1,'^ESCTLO605219',NULL,'Local recurrence of malignant tumour of cervix'),('gynaecological-cancer',1,'^ESCTLO605220',NULL,'Local recurrence of malignant tumor of cervix'),('gynaecological-cancer',1,'^ESCTMA370769',NULL,'Mass of pelvic structure'),('gynaecological-cancer',1,'^ESCTMA624309',NULL,'Malignant tumor of cervix'),('gynaecological-cancer',1,'^ESCTMA624311',NULL,'Malignant neoplasm of cervix'),('gynaecological-cancer',1,'^ESCTMA624612',NULL,'Malignant tumor of ovary'),('gynaecological-cancer',1,'^ESCTMA624805',NULL,'Malignant tumor of female genital organ'),('gynaecological-cancer',1,'^ESCTME403541',NULL,'Metastatic malignant neoplasm to lymph nodes of neck'),('gynaecological-cancer',1,'^ESCTME403542',NULL,'Metastasis to cervical lymph nodes'),('gynaecological-cancer',1,'^ESCTME403684',NULL,'Metastatic malignant neoplasm to ovary'),('gynaecological-cancer',1,'^ESCTME403688',NULL,'Metastasis to ovary'),('gynaecological-cancer',1,'^ESCTME404206',NULL,'Metastatic malignant neoplasm to uterine adnexa'),('gynaecological-cancer',1,'^ESCTME475130',NULL,'Metastatic malignant neoplasm to uterine cervix'),('gynaecological-cancer',1,'^ESCTME475131',NULL,'Metastatic malignant neoplasm to cervix uteri'),('gynaecological-cancer',1,'^ESCTME605247',NULL,'Metastasis from malignant tumour of cervix'),('gynaecological-cancer',1,'^ESCTME605248',NULL,'Metastasis from malignant tumor of cervix'),('gynaecological-cancer',1,'^ESCTNE404442',NULL,'Neoplasm of uncertain behaviour of uterine cervix'),('gynaecological-cancer',1,'^ESCTNE404443',NULL,'Neoplasm of uncertain behavior of uterine cervix'),('gynaecological-cancer',1,'^ESCTNE404444',NULL,'Neoplasm of uncertain behavior of cervix uteri'),('gynaecological-cancer',1,'^ESCTNE404445',NULL,'Neoplasm of uncertain behaviour of cervix uteri'),('gynaecological-cancer',1,'^ESCTNE404825',NULL,'Neoplasm of uncertain behavior of ovary'),('gynaecological-cancer',1,'^ESCTNE435657',NULL,'Neoplasm of uterine cervix'),('gynaecological-cancer',1,'^ESCTNE435662',NULL,'Neoplasm of ovary'),('gynaecological-cancer',1,'^ESCTNE801501',NULL,'Neoplasm of low malignant potential behaviour of ovary'),('gynaecological-cancer',1,'^ESCTNE801502',NULL,'Neoplasm of low malignant potential behavior of ovary'),
('gynaecological-cancer',1,'^ESCTOV403687',NULL,'Ovarian metastasis'),('gynaecological-cancer',1,'^ESCTOV417122',NULL,'Overlapping malignant neoplasm of uterine cervix'),('gynaecological-cancer',1,'^ESCTOV417123',NULL,'Overlapping malignant neoplasm of cervix uteri'),('gynaecological-cancer',1,'^ESCTOV431731',NULL,'Ovarian mature cystic teratoma'),('gynaecological-cancer',1,'^ESCTOV435664',NULL,'Ovarian tumour'),('gynaecological-cancer',1,'^ESCTOV435665',NULL,'Ovarian tumor'),('gynaecological-cancer',1,'^ESCTOV624615',NULL,'Ovarian cancer'),('gynaecological-cancer',1,'^ESCTOV699568',NULL,'Ovarian cancer, disseminated'),('gynaecological-cancer',1,'^ESCTOV700463',NULL,'Ovarian cancer stage 4'),('gynaecological-cancer',1,'^ESCTOV700825',NULL,'Ovarian cancer stage 3'),('gynaecological-cancer',1,'^ESCTOV702728',NULL,'Ovarian cancer stage 2'),('gynaecological-cancer',1,'^ESCTOV702951',NULL,'Ovarian cancer stage 1'),('gynaecological-cancer',1,'^ESCTPA786697',NULL,'Patient refused referral to gynecologist'),('gynaecological-cancer',1,'^ESCTPA786700',NULL,'Patient refused referral to gynaecologist'),('gynaecological-cancer',1,'^ESCTPE370768',NULL,'Pelvic lump'),('gynaecological-cancer',1,'^ESCTPM374814',NULL,'PMB - Postmenopausal bleeding'),('gynaecological-cancer',1,'^ESCTPR402715',NULL,'Primary malignant neoplasm of ovary'),('gynaecological-cancer',1,'^ESCTPR402929',NULL,'Primary malignant neoplasm of uterine adnexa'),('gynaecological-cancer',1,'^ESCTPR472843',NULL,'Private referral to gynecologist'),('gynaecological-cancer',1,'^ESCTPR632595',NULL,'Primary malignant neoplasm of left ovary'),('gynaecological-cancer',1,'^ESCTPR632608',NULL,'Primary malignant neoplasm of right ovary'),('gynaecological-cancer',1,'^ESCTPR636302',NULL,'Primary malignant neoplasm of uterine cervix'),('gynaecological-cancer',1,'^ESCTPR699569',NULL,'Primary malignant neoplasm of ovary, with widespread metastatic disease'),('gynaecological-cancer',1,'^ESCTRA716187',NULL,'Raised cancer antigen 125'),('gynaecological-cancer',1,'^ESCTRE472469',NULL,'Referral to gynaecology service'),('gynaecological-cancer',1,'^ESCTRE472472',NULL,'Referral to gynecology service'),('gynaecological-cancer',1,'^ESCTRE595195',NULL,'Referral to obstetrics and gynaecology service'),('gynaecological-cancer',1,'^ESCTRE595196',NULL,'Referral to obstetrics and gynecology service'),('gynaecological-cancer',1,'^ESCTRE595438',NULL,'Referral to obstetrician and gynecologist'),('gynaecological-cancer',1,'^ESCTRE597926',NULL,'Referral to gynecologist'),('gynaecological-cancer',1,'^ESCTRE753131',NULL,'Referral to pediatric gynecology service'),('gynaecological-cancer',1,'^ESCTRE786695',NULL,'Referral to gynaecologist declined by subject'),('gynaecological-cancer',1,'^ESCTRE786696',NULL,'Referral to gynecologist declined by subject'),('gynaecological-cancer',1,'^ESCTSC797919',NULL,'Screening for malignant neoplasm of cervix not done'),('gynaecological-cancer',1,'^ESCTSE403540',NULL,'Secondary malignant neoplasm of lymph nodes of neck'),('gynaecological-cancer',1,'^ESCTSE403686',NULL,'Secondary tumor to ovary'),('gynaecological-cancer',1,'^ESCTSE403689',NULL,'Secondary cancer of ovary'),('gynaecological-cancer',1,'^ESCTSE403690',NULL,'Secondary tumour to ovary'),('gynaecological-cancer',1,'^ESCTSE404205',NULL,'Secondary malignant neoplasm of uterine adnexa'),('gynaecological-cancer',1,'^ESCTSE475132',NULL,'Secondary malignant neoplasm of uterine cervix'),('gynaecological-cancer',1,'^ESCTSE632596',NULL,'Secondary malignant neoplasm of left ovary'),('gynaecological-cancer',1,'^ESCTSE632609',NULL,'Secondary malignant neoplasm of right ovary'),('gynaecological-cancer',1,'^ESCTSU659110',NULL,'Suspected gynecological cancer'),('gynaecological-cancer',1,'^ESCTSU786698',NULL,'Subject declined referral to gynecologist'),('gynaecological-cancer',1,'^ESCTSU786699',NULL,'Subject refused referral to gynecologist'),('gynaecological-cancer',1,'^ESCTSU786701',NULL,'Subject declined referral to gynaecologist'),('gynaecological-cancer',1,'^ESCTSU786702',NULL,'Subject refused referral to gynaecologist'),('gynaecological-cancer',1,'^ESCTT3633184',NULL,'T3 (III): Endometrial tumour with local and/or regional spread as specified in T3a, b, N1 and FIGO IIIA, B, and C below or adnexa (direct extension or metastasis) and/or cancer cells in ascites or peritoneal washings'),('gynaecological-cancer',1,'^ESCTT3633185',NULL,'T3 (III): Endometrial tumor with local and/or regional spread as specified in T3a, b, N1 and FIGO IIIA, B, and C below or adnexa (direct extension or metastasis) and/or cancer cells in ascites or peritoneal washings'),('gynaecological-cancer',1,'^ESCTTH775303',NULL,'Theca steroid producing cell malignant neoplasm of ovary'),('gynaecological-cancer',1,'^ESCTTH775304',NULL,'Theca steroid producing cell malignant tumor of ovary'),('gynaecological-cancer',1,'^ESCTTH775305',NULL,'Theca steroid producing cell malignant tumour of ovary'),('gynaecological-cancer',1,'^ESCTTU435658',NULL,'Tumour of cervix'),('gynaecological-cancer',1,'^ESCTTU435659',NULL,'Tumor of cervix'),('gynaecological-cancer',1,'^ESCTTU435663',NULL,'Tumour of ovary'),('gynaecological-cancer',1,'^ESCTTU435666',NULL,'Tumor of ovary'),('gynaecological-cancer',1,'^ESCTUN535181',NULL,'Undifferentiated carcinoma of ovary'),('gynaecological-cancer',1,'^ESCTUN535182',NULL,'Undifferentiated ovarian cancer'),('gynaecological-cancer',1,'EMISNQQC5',NULL,'QCancer ovarian cancer risk score'),('gynaecological-cancer',1,'EMISNQQC8',NULL,'QCancer cervical cancer risk score'),('gynaecological-cancer',1,'EMISNQQC9',NULL,'QCancer endometrial cancer risk score'),('gynaecological-cancer',1,'EMISNQSU3',NULL,'Suspected gynaecological cancer');
INSERT INTO #codesemis
VALUES ('cervical-smear',1,'^ESCT1192357',NULL,'Cerv.smear - viral infl.unsp.'),('cervical-smear',1,'^ESCT1205542',NULL,'Papanicolaou smear taken'),('cervical-smear',1,'^ESCT1205543',NULL,'Cervical smear biopsy taken'),('cervical-smear',1,'^ESCT1212168',NULL,'Cervical cancer screening offered'),('cervical-smear',1,'^ESCT1212174',NULL,'Cervical cancer screening not offered'),('cervical-smear',1,'^ESCT1248341',NULL,'Cervical smear - severe dyskaryosis ? invasive carcinoma'),('cervical-smear',1,'^ESCT1248344',NULL,'Cervical smear - ? glandular neoplasia'),('cervical-smear',1,'^ESCT1248468',NULL,'Cx. smear: colposcopy needed'),('cervical-smear',1,'^ESCT1248469',NULL,'Cx. smear: repeat 1 month'),('cervical-smear',1,'^ESCT1248470',NULL,'Cx. smear: repeat 12 months'),('cervical-smear',1,'^ESCT1248471',NULL,'Cx. smear: repeat 3 months'),('cervical-smear',1,'^ESCT1248472',NULL,'Cx. smear: repeat 4 months'),('cervical-smear',1,'^ESCT1248473',NULL,'Cx. smear: repeat 6 months'),('cervical-smear',1,'^ESCT1248474',NULL,'Cx. smear: repeat 9 months'),('cervical-smear',1,'^ESCT1261902',NULL,'Cervical smear screening done by other healthcare provider'),('cervical-smear',1,'^ESCT1262509',NULL,'Excepted from cervical screening quality indicators - no response to three invitations'),('cervical-smear',1,'^ESCT1262621',NULL,'Exception reporting - cervical screening quality indicators'),('cervical-smear',1,'^ESCT1272250',NULL,'Place cervical smear taken'),('cervical-smear',1,'^ESCT1273728',NULL,'Cervical HPV (human papillomavirus) screening test technical failure'),('cervical-smear',1,'^ESCTAB598463',NULL,'Abnormal cervical smear'),('cervical-smear',1,'^ESCTAB725335',NULL,'Abnormal cervical Papanicolaou smear with positive human papillomavirus deoxyribonucleic acid test'),('cervical-smear',1,'^ESCTAB725336',NULL,'Abnormal cervical Papanicolaou smear with positive human papillomavirus deoxyribonucleic acid (DNA) test'),('cervical-smear',1,'^ESCTAT724556',NULL,'Atypical squamous cells of undetermined significance on cervical Papanicolaou smear'),('cervical-smear',1,'^ESCTAT724557',NULL,'Atypical squamous cells on cervical Papanicolaou smear cannot exclude high grade squamous intraepithelial lesion'),('cervical-smear',1,'^ESCTAT724569',NULL,'Atypical endocervical cells on cervical Papanicolaou smear'),('cervical-smear',1,'^ESCTAT724728',NULL,'Atypical glandular cells on cervical Papanicolaou smear'),('cervical-smear',1,'^ESCTCA461353',NULL,'Cannot exclude glandular neoplasia on cervical smear'),('cervical-smear',1,'^ESCTCE396671',NULL,'Cervical smear test'),('cervical-smear',1,'^ESCTCE461369',NULL,'Cervical smear: repeat 1 month'),('cervical-smear',1,'^ESCTCE461371',NULL,'Cervical smear: repeat 3 months'),('cervical-smear',1,'^ESCTCE461373',NULL,'Cervical smear: repeat 4 months'),('cervical-smear',1,'^ESCTCE461375',NULL,'Cervical smear: repeat 6 months'),('cervical-smear',1,'^ESCTCE461377',NULL,'Cervical smear: repeat 9 months'),('cervical-smear',1,'^ESCTCE461379',NULL,'Cervical smear: repeat 12 months'),('cervical-smear',1,'^ESCTCE461381',NULL,'Cervical smear: colposcopy needed'),('cervical-smear',1,'^ESCTCE461383',NULL,'Cervical smear - cervical biopsy needed'),('cervical-smear',1,'^ESCTCE461384',NULL,'Cervical smear: uterine curettage needed'),('cervical-smear',1,'^ESCTCE551561',NULL,'Cervical smear - viral inflammation unspecified'),('cervical-smear',1,'^ESCTCE558543',NULL,'Cervical smear sample'),('cervical-smear',1,'^ESCTCE722764',NULL,'Cervical Papanicolaou smear positive for malignant neoplasm'),('cervical-smear',1,'^ESCTCE797918',NULL,'Cervical cancer screening not done'),('cervical-smear',1,'^ESCTCE800584',NULL,'Cervical cytology claim'),('cervical-smear',1,'^ESCTCE800586',NULL,'Cervical smear fee claim'),('cervical-smear',1,'^ESCTCE803550',NULL,'Cervical cancer Papanicolaou smear screening declined'),('cervical-smear',1,'^ESCTCE825790',NULL,'Cervical smear due date'),('cervical-smear',1,'^ESCTCE825962',NULL,'Cervical smear test indicated but not done'),('cervical-smear',1,'^ESCTCY396669',NULL,'Cytopathology procedure, preparation of smear, genital source'),('cervical-smear',1,'^ESCTCY803108',NULL,'Cytological evidence of malignancy on cervical Papanicolaou smear'),('cervical-smear',1,'^ESCTDY721821',NULL,'Dysplasia on cervical smear'),('cervical-smear',1,'^ESCTFP799104',NULL,'FP74 cervical cytology claim form'),('cervical-smear',1,'^ESCTHI723006',NULL,'History of abnormal cervical Papanicolaou smear'),('cervical-smear',1,'^ESCTHI801980',NULL,'High grade squamous intraepithelial lesion on cervical Papanicolaou smear'),('cervical-smear',1,'^ESCTHI802482',NULL,'History of negative cervical Papanicolaou smear performed within last 12 months'),('cervical-smear',1,'^ESCTHI932218',NULL,'History of total hysterectomy without abnormal cervical Papanicolaou smear'),('cervical-smear',1,'^ESCTLO801979',NULL,'Low grade squamous intraepithelial lesion on cervical Papanicolaou smear'),('cervical-smear',1,'^ESCTNE600292',NULL,'Neoplasm screening excluding cervical'),('cervical-smear',1,'^ESCTNO331153',NULL,'No endocervical cells present'),('cervical-smear',1,'^ESCTPA396670',NULL,'PAP smear preparation'),('cervical-smear',1,'^ESCTPR827955',NULL,'Provision of written information about cervical smear test'),('cervical-smear',1,'^ESCTSA803266',NULL,'Sampling of vagina for Papanicolaou smear after hysterectomy for dysplasia of cervix done'),('cervical-smear',1,'^ESCTSC600291',NULL,'Screening for malignant neoplasm excluding cervical'),('cervical-smear',1,'^ESCTSC797919',NULL,'Screening for malignant neoplasm of cervix not done'),('cervical-smear',1,'^ESCTSE461351',NULL,'Severe dyskaryosis on cervical smear cannot exclude invasive carcinoma'),('cervical-smear',1,'^ESCTSM564742',NULL,'Smear: no abnormality detected - no endocervical cells'),('cervical-smear',1,'^ESCTSP331154',NULL,'Specimen negative for endocervical component in premenopausal woman with cervix'),('cervical-smear',1,'^ESCTVA803267',NULL,'Vaginal Papanicolaou smear after hysterectomy with history of cervical dysplasia done'),('cervical-smear',1,'^ESCTVI557686',NULL,'Viral changes on cervical smear'),('cervical-smear',1,'EGTON441',NULL,'Abnormal smear result'),('cervical-smear',1,'EGTONCE1',NULL,'Cervical smear specific infection'),('cervical-smear',1,'EMISHGT60',NULL,'Cx. smear: repeat 3 years'),('cervical-smear',1,'EMISHGT61',NULL,'Cx. smear: repeat 5 years'),('cervical-smear',1,'EMISNQCE17',NULL,'Cervical smear repeat at 48 months'),('cervical-smear',1,'EMISNQCE18',NULL,'Cervical smear rejected by lab.: taken before recall period'),('cervical-smear',1,'EMISNQCE31',NULL,'Cervical smear report received'),('cervical-smear',1,'EMISNQCX1',NULL,'Cx. smear: repeat 2 years'),('cervical-smear',1,'EMISNQHI29',NULL,'High risk human papillomavirus (HPV) DNA test not done'),('cervical-smear',1,'EMISNQHI30',NULL,'High risk human papillomavirus (HPV) detected'),('cervical-smear',1,'EMISNQHU16',NULL,'Human papillomavirus self-sample test - inadequate specimen'),('cervical-smear',1,'EMISNQHU19',NULL,'Human papillomavirus self-sample test positive'),('cervical-smear',1,'EMISNQHU20',NULL,'Human papillomavirus self-sample test negative'),('cervical-smear',1,'EMISNQIN119',NULL,'Informed consent for cervical smear given'),('cervical-smear',1,'EMISNQIN121',NULL,'Inadequate cervical smear taken outside the practice'),('cervical-smear',1,'EMISNQNU7',NULL,'Number of years annual cervical smears recommended'),('cervical-smear',1,'EMISNQRE460',NULL,'Return to cervical smear recall - FHSA informed'),('cervical-smear',1,'EMISNQSM13',NULL,'Smear taker ID number'),('cervical-smear',1,'EMISSCE1',NULL,'Cervical smear adequacy'),('cervical-smear',1,'EMISSCE2',NULL,'Cervical smear adequate'),('cervical-smear',1,'ESCTMI1',NULL,'Microscopic examination of cervical Papanicolaou smear'),('cervical-smear',1,'^ESCTCA550598',NULL,'Cancer cervix - screening done'),('cervical-smear',1,'^ESCTCI532420',NULL,'CIN III - Cervical intraepithelial neoplasia grade III with severe dysplasia'),('cervical-smear',1,'^ESCTCI570708',NULL,'CIN I - Cervical intraepithelial neoplasia 1'),('cervical-smear',1,'^ESCTCI570715',NULL,'CIN 2 - Cervical intraepithelial neoplasia 2'),('cervical-smear',1,'^ESCTMI570710',NULL,'Mild dysplasia of cervix'),('cervical-smear',1,'^ESCTMO570716',NULL,'Moderate dysplasia of cervix'),('cervical-smear',1,'^ESCTSA723008',NULL,'Sampling of cervix for Papanicolaou smear')

INSERT INTO #AllCodes
SELECT [concept], [version], [code], [description] from #codesemis;


IF OBJECT_ID('tempdb..#TempRefCodes') IS NOT NULL DROP TABLE #TempRefCodes;
CREATE TABLE #TempRefCodes (FK_Reference_Coding_ID BIGINT NOT NULL, concept VARCHAR(255) NOT NULL, version INT NOT NULL, [description] VARCHAR(255));

-- Read v2 codes
INSERT INTO #TempRefCodes
SELECT PK_Reference_Coding_ID, dcr.concept, dcr.[version], dcr.[description]
FROM [SharedCare].[Reference_Coding] rc
INNER JOIN #codesreadv2 dcr on dcr.code = rc.MainCode
WHERE CodingType='ReadCodeV2'
AND (dcr.term IS NULL OR dcr.term = rc.Term)
and PK_Reference_Coding_ID != -1;

-- CTV3 codes
INSERT INTO #TempRefCodes
SELECT PK_Reference_Coding_ID, dcc.concept, dcc.[version], dcc.[description]
FROM [SharedCare].[Reference_Coding] rc
INNER JOIN #codesctv3 dcc on dcc.code = rc.MainCode
WHERE CodingType='CTV3'
and PK_Reference_Coding_ID != -1;

-- EMIS codes with a FK Reference Coding ID
INSERT INTO #TempRefCodes
SELECT FK_Reference_Coding_ID, ce.concept, ce.[version], ce.[description]
FROM [SharedCare].[Reference_Local_Code] rlc
INNER JOIN #codesemis ce on ce.code = rlc.LocalCode
WHERE FK_Reference_Coding_ID != -1;

IF OBJECT_ID('tempdb..#TempSNOMEDRefCodes') IS NOT NULL DROP TABLE #TempSNOMEDRefCodes;
CREATE TABLE #TempSNOMEDRefCodes (FK_Reference_SnomedCT_ID BIGINT NOT NULL, concept VARCHAR(255) NOT NULL, [version] INT NOT NULL, [description] VARCHAR(255));

-- SNOMED codes
INSERT INTO #TempSNOMEDRefCodes
SELECT PK_Reference_SnomedCT_ID, dcs.concept, dcs.[version], dcs.[description]
FROM SharedCare.Reference_SnomedCT rs
INNER JOIN #codessnomed dcs on dcs.code = rs.ConceptID;

-- EMIS codes with a FK SNOMED ID but without a FK Reference Coding ID
INSERT INTO #TempSNOMEDRefCodes
SELECT FK_Reference_SnomedCT_ID, ce.concept, ce.[version], ce.[description]
FROM [SharedCare].[Reference_Local_Code] rlc
INNER JOIN #codesemis ce on ce.code = rlc.LocalCode
WHERE FK_Reference_Coding_ID = -1
AND FK_Reference_SnomedCT_ID != -1;

-- De-duped tables
IF OBJECT_ID('tempdb..#CodeSets') IS NOT NULL DROP TABLE #CodeSets;
CREATE TABLE #CodeSets (FK_Reference_Coding_ID BIGINT NOT NULL, concept VARCHAR(255) NOT NULL, [description] VARCHAR(255));

IF OBJECT_ID('tempdb..#SnomedSets') IS NOT NULL DROP TABLE #SnomedSets;
CREATE TABLE #SnomedSets (FK_Reference_SnomedCT_ID BIGINT NOT NULL, concept VARCHAR(255) NOT NULL, [description] VARCHAR(255));

IF OBJECT_ID('tempdb..#VersionedCodeSets') IS NOT NULL DROP TABLE #VersionedCodeSets;
CREATE TABLE #VersionedCodeSets (FK_Reference_Coding_ID BIGINT NOT NULL, Concept VARCHAR(255), [Version] INT, [description] VARCHAR(255));

IF OBJECT_ID('tempdb..#VersionedSnomedSets') IS NOT NULL DROP TABLE #VersionedSnomedSets;
CREATE TABLE #VersionedSnomedSets (FK_Reference_SnomedCT_ID BIGINT NOT NULL, Concept VARCHAR(255), [Version] INT, [description] VARCHAR(255));

INSERT INTO #VersionedCodeSets
SELECT DISTINCT * FROM #TempRefCodes;

INSERT INTO #VersionedSnomedSets
SELECT DISTINCT * FROM #TempSNOMEDRefCodes;

INSERT INTO #CodeSets
SELECT FK_Reference_Coding_ID, c.concept, [description]
FROM #VersionedCodeSets c
INNER JOIN (
  SELECT concept, MAX(version) AS maxVersion FROM #VersionedCodeSets
  GROUP BY concept)
sub ON sub.concept = c.concept AND c.version = sub.maxVersion;

INSERT INTO #SnomedSets
SELECT FK_Reference_SnomedCT_ID, c.concept, [description]
FROM #VersionedSnomedSets c
INNER JOIN (
  SELECT concept, MAX(version) AS maxVersion FROM #VersionedSnomedSets
  GROUP BY concept)
sub ON sub.concept = c.concept AND c.version = sub.maxVersion;

--#endregion

-- >>> Following code sets injected: gynaecological-cancer v1


-- Set the start date
DECLARE @StartDate datetime;
DECLARE @EndDate datetime;
SET @StartDate = '2011-01-01';
SET @EndDate = '2022-06-01';

--Just want the output, not the messages
SET NOCOUNT ON;


-- Create the gynae cancer cohort========================================================================================================
IF OBJECT_ID('tempdb..#GynaeCohort') IS NOT NULL DROP TABLE #GynaeCohort;
SELECT DISTINCT FK_Patient_Link_ID 
INTO #GynaeCohort
FROM SharedCare.GP_Events
WHERE (
  FK_Reference_Coding_ID IN (SELECT FK_Reference_Coding_ID FROM #VersionedCodeSets WHERE Concept = 'gynaecological-cancer' AND Version = 1) OR
  FK_Reference_SnomedCT_ID IN (SELECT FK_Reference_SnomedCT_ID FROM #VersionedSnomedSets WHERE Concept = 'gynaecological-cancer' AND Version = 1)
) AND EventDate >= @StartDate AND EventDate < @EndDate;


-- Create a table with all patients for post COPI and within 2 cohorts=========================================================================================================================
IF OBJECT_ID('tempdb..#PatientsToInclude') IS NOT NULL DROP TABLE #PatientsToInclude;
SELECT FK_Patient_Link_ID INTO #PatientsToInclude
FROM [SharedCare].[Patient_GP_History]
WHERE FK_Patient_Link_ID IN (SELECT FK_Patient_Link_ID FROM #GynaeCohort)
GROUP BY FK_Patient_Link_ID
HAVING MIN(StartDate) < '2022-06-01';

IF OBJECT_ID('tempdb..#Patients') IS NOT NULL DROP TABLE #Patients;
SELECT DISTINCT FK_Patient_Link_ID 
INTO #Patients 
FROM #PatientsToInclude;


-- >>> Following code sets injected: cervical-smear v1


-- The final table============================================================================================================================================
SELECT DISTINCT FK_Patient_Link_ID AS PatientId, 
		CONVERT(date, EventDate) AS EventDate
FROM SharedCare.GP_Events
WHERE (
  FK_Reference_Coding_ID IN (SELECT FK_Reference_Coding_ID FROM #VersionedCodeSets WHERE Concept = 'cervical-smear' AND Version = 1) OR
  FK_Reference_SnomedCT_ID IN (SELECT FK_Reference_SnomedCT_ID FROM #VersionedSnomedSets WHERE Concept = 'cervical-smear' AND Version = 1)
) AND FK_Patient_Link_ID IN (SELECT FK_Patient_Link_ID FROM #Patients) AND CONVERT(date, EventDate) < @EndDate
ORDER BY FK_Patient_Link_ID, EventDate;
