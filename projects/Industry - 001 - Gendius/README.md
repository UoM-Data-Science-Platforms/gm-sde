_This file is autogenerated. Please do not edit._

# Evaluating the risk of undiagnosed CKD amongst people with type 2 diabetes within Greater Manchester

## Summary

We will use the secure data environment to study the current CKD diagnosis pathway for people living with type 2 diabetes and to evaluate the risk of undiagnosed CKD. To evaluate the pathway, we will look at the adherence to guidelines with respect to testing frequency and follow-up actions. For evaluating risk, we will apply an algorithm to data captured within the health record to estimate the risk that a person has kidney dysfunction. The feasibility of the application of this algorithm will be assessed by reporting the proportion of patients that do not have enough information to assess the risk. We will then identify practices that may benefit from the risk calculation by evaluating the volume of patients at high risk.

## Table of contents

- [Introduction](#introduction)
- [Methodology](#methodology)
- [Reusable queries](#reusable-queries)
- [Clinical code sets](#clinical-code-sets)

## Introduction

The aim of this document is to provide full transparency for all parts of the data extraction process.
This includes:

- The methodology around how the data extraction process is managed and quality is maintained.
- A full list of all queries used in the extraction, and their associated objectives and assumptions.
- A full list of all clinical codes used for the extraction.

## Methodology

After each proposal is approved, a Research Data Engineer (RDE) works closely with the research team to establish precisely what data they require and in what format.
The RDE has access to the entire de-identified database and so builds up an expertise as to which projects are feasible and how best to extract the relevant data.
The RDE has access to a library of resusable SQL queries for common tasks, and sets of clinical codes for different phenotypes, built up from previous studies.
Prior to data extraction, the code is checked and signed off by another RDE.

## Reusable queries
  
This project required the following reusable queries:

- Define Cohort for Gendius project: patients with T2D but no CKD
- Find the first diagnosis of a particular disease

Further details for each query can be found below.

### Define Cohort for Gendius project: patients with T2D but no CKD
To build the cohort of patients needed for the Gendius project. This reduces duplication of code in the template scripts.

_Input_
```
A single variable:
  - index-date: date - (YYYY-MM-DD) the date of the extract
```

_Output_
```
TODO A temp table as follows:
 #Cohort (FK_Patient_Link_ID)
 #PatientEventData
```
_File_: `query-build-industry-001-cohort.sql`

_Link_: [https://github.com/rw251/.../query-build-industry-001-cohort.sql](https://github.com/rw251/gm-idcr/tree/master/shared/Reusable%20queries%20for%20data%20extraction/query-build-industry-001-cohort.sql)

---
### Find the first diagnosis of a particular disease
To find the first diagnosis for a particular disease for every patient.

_Input_
```
A variable:
	-	all-patients: boolean - (true/false) if true, then all patients are included, otherwise only those in the pre-existing #Patients table.
	- gp-events-table: string - (table name) the name of the table containing the GP events. Usually is "SharedCare.GP_Events" but can be anything with the columns: FK_Patient_Link_ID, EventDate, and SuppliedCode
  - code-set: string - the name of the code set to be used. Must be one from the repository.
  - version: number - the code set version
  - temp-table-name: string - the name of the temp table that this will produce
```

_Output_
```
Temp tables as follows:
 #Patients - list of patient ids of the cohort
```
_File_: `query-get-first-diagnosis.sql`

_Link_: [https://github.com/rw251/.../query-get-first-diagnosis.sql](https://github.com/rw251/gm-idcr/tree/master/shared/Reusable%20queries%20for%20data%20extraction/query-get-first-diagnosis.sql)
## Clinical code sets

This project required the following clinical code sets:

- diabetes-type-ii v1
- chronic-kidney-disease v1
- hypertension v1

Further details for each code set can be found below.

### Diabetes mellitus type 2

Any diagnosis of T2DM. A super set of the QOF business rule. Includes "adult onset" diabetes, but DOES NOT include "maturity onset" diabetes.

Developed from https://getset.ga.
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `5.06% - 5.20%` suggests that this code set is well defined.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2021-05-07 | EMIS            | 2605681    |   133938 (5.14%) |    133938 (5.14%) |
| 2021-05-07 | TPP             | 210817     |    10954 (5.20%) |     10954 (5.20%) |
| 2021-05-07 | Vision          | 334632     |    16936 (5.06%) |     16933 (5.06%) |
| 2023-09-12 | EMIS            | 2463856    |   139199 (5.65%) |    139230 (5.65%) |
| 2023-09-12 | TPP             | 200590     |    13456 (6.71%) |     13458 (6.71%) |
| 2023-09-12 | Vision          | 332095     |    17554 (5.29%) |     17542 (5.28%) |
| 2023-09-15 | EMIS            | 2463856    |   139785 (5.67%) |    139814 (5.67%) |
| 2023-09-15 | TPP             | 200590     |    13485 (6.72%) |     13487 (6.72%) |
| 2023-09-15 | Vision          | 332095     |    17621 (5.31%) |      17609 (5.3%) |

LINK: [https://github.com/rw251/.../conditions/diabetes-type-ii/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/conditions/diabetes-type-ii/1)

### Chronic kidney disease (CKD) diagnosis codes

Developed from https://getset.ga.
This list only includes CKD diagnosis codes (`XaNbn. - Chronic kidney disease stage 3ASerum cholesterol raised`), rather than codes which indicate that a patient might have CKD (`9Ni9.00 - Did not attend chronic kidney disease monitoring clinic`).
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `3.18% - 4.30%` suggests that this code set is well defined.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2022-04-06 | EMIS            | 2660237    |  85992 (3.23%)   |   84567 (3.18%)   |
| 2022-04-06 | TPP             | 212647     |   9146 (4.30%)   |    9143 (4.30%)   |
| 2022-04-06 | Vision          | 341912     |  13406 (3.92%)   |   13375 (3.91%)   |
LINK: [https://github.com/rw251/.../conditions/chronic-kidney-disease/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/conditions/chronic-kidney-disease/1)

### Hypertension

Any diagnosis of hypertension. Excludes hypertension in pregnancy, gestational hyptertension, pre-eclampsia. Based on the QOF code sets for hypertension.

Developed from https://getset.ga.
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `12.55% - 12.95%` suggests that this code set is well defined.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2021-07-14 | EMIS            | 2615750    |  328350 (12.55%) |  328339 ( 12.55%) |
| 2021-07-14 | TPP             | 211345     |   27363 (12.95%) |   27362 ( 12.95%) |
| 2021-07-14 | Vision          | 336528     |   43389 (12.89%) |   43389 ( 12.89%) |
| 2023-09-12 | EMIS            | 2463856    |   348882 (14.2%) |    348930 (14.2%) |
| 2023-09-12 | TPP             | 200590     |    33584 (16.7%) |     31906 (15.9%) |
| 2023-09-12 | Vision          | 332095     |    45338 (13.7%) |     45277 (13.6%) |
| 2023-09-15 | EMIS            | 2463856    |   350029 (14.2%) |    350075 (14.2%) |
| 2023-09-15 | TPP             | 200590     |    33643 (16.8%) |     31967 (15.9%) |
| 2023-09-15 | Vision          | 332095     |    45529 (13.7%) |     45467 (13.7%) |

LINK: [https://github.com/rw251/.../conditions/hypertension/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/conditions/hypertension/1)
# Clinical code sets

All code sets required for this analysis are available here: [https://github.com/rw251/.../Industry - 001 - Gendius/clinical-code-sets.csv](https://github.com/rw251/gm-idcr/tree/master/projects/Industry%20-%20001%20-%20Gendius/clinical-code-sets.csv). Individual lists for each concept can also be found by using the links above.