_This file is autogenerated. Please do not edit._

# Establishing the clinical utility of pre-emptive pharmacogenetic testing across Greater Manchester using linked data

## Summary

Not everyone responds the same way to medicines. Some people develop side effects, some don’t respond at all, whereas others might respond well. This variability is very common and can be challenging for patients and healthcare professionals. There are lots of reasons for this variability, but one factor could be related to an individual’s genetics; a concept known as pharmacogenetics. Manchester is an international leader for pharmacogenetics research. Two major trials taking place at the moment are known as IPTIP and PROGRESS. IPTIP aims to understand how pharmacogenetics might be used in Hospitals whilst PROGRESS aims to develop a pharmacogenetic testing service in primary care. We’ve developed a video which explains a little more about how this works (https://tinyurl.com/mr37vmeu)

Using the secure data environment (SDE) we aim to create a dataset from patients in the PROGRESS and IPTIP trials. With their consent, we plan to gather information on their medications, hospital admissions, and health outcomes over time. The objectives include setting up a sample dataset, anonymizing and adding genetic data to the SDE. We will then compare medication use and outcomes with a control group for specific medications. Finally, by collaborating with a health economics centre, we will assess the cost and benefits of using genetic information to optimize medication choices. 

We are committed to developing an equitable service for all; therefore we are recruiting from a diverse range of practices across Manchester and our inclusion criteria are purposefully broad. Any adult patient being considered for one of four medicines (statins, two types of antidepressants, and proton pump inhibitors) are eligible for recruitment.

## Table of contents

- [Introduction](#introduction)
- [Methodology](#methodology)
- [Reusable queries](#reusable-queries)
- [Clinical code sets](#clinical-code-sets)

## Introduction

The aim of this document is to provide full transparency for all parts of the data extraction process.
This includes:

- The methodology around how the data extraction process is managed and quality is maintained.
- A full list of all queries used in the extraction, and their associated objectives and assumptions.
- A full list of all clinical codes used for the extraction.

## Methodology

After each proposal is approved, a Research Data Engineer (RDE) works closely with the research team to establish precisely what data they require and in what format.
The RDE has access to the entire de-identified database and so builds up an expertise as to which projects are feasible and how best to extract the relevant data.
The RDE has access to a library of resusable SQL queries for common tasks, and sets of clinical codes for different phenotypes, built up from previous studies.
Prior to data extraction, the code is checked and signed off by another RDE.

## Reusable queries
  
This project required the following reusable queries:

- Define Cohort for LH001: patients that had pharmacogenetic testing, and matched controls
- Cohort matching on year of birth / sex

Further details for each query can be found below.

### Define Cohort for LH001: patients that had pharmacogenetic testing, and matched controls
To build the cohort of patients needed for LH001. This reduces duplication of code in the template scripts.

_Input_
```
undefined
```

_Output_
```
undefined
```
_File_: `query-build-lh001-cohort.sql`

_Link_: [https://github.com/rw251/.../query-build-lh001-cohort.sql](https://github.com/rw251/gm-idcr/tree/master/shared/Reusable%20queries%20for%20data%20extraction/query-build-lh001-cohort.sql)

---
### Cohort matching on year of birth / sex
To take a primary cohort and find a 1:n matched cohort based on year of birth and sex.

_Input_
```
Takes two parameters
  - yob-flex: integer - number of years each way that still allow a year of birth match
  - num-matches: integer - number of matches for each patient in the cohort
 Requires two temp tables to exist as follows:
 MainCohort (FK_Patient_Link_ID, Sex, YearOfBirth)
 	- FK_Patient_Link_ID - unique patient id
	- Sex - M/F
	- YearOfBirth - Integer
 PotentialMatches (FK_Patient_Link_ID, Sex, YearOfBirth)
 	- FK_Patient_Link_ID - unique patient id
	- Sex - M/F
	- YearOfBirth - Integer
```

_Output_
```
A temp table as follows:
 #CohortStore (FK_Patient_Link_ID, YearOfBirth, Sex, MatchingPatientId, MatchingYearOfBirth)
  - FK_Patient_Link_ID - unique patient id for primary cohort patient
  - YearOfBirth - of the primary cohort patient
  - Sex - of the primary cohort patient
  - MatchingPatientId - id of the matched patient
  - MatchingYearOfBirth - year of birth of the matched patient
```
_File_: `query-cohort-matching-yob-sex-alt-SDE.sql`

_Link_: [https://github.com/rw251/.../query-cohort-matching-yob-sex-alt-SDE.sql](https://github.com/rw251/gm-idcr/tree/master/shared/Reusable%20queries%20for%20data%20extraction/query-cohort-matching-yob-sex-alt-SDE.sql)
## Clinical code sets

This project required the following clinical code sets:

- adverse-drug-reaction v1

Further details for each code set can be found below.

### Alcohol heavy drinker

Any code suggestive that a patient is a heavy drinker.

LINK: [https://github.com/rw251/.../patient/adverse-drug-reaction/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/patient/adverse-drug-reaction/1)
# Clinical code sets

All code sets required for this analysis are available here: [https://github.com/rw251/.../SDE Lighthouse 01 - Newman/clinical-code-sets.csv](https://github.com/rw251/gm-idcr/tree/master/projects/SDE%20Lighthouse%2001%20-%20Newman/clinical-code-sets.csv). Individual lists for each concept can also be found by using the links above.