_This file is autogenerated. Please do not edit._

# _TODO_ - project title

## Summary

**TODO** edit `about.md` to insert a brief lay summary of the work.

## Table of contents

- [Introduction](#introduction)
- [Methodology](#methodology)
- [Reusable queries](#reusable-queries)
- [Clinical code sets](#clinical-code-sets)

## Introduction

The aim of this document is to provide full transparency for all parts of the data extraction process.
This includes:

- The methodology around how the data extraction process is managed and quality is maintained.
- A full list of all queries used in the extraction, and their associated objectives and assumptions.
- A full list of all clinical codes used for the extraction.

## Methodology

After each proposal is approved, a Research Data Engineer (RDE) works closely with the research team to establish precisely what data they require and in what format.
The RDE has access to the entire de-identified database and so builds up an expertise as to which projects are feasible and how best to extract the relevant data.
The RDE has access to a library of resusable SQL queries for common tasks, and sets of clinical codes for different phenotypes, built up from previous studies.
Prior to data extraction, the code is checked and signed off by another RDE.

## Reusable queries
  
This project required the following reusable queries:

- This file loads whichever code set is specified, and inserts into a permanent snowflake table
- Define Cohort for LH001: patients that had pharmacogenetic testing, and matched controls

Further details for each query can be found below.

### This file loads whichever code set is specified, and inserts into a permanent snowflake table
undefined

_Input_
```
Two parameters
  - code-set: string - the name of the code set to be used. Must be one from the repository.
  - version: number - the code set version
```

_Output_
```
undefined
```
_File_: `query-insert-code-set-into-snowflake.sql`

_Link_: [https://github.com/rw251/.../query-insert-code-set-into-snowflake.sql](https://github.com/rw251/gm-idcr/tree/master/shared/Reusable%20queries%20for%20data%20extraction/query-insert-code-set-into-snowflake.sql)

---
### Define Cohort for LH001: patients that had pharmacogenetic testing, and matched controls
To build the cohort of patients needed for LH001. This reduces duplication of code in the template scripts.

_Input_
```
undefined
```

_Output_
```
Temp tables as follows:
 Cohort
```
_File_: `query-build-lh001-cohort.sql`

_Link_: [https://github.com/rw251/.../query-build-lh001-cohort.sql](https://github.com/rw251/gm-idcr/tree/master/shared/Reusable%20queries%20for%20data%20extraction/query-build-lh001-cohort.sql)
## Clinical code sets

This project required the following clinical code sets:

- cancer v1

Further details for each code set can be found below.

### Cancer
Readv2 codes from code sets published by in:

Zhu Y, Edwards D, Mant J, Payne RA, Kiddle S. Characteristics, service use and mortality of clusters of multimorbid patients in England: A population-based study. BMC Med [Internet]. 2020 Apr 10 [cited 2021 Apr 14];18(1):78. Available from: https://bmcmedicine.biomedcentral.com/articles/10.1186/s12916-020-01543-8

The above paper used the definition of LTCs as first determined in:

Barnett K, Mercer SW, Norbury M, Watt G, Wyke S, Guthrie B. Epidemiology of multimorbidity and implications for health care, research, and medical education: A cross-sectional study. Lancet [Internet]. 2012 Jul 7 [cited 2021 Apr 14];380(9836):37â€“43. Available from: www.thelancet.com

CTV3 and SNOMED code sets from OpenSafely.

ICD10 codes have been provided and verified by the Christie team (004). 
#### Prevalence log
By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set, as of 19th July 2021.

| Concept | Version   | System    | Patients | PatientsWithConcept | PatientsWithConceptFromCode | PercentageOfPatients | PercentageOfPatientsFromCode |
| :-----: | :-------: | :-------: | :------: | :-----------------: | :-------------------------: | :------------------: | :--------------------------: |
| cancer  | 1         | EMIS      | 2615750  | 118723              | 78901                       | 4.53877473000096     | 3.01638153493262             |
| cancer  | 1         | TPP       | 211345   | 9607	               | 7280                        | 4.5456481109087      | 3.44460479311079             |
| cancer  | 1         | Vision    | 336528   | 16642               | 11427                       | 4.94520515380592     | 3.39555698188561             |

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2024-02-22 | EMIS | 2524209 | 123626 (4.9%) | 123152 (4.88%) | 
| 2024-02-22 | TPP | 201752 | 11008 (5.46%) | 8580 (4.25%) | 
| 2024-02-22 | Vision | 335007 | 16786 (5.01%) | 16713 (4.99%) | 
LINK: [https://github.com/rw251/.../conditions/cancer/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/conditions/cancer/1)
# Clinical code sets

All code sets required for this analysis are available here: [https://github.com/rw251/.../SDE Lighthouse 01 - Newman/clinical-code-sets.csv](https://github.com/rw251/gm-idcr/tree/master/projects/SDE%20Lighthouse%2001%20-%20Newman/clinical-code-sets.csv). Individual lists for each concept can also be found by using the links above.