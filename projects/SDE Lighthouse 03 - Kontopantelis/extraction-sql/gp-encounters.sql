--┌───────────────────────────────────────────────────┐
--│ Dates of GP Encounters for dementia cohort        │
--└───────────────────────────────────────────────────┘

-- this sscript uses a reusable query to estimate gp encounters based on in-person events like 'blood pressure taken' 
-- and telephone/virtual events like phone calls 


---- RESEARCH DATA ENGINEER CHECK ----

--------------------------------------

-- OUTPUT: Data with the following fields
-- Patient Id
-- EncounterDate (DD-MM-YYYY)

-- Set the start date
DECLARE @StartDate datetime;
DECLARE @EndDate datetime;
SET @StartDate = '2006-01-01';
SET @EndDate = '2023-10-31';

--Just want the output, not the messages
SET NOCOUNT ON;

--┌───────────────────────────────────────────────────────────────────┐
--│ Define Cohort for LH003: patients that had a dementia diagnosis   │
--└───────────────────────────────────────────────────────────────────┘

-- OBJECTIVE: To build the cohort of patients needed for LH003. This reduces duplication of code in the template scripts.

-- COHORT: Any patient with a dementia diagnosis between start and end date.

-- INPUT: assumes there exists one temp table as follows:
-- #Patients (FK_Patient_Link_ID)
--  A distinct list of FK_Patient_Link_IDs for each patient in the cohort

-- OUTPUT: Temp tables as follows:
-- #Cohort

--┌───────────────────────────────────────────────────────────┐
--│ Create table of patients who are registered with a GM GP  │
--└───────────────────────────────────────────────────────────┘

-- INPUT REQUIREMENTS: @StudyStartDate

-- Find all patients alive at start date
IF OBJECT_ID('tempdb..#PossiblePatients') IS NOT NULL DROP TABLE #PossiblePatients;
SELECT PK_Patient_Link_ID as FK_Patient_Link_ID, EthnicMainGroup, EthnicGroupDescription, DeathDate INTO #PossiblePatients FROM [SharedCare].Patient_Link
WHERE 
	(DeathDate IS NULL OR (DeathDate >= @StudyStartDate))

-- Find all patients registered with a GP
IF OBJECT_ID('tempdb..#PatientsWithGP') IS NOT NULL DROP TABLE #PatientsWithGP;
SELECT DISTINCT FK_Patient_Link_ID INTO #PatientsWithGP FROM [SharedCare].Patient
where FK_Reference_Tenancy_ID = 2
AND GPPracticeCode NOT LIKE 'ZZZ%';

-- Make cohort from patients alive at start date and registered with a GP
IF OBJECT_ID('tempdb..#Patients') IS NOT NULL DROP TABLE #Patients;
SELECT pp.* INTO #Patients FROM #PossiblePatients pp
INNER JOIN #PatientsWithGP gp on gp.FK_Patient_Link_ID = pp.FK_Patient_Link_ID;

------------------------------------------

-- OUTPUT: #Patients
--┌───────────────┐
--│ Year of birth │
--└───────────────┘

-- OBJECTIVE: To get the year of birth for each patient.

-- INPUT: Assumes there exists a temp table as follows:
-- #Patients (FK_Patient_Link_ID)
--  A distinct list of FK_Patient_Link_IDs for each patient in the cohort

-- OUTPUT: A temp table as follows:
-- #PatientYearOfBirth (FK_Patient_Link_ID, YearOfBirth)
-- 	- FK_Patient_Link_ID - unique patient id
--	- YearOfBirth - INT

-- ASSUMPTIONS:
--	- Patient data is obtained from multiple sources. Where patients have multiple YOBs we determine the YOB as follows:
--	-	If the patients has a YOB in their primary care data feed we use that as most likely to be up to date
--	-	If every YOB for a patient is the same, then we use that
--	-	If there is a single most recently updated YOB in the database then we use that
--	-	Otherwise we take the highest YOB for the patient that is not in the future

-- Get all patients year of birth for the cohort
IF OBJECT_ID('tempdb..#AllPatientYearOfBirths') IS NOT NULL DROP TABLE #AllPatientYearOfBirths;
SELECT 
	FK_Patient_Link_ID,
	FK_Reference_Tenancy_ID,
	HDMModifDate,
	YEAR(Dob) AS YearOfBirth
INTO #AllPatientYearOfBirths
FROM SharedCare.Patient p
WHERE FK_Patient_Link_ID IN (SELECT FK_Patient_Link_ID FROM #Patients)
AND Dob IS NOT NULL;


-- If patients have a tenancy id of 2 we take this as their most likely YOB
-- as this is the GP data feed and so most likely to be up to date
IF OBJECT_ID('tempdb..#PatientYearOfBirth') IS NOT NULL DROP TABLE #PatientYearOfBirth;
SELECT FK_Patient_Link_ID, MIN(YearOfBirth) as YearOfBirth INTO #PatientYearOfBirth FROM #AllPatientYearOfBirths
WHERE FK_Patient_Link_ID IN (SELECT FK_Patient_Link_ID FROM #Patients)
AND FK_Reference_Tenancy_ID = 2
GROUP BY FK_Patient_Link_ID
HAVING MIN(YearOfBirth) = MAX(YearOfBirth);

-- Find the patients who remain unmatched
IF OBJECT_ID('tempdb..#UnmatchedYobPatients') IS NOT NULL DROP TABLE #UnmatchedYobPatients;
SELECT FK_Patient_Link_ID INTO #UnmatchedYobPatients FROM #Patients
EXCEPT
SELECT FK_Patient_Link_ID FROM #PatientYearOfBirth;

-- If every YOB is the same for all their linked patient ids then we use that
INSERT INTO #PatientYearOfBirth
SELECT FK_Patient_Link_ID, MIN(YearOfBirth) FROM #AllPatientYearOfBirths
WHERE FK_Patient_Link_ID IN (SELECT FK_Patient_Link_ID FROM #UnmatchedYobPatients)
GROUP BY FK_Patient_Link_ID
HAVING MIN(YearOfBirth) = MAX(YearOfBirth);

-- Find any still unmatched patients
TRUNCATE TABLE #UnmatchedYobPatients;
INSERT INTO #UnmatchedYobPatients
SELECT FK_Patient_Link_ID FROM #Patients
EXCEPT
SELECT FK_Patient_Link_ID FROM #PatientYearOfBirth;

-- If there is a unique most recent YOB then use that
INSERT INTO #PatientYearOfBirth
SELECT p.FK_Patient_Link_ID, MIN(p.YearOfBirth) FROM #AllPatientYearOfBirths p
INNER JOIN (
	SELECT FK_Patient_Link_ID, MAX(HDMModifDate) MostRecentDate FROM #AllPatientYearOfBirths
	WHERE FK_Patient_Link_ID IN (SELECT FK_Patient_Link_ID FROM #UnmatchedYobPatients)
	GROUP BY FK_Patient_Link_ID
) sub ON sub.FK_Patient_Link_ID = p.FK_Patient_Link_ID AND sub.MostRecentDate = p.HDMModifDate
GROUP BY p.FK_Patient_Link_ID
HAVING MIN(YearOfBirth) = MAX(YearOfBirth);

-- Find any still unmatched patients
TRUNCATE TABLE #UnmatchedYobPatients;
INSERT INTO #UnmatchedYobPatients
SELECT FK_Patient_Link_ID FROM #Patients
EXCEPT
SELECT FK_Patient_Link_ID FROM #PatientYearOfBirth;

-- Otherwise just use the highest value (with the exception that can't be in the future)
INSERT INTO #PatientYearOfBirth
SELECT FK_Patient_Link_ID, MAX(YearOfBirth) FROM #AllPatientYearOfBirths
WHERE FK_Patient_Link_ID IN (SELECT FK_Patient_Link_ID FROM #UnmatchedYobPatients)
GROUP BY FK_Patient_Link_ID
HAVING MAX(YearOfBirth) <= YEAR(GETDATE());

-- Tidy up - helpful in ensuring the tempdb doesn't run out of space mid-query
DROP TABLE #AllPatientYearOfBirths;
DROP TABLE #UnmatchedYobPatients;

-- >>> Codesets required... Inserting the code set code
--
--┌────────────────────┐
--│ Clinical code sets │
--└────────────────────┘

-- OBJECTIVE: To populate temporary tables with the existing clinical code sets.
--            See the [SQL-generation-process.md](SQL-generation-process.md) for more details.

-- INPUT: No pre-requisites

-- OUTPUT: Five temp tables as follows:
--  #AllCodes (Concept, Version, Code)
--  #CodeSets (FK_Reference_Coding_ID, Concept)
--  #SnomedSets (FK_Reference_SnomedCT_ID, FK_SNOMED_ID)
--  #VersionedCodeSets (FK_Reference_Coding_ID, Concept, Version)
--  #VersionedSnomedSets (FK_Reference_SnomedCT_ID, Version, FK_SNOMED_ID)

--!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
--!!! DO NOT EDIT THIS FILE MANUALLY !!!
--!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

--#region Clinical code sets

IF OBJECT_ID('tempdb..#AllCodes') IS NOT NULL DROP TABLE #AllCodes;
CREATE TABLE #AllCodes (
  [Concept] [varchar](255) NOT NULL,
  [Version] INT NOT NULL,
  [Code] [varchar](20) COLLATE Latin1_General_CS_AS NOT NULL,
  [description] [varchar] (255) NULL 
);

IF OBJECT_ID('tempdb..#codesreadv2') IS NOT NULL DROP TABLE #codesreadv2;
CREATE TABLE #codesreadv2 (
  [concept] [varchar](255) NOT NULL,
  [version] INT NOT NULL,
	[code] [varchar](20) COLLATE Latin1_General_CS_AS NOT NULL,
	[term] [varchar](20) COLLATE Latin1_General_CS_AS NULL,
	[description] [varchar](255) NULL
) ON [PRIMARY];

INSERT INTO #codesreadv2
VALUES ('dementia',1,'1461.',NULL,'H/O: dementia'),('dementia',1,'1461.00',NULL,'H/O: dementia'),('dementia',1,'4L49.',NULL,'Prion protein markers for Creutzfeldt-Jakob disease'),('dementia',1,'4L49.00',NULL,'Prion protein markers for Creutzfeldt-Jakob disease'),('dementia',1,'66h..',NULL,'Dementia monitoring'),('dementia',1,'66h..00',NULL,'Dementia monitoring'),('dementia',1,'6AB..',NULL,'Dementia annual review'),('dementia',1,'6AB..00',NULL,'Dementia annual review'),('dementia',1,'8BM02',NULL,'Dementia medication review'),('dementia',1,'8BM0200',NULL,'Dementia medication review'),('dementia',1,'9hD..',NULL,'Exception reporting: dementia quality indicators'),('dementia',1,'9hD..00',NULL,'Exception reporting: dementia quality indicators'),('dementia',1,'9hD0.',NULL,'Excepted from dementia quality indicators: Patient unsuitable'),('dementia',1,'9hD0.00',NULL,'Excepted from dementia quality indicators: Patient unsuitable'),('dementia',1,'9hD1.',NULL,'Excepted from dementia quality indicators: Informed dissent'),('dementia',1,'9hD1.00',NULL,'Excepted from dementia quality indicators: Informed dissent'),('dementia',1,'9Ou..',NULL,'Dementia monitoring administration'),('dementia',1,'9Ou..00',NULL,'Dementia monitoring administration'),('dementia',1,'9Ou1.',NULL,'Dementia monitoring first letter'),('dementia',1,'9Ou1.00',NULL,'Dementia monitoring first letter'),('dementia',1,'9Ou2.',NULL,'Dementia monitoring second letter'),('dementia',1,'9Ou2.00',NULL,'Dementia monitoring second letter'),('dementia',1,'9Ou3.',NULL,'Dementia monitoring third letter'),('dementia',1,'9Ou3.00',NULL,'Dementia monitoring third letter'),('dementia',1,'9Ou4.',NULL,'Dementia monitoring verbal invite'),('dementia',1,'9Ou4.00',NULL,'Dementia monitoring verbal invite'),('dementia',1,'9Ou5.',NULL,'Dementia monitoring telephone invite'),('dementia',1,'9Ou5.00',NULL,'Dementia monitoring telephone invite'),('dementia',1,'A410.',NULL,'Kuru'),('dementia',1,'A410.00',NULL,'Kuru'),('dementia',1,'A411.',NULL,'Jakob-Creutzfeldt disease'),('dementia',1,'A411.00',NULL,'Jakob-Creutzfeldt disease'),('dementia',1,'A4110',NULL,'Sporadic Creutzfeldt-Jakob disease'),('dementia',1,'A411000',NULL,'Sporadic Creutzfeldt-Jakob disease'),('dementia',1,'E00..',NULL,'Senile and presenile organic psychotic conditions'),('dementia',1,'E00..00',NULL,'Senile and presenile organic psychotic conditions'),('dementia',1,'E000.',NULL,'Uncomplicated senile dementia'),('dementia',1,'E000.00',NULL,'Uncomplicated senile dementia'),('dementia',1,'E001.',NULL,'Presenile dementia'),('dementia',1,'E001.00',NULL,'Presenile dementia'),('dementia',1,'E0010',NULL,'Uncomplicated presenile dementia'),('dementia',1,'E001000',NULL,'Uncomplicated presenile dementia'),('dementia',1,'E0011',NULL,'Presenile dementia with delirium'),('dementia',1,'E001100',NULL,'Presenile dementia with delirium'),('dementia',1,'E0012',NULL,'Presenile dementia with paranoia'),('dementia',1,'E001200',NULL,'Presenile dementia with paranoia'),('dementia',1,'E0013',NULL,'Presenile dementia with depression'),('dementia',1,'E001300',NULL,'Presenile dementia with depression'),('dementia',1,'E001z',NULL,'Presenile dementia NOS'),('dementia',1,'E001z00',NULL,'Presenile dementia NOS'),('dementia',1,'E002.',NULL,'Senile dementia with depressive or paranoid features'),('dementia',1,'E002.00',NULL,'Senile dementia with depressive or paranoid features'),('dementia',1,'E0020',NULL,'Senile dementia with paranoia'),('dementia',1,'E002000',NULL,'Senile dementia with paranoia'),('dementia',1,'E0021',NULL,'Senile dementia with depression'),('dementia',1,'E002100',NULL,'Senile dementia with depression'),('dementia',1,'E002z',NULL,'Senile dementia with depressive or paranoid features NOS'),('dementia',1,'E002z00',NULL,'Senile dementia with depressive or paranoid features NOS'),('dementia',1,'E003.',NULL,'Senile dementia with delirium'),('dementia',1,'E003.00',NULL,'Senile dementia with delirium'),('dementia',1,'E004.',NULL,'Arteriosclerotic dementia'),('dementia',1,'E004.00',NULL,'Arteriosclerotic dementia'),('dementia',1,'E0040',NULL,'Uncomplicated arteriosclerotic dementia'),('dementia',1,'E004000',NULL,'Uncomplicated arteriosclerotic dementia'),('dementia',1,'E0041',NULL,'Arteriosclerotic dementia with delirium'),('dementia',1,'E004100',NULL,'Arteriosclerotic dementia with delirium'),('dementia',1,'E0042',NULL,'Arteriosclerotic dementia with paranoia'),('dementia',1,'E004200',NULL,'Arteriosclerotic dementia with paranoia'),('dementia',1,'E0043',NULL,'Arteriosclerotic dementia with depression'),('dementia',1,'E004300',NULL,'Arteriosclerotic dementia with depression'),('dementia',1,'E004z',NULL,'Arteriosclerotic dementia NOS'),('dementia',1,'E004z00',NULL,'Arteriosclerotic dementia NOS'),('dementia',1,'E00y.',NULL,'Other senile and presenile organic psychoses'),('dementia',1,'E00y.00',NULL,'Other senile and presenile organic psychoses'),('dementia',1,'E00z.',NULL,'Senile or presenile psychoses NOS'),('dementia',1,'E00z.00',NULL,'Senile or presenile psychoses NOS'),('dementia',1,'E011.',NULL,'Alcohol amnestic syndrome'),('dementia',1,'E011.00',NULL,'Alcohol amnestic syndrome'),('dementia',1,'E0110',NULL,'Korsakovs alcoholic psychosis'),('dementia',1,'E011000',NULL,'Korsakovs alcoholic psychosis'),('dementia',1,'E0111',NULL,'Korsakovs alcoholic psychosis with peripheral neuritis'),('dementia',1,'E011100',NULL,'Korsakovs alcoholic psychosis with peripheral neuritis'),('dementia',1,'E0112',NULL,'Wernicke-Korsakov syndrome'),('dementia',1,'E011200',NULL,'Wernicke-Korsakov syndrome'),('dementia',1,'E011z',NULL,'Alcohol amnestic syndrome NOS'),('dementia',1,'E011z00',NULL,'Alcohol amnestic syndrome NOS'),('dementia',1,'E012.',NULL,'Other alcoholic dementia'),('dementia',1,'E012.00',NULL,'Other alcoholic dementia'),('dementia',1,'E040.',NULL,'Non-alcoholic amnestic syndrome'),('dementia',1,'E040.00',NULL,'Non-alcoholic amnestic syndrome'),('dementia',1,'E041.',NULL,'Dementia in conditions EC'),('dementia',1,'E041.00',NULL,'Dementia in conditions EC'),('dementia',1,'Eu00.',NULL,'[X]Dementia in Alzheimers disease'),('dementia',1,'Eu00.00',NULL,'[X]Dementia in Alzheimers disease'),('dementia',1,'Eu000',NULL,'[X]Dementia in Alzheimers disease with early onset'),('dementia',1,'Eu00000',NULL,'[X]Dementia in Alzheimers disease with early onset'),('dementia',1,'Eu001',NULL,'[X]Dementia in Alzheimers disease with late onset'),('dementia',1,'Eu00100',NULL,'[X]Dementia in Alzheimers disease with late onset'),('dementia',1,'Eu002',NULL,'[X]Dementia in Alzheimers dis, atypical or mixed type'),('dementia',1,'Eu00200',NULL,'[X]Dementia in Alzheimers dis, atypical or mixed type'),('dementia',1,'Eu00z',NULL,'[X]Dementia in Alzheimers disease, unspecified'),('dementia',1,'Eu00z00',NULL,'[X]Dementia in Alzheimers disease, unspecified'),('dementia',1,'Eu01.',NULL,'[X]Vascular dementia'),('dementia',1,'Eu01.00',NULL,'[X]Vascular dementia'),('dementia',1,'Eu010',NULL,'[X]Vascular dementia of acute onset'),('dementia',1,'Eu01000',NULL,'[X]Vascular dementia of acute onset'),('dementia',1,'Eu011',NULL,'[X]Multi-infarct dementia'),('dementia',1,'Eu01100',NULL,'[X]Multi-infarct dementia'),('dementia',1,'Eu012',NULL,'[X]Subcortical vascular dementia'),('dementia',1,'Eu01200',NULL,'[X]Subcortical vascular dementia'),('dementia',1,'Eu013',NULL,'[X]Mixed cortical and subcortical vascular dementia'),('dementia',1,'Eu01300',NULL,'[X]Mixed cortical and subcortical vascular dementia'),('dementia',1,'Eu01y',NULL,'[X]Other vascular dementia'),('dementia',1,'Eu01y00',NULL,'[X]Other vascular dementia'),('dementia',1,'Eu01z',NULL,'[X]Vascular dementia, unspecified'),('dementia',1,'Eu01z00',NULL,'[X]Vascular dementia, unspecified'),('dementia',1,'Eu02.',NULL,'[X]Dementia in other diseases classified elsewhere'),('dementia',1,'Eu02.00',NULL,'[X]Dementia in other diseases classified elsewhere'),('dementia',1,'Eu020',NULL,'[X]Dementia in Picks disease'),('dementia',1,'Eu02000',NULL,'[X]Dementia in Picks disease'),('dementia',1,'Eu021',NULL,'[X]Dementia in Creutzfeldt-Jakob disease'),('dementia',1,'Eu02100',NULL,'[X]Dementia in Creutzfeldt-Jakob disease'),('dementia',1,'Eu022',NULL,'[X]Dementia in Huntingtons disease'),('dementia',1,'Eu02200',NULL,'[X]Dementia in Huntingtons disease'),('dementia',1,'Eu023',NULL,'[X]Dementia in Parkinsons disease'),('dementia',1,'Eu02300',NULL,'[X]Dementia in Parkinsons disease'),('dementia',1,'Eu024',NULL,'[X]Dementia in human immunodef virus [HIV] disease'),('dementia',1,'Eu02400',NULL,'[X]Dementia in human immunodef virus [HIV] disease'),('dementia',1,'Eu025',NULL,'[X]Lewy body dementia'),('dementia',1,'Eu02500',NULL,'[X]Lewy body dementia'),('dementia',1,'Eu02y',NULL,'[X]Dementia in other specified diseases classif elsewhere'),('dementia',1,'Eu02y00',NULL,'[X]Dementia in other specified diseases classif elsewhere'),('dementia',1,'Eu02z',NULL,'[X] Unspecified dementia'),('dementia',1,'Eu02z00',NULL,'[X] Unspecified dementia'),('dementia',1,'Eu041',NULL,'[X]Delirium superimposed on dementia'),('dementia',1,'Eu04100',NULL,'[X]Delirium superimposed on dementia'),('dementia',1,'Eu106',NULL,'[X]Mental and behavioural disorders due to use of alcohol: amnesic syndrome'),('dementia',1,'Eu10600',NULL,'[X]Mental and behavioural disorders due to use of alcohol: amnesic syndrome'),('dementia',1,'Eu107','11','[X]Alcoholic dementia NOS'),('dementia',1,'Eu107','11','[X]Alcoholic dementia NOS'),('dementia',1,'F0300',NULL,'Encephalitis due to kuru'),('dementia',1,'F030000',NULL,'Encephalitis due to kuru'),('dementia',1,'F110.',NULL,'Alzheimers disease'),('dementia',1,'F110.00',NULL,'Alzheimers disease'),('dementia',1,'F1100',NULL,'Alzheimers disease with early onset'),('dementia',1,'F110000',NULL,'Alzheimers disease with early onset'),('dementia',1,'F1101',NULL,'Alzheimers disease with late onset'),('dementia',1,'F110100',NULL,'Alzheimers disease with late onset'),('dementia',1,'F111.',NULL,'Picks disease'),
('dementia',1,'F111.00',NULL,'Picks disease'),('dementia',1,'F116.',NULL,'Lewy body disease'),('dementia',1,'F116.00',NULL,'Lewy body disease'),('dementia',1,'F118.',NULL,'Frontotemporal degeneration'),('dementia',1,'F118.00',NULL,'Frontotemporal degeneration'),('dementia',1,'F11x7',NULL,'Cerebral degeneration due to Jakob - Creutzfeldt disease'),('dementia',1,'F11x700',NULL,'Cerebral degeneration due to Jakob - Creutzfeldt disease'),('dementia',1,'F11x8',NULL,'Cerebral degeneration due to progressive multifocal leucoencephalopathy'),('dementia',1,'F11x800',NULL,'Cerebral degeneration due to progressive multifocal leucoencephalopathy'),('dementia',1,'F21y2',NULL,'Binswangers disease'),('dementia',1,'F21y200',NULL,'Binswangers disease'),('dementia',1,'Fyu30',NULL,'[X]Other Alzheimers disease'),('dementia',1,'Fyu3000',NULL,'[X]Other Alzheimers disease'),('dementia',1,'A941.',NULL,'General paresis - neurosyphilis'),('dementia',1,'A941.00',NULL,'General paresis - neurosyphilis'),('dementia',1,'E02y1',NULL,'Drug-induced dementia'),('dementia',1,'E02y100',NULL,'Drug-induced dementia'),('dementia',1,'E2A2.',NULL,'Post-concussion syndrome'),('dementia',1,'E2A2.00',NULL,'Post-concussion syndrome'),('dementia',1,'Eu062',NULL,'[X]Postconcussional syndrome'),('dementia',1,'Eu06200',NULL,'[X]Postconcussional syndrome'),('dementia',1,'F112.',NULL,'Senile degeneration of brain'),('dementia',1,'F112.00',NULL,'Senile degeneration of brain')

INSERT INTO #AllCodes
SELECT [concept], [version], [code], [description] from #codesreadv2;

IF OBJECT_ID('tempdb..#codesctv3') IS NOT NULL DROP TABLE #codesctv3;
CREATE TABLE #codesctv3 (
  [concept] [varchar](255) NOT NULL,
  [version] INT NOT NULL,
	[code] [varchar](20) COLLATE Latin1_General_CS_AS NOT NULL,
	[term] [varchar](20) COLLATE Latin1_General_CS_AS NULL,
	[description] [varchar](255) NULL
) ON [PRIMARY];

INSERT INTO #codesctv3
VALUES ('dementia',1,'1461.',NULL,'H/O: dementia'),('dementia',1,'A410.',NULL,'Kuru'),('dementia',1,'A411.',NULL,'Creutzfeldt-Jakob disease'),('dementia',1,'E00..',NULL,'Senile and presenile organic psychot conditions (& dementia)'),('dementia',1,'E000.',NULL,'Uncomplicated senile dementia'),('dementia',1,'E001.',NULL,'Presenile dementia'),('dementia',1,'E0010',NULL,'Uncomplicated presenile dementia'),('dementia',1,'E0011',NULL,'Presenile dementia with delirium'),('dementia',1,'E0012',NULL,'Presenile dementia with paranoia'),('dementia',1,'E0013',NULL,'Presenile dementia with depression'),('dementia',1,'E001z',NULL,'Presenile dementia NOS'),('dementia',1,'E002.',NULL,'Senile dementia with depressive or paranoid features'),('dementia',1,'E0020',NULL,'Senile dementia with paranoia'),('dementia',1,'E0021',NULL,'Senile dementia with depression'),('dementia',1,'E002z',NULL,'Senile dementia with depressive or paranoid features NOS'),('dementia',1,'E003.',NULL,'Senile dementia with delirium'),('dementia',1,'E004.',NULL,'Arteriosclerotic dementia (including [multi infarct dement])'),('dementia',1,'E0040',NULL,'Uncomplicated arteriosclerotic dementia'),('dementia',1,'E0041',NULL,'Arteriosclerotic dementia with delirium'),('dementia',1,'E0042',NULL,'Arteriosclerotic dementia with paranoia'),('dementia',1,'E0043',NULL,'Arteriosclerotic dementia with depression'),('dementia',1,'E004z',NULL,'Arteriosclerotic dementia NOS'),('dementia',1,'E00y.',NULL,'(Oth senile/presen org psychoses) or (presbyophren psychos)'),('dementia',1,'E00z.',NULL,'Senile or presenile psychoses NOS'),('dementia',1,'E011.',NULL,'Korsakov psychosis'),('dementia',1,'E0110',NULL,'Korsakov psychosis'),('dementia',1,'E0111',NULL,'Korsakovs alcoholic psychosis with peripheral neuritis'),('dementia',1,'E0112',NULL,'Wernicke-Korsakov syndrome'),('dementia',1,'E011z',NULL,'Alcohol amnestic syndrome NOS'),('dementia',1,'E012.',NULL,'Alcoholic dementia: [other] or [NOS]'),('dementia',1,'E040.',NULL,'Korsakoffs syndrome - non-alcoholic'),('dementia',1,'E041.',NULL,'Dementia in conditions EC'),('dementia',1,'Eu00.',NULL,'[X]Dementia in Alzheimers disease'),('dementia',1,'Eu001',NULL,'Dementia in Alzheimers disease with late onset'),('dementia',1,'Eu002',NULL,'[X]Dementia in Alzheimers dis, atypical or mixed type'),('dementia',1,'Eu00z',NULL,'[X]Dementia in Alzheimers disease, unspecified'),('dementia',1,'Eu01.',NULL,'Vascular dementia'),('dementia',1,'Eu011',NULL,'[X]Dementia: [multi-infarct] or [predominantly cortical]'),('dementia',1,'Eu01y',NULL,'[X]Other vascular dementia'),('dementia',1,'Eu01z',NULL,'[X]Vascular dementia, unspecified'),('dementia',1,'Eu02.',NULL,'[X]Dementia in other diseases classified elsewhere'),('dementia',1,'Eu020',NULL,'[X]Dementia in Picks disease'),('dementia',1,'Eu021',NULL,'[X]Dementia in Creutzfeldt-Jakob disease'),('dementia',1,'Eu022',NULL,'[X]Dementia in Huntingtons disease'),('dementia',1,'Eu023',NULL,'[X]Dementia in Parkinsons disease'),('dementia',1,'Eu02y',NULL,'[X]Dementia in other specified diseases classif elsewhere'),('dementia',1,'Eu02z',NULL,'[X] Dementia: [unspecified] or [named variants (& NOS)]'),('dementia',1,'Eu041',NULL,'[X]Delirium superimposed on dementia'),('dementia',1,'F110.',NULL,'Alzheimers disease'),('dementia',1,'F1100',NULL,'Dementia in Alzheimers disease with early onset'),('dementia',1,'F1101',NULL,'Dementia in Alzheimers disease with late onset'),('dementia',1,'F111.',NULL,'Picks disease'),('dementia',1,'F11x7',NULL,'Cerebral degeneration due to Creutzfeldt-Jakob disease'),('dementia',1,'F11x8',NULL,'Cerebral degeneration due to multifocal leucoencephalopathy'),('dementia',1,'F21y2',NULL,'Binswangers disease'),('dementia',1,'Fyu30',NULL,'[X]Other Alzheimers disease'),('dementia',1,'Ub1T6',NULL,'Language disorder of dementia'),('dementia',1,'X002m',NULL,'Amyotrophic lateral sclerosis with dementia'),('dementia',1,'X002w',NULL,'Dementia'),('dementia',1,'X002x',NULL,'Dementia in Alzheimers disease with early onset'),('dementia',1,'X002y',NULL,'Familial Alzheimers disease of early onset'),('dementia',1,'X002z',NULL,'Non-familial Alzheimers disease of early onset'),('dementia',1,'X0030',NULL,'Dementia in Alzheimers disease with late onset'),('dementia',1,'X0031',NULL,'Familial Alzheimers disease of late onset'),('dementia',1,'X0032',NULL,'Non-familial Alzheimers disease of late onset'),('dementia',1,'X0033',NULL,'Focal Alzheimers disease'),('dementia',1,'X0034',NULL,'Frontotemporal dementia'),('dementia',1,'X0035',NULL,'Picks disease with Pick bodies'),('dementia',1,'X0036',NULL,'Picks disease with Pick cells and no Pick bodies'),('dementia',1,'X0037',NULL,'Frontotemporal degeneration'),('dementia',1,'X0039',NULL,'Frontal lobe degeneration with motor neurone disease'),('dementia',1,'X003A',NULL,'Lewy body disease'),('dementia',1,'X003G',NULL,'Progressive aphasia in Alzheimers disease'),('dementia',1,'X003H',NULL,'Argyrophilic brain disease'),('dementia',1,'X003I',NULL,'Post-traumatic dementia'),('dementia',1,'X003J',NULL,'Punch drunk syndrome'),('dementia',1,'X003K',NULL,'Spongiform encephalopathy'),('dementia',1,'X003L',NULL,'Prion protein disease'),('dementia',1,'X003M',NULL,'Gerstmann-Straussler-Scheinker syndrome'),('dementia',1,'X003P',NULL,'Acquired immune deficiency syndrome dementia complex'),('dementia',1,'X003R',NULL,'Vascular dementia of acute onset'),('dementia',1,'X003T',NULL,'Subcortical vascular dementia'),('dementia',1,'X003V',NULL,'Mixed cortical and subcortical vascular dementia'),('dementia',1,'X003W',NULL,'Semantic dementia'),('dementia',1,'X003X',NULL,'Patchy dementia'),('dementia',1,'X003Y',NULL,'Epileptic dementia'),('dementia',1,'X003l',NULL,'Parkinsons disease - dementia complex on Guam'),('dementia',1,'X00R0',NULL,'Presbyophrenic psychosis'),('dementia',1,'X00R2',NULL,'Senile dementia'),('dementia',1,'X00Rk',NULL,'Alcoholic dementia NOS'),('dementia',1,'X73mf',NULL,'Creutzfeldt-Jakob disease agent'),('dementia',1,'X73mj',NULL,'Bovine spongiform encephalopathy agent'),('dementia',1,'XE1Xr',NULL,'Senile and presenile organic psychotic conditions'),('dementia',1,'XE1Xs',NULL,'Vascular dementia'),('dementia',1,'XE1Xt',NULL,'Other senile and presenile organic psychoses'),('dementia',1,'XE1Xu',NULL,'Other alcoholic dementia'),('dementia',1,'XE1Z6',NULL,'[X]Unspecified dementia'),('dementia',1,'XE1aG',NULL,'Dementia (& [presenile] or [senile])'),('dementia',1,'Xa0lH',NULL,'Multi-infarct dementia'),('dementia',1,'Xa0sC',NULL,'Frontal lobe degeneration'),('dementia',1,'Xa0sE',NULL,'Dementia of frontal lobe type'),('dementia',1,'Xa1GB',NULL,'Cerebral degeneration presenting primarily with dementia'),('dementia',1,'Xa25J',NULL,'Alcoholic dementia'),('dementia',1,'Xa3ez',NULL,'Other senile/presenile dementia'),('dementia',1,'XaA1S',NULL,'New variant of Creutzfeldt-Jakob disease'),('dementia',1,'XaE74',NULL,'Senile dementia of the Lewy body type'),('dementia',1,'XaIKB',NULL,'Alzheimers disease with early onset'),('dementia',1,'XaIKC',NULL,'Alzheimers disease with late onset'),('dementia',1,'XaKyY',NULL,'[X]Lewy body dementia'),('dementia',1,'XaLFf',NULL,'Exception reporting: dementia quality indicators'),('dementia',1,'XaLFo',NULL,'Excepted from dementia quality indicators: Patient unsuitabl'),('dementia',1,'XaLFp',NULL,'Excepted from dementia quality indicators: Informed dissent'),('dementia',1,'XaMAo',NULL,'Prion protein markers for Creutzfeldt-Jakob disease'),('dementia',1,'XaMFy',NULL,'Dementia monitoring administration'),('dementia',1,'XaMG0',NULL,'Dementia monitoring first letter'),('dementia',1,'XaMGF',NULL,'Dementia annual review'),('dementia',1,'XaMGG',NULL,'Dementia monitoring second letter'),('dementia',1,'XaMGI',NULL,'Dementia monitoring third letter'),('dementia',1,'XaMGJ',NULL,'Dementia monitoring verbal invite'),('dementia',1,'XaMGK',NULL,'Dementia monitoring telephone invite'),('dementia',1,'XaMJC',NULL,'Dementia monitoring'),('dementia',1,'XaZWz',NULL,'Participates in Butterfly Scheme for dementia'),('dementia',1,'XaZX0',NULL,'Butterfly Scheme for dementia declined'),('dementia',1,'XabVp',NULL,'Sporadic Creutzfeldt-Jakob disease'),('dementia',1,'XabtQ',NULL,'Dementia medication review'),('dementia',1,'Xaghb',NULL,'Predominantly cortical dementia'),('dementia',1,'Y000c',NULL,'Dementia review done'),('dementia',1,'Y1f1d',NULL,'Dementia monitoring invitation'),('dementia',1,'Y1f22',NULL,'Dementia monitoring invitation'),('dementia',1,'Y1f98',NULL,'Quality and Outcomes Framework dementia quality indicator-related care invitation (procedure)'),('dementia',1,'Y23fb',NULL,'Mixed dementia'),('dementia',1,'Y6230',NULL,'Creutzfeldt - Jakob disease'),('dementia',1,'Y8180',NULL,'Other senile/presenile dement.'),('dementia',1,'Y9086',NULL,'Senile dementia - simple type'),('dementia',1,'Y9087',NULL,'Senile dementia-acute confused'),('dementia',1,'Eu106',NULL,'[X]Korsakovs psychosis, alcohol-induced'),('dementia',1,'Eu107',NULL,'[X]Alcoholic dementia NOS'),('dementia',1,'E02y1',NULL,'Drug-induced dementia'),('dementia',1,'F112.',NULL,'Senile degeneration of brain'),('dementia',1,'X003N',NULL,'Familial fatal insomnia'),('dementia',1,'X005A',NULL,'Dialysis encephalopathy'),('dementia',1,'X50Hu',NULL,'Amelocerebrohypohidrotic syndrome'),('dementia',1,'X70MA',NULL,'Juvenile general paresis'),('dementia',1,'XE2b7',NULL,'Post-concussional syndrome')

INSERT INTO #AllCodes
SELECT [concept], [version], [code], [description] from #codesctv3;

IF OBJECT_ID('tempdb..#codessnomed') IS NOT NULL DROP TABLE #codessnomed;
CREATE TABLE #codessnomed (
  [concept] [varchar](255) NOT NULL,
  [version] INT NOT NULL,
	[code] [varchar](20) COLLATE Latin1_General_CS_AS NOT NULL,
	[term] [varchar](20) COLLATE Latin1_General_CS_AS NULL,
	[description] [varchar](255) NULL
) ON [PRIMARY];

INSERT INTO #codessnomed
VALUES ('dementia',1,'1018591000000102',NULL,'Prion protein markers for Creutzfeldt-Jakob disease (observable entity)'),('dementia',1,'1089521000000106',NULL,'Predominantly cortical dementia (disorder)'),('dementia',1,'12348006',NULL,'Presenile dementia (disorder)'),('dementia',1,'13092008',NULL,'Picks disease (disorder)'),('dementia',1,'15662003',NULL,'Senile dementia (disorder)'),('dementia',1,'161465002',NULL,'History of - dementia (context-dependent category)'),('dementia',1,'17262008',NULL,'Non-alcoholic Korsakoffs psychosis (disorder)'),('dementia',1,'191448002',NULL,'Senile and presenile organic psychotic conditions (& dementia)'),('dementia',1,'191449005',NULL,'Uncomplicated senile dementia (disorder)'),('dementia',1,'191451009',NULL,'Uncomplicated presenile dementia (disorder)'),('dementia',1,'191452002',NULL,'Presenile dementia with delirium (disorder)'),('dementia',1,'191454001',NULL,'Presenile dementia with paranoia (disorder)'),('dementia',1,'191455000',NULL,'Presenile dementia with depression (disorder)'),('dementia',1,'191457008',NULL,'Senile dementia with depressive or paranoid features (disorder)'),('dementia',1,'191458003',NULL,'Senile dementia with paranoia (disorder)'),('dementia',1,'191459006',NULL,'Senile dementia with depression (disorder)'),('dementia',1,'191461002',NULL,'Senile dementia with delirium (disorder)'),('dementia',1,'191463004',NULL,'Uncomplicated arteriosclerotic dementia (disorder)'),('dementia',1,'191464005',NULL,'Arteriosclerotic dementia with delirium (disorder)'),('dementia',1,'191465006',NULL,'Arteriosclerotic dementia with paranoia (disorder)'),('dementia',1,'191466007',NULL,'Arteriosclerotic dementia with depression (disorder)'),('dementia',1,'191471000',NULL,'Korsakovs alcoholic psychosis with peripheral neuritis (disorder)'),('dementia',1,'191475009',NULL,'Chronic alcoholic brain syndrome (disorder)'),('dementia',1,'191519005',NULL,'Dementia in conditions EC (disorder)'),('dementia',1,'192818008',NULL,'Cerebral degeneration due to Creutzfeldt-Jakob disease (disorder)'),('dementia',1,'192819000',NULL,'Cerebral degeneration due to progressive multifocal leukoencephalopathy (disorder)'),('dementia',1,'20484008',NULL,'Prion disease (disorder)'),('dementia',1,'21921000119103',NULL,'Dementia co-occurrent and due to Picks disease (disorder)'),('dementia',1,'22381000119105',NULL,'Primary degenerative dementia (disorder)'),('dementia',1,'229672009',NULL,'Language disorder of dementia (disorder)'),('dementia',1,'230258005',NULL,'Amyotrophic lateral sclerosis with dementia (disorder)'),('dementia',1,'230265002',NULL,'Familial Alzheimers disease of early onset (disorder)'),('dementia',1,'230266001',NULL,'Non-familial Alzheimers disease of early onset (disorder)'),('dementia',1,'230267005',NULL,'Familial Alzheimers disease of late onset (disorder)'),('dementia',1,'230268000',NULL,'Non-familial Alzheimers disease of late onset (disorder)'),('dementia',1,'230269008',NULL,'Focal Alzheimers disease (disorder)'),('dementia',1,'230270009',NULL,'Frontotemporal dementia (disorder)'),('dementia',1,'230271008',NULL,'Picks disease with Pick bodies (disorder)'),('dementia',1,'230272001',NULL,'Picks disease with Pick cells and no Pick bodies (disorder)'),('dementia',1,'230273006',NULL,'Frontotemporal degeneration (disorder)'),('dementia',1,'230274000',NULL,'Frontal lobe degeneration with motor neurone disease (disorder)'),('dementia',1,'230280008',NULL,'Progressive aphasia in Alzheimers disease (disorder)'),('dementia',1,'230281007',NULL,'Argyrophilic brain disease (disorder)'),('dementia',1,'230282000',NULL,'Post-traumatic dementia (disorder)'),('dementia',1,'230283005',NULL,'Punch drunk syndrome (disorder)'),('dementia',1,'230284004',NULL,'Spongiform encephalopathy (disorder)'),('dementia',1,'230285003',NULL,'Vascular dementia of acute onset (disorder)'),('dementia',1,'230286002',NULL,'Subcortical vascular dementia (disorder)'),('dementia',1,'230287006',NULL,'Mixed cortical and subcortical vascular dementia (disorder)'),('dementia',1,'230288001',NULL,'Semantic dementia (disorder)'),('dementia',1,'230289009',NULL,'Patchy dementia (disorder)'),('dementia',1,'231438001',NULL,'Presbyophrenic psychosis (disorder)'),('dementia',1,'248711000000102',NULL,'Dementia monitoring (regime/therapy)'),('dementia',1,'249181000000100',NULL,'Dementia annual review (regime/therapy)'),('dementia',1,'267688001',NULL,'Cerebral degenerations NOS &/or Alzheimers disease &/or Picks disease &/or Reyes syndrome'),('dementia',1,'268612007',NULL,'Senile and presenile organic psychotic conditions (disorder)'),('dementia',1,'268745002',NULL,'(Alcoholic psychosis: [Korsakovs] or [other]) or (withdrawal syndrome - alcohol)'),('dementia',1,'26929004',NULL,'Alzheimers disease (disorder)'),('dementia',1,'278855005',NULL,'Frontal lobe degeneration (disorder)'),('dementia',1,'278857002',NULL,'Dementia of frontal lobe type (disorder)'),('dementia',1,'279982005',NULL,'Cerebral degeneration presenting primarily with dementia (disorder)'),('dementia',1,'281004',NULL,'Dementia associated with alcoholism (disorder)'),('dementia',1,'304603007',NULL,'New variant of Creutzfeldt-Jakob disease (disorder)'),('dementia',1,'312991009',NULL,'Senile dementia of the Lewy body type (disorder)'),('dementia',1,'371026009',NULL,'Senile dementia with psychosis (disorder)'),('dementia',1,'416780008',NULL,'Primary degenerative dementia of the Alzheimer type, presenile onset (disorder)'),('dementia',1,'416975007',NULL,'Primary degenerative dementia of the Alzheimer type, senile onset (disorder)'),('dementia',1,'421529006',NULL,'Dementia associated with AIDS (disorder)'),('dementia',1,'42344001',NULL,'Alcohol-induced psychosis (disorder)'),('dementia',1,'425390006',NULL,'Dementia associated with Parkinsons Disease (disorder)'),('dementia',1,'429458009',NULL,'Dementia due to Creutzfeldt Jakob disease (disorder)'),('dementia',1,'429998004',NULL,'Vascular dementia (disorder)'),('dementia',1,'442344002',NULL,'Dementia due to Huntington chorea (disorder)'),('dementia',1,'52448006',NULL,'Dementia (disorder)'),('dementia',1,'56267009',NULL,'Multi-infarct dementia (disorder)'),('dementia',1,'62239001',NULL,'Parkinson-dementia complex of Guam (disorder)'),('dementia',1,'67155006',NULL,'Gerstmann-Straussler-Scheinker syndrome (disorder)'),('dementia',1,'68638009',NULL,'Bovine spongiform encephalopathy agent (organism)'),('dementia',1,'69482004',NULL,'Korsakoffs psychosis (disorder)'),('dementia',1,'713060000',NULL,'Sporadic Creutzfeldt-Jakob disease (disorder)'),('dementia',1,'713821000000106',NULL,'Dementia monitoring administration (record artifact)'),('dementia',1,'715821000000107',NULL,'Dementia monitoring first letter (procedure)'),('dementia',1,'715881000000108',NULL,'Exception reporting - dementia quality indicators (finding)'),('dementia',1,'716131000000105',NULL,'Excepted from dementia quality indicators - informed dissent (finding)'),('dementia',1,'716221000000104',NULL,'Dementia monitoring verbal invitation (procedure)'),('dementia',1,'716341000000104',NULL,'Excepted from dementia quality indicators - patient unsuitable (finding)'),('dementia',1,'716671000000102',NULL,'Dementia monitoring third letter (procedure)'),('dementia',1,'716991000000108',NULL,'Dementia monitoring telephone invitation (procedure)'),('dementia',1,'717471000000101',NULL,'Dementia monitoring second letter (procedure)'),('dementia',1,'724992007',NULL,'Epilepsy co-occurrent and due to dementia (disorder)'),('dementia',1,'73097000',NULL,'Alcohol amnestic disorder (disorder)'),('dementia',1,'792004',NULL,'Jakob-Creutzfeldt disease (disorder)'),('dementia',1,'80098002',NULL,'Diffuse Lewy body disease (disorder)'),('dementia',1,'843991000000105',NULL,'Participates in Butterfly Scheme for dementia (finding)'),('dementia',1,'844001000000100',NULL,'Butterfly Scheme for dementia declined (situation)'),('dementia',1,'86188000',NULL,'Kuru (disorder)'),('dementia',1,'88520007',NULL,'Creutzfeldt-Jakob agent (organism)'),('dementia',1,'90099008',NULL,'Subcortical leukoencephalopathy (disorder)'),('dementia',1,'91388009',NULL,'Psychoactive substance abuse (disorder)'),('dementia',1,'938551000000108',NULL,'Dementia medication review (procedure)'),('dementia',1,'922071000000105',NULL,'Sporadic Creutzfeldt Jakob disease'),('dementia',1,'724776007',NULL,'Dementia due to disorder of central nervous system (disorder)'),('dementia',1,'1260354005',NULL,'Frontotemporal dementia due to C9orf72 mutation (disorder)'),('dementia',1,'268613002',NULL,'Vascular dementia (disorder)'),('dementia',1,'90253000',NULL,'Progressive subcortical gliosis (disorder)'),('dementia',1,'9345005',NULL,'Dialysis dementia (disorder)'),('dementia',1,'1259121008',NULL,'Amyotrophic lateral sclerosis, parkinsonism, dementia complex of West New Guinea (disorder)'),('dementia',1,'26852004',NULL,'Primary degenerative dementia of the Alzheimer type, senile onset, with depression (disorder)'),('dementia',1,'192802002',NULL,'Dementia in Alzheimers disease with early onset (disorder)'),('dementia',1,'1263555006',NULL,'Logopenic non-amnestic Alzheimer disease (disorder)'),('dementia',1,'715662009',NULL,'Iatrogenic Jakob-Creutzfeldt disease (disorder)'),('dementia',1,'155061007',NULL,'Creutzfeldt-Jakob disease (disorder)'),('dementia',1,'698954005',NULL,'Primary degenerative dementia of the Alzheimer type, senile onset in remission (disorder)'),('dementia',1,'716994006',NULL,'Behavioral variant of frontotemporal dementia (disorder)'),('dementia',1,'443541000000101',NULL,'[X]Dementia in Alzheimers disease, unspecified (disorder)'),('dementia',1,'733185001',NULL,'Dementia following injury caused by exposure to ionizing radiation (disorder)'),('dementia',1,'192176001',NULL,'[X]Dementia in Huntingtons disease (disorder)'),('dementia',1,'702429008',NULL,'Frontotemporal dementia with parkinsonism-17 (disorder)'),('dementia',1,'268675002',NULL,'[X]Unspecified dementia (disorder)'),
('dementia',1,'721255002',NULL,'Acquired prion disease (disorder)'),('dementia',1,'1259591007',NULL,'Dementia due to acquired hypothyroidism (disorder)'),('dementia',1,'1259584009',NULL,'Dementia due to and following dialysis (disorder)'),('dementia',1,'671511000000100',NULL,'Alcoholic dementia NOS (disorder)'),('dementia',1,'402771000000101',NULL,'[X]Delirium superimposed on dementia (disorder)'),('dementia',1,'79341000119107',NULL,'Mixed dementia (disorder)'),('dementia',1,'715737004',NULL,'Parkinsonism co-occurrent with dementia of Guadeloupe (disorder)'),('dementia',1,'82959004',NULL,'Dementia paralytica juvenilis (disorder)'),('dementia',1,'1259476008',NULL,'Dementia due to genetic disease (disorder)'),('dementia',1,'41161000000104',NULL,'Multi-infarct dementia'),('dementia',1,'840452004',NULL,'Classical sporadic Creutzfeldt-Jakob disease (disorder)'),('dementia',1,'192163007',NULL,'[X]Dementia in Alzheimers dis, atypical or mixed type (disorder)'),('dementia',1,'722980006',NULL,'Dementia due to chromosomal anomaly (disorder)'),('dementia',1,'721219005',NULL,'Familial Alzheimer-like prion disease (disorder)'),('dementia',1,'464291000000103',NULL,'[X]Dementia in other diseases classified elsewhere (disorder)'),('dementia',1,'1186877003',NULL,'Dementia due to vitamin E deficiency (disorder)'),('dementia',1,'191467003',NULL,'Arteriosclerotic dementia NOS (disorder)'),('dementia',1,'1259513009',NULL,'Dementia due to Whipple disease (disorder)'),('dementia',1,'1259492003',NULL,'Dementia due to metastatic malignant neoplasm to brain (disorder)'),('dementia',1,'698725008',NULL,'Dementia associated with neurosyphilis (disorder)'),('dementia',1,'154851005',NULL,'Other senile/presenile dementia (disorder)'),('dementia',1,'1089531000000108',NULL,'Predominantly cortical vascular dementia (disorder)'),('dementia',1,'723123001',NULL,'Ischemic vascular dementia (disorder)'),('dementia',1,'413681000000103',NULL,'[X] Dementia: [unspecif] or [presenile NOS (including presenile psychosis NOS)] or [primary degenerative NOS] or [senile NOS (including senile psychosis NOS)] or [senile depressed or paranoid type] (disorder)'),('dementia',1,'105421000119105',NULL,'Early onset Alzheimers disease with behavioral disturbance (disorder)'),('dementia',1,'1259531005',NULL,'Dementia due to hypertensive encephalopathy (disorder)'),('dementia',1,'788898005',NULL,'Dementia caused by volatile inhalant (disorder)'),('dementia',1,'698625002',NULL,'Dementia associated with normal pressure hydrocephalus (disorder)'),('dementia',1,'774069007',NULL,'Protein kinase cAMP-dependent type I regulatory subunit beta-related neurodegenerative dementia with intermediate filaments (disorder)'),('dementia',1,'266134000',NULL,'Tabes dorsalis (disorder)'),('dementia',1,'1259663006',NULL,'Dementia due to polyarteritis nodosa (disorder)'),('dementia',1,'109478007',NULL,'Kohlschutters syndrome (disorder)'),('dementia',1,'725898002',NULL,'Delirium co-occurrent with dementia (disorder)'),('dementia',1,'51928006',NULL,'General paresis - neurosyphilis (disorder)'),('dementia',1,'16276361000119109',NULL,'Vascular dementia without behavioral disturbance (disorder)'),('dementia',1,'715807002',NULL,'Familial Creutzfeldt-Jakob (disorder)'),('dementia',1,'198681000000106',NULL,'[X]Lewy body dementia (disorder)'),('dementia',1,'412631000000106',NULL,'[X]Other vascular dementia (disorder)'),('dementia',1,'12741002',NULL,'AIDS with dementia (disorder)'),('dementia',1,'154845000',NULL,'Dementia (& [presenile] or [senile]) (disorder)'),('dementia',1,'414351000000102',NULL,'[X]Dementia in Creutzfeldt-Jakob disease (disorder)'),('dementia',1,'733192006',NULL,'Dementia due to herpes encephalitis (disorder)'),('dementia',1,'154850006',NULL,'Vascular dementia (disorder)'),('dementia',1,'1259473000',NULL,'Dementia due to fragile X syndrome (disorder)'),('dementia',1,'390000004',NULL,'Binswangers disease (disorder)'),('dementia',1,'214031000000108',NULL,'[X]Lewy body dementia'),('dementia',1,'371024007',NULL,'Senile dementia with delusion (disorder)'),('dementia',1,'97751000119108',NULL,'Altered behavior in Alzheimers disease (disorder)'),('dementia',1,'716667005',NULL,'Right temporal atrophy variant frontotemporal dementia (disorder)'),('dementia',1,'192173009',NULL,'[X]Dementia in other diseases classified elsewhere (disorder)'),('dementia',1,'25772007',NULL,'Multi-infarct dementia with delusions (disorder)'),('dementia',1,'191493005',NULL,'Dementia caused by drug (disorder)'),('dementia',1,'1259667007',NULL,'Dementia due to paraneoplastic encephalitis (disorder)'),('dementia',1,'154846004',NULL,'Uncomplicated senile dementia (disorder)'),('dementia',1,'698626001',NULL,'Dementia associated with multiple sclerosis (disorder)'),('dementia',1,'42769004',NULL,'Diffuse Lewy body disease with spongiform cortical change (disorder)'),('dementia',1,'783258000',NULL,'Familial dementia Danish type (disorder)'),('dementia',1,'838276009',NULL,'Amyotrophic lateral sclerosis, parkinsonism, dementia complex (disorder)'),('dementia',1,'135811000119107',NULL,'Lewy body dementia with behavioral disturbance (disorder)'),('dementia',1,'762351006',NULL,'Dementia due to and following injury of head (disorder)'),('dementia',1,'230275004',NULL,'Lewy body disease (disorder)'),('dementia',1,'722977005',NULL,'Dementia co-occurrent and due to neurocysticercosis (disorder)'),('dementia',1,'1263585001',NULL,'Frontal variant non-amnestic Alzheimer disease (disorder)'),('dementia',1,'1186883000',NULL,'Dementia due to nutritional deficiency disorder (disorder)'),('dementia',1,'4817008',NULL,'Primary degenerative dementia of the Alzheimer type, senile onset, with delirium (disorder)'),('dementia',1,'702421006',NULL,'Familial encephalopathy with neuroserpin inclusion bodies (disorder)'),('dementia',1,'788862002',NULL,'Agitation due to dementia (finding)'),('dementia',1,'10532003',NULL,'Primary degenerative dementia of the Alzheimer type, presenile onset, with depression (disorder)'),('dementia',1,'698781002',NULL,'Dementia associated with cerebral anoxia (disorder)'),('dementia',1,'397791000000109',NULL,'[X]Dementia in other specified diseases classified elsewhere (disorder)'),('dementia',1,'1259661008',NULL,'Dementia due to inflammatory disorder of musculoskeletal system (disorder)'),('dementia',1,'82371000119101',NULL,'Dementia due to multiple sclerosis with altered behavior (disorder)'),('dementia',1,'54502004',NULL,'Primary degenerative dementia of the Alzheimer type, presenile onset, with delusions (disorder)'),('dementia',1,'1259465009',NULL,'Dementia due to hepatic failure (disorder)'),('dementia',1,'443491000000105',NULL,'[X]Dementia in Alzheimers disease (disorder)'),('dementia',1,'192170007',NULL,'[X]Other vascular dementia (disorder)'),('dementia',1,'1259677009',NULL,'Dementia due to multiple system atrophy (disorder)'),('dementia',1,'191462009',NULL,'Arteriosclerotic dementia (including [multi infarct dementia]) (disorder)'),('dementia',1,'1259524006',NULL,'Dementia due to trypanosomiasis (disorder)'),('dementia',1,'702393003',NULL,'Frontotemporal dementia with gene located on 3p11 (disorder)'),('dementia',1,'59651006',NULL,'Sedative, hypnotic AND/OR anxiolytic-induced persisting dementia (disorder)'),('dementia',1,'789170003',NULL,'Disinhibited behavior due to dementia (disorder)'),('dementia',1,'192180006',NULL,'[X] Dementia: [unspecif] or [presenile NOS (including presenile psychosis NOS)] or [primary degenerative NOS] or [senile NOS (including senile psychosis NOS)] or [senile depressed or paranoid type] (disorder)'),('dementia',1,'698726009',NULL,'Dementia associated with viral encephalitis (disorder)'),('dementia',1,'191456004',NULL,'Presenile dementia NOS (disorder)'),('dementia',1,'471341000000106',NULL,'[X]Unspecified dementia (disorder)'),('dementia',1,'1259586006',NULL,'Dementia due to autoimmune encephalitis (disorder)'),('dementia',1,'479161000000109',NULL,'[X]Dementia in Parkinsons disease (disorder)'),('dementia',1,'288631000119104',NULL,'Vascular dementia with behavioral disturbance (disorder)'),('dementia',1,'1156800008',NULL,'Autosomal dominant Alzheimer disease due to mutation of presenilin 1 (disorder)'),('dementia',1,'1089581000000107',NULL,'Predominantly cortical dementia (disorder)'),('dementia',1,'192179008',NULL,'[X]Dementia in other specified diseases classif elsewhere (disorder)'),('dementia',1,'192175002',NULL,'[X]Dementia in Creutzfeldt-Jakob disease (disorder)'),('dementia',1,'230290000',NULL,'Epileptic dementia (disorder)'),('dementia',1,'192184002',NULL,'[X]Delirium superimposed on dementia (disorder)'),('dementia',1,'788899002',NULL,'Dementia due to pellagra (disorder)'),('dementia',1,'82361000119107',NULL,'Altered behavior in dementia due to Huntington chorea (disorder)'),('dementia',1,'192808003',NULL,'Lewy body disease (disorder)'),('dementia',1,'194481000',NULL,'[X]Other Alzheimers disease (disorder)'),('dementia',1,'713844000',NULL,'Dementia co-occurrent with human immunodeficiency virus infection (disorder)'),('dementia',1,'733193001',NULL,'Dementia co-occurrent and due to progressive multifocal leukoencephalopathy (disorder)'),('dementia',1,'1259469003',NULL,'Dementia due to Gerstmann Straussler Scheinker syndrome (disorder)'),('dementia',1,'698948009',NULL,'Vascular dementia in remission (disorder)'),('dementia',1,'1259123006',NULL,'Amyotrophic lateral sclerosis, parkinsonism, dementia complex of Kii Peninsula (disorder)'),('dementia',1,'1259511006',NULL,'Dementia due to Wilson disease (disorder)'),('dementia',1,'700911000000100',NULL,'Other senile/presenile dementia (disorder)'),('dementia',1,'141991000119109',NULL,'Delusions in Alzheimers disease (disorder)'),('dementia',1,'66108005',NULL,'Primary degenerative dementia of the Alzheimer type, senile onset, uncomplicated (disorder)'),('dementia',1,'421023003',NULL,'Presenile dementia with acquired immunodeficiency syndrome (disorder)'),
('dementia',1,'1259673008',NULL,'Dementia due to neurofilament inclusion body disease (disorder)'),('dementia',1,'1260355006',NULL,'Frontotemporal dementia due to FUS mutation (disorder)'),('dementia',1,'762707000',NULL,'Subcortical dementia (disorder)'),('dementia',1,'413281000000101',NULL,'[X]Vascular dementia, unspecified (disorder)'),('dementia',1,'1259471003',NULL,'Dementia due to Hashimoto encephalopathy (disorder)'),('dementia',1,'1259499007',NULL,'Dementia due to hemorrhagic cerebral infarction due to hypertension (disorder)'),('dementia',1,'192174003',NULL,'[X]Dementia in Picks disease (disorder)'),('dementia',1,'154848003',NULL,'Senile dementia with depressive or paranoid features (disorder)'),('dementia',1,'1259990004',NULL,'Dementia due to classical pantothenate kinase associated neurodegeneration (disorder)'),('dementia',1,'722979008',NULL,'Dementia due to metabolic abnormality (disorder)'),('dementia',1,'192161009',NULL,'Dementia in Alzheimers disease with early onset (disorder)'),('dementia',1,'65096006',NULL,'Primary degenerative dementia of the Alzheimer type, presenile onset, with delirium (disorder)'),('dementia',1,'1186879000',NULL,'Dementia due to thiamine deficiency (disorder)'),('dementia',1,'1163119007',NULL,'Creutzfeldt Jakob disease following graft of dura (disorder)'),('dementia',1,'922061000000103',NULL,'Sporadic Creutzfeldt-Jakob disease (disorder)'),('dementia',1,'1259480003',NULL,'Dementia due to fatal familial insomnia (disorder)'),('dementia',1,'1259124000',NULL,'Amyotrophic lateral sclerosis with frontotemporal dementia (disorder)'),('dementia',1,'134422007',NULL,'Alzheimers disease with early onset (disorder)'),('dementia',1,'2421000119107',NULL,'Hallucinations co-occurrent and due to late onset dementia (disorder)'),('dementia',1,'613591000000100',NULL,'Presenile dementia NOS (disorder)'),('dementia',1,'192803007',NULL,'Dementia in Alzheimers disease with late onset (disorder)'),('dementia',1,'268744003',NULL,'Dementia (& [presenile] or [senile]) (disorder)'),('dementia',1,'1259128002',NULL,'Alzheimer disease with psychosis (disorder)'),('dementia',1,'1187004001',NULL,'Chronic traumatic encephalopathy (disorder)'),('dementia',1,'111480006',NULL,'Psychoactive substance-induced organic dementia (disorder)'),('dementia',1,'142001000119106',NULL,'Depressed mood in Alzheimers disease (disorder)'),('dementia',1,'723390000',NULL,'Rapidly progressive dementia (disorder)'),('dementia',1,'130121000119104',NULL,'Dementia due to Retts syndrome (disorder)'),('dementia',1,'16219201000119101',NULL,'Behavioral disturbance co-occurrent and due to late onset Alzheimer dementia (disorder)'),('dementia',1,'788861009',NULL,'Aggression due to dementia (finding)'),('dementia',1,'1581000119101',NULL,'Dementia of the Alzheimer type with behavioral disturbance (disorder)'),('dementia',1,'154847008',NULL,'Presenile dementia (disorder)'),('dementia',1,'840465008',NULL,'Dementia due to iron deficiency (disorder)'),('dementia',1,'443781000000102',NULL,'[X]Other Alzheimers disease (disorder)'),('dementia',1,'544871000000102',NULL,'Other alcoholic dementia (disorder)'),('dementia',1,'192168003',NULL,'Subcortical vascular dementia (disorder)'),('dementia',1,'1259494002',NULL,'Dementia due to leukodystrophy (disorder)'),('dementia',1,'55009008',NULL,'Primary degenerative dementia of the Alzheimer type, senile onset, with delusions (disorder)'),('dementia',1,'192177005',NULL,'[X]Dementia in Parkinsons disease (disorder)'),('dementia',1,'1260353004',NULL,'Frontotemporal dementia due to VCP mutation (disorder)'),('dementia',1,'702426001',NULL,'GRN-related frontotemporal dementia (disorder)'),('dementia',1,'414361000000104',NULL,'[X]Dementia in Huntingtons disease (disorder)'),('dementia',1,'142011000119109',NULL,'Alzheimers disease co-occurrent with delirium (disorder)'),('dementia',1,'703544004',NULL,'Inclusion body myopathy with early-onset Paget disease and frontotemporal dementia (disorder)'),('dementia',1,'90194001',NULL,'AIDS with organic dementia (disorder)'),('dementia',1,'1259665004',NULL,'Dementia due to progressive subcortical gliosis (disorder)'),('dementia',1,'1259581001',NULL,'Dementia due to celiac disease (disorder)'),('dementia',1,'762350007',NULL,'Dementia due to prion disease (disorder)'),('dementia',1,'10349009',NULL,'Multi-infarct dementia with delirium (disorder)'),('dementia',1,'88339003',NULL,'Dementia arising in the senium AND/OR presenium (disorder)'),('dementia',1,'230277007',NULL,'Lewy body disease (disorder)'),('dementia',1,'419261000000107',NULL,'[X]Dementia in Alzheimers dis, atypical or mixed type (disorder)'),('dementia',1,'1259496000',NULL,'Dementia due to Lyme disease (disorder)'),('dementia',1,'420614009',NULL,'Organic dementia with acquired immunodeficiency syndrome (disorder)'),('dementia',1,'192160005',NULL,'[X]Dementia in Alzheimers disease (disorder)'),('dementia',1,'6475002',NULL,'Primary degenerative dementia of the Alzheimer type, presenile onset, uncomplicated (disorder)'),('dementia',1,'62102009',NULL,'AIDS with presenile dementia (disorder)'),('dementia',1,'455381000000102',NULL,'[X]Dementia in Picks disease (disorder)'),('dementia',1,'1259501004',NULL,'Dementia due to kuru (disorder)'),('dementia',1,'192162002',NULL,'Dementia in Alzheimers disease with late onset (disorder)'),('dementia',1,'268615009',NULL,'Other alcoholic dementia (disorder)'),('dementia',1,'733191004',NULL,'Dementia due to chronic subdural hematoma (disorder)'),('dementia',1,'1186881003',NULL,'Dementia due to niacin deficiency (disorder)'),('dementia',1,'1259488005',NULL,'Dementia due to cerebral amyloid angiopathy (disorder)'),('dementia',1,'191474008',NULL,'Alcoholic dementia: [other] or [NOS] (disorder)'),('dementia',1,'1259478009',NULL,'Dementia due to familial Creutzfeldt-Jakob disease (disorder)'),('dementia',1,'698687007',NULL,'Post-traumatic dementia with behavioral change (disorder)'),('dementia',1,'613601000000106',NULL,'Senile dementia with depressive or paranoid features NOS (disorder)'),('dementia',1,'192164001',NULL,'[X]Dementia in Alzheimers disease, unspecified (disorder)'),('dementia',1,'1156789004',NULL,'Autosomal dominant Alzheimer disease due to mutation of amyloid precursor protein (disorder)'),('dementia',1,'70936005',NULL,'Multi-infarct dementia, uncomplicated (disorder)'),('dementia',1,'840464007',NULL,'Dementia due to carbon monoxide poisoning (disorder)'),('dementia',1,'138736007',NULL,'H/O: dementia (situation)'),('dementia',1,'733184002',NULL,'Dementia caused by heavy metal exposure (disorder)'),('dementia',1,'1186887004',NULL,'Dementia caused by manganese and/or manganese compound (disorder)'),('dementia',1,'106021000119105',NULL,'Multi-infarct dementia due to atherosclerosis (disorder)'),('dementia',1,'192165000',NULL,'Vascular dementia (disorder)'),('dementia',1,'286932008',NULL,'Other senile/presenile dementia (disorder)'),('dementia',1,'733190003',NULL,'Dementia due to primary malignant neoplasm of brain (disorder)'),('dementia',1,'860826006',NULL,'Creutzfeldt-Jakob Disease caused by human growth hormone (disorder)'),('dementia',1,'783161005',NULL,'Familial dementia British type (disorder)'),('dementia',1,'1259467001',NULL,'Dementia due to hypercalcemia (disorder)'),('dementia',1,'722600006',NULL,'Non-amnestic Alzheimer disease (disorder)'),('dementia',1,'597951000000102',NULL,'Arteriosclerotic dementia NOS (disorder)'),('dementia',1,'698624003',NULL,'Dementia associated with cerebral lipidosis (disorder)'),('dementia',1,'32875003',NULL,'Inhalant-induced persisting dementia (disorder)'),('dementia',1,'82351000119105',NULL,'Altered behavior due to Picks disease (disorder)'),('dementia',1,'134423002',NULL,'Alzheimers disease with late onset (disorder)'),('dementia',1,'192171006',NULL,'[X]Vascular dementia, unspecified (disorder)'),('dementia',1,'1259579003',NULL,'Dementia due to Behcet syndrome (disorder)'),('dementia',1,'833326008',NULL,'Cortical vascular dementia (disorder)'),('dementia',1,'1259679007',NULL,'Dementia due to atypical pantothenate kinase associated neurodegeneration (disorder)'),('dementia',1,'191460001',NULL,'Senile dementia with depressive or paranoid features NOS (disorder)'),('dementia',1,'154849006',NULL,'Senile dementia with delirium (disorder)'),('dementia',1,'698955006',NULL,'Primary degenerative dementia of the Alzheimer type, presenile onset in remission (disorder)'),('dementia',1,'1259656006',NULL,'Dementia due to renal failure (disorder)'),('dementia',1,'31081000119101',NULL,'Presenile dementia with delusions (disorder)'),('dementia',1,'1259485008',NULL,'Dementia due to cerebral vasculitis (disorder)'),('dementia',1,'1156798001',NULL,'Autosomal dominant Alzheimer disease due to mutation of presenilin 2 (disorder)'),('dementia',1,'724777003',NULL,'Dementia due to infectious disease (disorder)'),('dementia',1,'1259522005',NULL,'Dementia due to variant Creutzfeldt-Jakob disease (disorder)'),('dementia',1,'1186880002',NULL,'Dementia due to cobalamin deficiency (disorder)'),('dementia',1,'1260352009',NULL,'Frontotemporal dementia due to TARDBP mutation (disorder)'),('dementia',1,'733194007',NULL,'Dementia co-occurrent and due to Down syndrome (disorder)'),('dementia',1,'1259503001',NULL,'Dementia due to iatrogenic Creutzfeldt-Jakob disease (disorder)'),('dementia',1,'698949001',NULL,'Dementia in remission (disorder)'),('dementia',1,'293671000119109',NULL,'Behavioral disturbance due to multi-infarct dementia (disorder)'),('dementia',1,'82381000119103',NULL,'Epileptic dementia with behavioral disturbance (disorder)'),('dementia',1,'1591000119103',NULL,'Dementia with behavioral disturbance (disorder)'),('dementia',1,'191450005',NULL,'Presenile dementia (disorder)'),('dementia',1,'1259517005',NULL,'Dementia due to systemic lupus erythematosus (disorder)'),('dementia',1,'78511000000104',NULL,'Multi-infarct dementia'),('dementia',1,'1259519008',NULL,'Dementia due to subacute sclerosing panencephalitis (disorder)'),
('dementia',1,'1259529001',NULL,'Dementia due to sporadic Creutzfeldt-Jakob disease (disorder)'),('dementia',1,'14070001',NULL,'Multi-infarct dementia with depression (disorder)'),('dementia',1,'192166004',NULL,'Vascular dementia of acute onset (disorder)'),('dementia',1,'101421000119107',NULL,'Dementia due to Parkinsons disease (disorder)'),('dementia',1,'1259675001',NULL,'Dementia due to obstructive hydrocephalus (disorder)'),('dementia',1,'192178000',NULL,'Acquired immune deficiency syndrome dementia complex (disorder)'),('dementia',1,'192169006',NULL,'Mixed cortical and subcortical vascular dementia (disorder)'),('dementia',1,'722978000',NULL,'Dementia caused by toxin (disorder)'),('dementia',1,'713488003',NULL,'Presenile dementia co-occurrent with human immunodeficiency virus infection (disorder)'),('dementia',1,'192167008',NULL,'[X]Dementia: [multi-infarct] or [predominantly cortical] (disorder)'),('dementia',1,'230276003',NULL,'Lewy body disease (disorder)'),('dementia',1,'79358009',NULL,'Transmissible virus dementia (disorder)'),('dementia',1,'1148924004',NULL,'Dementia due to deficiency of folic acid (disorder)'),('dementia',1,'231463001',NULL,'Alcoholic dementia NOS (disorder)'),('dementia',1,'1089501000000102',NULL,'Presenile dementia with psychosis (disorder)'),('dementia',1,'142811000119104',NULL,'Dementia due to Alzheimers disease (disorder)'),('dementia',1,'2421000119107',NULL,'Hallucinations co-occurrent and due to late onset dementia (disorder)'),('dementia',1,'715737004',NULL,'Parkinsonism co-occurrent with dementia of Guadeloupe (disorder)'),('dementia',1,'83157008',NULL,'Fatal familial insomnia (disorder)'),('dementia',1,'45864009',NULL,'Senile degeneration of brain (disorder)'),('dementia',1,'16219201000119101',NULL,'Behavioral disturbance co-occurrent and due to late onset Alzheimer dementia (disorder)'),('dementia',1,'40425004',NULL,'Postconcussion syndrome (disorder)'),('dementia',1,'725898002',NULL,'Delirium co-occurrent with dementia (disorder)')

INSERT INTO #AllCodes
SELECT [concept], [version], [code], [description] from #codessnomed;

IF OBJECT_ID('tempdb..#codesemis') IS NOT NULL DROP TABLE #codesemis;
CREATE TABLE #codesemis (
  [concept] [varchar](255) NOT NULL,
  [version] INT NOT NULL,
	[code] [varchar](20) COLLATE Latin1_General_CS_AS NOT NULL,
	[term] [varchar](20) COLLATE Latin1_General_CS_AS NULL,
	[description] [varchar](255) NULL
) ON [PRIMARY];

INSERT INTO #codesemis
VALUES ('dementia',1,'^ESCTAC697343',NULL,'Acquired immune deficiency syndrome-related dementia'),('dementia',1,'^ESCTAC697346',NULL,'Acquired immune deficiency syndrome dementia complex'),('dementia',1,'^ESCTAD697345',NULL,'ADC - Acquired immune deficiency syndrome dementia complex'),('dementia',1,'^ESCTAI697344',NULL,'AIDS - Acquired immune deficiency syndrome dementia complex'),('dementia',1,'^ESCTDE697342',NULL,'Dementia associated with AIDS'),('dementia',1,'^ESCTDE697347',NULL,'Dementia associated with acquired immunodeficiency syndrome'),('dementia',1,'EMISICD10|F0000',NULL,'Dementia in Alzheimers disease with early onset, without additional symptoms'),('dementia',1,'EMISICD10|F0001',NULL,'Dementia in Alzheimers disease with early onset, other symptoms, predominantly delusional'),('dementia',1,'EMISICD10|F0002',NULL,'Dementia in Alzheimers disease with early onset, other symptoms, predominantly hallucinatory'),('dementia',1,'EMISICD10|F0003',NULL,'Dementia in Alzheimers disease with early onset, other symptoms, predominantly depressive'),('dementia',1,'EMISICD10|F0004',NULL,'Dementia in Alzheimers disease with early onset, other mixed symptoms'),('dementia',1,'EMISICD10|F0010',NULL,'Dementia in Alzheimers disease with late onset, without additional symptoms'),('dementia',1,'EMISICD10|F0011',NULL,'Dementia in Alzheimers disease with late onset, other symptoms, predominantly delusional'),('dementia',1,'EMISICD10|F0012',NULL,'Dementia in Alzheimers disease with late onset, other symptoms, predominantly hallucinatory'),('dementia',1,'EMISICD10|F0013',NULL,'Dementia in Alzheimers disease with late onset, other symptoms, predominantly depressive'),('dementia',1,'EMISICD10|F0014',NULL,'Dementia in Alzheimers disease with late onset, other mixed symptoms'),('dementia',1,'EMISICD10|F0020',NULL,'Dementia in Alzheimers dis, atypical or mixed type, without additional symptoms'),('dementia',1,'EMISICD10|F0021',NULL,'Dementia in Alzheimers dis, atypical or mixed type, other symptoms, predominantly delusional'),('dementia',1,'EMISICD10|F0022',NULL,'Dementia in Alzheimers dis, atypical or mixed type, other symptoms, predominantly hallucinatory'),('dementia',1,'EMISICD10|F0023',NULL,'Dementia in Alzheimers dis, atypical or mixed type, other symptoms, predominantly depressive'),('dementia',1,'EMISICD10|F0024',NULL,'Dementia in Alzheimers dis, atypical or mixed type, other mixed symptoms'),('dementia',1,'EMISICD10|F0090',NULL,'Dementia in Alzheimers disease, unspecified, without additional symptoms'),('dementia',1,'EMISICD10|F0091',NULL,'Dementia in Alzheimers disease, unspecified, other symptoms, predominantly delusional'),('dementia',1,'EMISICD10|F0092',NULL,'Dementia in Alzheimers disease, unspecified, other symptoms, predominantly hallucinatory'),('dementia',1,'EMISICD10|F0093',NULL,'Dementia in Alzheimers disease, unspecified, other symptoms, predominantly depressive'),('dementia',1,'EMISICD10|F0094',NULL,'Dementia in Alzheimers disease, unspecified, other mixed symptoms'),('dementia',1,'EMISICD10|F0100',NULL,'Vascular dementia of acute onset, without additional symptoms'),('dementia',1,'EMISICD10|F0101',NULL,'Vascular dementia of acute onset, other symptoms, predominantly delusional'),('dementia',1,'EMISICD10|F0102',NULL,'Vascular dementia of acute onset, other symptoms, predominantly hallucinatory'),('dementia',1,'EMISICD10|F0103',NULL,'Vascular dementia of acute onset, other symptoms, predominantly depressive'),('dementia',1,'EMISICD10|F0104',NULL,'Vascular dementia of acute onset, other mixed symptoms'),('dementia',1,'EMISICD10|F0110',NULL,'Multi-infarct dementia, without additional symptoms'),('dementia',1,'EMISICD10|F0111',NULL,'Multi-infarct dementia, other symptoms, predominantly delusional'),('dementia',1,'EMISICD10|F0112',NULL,'Multi-infarct dementia, other symptoms, predominantly hallucinatory'),('dementia',1,'EMISICD10|F0113',NULL,'Multi-infarct dementia, other symptoms, predominantly depressive'),('dementia',1,'EMISICD10|F0114',NULL,'Multi-infarct dementia, other mixed symptoms'),('dementia',1,'EMISICD10|F0120',NULL,'Subcortical vascular dementia, without additional symptoms'),('dementia',1,'EMISICD10|F0121',NULL,'Subcortical vascular dementia, other symptoms, predominantly delusional'),('dementia',1,'EMISICD10|F0122',NULL,'Subcortical vascular dementia, other symptoms, predominantly hallucinatory'),('dementia',1,'EMISICD10|F0123',NULL,'Subcortical vascular dementia, other symptoms, predominantly depressive'),('dementia',1,'EMISICD10|F0124',NULL,'Subcortical vascular dementia, other mixed symptoms'),('dementia',1,'EMISICD10|F0130',NULL,'Mixed cortical and subcortical vascular dementia, without additional symptoms'),('dementia',1,'EMISICD10|F0131',NULL,'Mixed cortical and subcortical vascular dementia, other symptoms, predominantly delusional'),('dementia',1,'EMISICD10|F0132',NULL,'Mixed cortical and subcortical vascular dementia, other symptoms, predominantly hallucinatory'),('dementia',1,'EMISICD10|F0133',NULL,'Mixed cortical and subcortical vascular dementia, other symptoms, predominantly depressive'),('dementia',1,'EMISICD10|F0134',NULL,'Mixed cortical and subcortical vascular dementia, other mixed symptoms'),('dementia',1,'EMISICD10|F0180',NULL,'Other vascular dementia, without additional symptoms'),('dementia',1,'EMISICD10|F0181',NULL,'Other vascular dementia, other symptoms, predominantly delusional'),('dementia',1,'EMISICD10|F0182',NULL,'Other vascular dementia, other symptoms, predominantly hallucinatory'),('dementia',1,'EMISICD10|F0183',NULL,'Other vascular dementia, other symptoms, predominantly depressive'),('dementia',1,'EMISICD10|F0184',NULL,'Other vascular dementia, other mixed symptoms'),('dementia',1,'EMISICD10|F0190',NULL,'Vascular dementia, unspecified, without additional symptoms'),('dementia',1,'EMISICD10|F0191',NULL,'Vascular dementia, unspecified, other symptoms, predominantly delusional'),('dementia',1,'EMISICD10|F0192',NULL,'Vascular dementia, unspecified, other symptoms, predominantly hallucinatory'),('dementia',1,'EMISICD10|F0193',NULL,'Vascular dementia, unspecified, other symptoms, predominantly depressive'),('dementia',1,'EMISICD10|F0194',NULL,'Vascular dementia, unspecified, other mixed symptoms'),('dementia',1,'EMISICD10|F03X0',NULL,'Unspecified dementia, without additional symptoms'),('dementia',1,'EMISICD10|F03X1',NULL,'Unspecified dementia, other symptoms, predominantly delusional'),('dementia',1,'EMISICD10|F03X2',NULL,'Unspecified dementia, other symptoms, predominantly hallucinatory'),('dementia',1,'EMISICD10|F03X3',NULL,'Unspecified dementia, other symptoms, predominantly depressive'),('dementia',1,'EMISICD10|F03X4',NULL,'Unspecified dementia, other mixed symptoms'),('dementia',1,'^ESCT1171773',NULL,'Predominantly cortical dementia'),('dementia',1,'^ESCT1381019',NULL,'SDLT - senile dementia of Lewy body type'),('dementia',1,'^ESCT1407776',NULL,'Senile Lewy body dementia'),('dementia',1,'^ESCTAL250298',NULL,'Alcohol-induced persisting dementia'),('dementia',1,'^ESCTAL293125',NULL,'Alzheimer dementia'),('dementia',1,'^ESCTAM500542',NULL,'Amyotrophic lateral sclerosis with dementia'),('dementia',1,'^ESCTBI396461',NULL,'Binswangers dementia'),('dementia',1,'^ESCTBO500582',NULL,'Boxers dementia'),('dementia',1,'^ESCTBU828470',NULL,'Butterfly Scheme for dementia declined'),('dementia',1,'^ESCTDE250297',NULL,'Dementia associated with alcoholism'),('dementia',1,'^ESCTDE380265',NULL,'Dementia of the Lewy body type'),('dementia',1,'^ESCTDE500577',NULL,'Dementia due to head trauma'),('dementia',1,'^ESCTDE500580',NULL,'Dementia pugilistica'),('dementia',1,'^ESCTDE561826',NULL,'Dementia of frontal lobe type'),('dementia',1,'^ESCTDE689724',NULL,'Dementia of the Alzheimers type with early onset'),('dementia',1,'^ESCTDE689727',NULL,'Dementia in Alzheimers disease - type 2'),('dementia',1,'^ESCTDE690020',NULL,'Dementia of the Alzheimers type, late onset'),('dementia',1,'^ESCTDE690024',NULL,'Dementia in Alzheimers disease - type 1'),('dementia',1,'^ESCTDE704365',NULL,'Dementia associated with Parkinsons Disease'),('dementia',1,'^ESCTDE704366',NULL,'Dementia associated with Parkinson Disease'),('dementia',1,'^ESCTDE710360',NULL,'Dementia due to Creutzfeldt-Jakob disease'),('dementia',1,'^ESCTDE726301',NULL,'Dementia due to Huntington disease'),('dementia',1,'^ESCTDE726302',NULL,'Dementia due to Huntingtons disease'),('dementia',1,'^ESCTDE800952',NULL,'Dementia due to Picks disease'),('dementia',1,'^ESCTDE800953',NULL,'Dementia due to Pick disease'),('dementia',1,'^ESCTDE800954',NULL,'Dementia co-occurrent and due to Picks disease'),('dementia',1,'^ESCTDF561827',NULL,'DFT - Dementia frontal lobe type'),('dementia',1,'^ESCTEP786368',NULL,'Epilepsy co-occurrent and due to dementia'),('dementia',1,'^ESCTEP786369',NULL,'Epileptic dementia'),('dementia',1,'^ESCTEP786370',NULL,'Epilepsy with dementia'),('dementia',1,'^ESCTFR500560',NULL,'Frontotemporal dementia'),('dementia',1,'^ESCTHI453987',NULL,'History of dementia'),('dementia',1,'^ESCTLA499781',NULL,'Language disorder of dementia'),('dementia',1,'^ESCTLE602407',NULL,'Lewy body dementia'),('dementia',1,'^ESCTMI341423',NULL,'MID - Multi-infarct dementia'),('dementia',1,'^ESCTMU341426',NULL,'Multi infarct dementia'),('dementia',1,'^ESCTOR335044',NULL,'Organic dementia'),('dementia',1,'^ESCTPA351118',NULL,'Parkinson-dementia complex of Guam'),('dementia',1,'^ESCTPA351119',NULL,'Parkinsons disease - dementia complex on Guam'),('dementia',1,'^ESCTPA500588',NULL,'Patchy dementia'),('dementia',1,'^ESCTPA828469',NULL,'Participates in Butterfly Scheme for dementia'),('dementia',1,'^ESCTPO500575',NULL,'Post-traumatic dementia'),('dementia',1,'^ESCTPR689721',NULL,'Primary degenerative dementia of the Alzheimer type, presenile onset'),('dementia',1,'^ESCTPR689722',NULL,'Primary degenerative dementia of the Alzheimer type, early onset'),('dementia',1,'^ESCTPR689725',NULL,'Presenile dementia, Alzheimers type'),
('dementia',1,'^ESCTPR690018',NULL,'Primary degenerative dementia of the Alzheimer type, senile onset'),('dementia',1,'^ESCTPR690019',NULL,'Primary degenerative dementia of the Alzheimer type, late onset'),('dementia',1,'^ESCTPR801011',NULL,'Primary degenerative dementia'),('dementia',1,'^ESCTSD274844',NULL,'SD - Senile dementia'),('dementia',1,'^ESCTSD380263',NULL,'SDLT - Senile dementia of the Lewy body type'),('dementia',1,'^ESCTSD690022',NULL,'SDAT - Senile dementia, Alzheimers type'),('dementia',1,'^ESCTSE500587',NULL,'Semantic dementia'),('dementia',1,'^ESCTSE602406',NULL,'Senile dementia of the Lewy body type'),('dementia',1,'^ESCTSE634806',NULL,'Senile dementia with psychosis'),('dementia',1,'^ESCTSU396466',NULL,'Subcortical atherosclerotic dementia'),('dementia',1,'^ESCTTR251100',NULL,'Transmissible virus dementia'),('dementia',1,'^ESCTVA341425',NULL,'VAD - Vascular dementia'),('dementia',1,'EMISNQDE41',NULL,'Dementia monitoring in primary care'),('dementia',1,'EMISNQDE42',NULL,'Dementia monitoring in secondary care'),('dementia',1,'^ESCTAD293123',NULL,'AD - Alzheimers disease'),('dementia',1,'^ESCTAL293124',NULL,'Alzheimer disease'),('dementia',1,'^ESCTFA500550',NULL,'Familial Alzheimers disease of early onset'),('dementia',1,'^ESCTFA500551',NULL,'Familial Alzheimer disease of early onset'),('dementia',1,'^ESCTFA500554',NULL,'Familial Alzheimers disease of late onset'),('dementia',1,'^ESCTFA500555',NULL,'Familial Alzheimer disease of late onset'),('dementia',1,'^ESCTFO500558',NULL,'Focal Alzheimers disease'),('dementia',1,'^ESCTFO500559',NULL,'Focal Alzheimer disease'),('dementia',1,'^ESCTLE380262',NULL,'Lewy body variant of Alzheimers disease'),('dementia',1,'^ESCTNO500552',NULL,'Non-familial Alzheimers disease of early onset'),('dementia',1,'^ESCTNO500553',NULL,'Non-familial Alzheimer disease of early onset'),('dementia',1,'^ESCTNO500556',NULL,'Non-familial Alzheimers disease of late onset'),('dementia',1,'^ESCTNO500557',NULL,'Non-familial Alzheimer disease of late onset'),('dementia',1,'^ESCTPR500571',NULL,'Progressive aphasia in Alzheimers disease'),('dementia',1,'^ESCTPR500572',NULL,'Progressive aphasia in Alzheimer disease'),('dementia',1,'^ESCTCE476898',NULL,'Cerebral degeneration due to Creutzfeldt-Jakob disease'),('dementia',1,'^ESCTCJ251098',NULL,'CJD - Creutzfeldt-Jakob disease'),('dementia',1,'^ESCTCR251095',NULL,'Creutzfeldt-Jakob disease'),('dementia',1,'^ESCTCR251101',NULL,'Creutzfeldt Jakob disease'),('dementia',1,'^ESCTCR393867',NULL,'Creutzfeldt-Jakob agent'),('dementia',1,'^ESCTCR393869',NULL,'Creutzfeldt-Jakob disease agent'),('dementia',1,'^ESCTCR593165',NULL,'Creutzfeldt-Jakob variant disease'),('dementia',1,'^ESCTJA393868',NULL,'Jakob-Creutzfeldt agent'),('dementia',1,'^ESCTJC251099',NULL,'JCD - Jakob-Creutzfeldt disease'),('dementia',1,'^ESCTNV593163',NULL,'nvCJD - New variant of Creutzfeldt-Jakob disease'),('dementia',1,'^ESCTPR839987',NULL,'Prion protein markers for CJD (Creutzfeldt-Jakob disease)'),('dementia',1,'^ESCTSP769925',NULL,'Sporadic Jakob-Creutzfeldt disease'),('dementia',1,'^ESCTVC593164',NULL,'vCJD - variant Creutzfeldt-Jakob disease'),('dementia',1,'EMISNQSP44',NULL,'Sporadic Creutzfeldt-Jakob disease'),('dementia',1,'EMISNQVA13',NULL,'Variant Creutzfeldt-Jakob disease'),('dementia',1,'^ESCT1407239',NULL,'Picks disease'),('dementia',1,'^ESCT1407240',NULL,'Picks disease'),('dementia',1,'^ESCTAL363017',NULL,'Alcoholic amnestic syndrome'),('dementia',1,'^ESCTAL368893',NULL,'Alcohol-induced persisting amnestic disorder'),('dementia',1,'^ESCTAM363010',NULL,'Amnestic syndrome of Wernickes disease'),('dementia',1,'^ESCTAM363016',NULL,'Amnesic syndrome due to alcohol'),('dementia',1,'^ESCTAR500573',NULL,'Argyrophilic grain disease'),('dementia',1,'^ESCTBO361688',NULL,'Bovine spongiform encephalopathy agent'),('dementia',1,'^ESCTCE476900',NULL,'Cerebral degeneration due to progressive multifocal leukoencephalopathy'),('dementia',1,'^ESCTCH396467',NULL,'Chronic progressive subcortical encephalopathy'),('dementia',1,'^ESCTCI270765',NULL,'Circumscribed cerebral atrophy'),('dementia',1,'^ESCTCL380268',NULL,'CLBD - Cortical Lewy body disease'),('dementia',1,'^ESCTCO380267',NULL,'Cortical Lewy body disease'),('dementia',1,'^ESCTDL380266',NULL,'DLBD - Diffuse Lewy body disease'),('dementia',1,'^ESCTEN396462',NULL,'Encephalitis subcorticalis chronica'),('dementia',1,'^ESCTFR500567',NULL,'Frontal lobe degeneration with motor neurone disease'),('dementia',1,'^ESCTFR561823',NULL,'Frontal lobe degeneration'),('dementia',1,'^ESCTGE359182',NULL,'Gerstmann-Straussler-Scheinker syndrome'),('dementia',1,'^ESCTGS359183',NULL,'GSS - Gerstmann-Straussler-Scheinker syndrome'),('dementia',1,'^ESCTKO277383',NULL,'Korsakovs syndrome - non-alcoholic'),('dementia',1,'^ESCTKO363012',NULL,'Korsakoff psychosis'),('dementia',1,'^ESCTKO363014',NULL,'Korsakov syndrome - alcoholic'),('dementia',1,'^ESCTKO363015',NULL,'Korsakov psychosis'),('dementia',1,'^ESCTKO476314',NULL,'Korsakov alcoholic psychosis with peripheral neuritis'),('dementia',1,'^ESCTLB380264',NULL,'LBD - Lewy body disease'),('dementia',1,'^ESCTLO500566',NULL,'Lobar atrophy'),('dementia',1,'^ESCTNO277380',NULL,'Non-alcoholic Korsakoffs psychosis'),('dementia',1,'^ESCTNO277384',NULL,'Non-alcoholic Korsakoff psychosis'),('dementia',1,'^ESCTPI270766',NULL,'Pick disease'),('dementia',1,'^ESCTPI270767',NULL,'Picks disease'),('dementia',1,'^ESCTPI500561',NULL,'Picks disease with Pick bodies'),('dementia',1,'^ESCTPI500562',NULL,'Pick disease with Pick bodies'),('dementia',1,'^ESCTPI500563',NULL,'Picks disease with Pick cells and no Pick bodies'),('dementia',1,'^ESCTPI500564',NULL,'Pick disease with Pick cells and no Pick bodies'),('dementia',1,'^ESCTPO500576',NULL,'Post-traumatic brain syndrome'),('dementia',1,'^ESCTPR282554',NULL,'Prion disease'),('dementia',1,'^ESCTPU500578',NULL,'Punch drunk syndrome'),('dementia',1,'^ESCTPU500579',NULL,'Punchdrunk encephalopathy'),('dementia',1,'^ESCTPU500581',NULL,'Punch drunk'),('dementia',1,'^ESCTSE476308',NULL,'Senile delirium'),('dementia',1,'^ESCTSP500583',NULL,'Spongiform encephalopathy'),('dementia',1,'^ESCTSU251097',NULL,'Subacute spongiform encephalopathy'),('dementia',1,'^ESCTSU396459',NULL,'Subcortical leucoencephalopathy'),('dementia',1,'^ESCTSU396460',NULL,'Subcortical leukoencephalopathy'),('dementia',1,'^ESCTSU396465',NULL,'Subcortical arteriosclerotic encephalopathy'),('dementia',1,'^ESCTTR500574',NULL,'Traumatic encephalopathy'),('dementia',1,'^ESCTWE363009',NULL,'Wernicke-Korsakoff syndrome'),('dementia',1,'^ESCT1164104',NULL,'Dementia following injury caused by exposure to ionising radiation'),('dementia',1,'^ESCT1164105',NULL,'Postradiation dementia'),('dementia',1,'^ESCT1164106',NULL,'Dementia following injury caused by exposure to ionizing radiation'),('dementia',1,'^ESCT1169048',NULL,'Dementia due to prion disease'),('dementia',1,'^ESCT1169049',NULL,'Dementia due to and following injury of head'),('dementia',1,'^ESCT1169441',NULL,'Subcortical dementia'),('dementia',1,'^ESCT1171771',NULL,'Presenile dementia with psychosis'),('dementia',1,'^ESCT1171774',NULL,'Predominantly cortical vascular dementia'),('dementia',1,'^ESCT1191489',NULL,'[X]Dementia in Alzheimers dis, atypical or mixed type'),('dementia',1,'^ESCT1237064',NULL,'Dementia with mixed etiology'),('dementia',1,'^ESCT1237065',NULL,'MVAD - Mixed vascular Alzheimer dementia'),('dementia',1,'^ESCT1237066',NULL,'Dementia with mixed aetiology'),('dementia',1,'^ESCT1353008',NULL,'PRKAR1B-related neurodegenerative dementia with intermediate filaments'),('dementia',1,'^ESCT1353009',NULL,'Protein kinase cAMP-dependent type I regulatory subunit beta-related neurodegenerative dementia with intermediate filaments'),('dementia',1,'^ESCT1362778',NULL,'Familial dementia British type'),('dementia',1,'^ESCT1362879',NULL,'Familial dementia Danish type'),('dementia',1,'^ESCT1390962',NULL,'Aggression due to dementia'),('dementia',1,'^ESCT1390963',NULL,'Aggression in dementia'),('dementia',1,'^ESCT1390964',NULL,'Agitation due to dementia'),('dementia',1,'^ESCT1390965',NULL,'Agitation in dementia'),('dementia',1,'^ESCT1391007',NULL,'Dementia caused by volatile inhalant'),('dementia',1,'^ESCT1391008',NULL,'Dementia due to pellagra'),('dementia',1,'^ESCT1391306',NULL,'Disinhibited behaviour due to dementia'),('dementia',1,'^ESCT1393438',NULL,'Cortical vascular dementia'),('dementia',1,'^ESCT1393718',NULL,'Amyotrophic lateral sclerosis, parkinsonism, dementia complex'),('dementia',1,'^ESCT1393719',NULL,'Amyotrophic lateral sclerosis, parkinsonism, dementia of Guam syndrome'),('dementia',1,'^ESCT1393722',NULL,'PDALS (parkinsonism, dementia, amyotrophic lateral sclerosis) complex'),('dementia',1,'^ESCT1394318',NULL,'Classical sporadic Creutzfeldt-Jakob disease'),('dementia',1,'^ESCT1394341',NULL,'Dementia due to carbon monoxide poisoning'),('dementia',1,'^ESCT1394342',NULL,'Dementia due to iron deficiency'),('dementia',1,'^ESCT1395118',NULL,'Creutzfeldt-Jakob Disease caused by human growth hormone'),('dementia',1,'^ESCT1395119',NULL,'Human-growth hormone ingestion-related Creutzfeldt-Jakob Disease'),('dementia',1,'^ESCT1409128',NULL,'Dementia with progressive multifocal leucoencephalopathy'),('dementia',1,'^ESCT1409129',NULL,'Dementia co-occurrent and due to progressive multifocal leucoencephalopathy'),('dementia',1,'^ESCT1409378',NULL,'Familial British dementia with amyloid angiopathy'),('dementia',1,'^ESCTAC781444',NULL,'Acquired prion disease'),('dementia',1,'^ESCTAG324065',NULL,'Age-related degeneration of brain'),('dementia',1,'^ESCTAL266745',NULL,'Alzheimers dementia, early onset, with depressed mood'),('dementia',1,'^ESCTAL292995',NULL,'Alzheimers dementia, late onset, with depressive mood'),('dementia',1,'^ESCTAL339290',NULL,'Alzheimers dementia, late onset, with delusions'),('dementia',1,'^ESCTAL802462',NULL,'Altered behaviour co-occurrent and due to Picks disease'),
('dementia',1,'^ESCTAL802463',NULL,'Altered behavior co-occurrent and due to Picks disease'),('dementia',1,'^ESCTAL802464',NULL,'Altered behaviour in Huntingtons dementia'),('dementia',1,'^ESCTAL802465',NULL,'Altered behavior in Huntingtons dementia'),('dementia',1,'^ESCTAL802466',NULL,'Altered behavior in dementia due to Huntington chorea'),('dementia',1,'^ESCTAL803079',NULL,'Altered behaviour in Alzheimers disease'),('dementia',1,'^ESCTAL803080',NULL,'Altered behavior in Alzheimers disease'),('dementia',1,'^ESCTAL803081',NULL,'Altered behavior in Alzheimer disease'),('dementia',1,'^ESCTAL803082',NULL,'Altered behavior in Alzheimers disease'),('dementia',1,'^ESCTAL804495',NULL,'Alzheimers dementia with depressed mood'),('dementia',1,'^ESCTAL804498',NULL,'Alzheimers disease co-occurrent with delirium'),('dementia',1,'^ESCTAM416492',NULL,'Amelocerebrohypohidrotic syndrome'),('dementia',1,'^ESCTBE775512',NULL,'Behavioural variant of frontotemporal dementia'),('dementia',1,'^ESCTBE775513',NULL,'Behavioral variant of frontotemporal dementia'),('dementia',1,'^ESCTBE989613',NULL,'Behavioural disturbance co-occurrent and due to late onset Alzheimer dementia'),('dementia',1,'^ESCTBE989614',NULL,'Behavioral disturbance co-occurrent and due to late onset Alzheimer dementia'),('dementia',1,'^ESCTCH755962',NULL,'CHMP2B-related frontotemporal dementia'),('dementia',1,'^ESCTCH755964',NULL,'Chromosome 3-linked frontotemporal dementia'),('dementia',1,'^ESCTDE257574',NULL,'Dementia of the Alzheimers type, with late onset, with delirium'),('dementia',1,'^ESCTDE257575',NULL,'Dementia Alzheimers type, late onset with delirium'),('dementia',1,'^ESCTDE260328',NULL,'Dementia of the Alzheimers type, with early onset, uncomplicated'),('dementia',1,'^ESCTDE266744',NULL,'Dementia of the Alzheimers type, with early onset, with depressive mood'),('dementia',1,'^ESCTDE292994',NULL,'Dementia of the Alzheimers type, with late onset, with depressive mood'),('dementia',1,'^ESCTDE338438',NULL,'Dementia of the Alzheimers type, with early onset, with delusions'),('dementia',1,'^ESCTDE339289',NULL,'Dementia of the Alzheimers type, with late onset, with delusions'),('dementia',1,'^ESCTDE355841',NULL,'Dementia of the Alzheimers type, with early onset, with delirium'),('dementia',1,'^ESCTDE357505',NULL,'Dementia of the Alzheimers type, with late onset, uncomplicated'),('dementia',1,'^ESCTDE384966',NULL,'Dementia paralytica juvenilis'),('dementia',1,'^ESCTDE751072',NULL,'Dementia associated with cerebral lipidosis'),('dementia',1,'^ESCTDE751073',NULL,'Dementia associated with normal pressure hydrocephalus'),('dementia',1,'^ESCTDE751074',NULL,'Dementia associated with multiple sclerosis'),('dementia',1,'^ESCTDE751196',NULL,'Dementia associated with neurosyphilis'),('dementia',1,'^ESCTDE751197',NULL,'Dementia associated with viral encephalitis'),('dementia',1,'^ESCTDE751279',NULL,'Dementia associated with cerebral anoxia'),('dementia',1,'^ESCTDE751507',NULL,'Dementia in remission'),('dementia',1,'^ESCTDE771038',NULL,'Dementia co-occurrent with human immunodeficiency virus infection'),('dementia',1,'^ESCTDE783882',NULL,'Dementia co-occurrent and due to neurocysticercosis'),('dementia',1,'^ESCTDE783883',NULL,'Dementia caused by toxin'),('dementia',1,'^ESCTDE783884',NULL,'Dementia due to metabolic abnormality'),('dementia',1,'^ESCTDE783885',NULL,'Dementia due to chromosomal anomaly'),('dementia',1,'^ESCTDE786113',NULL,'Dementia due to disorder of central nervous system'),('dementia',1,'^ESCTDE786114',NULL,'Dementia due to infectious disease'),('dementia',1,'^ESCTDE787476',NULL,'Delirium co-occurrent with dementia'),('dementia',1,'^ESCTDE787477',NULL,'Delirium superimposed on dementia'),('dementia',1,'^ESCTDE795509',NULL,'Dementia caused by heavy metal exposure'),('dementia',1,'^ESCTDE795510',NULL,'Dementia due to primary malignant neoplasm of brain'),('dementia',1,'^ESCTDE795511',NULL,'Dementia due to chronic subdural haematoma'),('dementia',1,'^ESCTDE795512',NULL,'Dementia due to chronic subdural hematoma'),('dementia',1,'^ESCTDE795513',NULL,'Dementia due to herpes encephalitis'),('dementia',1,'^ESCTDE795514',NULL,'Dementia with progressive multifocal leukoencephalopathy'),('dementia',1,'^ESCTDE795515',NULL,'Dementia co-occurrent and due to progressive multifocal leukoencephalopathy'),('dementia',1,'^ESCTDE795516',NULL,'Dementia with Down syndrome'),('dementia',1,'^ESCTDE795517',NULL,'Dementia co-occurrent and due to Down syndrome'),('dementia',1,'^ESCTDE796928',NULL,'Dementia of the Alzheimer type with behavioural disturbance'),('dementia',1,'^ESCTDE796929',NULL,'Dementia of the Alzheimer type with behavioral disturbance'),('dementia',1,'^ESCTDE796937',NULL,'Dementia with behavioural disturbance'),('dementia',1,'^ESCTDE796938',NULL,'Dementia with behavioral disturbance'),('dementia',1,'^ESCTDE802467',NULL,'Dementia due to multiple sclerosis with altered behaviour'),('dementia',1,'^ESCTDE802468',NULL,'Dementia due to multiple sclerosis with altered behavior'),('dementia',1,'^ESCTDE803175',NULL,'Dementia due to Parkinsons disease'),('dementia',1,'^ESCTDE803176',NULL,'Dementia due to Parkinsons disease'),('dementia',1,'^ESCTDE803177',NULL,'Dementia due to Parkinson disease'),('dementia',1,'^ESCTDE804101',NULL,'Dementia due to Retts syndrome'),('dementia',1,'^ESCTDE804491',NULL,'Delusions in Alzheimers disease'),('dementia',1,'^ESCTDE804492',NULL,'Delusions in Alzheimers disease'),('dementia',1,'^ESCTDE804493',NULL,'Delusions in Alzheimer disease'),('dementia',1,'^ESCTDE804494',NULL,'Depressed mood in Alzheimers disease'),('dementia',1,'^ESCTDE804496',NULL,'Depressed mood in Alzheimer disease'),('dementia',1,'^ESCTDI264906',NULL,'Dialysis dementia'),('dementia',1,'^ESCTDI264907',NULL,'Dialysis encephalopathy syndrome'),('dementia',1,'^ESCTDI264908',NULL,'Dialysis encephalopathy'),('dementia',1,'^ESCTEA801440',NULL,'Early onset dementia with delusions'),('dementia',1,'^ESCTEA803291',NULL,'Early onset Alzheimers disease with behavioural disturbance'),('dementia',1,'^ESCTEA803292',NULL,'Early onset Alzheimers disease with behavioral disturbance'),('dementia',1,'^ESCTEA803293',NULL,'Early onset Alzheimers disease with behavioral disturbance'),('dementia',1,'^ESCTEA803294',NULL,'Early onset Alzheimer disease with behavioral disturbance'),('dementia',1,'^ESCTEP416490',NULL,'Epilepsy, dementia and amelogenesis imperfecta'),('dementia',1,'^ESCTEP416491',NULL,'Epilepsy, mental deterioration and yellow teeth'),('dementia',1,'^ESCTEP802469',NULL,'Epileptic dementia with behavioural disturbance'),('dementia',1,'^ESCTEP802470',NULL,'Epileptic dementia with behavioral disturbance'),('dementia',1,'^ESCTFA385338',NULL,'Fatal familial insomnia'),('dementia',1,'^ESCTFA385340',NULL,'Familial fatal insomnia'),('dementia',1,'^ESCTFA756028',NULL,'Familial encephalopathy with neuroserpin inclusion bodies'),('dementia',1,'^ESCTFA756029',NULL,'Familial dementia with neuroserpin inclusion bodies'),('dementia',1,'^ESCTFA756054',NULL,'Familial Picks disease'),('dementia',1,'^ESCTFA773790',NULL,'Familial Creutzfeldt-Jakob'),('dementia',1,'^ESCTFA781383',NULL,'Familial Alzheimer-like prion disease'),('dementia',1,'^ESCTFC773791',NULL,'fCJD (Familial Creutzfeldt-Jakob disease)'),('dementia',1,'^ESCTFF385339',NULL,'FFI - Familial fatal insomnia'),('dementia',1,'^ESCTFR755963',NULL,'Frontotemporal dementia with gene located on 3p11'),('dementia',1,'^ESCTFR756041',NULL,'Frontotemporal lobar degeneration'),('dementia',1,'^ESCTFR756053',NULL,'Frontotemporal dementia with parkinsonism-17'),('dementia',1,'^ESCTFT756057',NULL,'FTDP-17 - Frontotemporal dementia with parkinsonism 17'),('dementia',1,'^ESCTGR756039',NULL,'GRN-related frontotemporal dementia'),('dementia',1,'^ESCTHA797312',NULL,'Hallucinations co-occurrent and due to late onset dementia'),('dementia',1,'^ESCTHE756040',NULL,'Hereditary dysphasic disinhibition dementia'),('dementia',1,'^ESCTIA773559',NULL,'Iatrogenic Jakob-Creutzfeldt disease'),('dementia',1,'^ESCTIA773560',NULL,'Iatrogenic Creutzfeldt-Jakob disease'),('dementia',1,'^ESCTIB757762',NULL,'IBMPFD - Inclusion body myopathy with early onset Paget disease and frontotemporal dementia'),('dementia',1,'^ESCTIN302942',NULL,'Inhalant-induced persisting dementia'),('dementia',1,'^ESCTIN757757',NULL,'Inclusion body myopathy with early-onset Paget disease and frontotemporal dementia'),('dementia',1,'^ESCTIN773792',NULL,'Inherited Creutzfeldt-Jakob disease'),('dementia',1,'^ESCTIS784063',NULL,'Ischaemic vascular dementia'),('dementia',1,'^ESCTIS784064',NULL,'Ischemic vascular dementia'),('dementia',1,'^ESCTMI802420',NULL,'Mixed dementia'),('dementia',1,'^ESCTMU266460',NULL,'Multi-infarct dementia with delirium'),('dementia',1,'^ESCTMU266462',NULL,'Multi infarct dementia with delirium'),('dementia',1,'^ESCTMU272293',NULL,'Multi-infarct dementia with depression'),('dementia',1,'^ESCTMU291232',NULL,'Multi-infarct dementia with delusions'),('dementia',1,'^ESCTMU291234',NULL,'Multi infarct dementia with delusions'),('dementia',1,'^ESCTMU365367',NULL,'Multi-infarct dementia, uncomplicated'),('dementia',1,'^ESCTMU365369',NULL,'Multi infarct dementia, uncomplicated'),('dementia',1,'^ESCTMU803324',NULL,'Multi-infarct dementia due to atherosclerosis'),('dementia',1,'^ESCTMU803325',NULL,'Multi infarct dementia with atherosclerosis'),('dementia',1,'^ESCTNO783407',NULL,'Non-amnestic Alzheimer disease'),('dementia',1,'^ESCTOR695730',NULL,'Organic dementia associated with AIDS'),('dementia',1,'^ESCTOR695731',NULL,'Organic dementia associated with acquired immunodeficiency syndrome'),('dementia',1,'^ESCTPA773701',NULL,'Parkinsonism with dementia of Guadeloupe'),('dementia',1,'^ESCTPA773702',NULL,'Parkinsonism co-occurrent with dementia of Guadeloupe'),('dementia',1,'^ESCTPO751142',NULL,'Post-traumatic dementia with behavioural change'),('dementia',1,'^ESCTPO751143',NULL,'Post-traumatic dementia with behavioral change'),
('dementia',1,'^ESCTPR257573',NULL,'Primary degenerative dementia of the Alzheimer type, senile onset, with delirium'),('dementia',1,'^ESCTPR260327',NULL,'Primary degenerative dementia of the Alzheimer type, presenile onset, uncomplicated'),('dementia',1,'^ESCTPR266743',NULL,'Primary degenerative dementia of the Alzheimer type, presenile onset, with depression'),('dementia',1,'^ESCTPR292993',NULL,'Primary degenerative dementia of the Alzheimer type, senile onset, with depression'),('dementia',1,'^ESCTPR338437',NULL,'Primary degenerative dementia of the Alzheimer type, presenile onset, with delusions'),('dementia',1,'^ESCTPR339288',NULL,'Primary degenerative dementia of the Alzheimer type, senile onset, with delusions'),('dementia',1,'^ESCTPR355840',NULL,'Primary degenerative dementia of the Alzheimer type, presenile onset, with delirium'),('dementia',1,'^ESCTPR357504',NULL,'Primary degenerative dementia of the Alzheimer type, senile onset, uncomplicated'),('dementia',1,'^ESCTPR696469',NULL,'Presenile dementia associated with AIDS'),('dementia',1,'^ESCTPR696470',NULL,'Presenile dementia associated with acquired immunodeficiency syndrome'),('dementia',1,'^ESCTPR751512',NULL,'Primary degenerative dementia of the Alzheimer type, senile onset in remission'),('dementia',1,'^ESCTPR751513',NULL,'Primary degenerative dementia of the Alzheimer type, presenile onset in remission'),('dementia',1,'^ESCTPR770469',NULL,'Presenile dementia co-occurrent with human immunodeficiency virus infection'),('dementia',1,'^ESCTPR801439',NULL,'Presenile dementia with delusions'),('dementia',1,'^ESCTPS419613',NULL,'Psychoactive substance-induced organic dementia'),('dementia',1,'^ESCTPS419614',NULL,'Psychoactive substance induced dementia'),('dementia',1,'^ESCTRA784352',NULL,'Rapidly progressive dementia'),('dementia',1,'^ESCTRI775042',NULL,'Right temporal atrophy variant frontotemporal dementia'),('dementia',1,'^ESCTSE634803',NULL,'Senile dementia with delusion'),('dementia',1,'^ESCTSE634804',NULL,'Senile delusion'),('dementia',1,'^ESCTVA266461',NULL,'Vascular dementia, with delirium'),('dementia',1,'^ESCTVA272294',NULL,'Vascular dementia, with depressive mood'),('dementia',1,'^ESCTVA291233',NULL,'Vascular dementia, with delusions'),('dementia',1,'^ESCTVA365368',NULL,'Vascular dementia, uncomplicated'),('dementia',1,'^ESCTVA751506',NULL,'Vascular dementia in remission'),('dementia',1,'^ESCTVA808923',NULL,'Vascular dementia with behavioural disturbance'),('dementia',1,'^ESCTVA808924',NULL,'Vascular dementia with behavioral disturbance'),('dementia',1,'^ESCTVA990225',NULL,'Vascular dementia without behavioural disturbance'),('dementia',1,'^ESCTVA990226',NULL,'Vascular dementia without behavioral disturbance')

INSERT INTO #AllCodes
SELECT [concept], [version], [code], [description] from #codesemis;


IF OBJECT_ID('tempdb..#TempRefCodes') IS NOT NULL DROP TABLE #TempRefCodes;
CREATE TABLE #TempRefCodes (FK_Reference_Coding_ID BIGINT NOT NULL, concept VARCHAR(255) NOT NULL, version INT NOT NULL, [description] VARCHAR(255));

-- Read v2 codes
INSERT INTO #TempRefCodes
SELECT PK_Reference_Coding_ID, dcr.concept, dcr.[version], dcr.[description]
FROM [SharedCare].[Reference_Coding] rc
INNER JOIN #codesreadv2 dcr on dcr.code = rc.MainCode
WHERE CodingType='ReadCodeV2'
AND (dcr.term IS NULL OR dcr.term = rc.Term)
and PK_Reference_Coding_ID != -1;

-- CTV3 codes
INSERT INTO #TempRefCodes
SELECT PK_Reference_Coding_ID, dcc.concept, dcc.[version], dcc.[description]
FROM [SharedCare].[Reference_Coding] rc
INNER JOIN #codesctv3 dcc on dcc.code = rc.MainCode
WHERE CodingType='CTV3'
and PK_Reference_Coding_ID != -1;

-- EMIS codes with a FK Reference Coding ID
INSERT INTO #TempRefCodes
SELECT FK_Reference_Coding_ID, ce.concept, ce.[version], ce.[description]
FROM [SharedCare].[Reference_Local_Code] rlc
INNER JOIN #codesemis ce on ce.code = rlc.LocalCode
WHERE FK_Reference_Coding_ID != -1;

IF OBJECT_ID('tempdb..#TempSNOMEDRefCodes') IS NOT NULL DROP TABLE #TempSNOMEDRefCodes;
CREATE TABLE #TempSNOMEDRefCodes (FK_Reference_SnomedCT_ID BIGINT NOT NULL, concept VARCHAR(255) NOT NULL, [version] INT NOT NULL, [description] VARCHAR(255));

-- SNOMED codes
INSERT INTO #TempSNOMEDRefCodes
SELECT PK_Reference_SnomedCT_ID, dcs.concept, dcs.[version], dcs.[description]
FROM SharedCare.Reference_SnomedCT rs
INNER JOIN #codessnomed dcs on dcs.code = rs.ConceptID;

-- EMIS codes with a FK SNOMED ID but without a FK Reference Coding ID
INSERT INTO #TempSNOMEDRefCodes
SELECT FK_Reference_SnomedCT_ID, ce.concept, ce.[version], ce.[description]
FROM [SharedCare].[Reference_Local_Code] rlc
INNER JOIN #codesemis ce on ce.code = rlc.LocalCode
WHERE FK_Reference_Coding_ID = -1
AND FK_Reference_SnomedCT_ID != -1;

-- De-duped tables
IF OBJECT_ID('tempdb..#CodeSets') IS NOT NULL DROP TABLE #CodeSets;
CREATE TABLE #CodeSets (FK_Reference_Coding_ID BIGINT NOT NULL, concept VARCHAR(255) NOT NULL, [description] VARCHAR(255));

IF OBJECT_ID('tempdb..#SnomedSets') IS NOT NULL DROP TABLE #SnomedSets;
CREATE TABLE #SnomedSets (FK_Reference_SnomedCT_ID BIGINT NOT NULL, concept VARCHAR(255) NOT NULL, [description] VARCHAR(255));

IF OBJECT_ID('tempdb..#VersionedCodeSets') IS NOT NULL DROP TABLE #VersionedCodeSets;
CREATE TABLE #VersionedCodeSets (FK_Reference_Coding_ID BIGINT NOT NULL, Concept VARCHAR(255), [Version] INT, [description] VARCHAR(255));

IF OBJECT_ID('tempdb..#VersionedSnomedSets') IS NOT NULL DROP TABLE #VersionedSnomedSets;
CREATE TABLE #VersionedSnomedSets (FK_Reference_SnomedCT_ID BIGINT NOT NULL, Concept VARCHAR(255), [Version] INT, [description] VARCHAR(255));

INSERT INTO #VersionedCodeSets
SELECT DISTINCT * FROM #TempRefCodes;

INSERT INTO #VersionedSnomedSets
SELECT DISTINCT * FROM #TempSNOMEDRefCodes;

INSERT INTO #CodeSets
SELECT FK_Reference_Coding_ID, c.concept, [description]
FROM #VersionedCodeSets c
INNER JOIN (
  SELECT concept, MAX(version) AS maxVersion FROM #VersionedCodeSets
  GROUP BY concept)
sub ON sub.concept = c.concept AND c.version = sub.maxVersion;

INSERT INTO #SnomedSets
SELECT FK_Reference_SnomedCT_ID, c.concept, [description]
FROM #VersionedSnomedSets c
INNER JOIN (
  SELECT concept, MAX(version) AS maxVersion FROM #VersionedSnomedSets
  GROUP BY concept)
sub ON sub.concept = c.concept AND c.version = sub.maxVersion;

--#endregion

-- >>> Following code sets injected: dementia v1

-- table of dementia coding events

IF OBJECT_ID('tempdb..#DementiaCodes') IS NOT NULL DROP TABLE #DementiaCodes;
SELECT FK_Patient_Link_ID AS PatientId, EventDate, COUNT(*) AS NumberOfDementiaCodes
INTO #DementiaCodes
FROM SharedCare.GP_Events
WHERE (
  FK_Reference_Coding_ID IN (SELECT FK_Reference_Coding_ID FROM #VersionedCodeSets WHERE Concept = 'dementia' AND Version = 1) OR
  FK_Reference_SnomedCT_ID IN (SELECT FK_Reference_SnomedCT_ID FROM #VersionedSnomedSets WHERE Concept = 'dementia' AND Version = 1)
)
AND EventDate >= '2006-01-01' -- when dementia was added to QOF
GROUP BY FK_Patient_Link_ID, EventDate

-- create cohort of patients with a dementia diagnosis in the study period

IF OBJECT_ID('tempdb..#Cohort') IS NOT NULL DROP TABLE #Cohort;
SELECT
	 p.FK_Patient_Link_ID
	,yob.YearOfBirth
	,p.EthnicGroupDescription 
	,p.DeathDate
INTO #Cohort
FROM #Patients p
LEFT OUTER JOIN #PatientYearOfBirth yob ON yob.FK_Patient_Link_ID = p.FK_Patient_Link_ID
WHERE p.FK_Patient_Link_ID IN 
	(SELECT DISTINCT PatientId
	 FROM #DementiaCodes
	 WHERE NumberOfDementiaCodes >= 1)
AND YEAR(@StartDate) - YearOfBirth > 18


---------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------
---------------------------------------------------------------------------------------------------------------

----------------------------------------------------------------------------------------

-- REDUCE THE #Patients TABLE SO THAT IT ONLY INCLUDES THE COHORT, AND REUSABLE QUERIES CAN USE IT TO BE RUN QUICKER 

DELETE FROM #Patients
WHERE FK_Patient_Link_ID NOT IN (SELECT FK_Patient_Link_ID FROM #Cohort)

--------------------- IDENTIFY GP ENCOUNTERS -------------------------

--┌───────────────────────┐
--│ Patient GP encounters │
--└───────────────────────┘

-- OBJECTIVE: To produce a table of GP encounters for a list of patients.
-- This script uses many codes related to observations (e.g. blood pressure), symptoms, and diagnoses, to infer when GP encounters occured.
-- This script includes face to face and telephone encounters - it will need copying and editing if you don't require both.

-- ASSUMPTIONS:
--	- multiple codes on the same day will be classed as one encounter (so max daily encounters per patient is 1)

-- INPUT: Assumes there exists a temp table as follows:
-- #Patients (FK_Patient_Link_ID)
--  A distinct list of FK_Patient_Link_IDs for each patient in the cohort

-- Also takes parameters:
--	-	all-patients: boolean - (true/false) if true, then all patients are included, otherwise only those in the pre-existing #Patients table.
--	- gp-events-table: string - (table name) the name of the table containing the GP events. Usually is "RLS.vw_GP_Events" but can be anything with the columns: FK_Patient_Link_ID, EventDate, FK_Reference_Coding_ID, and FK_Reference_SnomedCT_ID
--  - start-date: string - (YYYY-MM-DD) the date to count encounters from.
--  - end-date: string - (YYYY-MM-DD) the date to count encounters to.


-- OUTPUT: A temp table as follows:
-- #GPEncounters (FK_Patient_Link_ID, EncounterDate)
--	- FK_Patient_Link_ID - unique patient id
--	- EncounterDate - date the patient had a GP encounter


-- Create a table with all GP encounters ========================================================================================================

IF OBJECT_ID('tempdb..#CodingClassifier') IS NOT NULL DROP TABLE #CodingClassifier;
SELECT 'Face2face' AS EncounterType, PK_Reference_Coding_ID, FK_Reference_SnomedCT_ID
INTO #CodingClassifier
FROM SharedCare.Reference_Coding
WHERE CodingType='ReadCodeV2'
AND (
	MainCode like '1%'
	or MainCode like '2%'
	or MainCode in ('6A2..','6A9..','6AA..','6AB..','662d.','662e.','66AS.','66AS0','66AT.','66BB.','66f0.','66YJ.','66YM.','661Q.','66480','6AH..','6A9..','66p0.','6A2..','66Ay.','66Az.','69DC.')
	or MainCode like '6A%'
	or MainCode like '65%'
	or MainCode like '8B31[356]%'
	or MainCode like '8B3[3569ADEfilOqRxX]%'
	or MainCode in ('8BS3.')
	or MainCode like '8H[4-8]%' 
	or MainCode like '94Z%'
	or MainCode like '9N1C%' 
	or MainCode like '9N21%'
	or MainCode in ('9kF1.','9kR..','9HB5.')
	or MainCode like '9H9%'
);

INSERT INTO #CodingClassifier
SELECT 'Telephone', PK_Reference_Coding_ID, FK_Reference_SnomedCT_ID
FROM SharedCare.Reference_Coding
WHERE CodingType='ReadCodeV2'
AND (
	MainCode like '8H9%'
	or MainCode like '9N31%'
	or MainCode like '9N3A%'
);

-- Add the equivalent CTV3 codes
INSERT INTO #CodingClassifier
SELECT 'Face2face', PK_Reference_Coding_ID, FK_Reference_SnomedCT_ID FROM SharedCare.Reference_Coding
WHERE FK_Reference_SnomedCT_ID IN (SELECT FK_Reference_SnomedCT_ID FROM #CodingClassifier WHERE EncounterType='Face2face' AND FK_Reference_SnomedCT_ID != -1)
AND CodingType='CTV3';

INSERT INTO #CodingClassifier
SELECT 'Telephone', PK_Reference_Coding_ID, FK_Reference_SnomedCT_ID FROM SharedCare.Reference_Coding
WHERE FK_Reference_SnomedCT_ID IN (SELECT FK_Reference_SnomedCT_ID FROM #CodingClassifier WHERE EncounterType='Telephone' AND FK_Reference_SnomedCT_ID != -1)
AND CodingType='CTV3';

-- Add the equivalent EMIS codes
INSERT INTO #CodingClassifier
SELECT 'Face2face', FK_Reference_Coding_ID, FK_Reference_SnomedCT_ID FROM SharedCare.Reference_Local_Code
WHERE (
	FK_Reference_SnomedCT_ID IN (SELECT FK_Reference_SnomedCT_ID FROM #CodingClassifier WHERE EncounterType='Face2face' AND FK_Reference_SnomedCT_ID != -1) OR
	FK_Reference_Coding_ID IN (SELECT PK_Reference_Coding_ID FROM #CodingClassifier WHERE EncounterType='Face2face' AND PK_Reference_Coding_ID != -1)
);
INSERT INTO #CodingClassifier
SELECT 'Telephone', FK_Reference_Coding_ID, FK_Reference_SnomedCT_ID FROM SharedCare.Reference_Local_Code
WHERE (
	FK_Reference_SnomedCT_ID IN (SELECT FK_Reference_SnomedCT_ID FROM #CodingClassifier WHERE EncounterType='Telephone' AND FK_Reference_SnomedCT_ID != -1) OR
	FK_Reference_Coding_ID IN (SELECT PK_Reference_Coding_ID FROM #CodingClassifier WHERE EncounterType='Telephone' AND PK_Reference_Coding_ID != -1)
);

-- All above takes ~30s

IF OBJECT_ID('tempdb..#GPEncounters') IS NOT NULL DROP TABLE #GPEncounters;
CREATE TABLE #GPEncounters (
	FK_Patient_Link_ID BIGINT,
	EncounterDate DATE
);

BEGIN
  IF 'false'='true'
    INSERT INTO #GPEncounters 
    SELECT DISTINCT FK_Patient_Link_ID, CAST(EventDate AS DATE) AS EncounterDate
    FROM SharedCare.GP_Events
    WHERE 
      FK_Reference_Coding_ID IN (SELECT PK_Reference_Coding_ID FROM #CodingClassifier WHERE PK_Reference_Coding_ID != -1)
      AND EventDate BETWEEN '2006-01-01' AND '2023-10-31'
  ELSE 
    INSERT INTO #GPEncounters 
    SELECT DISTINCT FK_Patient_Link_ID, CAST(EventDate AS DATE) AS EncounterDate
    FROM SharedCare.GP_Events
    WHERE 
      FK_Patient_Link_ID IN (SELECT FK_Patient_Link_ID FROM #Patients)
      AND FK_Reference_Coding_ID IN (SELECT PK_Reference_Coding_ID FROM #CodingClassifier WHERE PK_Reference_Coding_ID != -1)
      AND EventDate BETWEEN '2006-01-01' AND '2023-10-31'
  END

------------ FIND ALL GP ENCOUNTERS FOR COHORT
SELECT PatientId = FK_Patient_Link_ID,
	[Year] = YEAR(EncounterDate), 
	GPEncounters = COUNT(*)
FROM #GPEncounters
GROUP BY FK_Patient_Link_ID, YEAR(EncounterDate)
ORDER BY FK_Patient_Link_ID, YEAR(EncounterDate)
