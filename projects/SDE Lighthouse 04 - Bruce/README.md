_This file is autogenerated. Please do not edit._

# _TODO_ - project title

## Summary

**TODO** edit `about.md` to insert a brief lay summary of the work.

## Table of contents

- [Introduction](#introduction)
- [Methodology](#methodology)
- [Reusable queries](#reusable-queries)
- [Clinical code sets](#clinical-code-sets)

## Introduction

The aim of this document is to provide full transparency for all parts of the data extraction process.
This includes:

- The methodology around how the data extraction process is managed and quality is maintained.
- A full list of all queries used in the extraction, and their associated objectives and assumptions.
- A full list of all clinical codes used for the extraction.

## Methodology

After each proposal is approved, a Research Data Engineer (RDE) works closely with the research team to establish precisely what data they require and in what format.
The RDE has access to the entire de-identified database and so builds up an expertise as to which projects are feasible and how best to extract the relevant data.
The RDE has access to a library of resusable SQL queries for common tasks, and sets of clinical codes for different phenotypes, built up from previous studies.
Prior to data extraction, the code is checked and signed off by another RDE.

## Reusable queries
  
This project required the following reusable queries:

- Define Cohort for LH004: patients that had an SLE diagnosis
- Year of birth
- Create table of patients who are registered with a GM GP

Further details for each query can be found below.

### Define Cohort for LH004: patients that had an SLE diagnosis
To build the cohort of patients needed for LH004. This reduces duplication of code in the template scripts.

_Input_
```
None
```

_Output_
```
Temp tables as follows:
 #Cohort
```
_File_: `query-build-lh004-cohort.sql`

_Link_: [https://github.com/rw251/.../query-build-lh004-cohort.sql](https://github.com/rw251/gm-idcr/tree/master/shared/Reusable%20queries%20for%20data%20extraction/query-build-lh004-cohort.sql)

---
### Year of birth
To get the year of birth for each patient.

_Assumptions_

- Patient data is obtained from multiple sources. Where patients have multiple YOBs we determine the YOB as follows:
- If the patients has a YOB in their primary care data feed we use that as most likely to be up to date
- If every YOB for a patient is the same, then we use that
- If there is a single most recently updated YOB in the database then we use that
- Otherwise we take the highest YOB for the patient that is not in the future

_Input_
```
Assumes there exists a temp table as follows:
 #Patients (FK_Patient_Link_ID)
  A distinct list of FK_Patient_Link_IDs for each patient in the cohort
```

_Output_
```
A temp table as follows:
 #PatientYearOfBirth (FK_Patient_Link_ID, YearOfBirth)
 	- FK_Patient_Link_ID - unique patient id
	- YearOfBirth - INT
```
_File_: `query-patient-year-of-birth.sql`

_Link_: [https://github.com/rw251/.../query-patient-year-of-birth.sql](https://github.com/rw251/gm-idcr/tree/master/shared/Reusable%20queries%20for%20data%20extraction/query-patient-year-of-birth.sql)

---
### Create table of patients who are registered with a GM GP
undefined

_Input_
```
undefined
```

_Output_
```
undefined
```
_File_: `query-get-possible-patients.sql`

_Link_: [https://github.com/rw251/.../query-get-possible-patients.sql](https://github.com/rw251/gm-idcr/tree/master/shared/Reusable%20queries%20for%20data%20extraction/query-get-possible-patients.sql)
## Clinical code sets

This project required the following clinical code sets:

- sle v1
- lupus-nephritis v1
- ckd-stage-1 v1
- ckd-stage-2 v1
- ckd-stage-3 v1
- ckd-stage-4 v1
- ckd-stage-5 v1
- belimumab v1
- hydroxychloroquine v1
- chloroquine v1
- tuberculosis v1
- hepatitis-a v1
- hepatitis-b v1
- hepatitis-c v1
- hepatitis-d v1
- infections v1
- flu-vaccination v1
- covid-vaccination v1
- pneumococcal-vaccination v1
- shingles-vaccination v1

Further details for each code set can be found below.

### Systemic Lupus Erythematosus (SLE)

Codes from: https://www.opencodelists.org/codelist/opensafely/systemic-lupus-erythematosus-sle/2020-05-12/#full-list

Includes codes for other diagnoses that are "due to" or "caused by" SLE.

Does not include lupus limited to the skin e.g. chronic cutaneous lupus erythematosus (aka discoid lupus erythematosus), subacute cutaneous lupus erythematosus, chilblain lupus, tumid lupus.
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set.

The prevalence range `0.11% - 0.125%` suggests that this code set is well defined.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2023-10-03 | EMIS            | 2469004    |    4340 (0.176%) |     2866 (0.116%) |
| 2023-10-03 | TPP             | 200687     |     326 (0.162%) |      209 (0.104%) |
| 2023-10-03 | Vision          | 332247     |     712 (0.214%) |      420 (0.126%) |
| 2024-01-19 | EMIS            | 2519438    |    2912 (0.116%) |     2913 (0.116%) |
| 2024-01-19 | TPP             | 201469     |     215 (0.107%) |      215 (0.107%) |
| 2024-01-19 | Vision          | 334528     |     419 (0.125%) |      419 (0.125%) |
#### Audit log

- Find_missing_codes last run 2024-01-19

LINK: [https://github.com/rw251/.../conditions/sle/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/conditions/sle/1)

### Lupus nephritis

Any diagnosis of lupus nephritis.
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `0.005 - 0.009%` suggests that this code set is well defined, but not frequently used in primary care.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2024-08-21 | EMIS            | 2538487    |   195 (0.00768%) |    195 (0.00768%) |
| 2024-08-21 | TPP             | 202116     |     19 (0.0094%) |      19 (0.0094%) |
| 2024-08-21 | Vision          | 336479     |    18 (0.00535%) |     17 (0.00505%) |
#### Audit log

- Find_missing_codes last run 2024-08-16

LINK: [https://github.com/rw251/.../conditions/lupus-nephritis/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/conditions/lupus-nephritis/1)

### Chronic kidney disease (CKD) - Stage 1 - diagnosis codes

Developed from https://getset.ga.

#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `% - %` suggests that this code set is well defined.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2022-04-06 | EMIS            | 2660237    |   (%)   |    (%)   |
| 2022-04-06 | TPP             | 212647     |   (%)   |    (%)   |
| 2022-04-06 | Vision          | 341912     |   (%)   |    (%)   |
LINK: [https://github.com/rw251/.../conditions/ckd-stage-1/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/conditions/ckd-stage-1/1)

### Chronic kidney disease stage 2

Codes taken from the general CKD code set
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `% - %` suggests that this code set is well defined.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2022-04-06 | EMIS            | 2660237    |   (%)   |    (%)   |
| 2022-04-06 | TPP             | 212647     |   (%)   |    (%)   |
| 2022-04-06 | Vision          | 341912     |   (%)   |    (%)   |
LINK: [https://github.com/rw251/.../conditions/ckd-stage-2/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/conditions/ckd-stage-2/1)

### Chronic kidney disease (CKD) stage 3

Codes showing a diagnosis of stage 3 CKD.
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `2.9% - 3.2%` for EMIS and Vision suggests that this code set is well defined. TPP practices are a bit higher at `4.3%` which may be down to the way CKD is recorded there.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2023-10-31 | EMIS            | 2472595    |    72486 (2.93%) |     72556 (2.93%) |
| 2023-10-31 | TPP             | 200603     |      8619 (4.3%) |       8619 (4.3%) |
| 2023-10-31 | Vision          | 332447     |    10540 (3.17%) |     10551 (3.17%) |
#### Audit log

- Find_missing_codes last run 2023-10-31

LINK: [https://github.com/rw251/.../conditions/ckd-stage-3/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/conditions/ckd-stage-3/1)

### Chronic kidney disease (CKD) stage 4 codes

Codes showing a diagnosis of stage 4 CKD.
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `0.21% - 0.22%` suggests that this code set is well defined.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2023-10-31 | EMIS            | 2472595    |    5456 (0.221%) |     5465 (0.221%) |
| 2023-10-31 | TPP             | 200603     |     444 (0.221%) |      444 (0.221%) |
| 2023-10-31 | Vision          | 332447     |     682 (0.205%) |      682 (0.205%) |
#### Audit log

- Find_missing_codes last run 2023-10-31

LINK: [https://github.com/rw251/.../conditions/ckd-stage-4/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/conditions/ckd-stage-4/1)

### Chronic kidney disease (CKD) stage 5

Codes showing a diagnosis of stage 5 CKD. Also includes codes for "end stage renal failure".
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `0.075% - 0.085%` suggests that this code set is well defined.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2023-10-31 | EMIS            | 2472595    |   2099 (0.0849%) |     2101 (0.085%) |
| 2023-10-31 | TPP             | 200603     |    151 (0.0753%) |     151 (0.0753%) |
| 2023-10-31 | Vision          | 332447     |    247 (0.0743%) |     248 (0.0746%) |
#### Audit log

- Find_missing_codes last run 2023-10-31

LINK: [https://github.com/rw251/.../conditions/ckd-stage-5/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/conditions/ckd-stage-5/1)

### Belimumab

Any prescription of Belimumab (brand name: Benlysta)

This code set has been generated by searching for belimumab or benlysta in the BNF files. The BNF codes are then mapped to SNOMED, and then on to EMIS, Readv2 and CTV3.
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `0% - 0%` suggests that this code set is either incomplete or this medication is unused in primary care.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2024-05-09 | EMIS | 2516912 | 7 (0.000278%) | 7 (0.000278%) | 
| 2024-05-09 | TPP | 200013 | 0 (0%) | 0 (0%) | 
| 2024-05-09 | Vision | 334384 | 1 (0.000299%) | 1 (0.000299%) | 


LINK: [https://github.com/rw251/.../medications/belimumab/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/medications/belimumab/1)

### Hydroxychloroquine

Any prescription of hydroxychloroquine. Other names: Quinoric/Hydrochloroquine/Plaquenil.

This code set originally created by identifying the relevant codes in the BNF files. The BNF codes are then mapped to SNOMED, and then on to EMIS, Readv2 and CTV3. Subsequently extended by searching the SNOMED, CTV3 and Readv2 hierarchies for the main name and the brand equivalents, then mapped to EMIS codes.
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `0.46% - 0.62%` suggests this is probably well defined.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2021-03-31 | EMIS            | 2604007    |    12974 (0.50%) |     12974 (0.50%) |
| 2021-03-31 | TPP             | 210535     |      787 (0.37%) |       787 (0.37%) |
| 2021-03-31 | Vision          | 333730     |     2056 (0.62%) |      2056 (0.62%) |
| 2024-07-04 | EMIS            | 2534135    |   12003 (0.474%) |    12003 (0.474%) |
| 2024-07-04 | TPP             | 202036     |     938 (0.464%) |      938 (0.464%) |
| 2024-07-04 | Vision          | 335836     |    2074 (0.618%) |     2074 (0.618%) |

LINK: [https://github.com/rw251/.../medications/hydroxychloroquine/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/medications/hydroxychloroquine/1)

### Chloroquine

Any prescription of chloroquine. Other names: Avloclor/Malarivon/Nivaquine.

This code set originally created by identifying the relevant codes in the BNF files. The BNF codes are then mapped to SNOMED, and then on to EMIS, Readv2 and CTV3. Subsequently extended by searching the SNOMED, CTV3 and Readv2 hierarchies for the main name and the brand equivalents, then mapped to EMIS codes.
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `0.26% - 0.33%` suggests this is probably well defined.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2024-07-04 | EMIS            | 2534135    |    6740 (0.266%) |     6740 (0.266%) |
| 2024-07-04 | TPP             | 202036     |     665 (0.329%) |      665 (0.329%) |
| 2024-07-04 | Vision          | 335836     |     869 (0.259%) |      869 (0.259%) |

LINK: [https://github.com/rw251/.../medications/chloroquine/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/medications/chloroquine/1)

### Tuberculosis

Any code indicating a diagnosis of tuberculosis. This code set was developed using the reference coding table in the GMCR environment, converting from ICD10 codes A15 - A19, followed by a complete cross reference check with SNOMED and mapping to other terminologies.
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `0.33 -0.46%` suggests that this code set is well defined.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2024-05-09 | EMIS            | 2516912    |   11598 (0.461%) |    11598 (0.461%) |
| 2024-05-09 | TPP             | 200013     |     689 (0.344%) |      689 (0.344%) |
| 2024-05-09 | Vision          | 334384     |    1058 (0.316%) |     1058 (0.316%) |
| 2024-07-16 | EMIS            | 2696332    |   125681 (4.66%) |    12455 (0.462%) |
| 2024-07-16 | TPP             | 215597     |    1346 (0.624%) |      767 (0.356%) |
| 2024-07-16 | Vision          | 351153     |    13197 (3.76%) |     1142 (0.325%) |

LINK: [https://github.com/rw251/.../conditions/tuberculosis/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/conditions/tuberculosis/1)

### Hepatitis A

Any code indicating that a patient has hepatitis A.
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `0.11% - 0.13%` for EMIS and Vision is sufficiently narrow that this code set is likely well defined. TPP is a lot lower, but possibly due to the coding of hepatitis often being non-specific (e.g. XaYbp - Viral hepatitis with hepatic coma).

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2024-07-16 | EMIS            | 2696332    |    4432 (0.164%) |     3016 (0.112%) |
| 2024-07-16 | TPP             | 215597     |    135 (0.0626%) |      32 (0.0148%) |
| 2024-07-16 | Vision          | 351153     |     663 (0.189%) |      460 (0.131%) |
#### Audit log

- Find_missing_codes last run 2024-07-17

LINK: [https://github.com/rw251/.../conditions/hepatitis-a/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/conditions/hepatitis-a/1)

### Hepatitis B

Any code indicating that a patient has hepatitis B. Also known as "serum hepatitis".
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `0.16% - 0.20%` for EMIS and Vision is sufficiently narrow that this code set is likely well defined. TPP is a lot lower, but possibly due to the coding of hepatitis often being non-specific (e.g. XaYbp - Viral hepatitis with hepatic coma).

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2024-07-17 | EMIS            | 2693087    |    8052 (0.299%) |     5262 (0.195%) |
| 2024-07-17 | TPP             | 215405     |      28 (0.013%) |      25 (0.0116%) |
| 2024-07-17 | Vision          | 350767     |     671 (0.191%) |      542 (0.155%) |
#### Audit log

- Find_missing_codes last run 2024-07-17

LINK: [https://github.com/rw251/.../conditions/hepatitis-b/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/conditions/hepatitis-b/1)

### Hepatitis C

Any code indicating that a patient has hepatitis C.
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `0.22% - 0.28%` for EMIS and Vision is sufficiently narrow that this code set is likely well defined. TPP is lower, but possibly due to the coding of hepatitis often being non-specific (e.g. XaYbp - Viral hepatitis with hepatic coma).

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2024-07-17 | EMIS            | 2693087    |   11023 (0.409%) |     7527 (0.279%) |
| 2024-07-17 | TPP             | 215405     |     363 (0.169%) |      247 (0.115%) |
| 2024-07-17 | Vision          | 350767     |    1572 (0.448%) |      787 (0.224%) |
#### Audit log

- Find_missing_codes last run 2024-07-17

LINK: [https://github.com/rw251/.../conditions/hepatitis-c/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/conditions/hepatitis-c/1)

### Hepatitis D

Any code indicating that a patient has hepatitis D. Also known as delta-agent hepatitis.
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `0% - 0.003%` suggests this has a very low prevalence, or is not well-recorded in primary care.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2024-07-16 | EMIS            | 2696332    |     29564 (1.1%) |     68 (0.00252%) |
| 2024-07-16 | TPP             | 215597     |    103 (0.0478%) |            0 (0%) |
| 2024-07-16 | Vision          | 351153     |    2158 (0.615%) |      5 (0.00142%) |
#### Audit log

- Find_missing_codes last run 2024-07-17

LINK: [https://github.com/rw251/.../conditions/hepatitis-d/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/conditions/hepatitis-d/1)

### Infections

Any code indicating an infection. Codes from https://research-information.bris.ac.uk/en/datasets/cprd-codes-infections-and-autoimmune-diseases.

This code set was built for lighthouse study number 4 (Bruce - SLE).
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `74.1% - 80.1%` suggests that this code set is well defined.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2024-05-01 | EMIS | 2530927 | 1875578 (74.1%) | 1875483 (74.1%) | 
| 2024-05-01 | TPP | 201816 | 161930 (80.2%) | 161753 (80.1%) | 
| 2024-05-01 | Vision | 335411 | 253518 (75.6%) | 253503 (75.6%) | 
LINK: [https://github.com/rw251/.../conditions/infections/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/conditions/infections/1)

### Flu vaccination

Any code that indicates that the patient has had a flu vaccine. Includes procedure codes and admin codes confirming a vaccination has been administered. **NB it does not include the flu vaccine product - see the `flu-vaccine` code set**

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2024-02-27 | EMIS | 2525130 | 1269267 (50.3%) | 1269291 (50.3%) | 
| 2024-02-27 | TPP | 201782 | 91527 (45.4%) | 91540 (45.4%) | 
| 2024-02-27 | Vision | 335118 | 169002 (50.4%) | 169017 (50.4%) | 
LINK: [https://github.com/rw251/.../procedures/flu-vaccination/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/procedures/flu-vaccination/1)

#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set.

The discrepancy between the patients counted when using the IDs vs using the clinical codes is due to these being new codes which haven't all filtered through to the main Graphnet dictionary. The prevalence range `1.19% - 26.55%` as of 11th March 2021 is too wide. However the prevalence figure of 26.55% from EMIS is close to public data and is likely ok.

**UPDATE - 25th March 2021** Missing Read and CTV3 codes were added to the vaccination list and now the range of `26.91% - 32.96%` seems reasonable. It should be noted that there is an approx 2 week lag between events occurring and them being entered in the record.

**UPDATE - 12th April 2021**, latest prevalence figures.

**UPDATE - 18th March 2022** There are now new codes for things like 3rd/4th/booster dose of vaccine. The latest prevalence shows `65.0% - 66.3%` have at least one vaccine code in the GP_Events table, and `88.2% - 93.6%` have at least one code for the vaccine in the GP_Medications table.

**UPDATE - 24th January 2024** There has clearly been a reporting change as the prevalence of the vaccine as a medication has gone down. The event codes for the administration of the COVID vaccine seem to be the reliable place to find this informaiton.
##### MED

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2021-05-12 | EMIS            | 2606497    |           0 (0%) |    379577(14.56%) |
| 2021-05-12 | TPP             | 210810     |           0 (0%) |       1637(0.78%) |
| 2021-05-12 | Vision          | 334784     |           0 (0%) |         93(0.03%) |
| 2022-03-18 | EMIS            | 2658131    |  1750506 (65.9%) |    1763420(66.3%) |
| 2022-03-18 | TPP             | 212662     |      8207 (3.9%) |     138285(65.0%) |
| 2022-03-18 | Vision          | 341594     |   122060 (35.7%) |     225844(66.1%) |
| 2024-01-23 | EMIS            | 2520311    |  1547833 (61.4%) |   1547833 (61.4%) |
| 2024-01-23 | TPP             | 201513     |     8819 (4.38%) |      8819 (4.38%) |
| 2024-01-23 | Vision          | 334747     |   127541 (38.1%) |    127541 (38.1%) |
| 2024-04-23 | EMIS 		   | 2530666    |  1538265 (60.8%) |   1538265 (60.8%) | 
| 2024-04-23 | TPP 			   | 201812     |     9383 (4.65%) |      9383 (4.65%) | 
| 2024-04-23 | Vision 		   | 335433     |   127287 (37.9%) |    127287 (37.9%) | 
##### EVENT

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2021-05-12 | EMIS            | 2606497    |     4446 (0.17%) |  1101577 (42.26%) |
| 2021-05-12 | TPP             | 210810     |        7 (0.00%) |    87841 (41.66%) |
| 2021-05-12 | Vision          | 334784     |        1 (0.00%) |   142724 (42.63%) |
| 2022-03-18 | EMIS            | 2658131    |  2486786 (93.6%) |   1676951 (63.1%) |
| 2022-03-18 | TPP             | 212662     |   187463 (88.2%) |      7314 (3.44%) |
| 2022-03-18 | Vision          | 341594     |   312617 (91.5%) |     62512 (18.3%) |
| 2024-01-23 | EMIS            | 2520311    |   243506 (9.66%) |   1571372 (62.3%) |
| 2024-01-23 | TPP             | 201513     |     2322 (1.15%) |    137349 (68.2%) |
| 2024-01-23 | Vision          | 334747     |     32138 (9.6%) |    209223 (62.5%) |
| 2024-04-23 | EMIS 		   | 2530666    |  1611670 (63.7%) |   1573511 (62.2%) | 
| 2024-04-23 | TPP 			   | 201812     |    10713 (5.31%) |    136355 (67.6%) | 
| 2024-04-23 | Vision 		   | 335433     |     214580 (64%) |    208920 (62.3%) | 
#### Audit log

- Find_missing_codes last run 2024-01-23

LINK: [https://github.com/rw251/.../procedures/covid-vaccination/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/procedures/covid-vaccination/1)

### Pneumococcal vaccination

Codes taken from OpenCodelists https://www.opencodelists.org/codelist/nhsd-primary-care-domain-refsets/pcv_cod/20200812/#full-list and https://www.opencodelists.org/codelist/nhsd-primary-care-domain-refsets/pneuvac1_cod/20210127/#full-list
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence range `34.2% - 34.8%` for EMIS and Vision suggests that this code set is well defined. TPP practices are a lot lower at `16.2%` which may be down to the way the codes are recorded there.

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2023-11-01 | EMIS            | 2472595    |   722523 (29.2%) |    862422 (34.8%) |
| 2023-11-01 | TPP             | 200603     |    30992 (15.4%) |     32488 (16.2%) |
| 2023-11-01 | Vision          | 332447     |   110871 (33.3%) |    113668 (34.2%) |


MED

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2023-11-10 | EMIS            | 2482563    |    43312 (1.74%) |     43313 (1.74%) | 
| 2023-11-10 | TPP             | 201030     |     73 (0.0363%) |      74 (0.0368%) | 
| 2023-11-10 | Vision          | 333490     |     2702 (0.81%) |      2702 (0.81%) | 

EVENT

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2023-11-10 | EMIS            | 2482563    |   722186 (29.1%) |    860756 (34.7%) | 
| 2023-11-10 | TPP             | 201030     |    31354 (15.6%) |     32487 (16.2%) | 
| 2023-11-10 | Vision          | 333490     |   110696 (33.2%) |      113431 (34%) | 

LINK: [https://github.com/rw251/.../procedures/pneumococcal-vaccination/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/procedures/pneumococcal-vaccination/1)

### Shingles vaccination

Codes taken from OpenCodelists https://www.opencodelists.org/codelist/nhsd-primary-care-domain-refsets/shvacgp_cod/20200812/#full-list and https://www.opencodelists.org/codelist/nhsd-primary-care-domain-refsets/shvacgp1_cod/20211221/#full-list and https://www.opencodelists.org/codelist/nhsd-primary-care-domain-refsets/shvacgp2_cod/20211221/#full-list 

Also the following codes were added as advised by RQ062 PI: n4v1, n4v4.

** 01.05.24: codes were added from [NHS ref](https://nhs-pcd-refset.pages.dev/)
#### Prevalence log

By examining the prevalence of codes (number of patients with the code in their record) broken down by clinical system, we can attempt to validate the clinical code sets and the reporting of the conditions. Here is a log for this code set. The prevalence `6.26 - 7.55%` suggests that this code set is well defined.

From GP_Events:

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2024-02-27 | EMIS | 2525130 | 158147 (6.26%) | 159573 (6.32%) | 
| 2024-02-27 | TPP | 201782 | 15218 (7.54%) | 15232 (7.55%) | 
| 2024-02-27 | Vision | 335118 | 21409 (6.39%) | 21616 (6.45%) | 

From GP_Medications:

| Date       | Practice system | Population | Patients from ID | Patient from code |
| ---------- | --------------- | ---------- | ---------------: | ----------------: |
| 2024-02-27 | EMIS | 2525130 | 9011 (0.357%) | 9011 (0.357%) | 
| 2024-02-27 | TPP | 201782 | 145 (0.0719%) | 145 (0.0719%) | 
| 2024-02-27 | Vision | 335118 | 473 (0.141%) | 473 (0.141%) | 
LINK: [https://github.com/rw251/.../procedures/shingles-vaccination/1](https://github.com/rw251/gm-idcr/tree/master/shared/clinical-code-sets/procedures/shingles-vaccination/1)
# Clinical code sets

All code sets required for this analysis are available here: [https://github.com/rw251/.../SDE Lighthouse 04 - Bruce/clinical-code-sets.csv](https://github.com/rw251/gm-idcr/tree/master/projects/SDE%20Lighthouse%2004%20-%20Bruce/clinical-code-sets.csv). Individual lists for each concept can also be found by using the links above.