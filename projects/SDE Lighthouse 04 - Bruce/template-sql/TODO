Only outstanding are:

- await SLE code set from PI
- decide whether to look for SLE and hepatitis in HES as well as GP - does it add many people?
- RDE check

DROP TABLE IF EXISTS APCS_SLE;
CREATE TEMPORARY TABLE APCS_SLE AS
select SUBSTRING("Der_Pseudo_NHS_Number", 2)::INT AS "GmPseudo", MIN(CAST("Admission_Date" AS DATE)) AS "SLEDate"
from INTERMEDIATE.national_flows_apc."tbl_Data_SUS_APCS"
where contains(lower("Der_Diagnosis_All"), 'm321') -- Systemic lupus erythematosus with organ or system involvement
or contains(lower("Der_Diagnosis_All"), 'm328') -- Other forms of systemic lupus erythematosus
or contains(lower("Der_Diagnosis_All"), 'm329') -- Systemic lupus erythematosus, unspecified
group by SUBSTRING("Der_Pseudo_NHS_Number", 2)::INT;

# General

- Send SLE code set to double check

# 1.patients

- Asked for quartile, is decile ok for IMD (can then choose decile or quintile)
  YES

# medications (files 2 - 4)

- would format of PatientId, Date, MedicationCategory, Medication, Dose work instead?
  YES
  DONE- Need to add hydrochlorquine and chlorquine code sets once we have table in snowflake
  DONE- Need to link back to gmpseudo

# comorbidities

- requested in long format
- would wide be ok? it's in that currently happy to transform but no point if you will transform back
  YES
- viral hepatitis (A, B, C and D) - combined or separate?
  SEPARATE
  DONE- just need to check syntax of code set usage

# infections / vaccines

PneumococcalVaccination (ever recorded y/n)
PneumoVacDate
InfluenzaVaccination (in past 12 months y/n)
FluVacDate
COVIDVaccination (in past 12 months y/n)
COVIDVacDate
ShinglesVaccination
ShinglesVacDate
BCGVaccination
BCGVacDate
HPVVaccination
HPVVacDate
Infection (from list below)
InfectionDate (for each recorded infection)
HospitalAdmissionForInfection (if available)
HospitalAdmissionDate
PreviousSmear (ever y/n)
SmearDates
SmearResults (for each smear documented)

ALL DONE

# mortality

DONE- cause of death - we can provide the ICD10 code - do you want it mapping to a description?

## Appear under Immunosuppression_Drugs

MycophenolateMofetil (y/n)
Azathioprine (y/n)
Tacrolimus (y/n)
Methotrexate (y/n)
Ciclosporin (y/n)
Cyclophosphamide
Rituximab

## Appear under own name

Prednisolone (y/n)

## Appear with FoundValue

ACEInhibitorOrARB*
SGLT2Inhibitor*
AntiplateletDrug*
Statin*
Anticoagulant\*

## Use our code sets

HydroxychloroquineOrChloroquine (y/n)
Belimumab (y/n) - this is a monthly med so for this we want minimum of 2 prescriptions in 3 months

TODO getting hep from APC???
select \* from intermediate.national_flows_apc."tbl_Data_SUS_APCS"
-- 497 hep a
-- where contains(lower("Der_Diagnosis_All"), 'b150') -- Hepatitis A with hepatic coma
-- or contains(lower("Der_Diagnosis_All"), 'b159'); -- Hepatitis A without hepatic coma

-- 6746 hep b
-- where contains(lower("Der_Diagnosis_All"), 'b160') -- Acute hepatitis B with delta-agent (coinfection) with hepatic coma
-- or contains(lower("Der_Diagnosis_All"), 'b161') -- Acute hepatitis B with delta-agent (coinfection) without hepatic coma
-- or contains(lower("Der_Diagnosis_All"), 'b162') -- Acute hepatitis B without delta-agent with hepatic coma
-- or contains(lower("Der_Diagnosis_All"), 'b169') -- Acute hepatitis B without delta-agent and without hepatic coma
-- or contains(lower("Der_Diagnosis_All"), 'b170') -- Acute delta-(super)infection in chronic hepatitis B
-- or contains(lower("Der_Diagnosis_All"), 'b180') -- Chronic viral hepatitis B with delta-agent
-- or contains(lower("Der_Diagnosis_All"), 'b181'); -- Chronic viral hepatitis B without delta-agent

-- 11332 hep c
-- where contains(lower("Der_Diagnosis_All"), 'b171') -- Acute hepatitis C
-- or contains(lower("Der_Diagnosis_All"), 'b182'); -- Chronic viral hepatitis C

-- 124 hep d
where contains(lower("Der_Diagnosis_All"), 'b160') -- Acute hepatitis B with delta-agent (coinfection) with hepatic coma
or contains(lower("Der_Diagnosis_All"), 'b161') -- Acute hepatitis B with delta-agent (coinfection) without hepatic coma
or contains(lower("Der_Diagnosis_All"), 'b170') -- Acute delta-(super)infection in chronic hepatitis B
or contains(lower("Der_Diagnosis_All"), 'b180') -- Chronic viral hepatitis B with delta-agent
