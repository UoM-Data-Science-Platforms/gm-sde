--
--┌────────────────────┐
--│ Clinical code sets │
--└────────────────────┘

-- OBJECTIVE: To populate temporary tables with the existing clinical code sets.
--            See the "SQL generation process.md" for more details.

-- INPUT: No pre-requisites

-- OUTPUT: Four temp tables as follows:
--  #CodeSets (Concept, FK_Coding_ID)
--  #SnomedSets (Concept, FK_SNOMED_ID)
--  #VersionedCodeSets (Concept, Version, FK_Coding_ID)
--  #VersionedSnomedSets (Concept, Version, FK_SNOMED_ID)

--!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
--!!! DO NOT EDIT THIS FILE MANUALLY !!!
--!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

IF OBJECT_ID('tempdb..#codesreadv2') IS NOT NULL DROP TABLE #codesreadv2;
CREATE TABLE #codesreadv2 (
  [concept] [varchar](255) NOT NULL,
  [version] INT NOT NULL,
	[code] [varchar](20) COLLATE Latin1_General_CS_AS NOT NULL,
	[description] [varchar](255) NULL
) ON [PRIMARY];

INSERT INTO #codesreadv2
VALUES ('atrial-fibrillation',1,'G573200','Paroxysmal atrial fibrillation'),('atrial-fibrillation',1,'G5732','Paroxysmal atrial fibrillation'),('atrial-fibrillation',1,'G573000','Atrial fibrillation'),('atrial-fibrillation',1,'G5730','Atrial fibrillation'),('atrial-fibrillation',1,'G573100','Atrial flutter'),('atrial-fibrillation',1,'G5731','Atrial flutter'),('atrial-fibrillation',1,'G573.00','Atrial fibrillation and flutter'),('atrial-fibrillation',1,'G573.','Atrial fibrillation and flutter'),('atrial-fibrillation',1,'G573z00','Atrial fibrillation and flutter NOS'),('atrial-fibrillation',1,'G573z','Atrial fibrillation and flutter NOS'),('atrial-fibrillation',1,'G573300','Non-rheumatic atrial fibrillation'),('atrial-fibrillation',1,'G5733','Non-rheumatic atrial fibrillation'),('atrial-fibrillation',1,'G573500','Persistent atrial fibrillation'),('atrial-fibrillation',1,'G5735','Persistent atrial fibrillation'),('atrial-fibrillation',1,'G573400','Permanent atrial fibrillation'),('atrial-fibrillation',1,'G5734','Permanent atrial fibrillation');
INSERT INTO #codesreadv2
VALUES ('hypertension',1,'G2...00','Hypertensive disease'),('hypertension',1,'G2...','Hypertensive disease'),('hypertension',1,'G20..11','High blood pressure'),('hypertension',1,'G20..','High blood pressure'),('hypertension',1,'G20..00','Essential hypertension'),('hypertension',1,'G20..','Essential hypertension'),('hypertension',1,'G201.00','Benign essential hypertension'),('hypertension',1,'G201.','Benign essential hypertension'),('hypertension',1,'G20z.11','Hypertension NOS'),('hypertension',1,'G20z.','Hypertension NOS'),('hypertension',1,'G202.00','Systolic hypertension'),('hypertension',1,'G202.','Systolic hypertension'),('hypertension',1,'G2z..00','Hypertensive disease NOS'),('hypertension',1,'G2z..','Hypertensive disease NOS'),('hypertension',1,'G24..00','Secondary hypertension'),('hypertension',1,'G24..','Secondary hypertension'),('hypertension',1,'G20z.00','Essential hypertension NOS'),('hypertension',1,'G20z.','Essential hypertension NOS'),('hypertension',1,'G200.00','Malignant essential hypertension'),('hypertension',1,'G200.','Malignant essential hypertension'),('hypertension',1,'G24z.00','Secondary hypertension NOS'),('hypertension',1,'G24z.','Secondary hypertension NOS'),('hypertension',1,'G2y..00','Other specified hypertensive disease'),('hypertension',1,'G2y..','Other specified hypertensive disease'),('hypertension',1,'G241000','Secondary benign renovascular hypertension'),('hypertension',1,'G2410','Secondary benign renovascular hypertension'),('hypertension',1,'G24z100','Hypertension secondary to drug'),('hypertension',1,'G24z1','Hypertension secondary to drug'),('hypertension',1,'G24z000','Secondary renovascular hypertension NOS'),('hypertension',1,'G24z0','Secondary renovascular hypertension NOS'),('hypertension',1,'G240.00','Secondary malignant hypertension'),('hypertension',1,'G240.','Secondary malignant hypertension'),('hypertension',1,'G244.00','Hypertension secondary to endocrine disorders'),('hypertension',1,'G244.','Hypertension secondary to endocrine disorders'),('hypertension',1,'G24zz00','Secondary hypertension NOS'),('hypertension',1,'G24zz','Secondary hypertension NOS'),('hypertension',1,'G241z00','Secondary benign hypertension NOS'),('hypertension',1,'G241z','Secondary benign hypertension NOS'),('hypertension',1,'G241.00','Secondary benign hypertension'),('hypertension',1,'G241.','Secondary benign hypertension'),('hypertension',1,'G240000','Secondary malignant renovascular hypertension'),('hypertension',1,'G2400','Secondary malignant renovascular hypertension'),('hypertension',1,'Gyu2.00','[X]Hypertensive diseases'),('hypertension',1,'Gyu2.','[X]Hypertensive diseases'),('hypertension',1,'G240z00','Secondary malignant hypertension NOS'),('hypertension',1,'G240z','Secondary malignant hypertension NOS'),('hypertension',1,'G203.00','Diastolic hypertension'),('hypertension',1,'G203.','Diastolic hypertension'),('hypertension',1,'Gyu2000','[X]Other secondary hypertension'),('hypertension',1,'Gyu20','[X]Other secondary hypertension');
INSERT INTO #codesreadv2
VALUES ('methotrexate',1,'h34..','METHOTREXATE'),('methotrexate',1,'h34..00','METHOTREXATE'),('methotrexate',1,'h341.','METHOTREXATE 2.5mg tablets'),('methotrexate',1,'h341.00','METHOTREXATE 2.5mg tablets'),('methotrexate',1,'h342.','METHOTREXATE 10mg tablets'),('methotrexate',1,'h342.00','METHOTREXATE 10mg tablets'),('methotrexate',1,'h34d.','*EMTEXATE 10mg tablets'),('methotrexate',1,'h34d.00','*EMTEXATE 10mg tablets'),('methotrexate',1,'h34p.','MAXTREX 2.5mg tablets'),('methotrexate',1,'h34p.00','MAXTREX 2.5mg tablets'),('methotrexate',1,'h34q.','MAXTREX 10mg tablets'),('methotrexate',1,'h34q.00','MAXTREX 10mg tablets'),('methotrexate',1,'h343.','*METHOTREXATE 2.5mg/1mL inj'),('methotrexate',1,'h343.00','*METHOTREXATE 2.5mg/1mL inj'),('methotrexate',1,'h345.','*METHOTREXATE 25mg/1mL inj'),('methotrexate',1,'h345.00','*METHOTREXATE 25mg/1mL inj'),('methotrexate',1,'h346.','METHOTREXATE 50mg/2mL inj soln'),('methotrexate',1,'h346.00','METHOTREXATE 50mg/2mL inj soln'),('methotrexate',1,'h347.','*METHOTREXATE 100mg/4mL inj'),('methotrexate',1,'h347.00','*METHOTREXATE 100mg/4mL inj'),('methotrexate',1,'h348.','*METHOTREXTE 200mg/8mL inj sol'),('methotrexate',1,'h348.00','*METHOTREXTE 200mg/8mL inj sol'),('methotrexate',1,'h349.','METHOTREXATE 500mg/20mL inj'),('methotrexate',1,'h349.00','METHOTREXATE 500mg/20mL inj'),('methotrexate',1,'h34A.','*METHOTREXATE 15mg/1.5mL pfs'),('methotrexate',1,'h34A.00','*METHOTREXATE 15mg/1.5mL pfs'),('methotrexate',1,'h34E.','*METOJECT 10mg/1mL syringe'),('methotrexate',1,'h34E.00','*METOJECT 10mg/1mL syringe'),('methotrexate',1,'h34F.','*METOJECT 15mg/1.5mL p/f syrg'),('methotrexate',1,'h34F.00','*METOJECT 15mg/1.5mL p/f syrg'),('methotrexate',1,'h34G.','*METOJECT 20mg/2mL p/f syringe'),('methotrexate',1,'h34G.00','*METOJECT 20mg/2mL p/f syringe'),('methotrexate',1,'h34H.','*METOJECT 25mg/2.5mL p/f syrng'),('methotrexate',1,'h34H.00','*METOJECT 25mg/2.5mL p/f syrng'),('methotrexate',1,'h34L.','*METOJECT 7.5mg/0.15mL inj pfs'),('methotrexate',1,'h34L.00','*METOJECT 7.5mg/0.15mL inj pfs'),('methotrexate',1,'h34N.','*METOJECT 10mg/0.2mL inj pfs'),('methotrexate',1,'h34N.00','*METOJECT 10mg/0.2mL inj pfs'),('methotrexate',1,'h34O.','*METHOTREXATE 10mg/0.2mL inj'),('methotrexate',1,'h34O.00','*METHOTREXATE 10mg/0.2mL inj'),('methotrexate',1,'h34R.','*METOJECT 20mg/0.4mL inj pfs'),('methotrexate',1,'h34R.00','*METOJECT 20mg/0.4mL inj pfs'),('methotrexate',1,'h34T.','*METOJECT 25mg/0.5mL inj pfs'),('methotrexate',1,'h34T.00','*METOJECT 25mg/0.5mL inj pfs'),('methotrexate',1,'h34U.','*METHOTREXATE 25mg/0.5mL inj'),('methotrexate',1,'h34U.00','*METHOTREXATE 25mg/0.5mL inj'),('methotrexate',1,'h34V.','*METOJECT 30mg/0.6mL inj pfs'),('methotrexate',1,'h34V.00','*METOJECT 30mg/0.6mL inj pfs'),('methotrexate',1,'h34W.','*METHOTREXATE 30mg/0.6mL inj'),('methotrexate',1,'h34W.00','*METHOTREXATE 30mg/0.6mL inj'),('methotrexate',1,'h34X.','*EBETREX 7.5mg/0.75mL inj pfs'),('methotrexate',1,'h34X.00','*EBETREX 7.5mg/0.75mL inj pfs'),('methotrexate',1,'h34Y.','*EBETREX 10mg/1mL inj pfs'),('methotrexate',1,'h34Y.00','*EBETREX 10mg/1mL inj pfs'),('methotrexate',1,'h34a.','*METHOTREXATE 1g/40mL inj soln'),('methotrexate',1,'h34a.00','*METHOTREXATE 1g/40mL inj soln'),('methotrexate',1,'h34e.','*EMTEXATE 5mg/2mL inj soln'),('methotrexate',1,'h34e.00','*EMTEXATE 5mg/2mL inj soln'),('methotrexate',1,'h34f.','*EMTEXATE 50mg/2mL inj soln'),('methotrexate',1,'h34f.00','*EMTEXATE 50mg/2mL inj soln'),('methotrexate',1,'h34g.','*EMTEXATE 250mg/10mL inj soln'),('methotrexate',1,'h34g.00','*EMTEXATE 250mg/10mL inj soln'),('methotrexate',1,'h34h.','*EMTEXATE 500mg/20mL inj soln'),('methotrexate',1,'h34h.00','*EMTEXATE 500mg/20mL inj soln'),('methotrexate',1,'h34i.','*EMTEXATE 1g/40mL inj soln'),('methotrexate',1,'h34i.00','*EMTEXATE 1g/40mL inj soln'),('methotrexate',1,'h34j.','*EMTEXATE 5g/200mL inj soln'),('methotrexate',1,'h34j.00','*EMTEXATE 5g/200mL inj soln'),('methotrexate',1,'h34k.','*EMTEXATE 1g/10mL inj soln'),('methotrexate',1,'h34k.00','*EMTEXATE 1g/10mL inj soln'),('methotrexate',1,'h34l.','*EMTEXATE 5g/50mL inj soln'),('methotrexate',1,'h34l.00','*EMTEXATE 5g/50mL inj soln'),('methotrexate',1,'h34n.','*EMTEXATE 1g inj pdr'),('methotrexate',1,'h34n.00','*EMTEXATE 1g inj pdr'),('methotrexate',1,'h34o.','*EMTEXATE 5g inj pdr'),('methotrexate',1,'h34o.00','*EMTEXATE 5g inj pdr'),('methotrexate',1,'h34r.','*MAXTREX 5mg/2mL inj soln'),('methotrexate',1,'h34r.00','*MAXTREX 5mg/2mL inj soln'),('methotrexate',1,'h34t.','*MAXTREX 500mg/20mL inj soln'),('methotrexate',1,'h34t.00','*MAXTREX 500mg/20mL inj soln'),('methotrexate',1,'h34u.','*MAXTREX 1g/40mL inj soln'),('methotrexate',1,'h34u.00','*MAXTREX 1g/40mL inj soln'),('methotrexate',1,'h34v.','*MAXTREX 5g/200mL inj soln'),('methotrexate',1,'h34v.00','*MAXTREX 5g/200mL inj soln'),('methotrexate',1,'h34w.','METHOTREXATE 1g/10mL injection'),('methotrexate',1,'h34w.00','METHOTREXATE 1g/10mL injection'),('methotrexate',1,'h34x.','METHOTREXATE 5g/50mL injection'),('methotrexate',1,'h34x.00','METHOTREXATE 5g/50mL injection'),('methotrexate',1,'h34y.','*METHOTREXATE 7.5mg/0.75mL pfs'),('methotrexate',1,'h34y.00','*METHOTREXATE 7.5mg/0.75mL pfs'),('methotrexate',1,'h3G..','METHOTREXATE(2)'),('methotrexate',1,'h3G..00','METHOTREXATE(2)'),('methotrexate',1,'h3G1.','*EBETREX 20mg/1mL inj pfs'),('methotrexate',1,'h3G1.00','*EBETREX 20mg/1mL inj pfs'),('methotrexate',1,'h3G2.','*EBETREX 25mg/1.25mL inj pfs'),('methotrexate',1,'h3G2.00','*EBETREX 25mg/1.25mL inj pfs'),('methotrexate',1,'h3G3.','*EBETREX 30mg/1.5mL inj pfs'),('methotrexate',1,'h3G3.00','*EBETREX 30mg/1.5mL inj pfs'),('methotrexate',1,'h3G4.','*METHOTREXATE 20mg/1mL inj pfs'),('methotrexate',1,'h3G4.00','*METHOTREXATE 20mg/1mL inj pfs'),('methotrexate',1,'h3G5.','*METHOTREXATE 25mg/1.25mL pfs'),('methotrexate',1,'h3G5.00','*METHOTREXATE 25mg/1.25mL pfs'),('methotrexate',1,'h3G6.','*METHOTREXATE 30mg/1.5mL pfs'),('methotrexate',1,'h3G6.00','*METHOTREXATE 30mg/1.5mL pfs'),('methotrexate',1,'h3G7.','*METOJCT 12.5mg/0.25mL inj pfs'),('methotrexate',1,'h3G7.00','*METOJCT 12.5mg/0.25mL inj pfs'),('methotrexate',1,'h3G9.','*METOJCT 17.5mg/0.35mL inj pfs'),('methotrexate',1,'h3G9.00','*METOJCT 17.5mg/0.35mL inj pfs'),('methotrexate',1,'h3GB.','*METOJCT 22.5mg/0.45mL inj pfs'),('methotrexate',1,'h3GB.00','*METOJCT 22.5mg/0.45mL inj pfs'),('methotrexate',1,'h3GC.','*METHOTRXATE 22.5mg/0.45mL inj'),('methotrexate',1,'h3GC.00','*METHOTRXATE 22.5mg/0.45mL inj'),('methotrexate',1,'h3GD.','*METOJCT 27.5mg/0.55mL inj pfs'),('methotrexate',1,'h3GD.00','*METOJCT 27.5mg/0.55mL inj pfs'),('methotrexate',1,'h3GE.','*METHOTRXATE 27.5mg/0.55mL inj'),('methotrexate',1,'h3GE.00','*METHOTRXATE 27.5mg/0.55mL inj'),('methotrexate',1,'h3GF.','METOJECT PEN 7.5mg/0.15mL inj'),('methotrexate',1,'h3GF.00','METOJECT PEN 7.5mg/0.15mL inj'),('methotrexate',1,'h3GG.','METHOTREXATE 7.5mg/0.15mL pen'),('methotrexate',1,'h3GG.00','METHOTREXATE 7.5mg/0.15mL pen'),('methotrexate',1,'h3GH.','METOJECT PEN 10mg/0.2mL inj'),('methotrexate',1,'h3GH.00','METOJECT PEN 10mg/0.2mL inj'),('methotrexate',1,'h3GJ.','METOJECT PEN 12.5mg/0.25mL inj'),('methotrexate',1,'h3GJ.00','METOJECT PEN 12.5mg/0.25mL inj'),('methotrexate',1,'h3GK.','METHOTREXATE 12.5mg/0.25mL pen'),('methotrexate',1,'h3GK.00','METHOTREXATE 12.5mg/0.25mL pen'),('methotrexate',1,'h3GL.','METOJECT PEN 15mg/0.3mL inj'),('methotrexate',1,'h3GL.00','METOJECT PEN 15mg/0.3mL inj'),('methotrexate',1,'h3GM.','METHOTREXATE 15mg/0.3mL pen'),('methotrexate',1,'h3GM.00','METHOTREXATE 15mg/0.3mL pen'),('methotrexate',1,'h3GN.','METOJECT PEN 17.5mg/0.35mL inj'),('methotrexate',1,'h3GN.00','METOJECT PEN 17.5mg/0.35mL inj'),('methotrexate',1,'h3GP.','METOJECT PEN 20mg/0.4mL inj'),('methotrexate',1,'h3GP.00','METOJECT PEN 20mg/0.4mL inj'),('methotrexate',1,'h3GR.','METOJECT PEN 22.5mg/0.45mL inj'),('methotrexate',1,'h3GR.00','METOJECT PEN 22.5mg/0.45mL inj'),('methotrexate',1,'h3GT.','METOJECT PEN 25mg/0.5mL inj'),('methotrexate',1,'h3GT.00','METOJECT PEN 25mg/0.5mL inj'),('methotrexate',1,'h3GV.','METOJECT PEN 27.5mg/0.55mL inj'),('methotrexate',1,'h3GV.00','METOJECT PEN 27.5mg/0.55mL inj'),('methotrexate',1,'h3GW.','METHOTREXATE 27.5mg/0.55mL pen'),('methotrexate',1,'h3GW.00','METHOTREXATE 27.5mg/0.55mL pen'),('methotrexate',1,'h3GX.','METOJECT PEN 30mg/0.6mL inj'),('methotrexate',1,'h3GX.00','METOJECT PEN 30mg/0.6mL inj'),('methotrexate',1,'h3GY.','METHOTREXATE 30mg/0.6mL pen'),('methotrexate',1,'h3GY.00','METHOTREXATE 30mg/0.6mL pen'),('methotrexate',1,'h3GZ.','METHOTREXATE 2mg/mL oral soln'),('methotrexate',1,'h3GZ.00','METHOTREXATE 2mg/mL oral soln'),('methotrexate',1,'h24B.','METHOTREXATE inj 20mg/2ml'),('methotrexate',1,'h24B.00','METHOTREXATE inj 20mg/2ml'),('methotrexate',1,'h344.','METHOTREXATE 5MG/2ML INJ'),('methotrexate',1,'h344.00','METHOTREXATE 5MG/2ML INJ'),('methotrexate',1,'h34b.','METHOTREXATE 25MG/1M INJ'),('methotrexate',1,'h34b.00','METHOTREXATE 25MG/1M INJ'),('methotrexate',1,'h34B.','*METHOTREXATE 20mg/2mL pfs'),('methotrexate',1,'h34B.00','*METHOTREXATE 20mg/2mL pfs'),('methotrexate',1,'h34D.','*METOJECT 7.5mg/0.75mL pfs'),('methotrexate',1,'h34D.00','*METOJECT 7.5mg/0.75mL pfs'),('methotrexate',1,'h34P.','*METOJECT 15mg/0.3mL inj pfs'),('methotrexate',1,'h34P.00','*METOJECT 15mg/0.3mL inj pfs'),('methotrexate',1,'h34Z.','*EBETREX 15mg/1.5mL inj pfs'),('methotrexate',1,'h34Z.00','*EBETREX 15mg/1.5mL inj pfs'),('methotrexate',1,'h34c.','*METHOTREXATE 500mg inj pdr'),('methotrexate',1,'h34c.00','*METHOTREXATE 500mg inj pdr'),('methotrexate',1,'h34m.','*EMTEXATE 0.5g inj pdr'),('methotrexate',1,'h34m.00','*EMTEXATE 0.5g inj pdr'),('methotrexate',1,'h34s.','*MAXTREX 50mg/2mL inj soln'),('methotrexate',1,'h34s.00','*MAXTREX 50mg/2mL inj soln'),('methotrexate',1,'h34C.','METHOTREXATE inj 25mg/2.5ml'),('methotrexate',1,'h34C.00','METHOTREXATE inj 25mg/2.5ml'),('methotrexate',1,'h34M.','METHOTREXATE inj 7.5mg/0.15ml'),
('methotrexate',1,'h34M.00','METHOTREXATE inj 7.5mg/0.15ml'),('methotrexate',1,'h34Q.','Methotrexate 15mg/0.3ml solution for injection pre-filled...'),('methotrexate',1,'h34Q.00','Methotrexate 15mg/0.3ml solution for injection pre-filled...'),('methotrexate',1,'h34S.','METHOTREXATE inj 20mg/0.4ml'),('methotrexate',1,'h34S.00','METHOTREXATE inj 20mg/0.4ml'),('methotrexate',1,'h34z.','METHOTREXATE inj 10mg/1ml'),('methotrexate',1,'h34z.00','METHOTREXATE inj 10mg/1ml'),('methotrexate',1,'h3G8.','Methotrexate 12.5mg/0.25ml solution for injection pre-fil...'),('methotrexate',1,'h3G8.00','Methotrexate 12.5mg/0.25ml solution for injection pre-fil...'),('methotrexate',1,'h3GA.','Methotrexate 17.5mg/0.35ml solution for injection pre-fil...'),('methotrexate',1,'h3GA.00','Methotrexate 17.5mg/0.35ml solution for injection pre-fil...'),('methotrexate',1,'h3GI.','Methotrexate 10mg/0.2ml solution for injection pre-filled...'),('methotrexate',1,'h3GI.00','Methotrexate 10mg/0.2ml solution for injection pre-filled...'),('methotrexate',1,'h3GO.','Methotrexate 17.5mg/0.35ml solution for injection pre-fil...'),('methotrexate',1,'h3GO.00','Methotrexate 17.5mg/0.35ml solution for injection pre-fil...'),('methotrexate',1,'h3GQ.','Methotrexate 20mg/0.4ml solution for injection pre-filled...'),('methotrexate',1,'h3GQ.00','Methotrexate 20mg/0.4ml solution for injection pre-filled...'),('methotrexate',1,'h3GS.','Methotrexate 22.5mg/0.45ml solution for injection pre-fil...'),('methotrexate',1,'h3GS.00','Methotrexate 22.5mg/0.45ml solution for injection pre-fil...'),('methotrexate',1,'h3GU.','Methotrexate 25mg/0.5ml solution for injection pre-filled...'),('methotrexate',1,'h3GU.00','Methotrexate 25mg/0.5ml solution for injection pre-filled...')

IF OBJECT_ID('tempdb..#codesctv3') IS NOT NULL DROP TABLE #codesctv3;
CREATE TABLE #codesctv3 (
  [concept] [varchar](255) NOT NULL,
  [version] INT NOT NULL,
	[code] [varchar](20) COLLATE Latin1_General_CS_AS NOT NULL,
	[description] [varchar](255) NULL
) ON [PRIMARY];

INSERT INTO #codesctv3
VALUES ('atrial-fibrillation',1,'G573.','Atrial fibrillation and flutter'),('atrial-fibrillation',1,'G5730','Atrial fibrillation'),('atrial-fibrillation',1,'G5731','Atrial flutter'),('atrial-fibrillation',1,'G573z','Atrial fibrillation and flutter NOS'),('atrial-fibrillation',1,'X202R','Lone atrial fibrillation'),('atrial-fibrillation',1,'X202S','Non-rheumatic atrial fibrillation'),('atrial-fibrillation',1,'Xa2E8','Paroxysmal atrial fibrillation'),('atrial-fibrillation',1,'Xa7nI','Controlled atrial fibrillation'),('atrial-fibrillation',1,'XaEga','Rapid atrial fibrillation'),('atrial-fibrillation',1,'XaOfa','Persistent atrial fibrillation'),('atrial-fibrillation',1,'XaOft','Permanent atrial fibrillation'),('atrial-fibrillation',1,'XaaUH','Paroxysmal atrial flutter'),('atrial-fibrillation',1,'XaeUP','Chronic atrial fibrillation'),('atrial-fibrillation',1,'XaeUQ','Typical atrial flutter'),('atrial-fibrillation',1,'XaeUR','Atypical atrial flutter');
INSERT INTO #codesctv3
VALUES ('hypertension',1,'14A2.','H/O: hypertension'),('hypertension',1,'21261','Hypertension resolved'),('hypertension',1,'2466.','O/E - BP reading raised'),('hypertension',1,'2467.','O/E - BP reading very high'),('hypertension',1,'662..','Cardiac disease monitoring (& [hypertension])'),('hypertension',1,'6627.','Good hypertension control'),('hypertension',1,'6628.','Poor hypertension control'),('hypertension',1,'6629.','Hypertension:follow-up default'),('hypertension',1,'662F.','Hypertension treatm. started'),('hypertension',1,'662G.','Hypertensive treatm.changed'),('hypertension',1,'662H.','Hypertension treatm.stopped'),('hypertension',1,'662O.','On treatment for hypertension'),('hypertension',1,'662P.','Hypertension monitoring'),('hypertension',1,'8HT5.','Referral to hypertension clinic'),('hypertension',1,'9N03.','Seen in hypertension clinic'),('hypertension',1,'9N1y2','Seen in hypertension clinic'),('hypertension',1,'9OI..','Hypertension admin: [monitoring] or [clinic]'),('hypertension',1,'9OI1.','Attends hypertension monitoring'),('hypertension',1,'9OI3.','Hypertension monitoring offer default'),('hypertension',1,'9OI4.','Hypertension monitoring first letter'),('hypertension',1,'9OI4.','Hypertension monitoring first letter'),('hypertension',1,'9OI5.','Hypertension monitoring second letter'),('hypertension',1,'9OI5.','Hypertension monitoring second letter'),('hypertension',1,'9OI6.','Hypertension monitoring third letter'),('hypertension',1,'9OI6.','Hypertension monitoring third letter'),('hypertension',1,'9OI7.','Hypertension monitoring verbal invite'),('hypertension',1,'9OI7.','Hypertension monitoring verbal invite'),('hypertension',1,'9OI8.','Hypertension monitoring telephone invite'),('hypertension',1,'9OI8.','Hypertension monitoring telephone invite'),('hypertension',1,'9OIA.','Hypertension monitor (& check done)'),('hypertension',1,'9OIZ.','Hypertens.monitoring admin.NOS'),('hypertension',1,'F4211','Hypertensive retinopathy'),('hypertension',1,'G2...','Hypertensive disease'),('hypertension',1,'G2...','Hypertensive disease'),('hypertension',1,'G2...','Hypertensive disease'),('hypertension',1,'G20..','High blood pressure (& [essential hypertension])'),('hypertension',1,'G20..','High blood pressure (& [essential hypertension])'),('hypertension',1,'G200.','Malignant essential hypertension'),('hypertension',1,'G200.','Malignant essential hypertension'),('hypertension',1,'G201.','Benign essential hypertension'),('hypertension',1,'G201.','Benign essential hypertension'),('hypertension',1,'G202.','Systolic hypertension'),('hypertension',1,'G202.','Systolic hypertension'),('hypertension',1,'G20z.','Hypertension NOS (& [essential])'),('hypertension',1,'G20z.','Hypertension NOS (& [essential])'),('hypertension',1,'G21..','Hypertensive heart disease'),('hypertension',1,'G21..','Hypertensive heart disease'),('hypertension',1,'G210.','Malignant hypertensive heart disease'),('hypertension',1,'G210.','Malignant hypertensive heart disease'),('hypertension',1,'G2100','Malignant hypertensive heart disease without CCF'),('hypertension',1,'G2100','Malignant hypertensive heart disease without CCF'),('hypertension',1,'G2101','Malignant hypertensive heart disease with CCF'),('hypertension',1,'G2101','Malignant hypertensive heart disease with CCF'),('hypertension',1,'G210z','Malignant hypertensive heart disease NOS'),('hypertension',1,'G210z','Malignant hypertensive heart disease NOS'),('hypertension',1,'G211.','Benign hypertensive heart disease'),('hypertension',1,'G211.','Benign hypertensive heart disease'),('hypertension',1,'G2110','Benign hypertensive heart disease without CCF'),('hypertension',1,'G2110','Benign hypertensive heart disease without CCF'),('hypertension',1,'G2111','Benign hypertensive heart disease with CCF'),('hypertension',1,'G2111','Benign hypertensive heart disease with CCF'),('hypertension',1,'G211z','Benign hypertensive heart disease NOS'),('hypertension',1,'G211z','Benign hypertensive heart disease NOS'),('hypertension',1,'G21z.','Hypertensive heart disease NOS'),('hypertension',1,'G21z.','Hypertensive heart disease NOS'),('hypertension',1,'G21z0','"Hypertensiv:[cardiomeg][heart dis NOS, no congest card fail]"'),('hypertension',1,'G21z0','"Hypertensiv:[cardiomeg][heart dis NOS, no congest card fail]"'),('hypertension',1,'G21z1','Hypertensive heart disease NOS with CCF'),('hypertension',1,'G21z1','Hypertensive heart disease NOS with CCF'),('hypertension',1,'G22..','Hypertensive renal disease (& [nephrosclerosis])'),('hypertension',1,'G220.','Malignant hypertensive renal disease'),('hypertension',1,'G221.','Benign hypertensive renal disease'),('hypertension',1,'G222.','Hypertensive renal disease with renal failure'),('hypertension',1,'G22z.','(Renal hypertension) or (hypertensive renal disease NOS)'),('hypertension',1,'G23..','Hypertensive heart and renal disease'),('hypertension',1,'G23..','Hypertensive heart and renal disease'),('hypertension',1,'G230.','Malignant hypertensive heart and renal disease'),('hypertension',1,'G230.','Malignant hypertensive heart and renal disease'),('hypertension',1,'G231.','Benign hypertensive heart and renal disease'),('hypertension',1,'G231.','Benign hypertensive heart and renal disease'),('hypertension',1,'G232.','Hypertensive heart&renal dis wth (congestive) heart failure'),('hypertension',1,'G232.','Hypertensive heart&renal dis wth (congestive) heart failure'),('hypertension',1,'G233.','Hypertensive heart and renal disease with renal failure'),('hypertension',1,'G233.','Hypertensive heart and renal disease with renal failure'),('hypertension',1,'G234.','Hyperten heart&renal dis+both(congestv)heart and renal fail'),('hypertension',1,'G234.','Hyperten heart&renal dis+both(congestv)heart and renal fail'),('hypertension',1,'G23z.','Hypertensive heart and renal disease NOS'),('hypertension',1,'G23z.','Hypertensive heart and renal disease NOS'),('hypertension',1,'G24..','Secondary hypertension'),('hypertension',1,'G24..','Secondary hypertension'),('hypertension',1,'G240.','Malignant secondary hypertension'),('hypertension',1,'G240.','Malignant secondary hypertension'),('hypertension',1,'G2400','Secondary malignant renovascular hypertension'),('hypertension',1,'G2400','Secondary malignant renovascular hypertension'),('hypertension',1,'G240z','Secondary malignant hypertension NOS'),('hypertension',1,'G240z','Secondary malignant hypertension NOS'),('hypertension',1,'G241.','Secondary benign hypertension'),('hypertension',1,'G241.','Secondary benign hypertension'),('hypertension',1,'G2410','Secondary benign renovascular hypertension'),('hypertension',1,'G2410','Secondary benign renovascular hypertension'),('hypertension',1,'G241z','Secondary benign hypertension NOS'),('hypertension',1,'G241z','Secondary benign hypertension NOS'),('hypertension',1,'G244.','Hypertension secondary to endocrine disorders'),('hypertension',1,'G244.','Hypertension secondary to endocrine disorders'),('hypertension',1,'G24z.','Secondary hypertension NOS'),('hypertension',1,'G24z.','Secondary hypertension NOS'),('hypertension',1,'G24z0','Secondary renovascular hypertension NOS'),('hypertension',1,'G24z0','Secondary renovascular hypertension NOS'),('hypertension',1,'G24zz','Secondary hypertension NOS'),('hypertension',1,'G24zz','Secondary hypertension NOS'),('hypertension',1,'G2y..','Other specified hypertensive disease'),('hypertension',1,'G2y..','Other specified hypertensive disease'),('hypertension',1,'G2z..','Hypertensive disease NOS'),('hypertension',1,'G2z..','Hypertensive disease NOS'),('hypertension',1,'G672.','Hypertensive: [encephalopathy] or [crisis]'),('hypertension',1,'Gyu2.','[X]Hypertensive diseases'),('hypertension',1,'Gyu2.','[X]Hypertensive diseases'),('hypertension',1,'Gyu20','[X]Other secondary hypertension'),('hypertension',1,'Gyu20','[X]Other secondary hypertension'),('hypertension',1,'Gyu21','[X]Hypertension secondary to other renal disorders'),('hypertension',1,'Gyu21','[X]Hypertension secondary to other renal disorders'),('hypertension',1,'L122.','Other pre-existing hypertension in preg/childbirth/puerp'),('hypertension',1,'L122.','Other pre-existing hypertension in preg/childbirth/puerp'),('hypertension',1,'L1220','Other pre-existing hypertension in preg/childb/puerp unspec'),('hypertension',1,'L1220','Other pre-existing hypertension in preg/childb/puerp unspec'),('hypertension',1,'L1221','Other pre-existing hypertension in preg/childb/puerp - deliv'),('hypertension',1,'L1221','Other pre-existing hypertension in preg/childb/puerp - deliv'),('hypertension',1,'L1222','Oth pre-exist hypert in preg/childb/puerp -del with p/n comp'),('hypertension',1,'L1222','Oth pre-exist hypert in preg/childb/puerp -del with p/n comp'),('hypertension',1,'L1223','Other pre-exist hypertension in preg/childb/puerp-not deliv'),('hypertension',1,'L1223','Other pre-exist hypertension in preg/childb/puerp-not deliv'),('hypertension',1,'L1224','Other pre-exist hypertension in preg/childb/puerp + p/n comp'),('hypertension',1,'L1224','Other pre-exist hypertension in preg/childb/puerp + p/n comp'),('hypertension',1,'L122z','Other pre-existing hypertension in preg/childb/puerp NOS'),('hypertension',1,'L122z','Other pre-existing hypertension in preg/childb/puerp NOS'),('hypertension',1,'L127.','Pre-eclampsia or eclampsia with pre-existing hypertension'),('hypertension',1,'L127.','Pre-eclampsia or eclampsia with pre-existing hypertension'),('hypertension',1,'L127z','Pre-eclampsia or eclampsia + pre-existing hypertension NOS'),('hypertension',1,'L127z','Pre-eclampsia or eclampsia + pre-existing hypertension NOS'),('hypertension',1,'L128.','Pre-exist hypertension compl preg childbirth and puerperium'),('hypertension',1,'L128.','Pre-exist hypertension compl preg childbirth and puerperium'),('hypertension',1,'L1280','Pre-exist hyperten heart dis compl preg childbth+puerperium'),('hypertension',1,'L1281','Pre-exist hyperten heart renal dis comp preg chldbirth/puerp'),
('hypertension',1,'L1281','Pre-exist hyperten heart renal dis comp preg chldbirth/puerp'),('hypertension',1,'L1282','Pre-exist 2ndry hypertens comp preg childbth and puerprum'),('hypertension',1,'L1282','Pre-exist 2ndry hypertens comp preg childbth and puerprum'),('hypertension',1,'XE0Ub','Hypertension'),('hypertension',1,'XE0Ub','Hypertension'),('hypertension',1,'XE0Ub','Hypertension'),('hypertension',1,'XE0Uc','Essential hypertension'),('hypertension',1,'XE0Uc','Essential hypertension'),('hypertension',1,'XE0Uc','Essential hypertension'),('hypertension',1,'XE0Ud','Essential hypertension NOS'),('hypertension',1,'XE0Ud','Essential hypertension NOS'),('hypertension',1,'XE0Ud','Essential hypertension NOS'),('hypertension',1,'XE0Ue','Hypertensive heart disease NOS without CCF'),('hypertension',1,'XE0Ue','Hypertensive heart disease NOS without CCF'),('hypertension',1,'XE0Ue','Hypertensive heart disease NOS without CCF'),('hypertension',1,'XE0Uf','Hypertensive renal disease'),('hypertension',1,'XE0Uf','Hypertensive renal disease'),('hypertension',1,'XE0VM','Hypertensive encephalopathy'),('hypertension',1,'XE0VM','Hypertensive encephalopathy'),('hypertension',1,'XE0W8','(Hypertensive disease) or (hypertension)'),('hypertension',1,'XE0W8','(Hypertensive disease) or (hypertension)'),('hypertension',1,'XE0xu','Pregnancy with hypertension (& [pre-existing])'),('hypertension',1,'XE2NY','Hypertension monitoring admin.'),('hypertension',1,'XE2NY','Hypertension monitoring admin.'),('hypertension',1,'XE2NZ','Hypertension monitoring check done'),('hypertension',1,'XE2NZ','Hypertension monitoring check done'),('hypertension',1,'XM1Qp','Cardiomegaly - hypertensive'),('hypertension',1,'XM1Qp','Cardiomegaly - hypertensive'),('hypertension',1,'XM1Qp','Cardiomegaly - hypertensive'),('hypertension',1,'XM1U2','Hypertension clinic admin.'),('hypertension',1,'XM1U2','Hypertension clinic admin.'),('hypertension',1,'XM1YA','Hypertension monitoring'),('hypertension',1,'XSDSb','Diastolic hypertension'),('hypertension',1,'XSDSb','Diastolic hypertension'),('hypertension',1,'Xa0Cs','Labile hypertension'),('hypertension',1,'Xa0Cs','Labile hypertension'),('hypertension',1,'Xa0kX','Renovascular hypertension'),('hypertension',1,'Xa0kX','Renovascular hypertension'),('hypertension',1,'Xa0lt','Pre-existing hypertension complicating pregnancy'),('hypertension',1,'Xa0lt','Pre-existing hypertension complicating pregnancy'),('hypertension',1,'Xa3fQ','Malignant hypertension'),('hypertension',1,'Xa3fQ','Malignant hypertension'),('hypertension',1,'Xa8HD','On treatment for hypertension'),('hypertension',1,'XaBLq','Antihypertensive therapy'),('hypertension',1,'XaBSX','Hypertension screening recall'),('hypertension',1,'XaBU4','Hypertension monitoring status'),('hypertension',1,'XaBU5','Hypertension monitoring call'),('hypertension',1,'XaIy8','Moderate hypertension control'),('hypertension',1,'XaIyD','Hypertension six month review'),('hypertension',1,'XaIyE','Hypertension annual review'),('hypertension',1,'XaJ5h','Patient on maximal tolerated antihypertensive therapy'),('hypertension',1,'XaJ5h','Patient on maximal tolerated antihypertensive therapy'),('hypertension',1,'XaJYi','Hypertension clinical management plan'),('hypertension',1,'XaM5f','High cost hypertension drugs'),('hypertension',1,'XaM5n','Other specified high cost hypertension drugs'),('hypertension',1,'XaM5p','High cost hypertension drugs NOS'),('hypertension',1,'XaXOi','Hypertension 9 month review'),('hypertension',1,'XaYZS','Hypertension self-management plan review'),('hypertension',1,'XaZWm','Stage 1 hypertension (NICE - Nat Ins for Hth Clin Excl 2011)'),('hypertension',1,'XaZWm','Stage 1 hypertension (NICE - Nat Ins for Hth Clin Excl 2011)'),('hypertension',1,'XaZWm','Stage 1 hypertension (NICE - Nat Ins for Hth Clin Excl 2011)'),('hypertension',1,'XaZWn','Severe hypertension (Nat Inst for Health Clinical Ex 2011)'),('hypertension',1,'XaZWn','Severe hypertension (Nat Inst for Health Clinical Ex 2011)'),('hypertension',1,'XaZWn','Severe hypertension (Nat Inst for Health Clinical Ex 2011)'),('hypertension',1,'XaZbT','Hypertension resistant to drug therapy'),('hypertension',1,'XaZbT','Hypertension resistant to drug therapy'),('hypertension',1,'XaZbz','Stage 2 hypertension (NICE - Nat Ins for Hth Clin Excl 2011)'),('hypertension',1,'XaZbz','Stage 2 hypertension (NICE - Nat Ins for Hth Clin Excl 2011)'),('hypertension',1,'XaZzo','Nocturnal hypertension'),('hypertension',1,'XaZzo','Nocturnal hypertension'),('hypertension',1,'Xab9L','Stage 1 hyperten (NICE 2011) without evidnce end organ damge'),('hypertension',1,'Xab9L','Stage 1 hyperten (NICE 2011) without evidnce end organ damge'),('hypertension',1,'Xab9M','Stage 1 hyperten (NICE 2011) with evidnce end organ damge'),('hypertension',1,'Xab9M','Stage 1 hyperten (NICE 2011) with evidnce end organ damge'),('hypertension',1,'Xafj3','Hypertension monitoring invitation short msg service txt msg'),('hypertension',1,'Xafj4','Hypertension mnitoring short msg service text msg 1st invitn'),('hypertension',1,'Xafj5','Hypertension mnitoring short msg service text msg 2nd invitn'),('hypertension',1,'Xafj6','Hypertension mnitoring short msg service text msg 3rd invitn'),('hypertension',1,'XagLb','Hypertension monitoring invitation email'),('hypertension',1,'Y1328','Refractory Hypertension');
INSERT INTO #codesctv3
VALUES ('methotrexate',1,'h34..','Methotrexate'),('methotrexate',1,'h341.','Methotrexate 2.5mg tablet'),('methotrexate',1,'h342.','Methotrexate 10mg tablet'),('methotrexate',1,'h343.','Methotrexate 2.5mg/1mL injection solution'),('methotrexate',1,'h344.','Methotrexate 5mg/2mL injection'),('methotrexate',1,'h345.','Methotrexate 25mg/1mL injection'),('methotrexate',1,'h346.','Methotrexate 50mg/2mL injection'),('methotrexate',1,'h347.','Methotrexate 100mg/4mL injection'),('methotrexate',1,'h348.','Methotrexate 200mg/8mL injection'),('methotrexate',1,'h349.','Methotrexate 500mg/20mL injection'),('methotrexate',1,'h34A.','METHOTREXATE 15mg/1.5mL solution for injection p/f syringe'),('methotrexate',1,'h34a.','Methotrexate 1g/40mL injection'),('methotrexate',1,'h34B.','METHOTREXATE 20mg/2mL solution for injection p/f syringe'),('methotrexate',1,'h34b.','Methotrexate 5g/200mL injection'),('methotrexate',1,'h34C.','METHOTREXATE 25mg/2.5mL solution for injection p/f syringe'),('methotrexate',1,'h34c.','Methotrexate 500mg injection (pdr for recon)'),('methotrexate',1,'h34d.','Emtexate 10mg tablet'),('methotrexate',1,'h34D.','METOJECT 7.5mg/0.75mL solution for injection p/f syringe'),('methotrexate',1,'h34e.','Emtexate 5mg/2mL injection solution'),('methotrexate',1,'h34E.','METOJECT 10mg/1mL solution for injection prefilled syringe'),('methotrexate',1,'h34f.','Emtexate 50mg/2mL injection solution'),('methotrexate',1,'h34F.','METOJECT 15mg/1.5mL solution for injection prefilled syringe'),('methotrexate',1,'h34g.','Emtexate 250mg/10mL injection solution'),('methotrexate',1,'h34G.','METOJECT 20mg/2mL solution for injection prefilled syringe'),('methotrexate',1,'h34h.','Emtexate 500mg/20mL injection solution'),('methotrexate',1,'h34H.','METOJECT 25mg/2.5mL solution for injection prefilled syringe'),('methotrexate',1,'h34i.','Emtexate 1g/40mL injection solution'),('methotrexate',1,'h34j.','Emtexate 5g/200mL injection solution'),('methotrexate',1,'h34k.','Emtexate 1g/10mL injection solution'),('methotrexate',1,'h34l.','Emtexate 5g/50mL injection solution'),('methotrexate',1,'h34L.','METOJECT 7.5mg/0.15mL solution for injection pfs'),('methotrexate',1,'h34m.','Emtexate 0.5g injection (pdr for recon)'),('methotrexate',1,'h34M.','METHOTREXATE 7.5mg/0.15mL solution for injection pfs'),('methotrexate',1,'h34n.','Emtexate 1g injection (pdr for recon)'),('methotrexate',1,'h34N.','METOJECT 10mg/0.2mL solution for injection prefilled syringe'),('methotrexate',1,'h34o.','Emtexate 5g injection (pdr for recon)'),('methotrexate',1,'h34O.','METHOTREXATE 10mg/0.2mL solution for injection pfs'),('methotrexate',1,'h34p.','Maxtrex 2.5mg tablet'),('methotrexate',1,'h34P.','METOJECT 15mg/0.3mL solution for injection prefilled syringe'),('methotrexate',1,'h34q.','Maxtrex 10mg tablet'),('methotrexate',1,'h34Q.','METHOTREXATE 15mg/0.3mL solution for injection pfs'),('methotrexate',1,'h34r.','Maxtrex 5mg/2mL injection solution'),('methotrexate',1,'h34R.','METOJECT 20mg/0.4mL solution for injection prefilled syringe'),('methotrexate',1,'h34s.','Maxtrex 50mg/2mL injection solution'),('methotrexate',1,'h34S.','METHOTREXATE 20mg/0.4mL solution for injection pfs'),('methotrexate',1,'h34t.','Maxtrex 500mg/20mL injection solution'),('methotrexate',1,'h34T.','METOJECT 25mg/0.5mL solution for injection prefilled syringe'),('methotrexate',1,'h34u.','Maxtrex 1g/40mL injection solution'),('methotrexate',1,'h34U.','METHOTREXATE 25mg/0.5mL solution for injection pfs'),('methotrexate',1,'h34v.','Maxtrex 5g/200mL injection solution'),('methotrexate',1,'h34V.','METOJECT 30mg/0.6mL solution for injection prefilled syringe'),('methotrexate',1,'h34w.','Methotrexate 1g/10mL injection'),('methotrexate',1,'h34W.','METHOTREXATE 30mg/0.6mL solution for injection pfs'),('methotrexate',1,'h34X.','EBETREX 7.5mg/0.75mL soln for injection prefilled syringe'),('methotrexate',1,'h34x.','Methotrexate 5g/50mL injection'),('methotrexate',1,'h34Y.','EBETREX 10mg/1mL solution for injection prefilled syringe'),('methotrexate',1,'h34y.','METHOTREXATE 7.5mg/0.75mL solution for injection p/f syringe'),('methotrexate',1,'h34Z.','EBETREX 15mg/1.5mL solution for injection prefilled syringe'),('methotrexate',1,'h34z.','METHOTREXATE 10mg/1mL solution for injection p/f syringe'),('methotrexate',1,'h3G..%','METHOTREXATE(2)'),('methotrexate',1,'h3G1.','EBETREX 20mg/1mL solution for injection prefilled syringe'),('methotrexate',1,'h3G2.','EBETREX 25mg/1.25mL solution for injection prefilled syringe'),('methotrexate',1,'h3G3.','EBETREX 30mg/1.5mL solution for injection prefilled syringe'),('methotrexate',1,'h3G4.','METHOTREXATE 20mg/1mL solution for injection p/f syringe'),('methotrexate',1,'h3G5.','METHOTREXATE 25mg/1.25mL solution for injection p/f syringe'),('methotrexate',1,'h3G6.','METHOTREXATE 30mg/1.5mL solution for injection p/f syringe'),('methotrexate',1,'h3G7.','METOJECT 12.5mg/0.25mL soln for injection prefilled syringe'),('methotrexate',1,'h3G8.','METHOTREXATE 12.5mg/0.25mL solution for injection pfs'),('methotrexate',1,'h3G9.','METOJECT 17.5mg/0.35mL soln for injection prefilled syringe'),('methotrexate',1,'h3GA.','METHOTREXATE 17.5mg/0.35mL solution for injection pfs'),('methotrexate',1,'h3GB.','METOJECT 22.5mg/0.45mL soln for injection prefilled syringe'),('methotrexate',1,'h3GC.','METHOTREXATE 22.5mg/0.45mL solution for injection pfs'),('methotrexate',1,'h3GD.','METOJECT 27.5mg/0.55mL soln for injection prefilled syringe'),('methotrexate',1,'h3GE.','METHOTREXATE 27.5mg/0.55mL solution for injection pfs'),('methotrexate',1,'h3GF.','METOJECT PEN 7.5mg/0.15mL soln for injection prefilled pen'),('methotrexate',1,'h3GG.','METHOTREXATE 7.5mg/0.15mL soln for injection prefilled pen'),('methotrexate',1,'h3GH.','METOJECT PEN 10mg/0.2mL solution for injection prefilled pen'),('methotrexate',1,'h3GI.','METHOTREXATE 10mg/0.2mL solution for injection prefilled pen'),('methotrexate',1,'h3GJ.','METOJECT PEN 12.5mg/0.25mL soln for injection prefilled pen'),('methotrexate',1,'h3GK.','METHOTREXATE 12.5mg/0.25mL soln for injection prefilled pen'),('methotrexate',1,'h3GL.','METOJECT PEN 15mg/0.3mL solution for injection prefilled pen'),('methotrexate',1,'h3GM.','METHOTREXATE 15mg/0.3mL solution for injection prefilled pen'),('methotrexate',1,'h3GN.','METOJECT PEN 17.5mg/0.35mL soln for injection prefilled pen'),('methotrexate',1,'h3GO.','METHOTREXATE 17.5mg/0.35mL soln for injection prefilled pen'),('methotrexate',1,'h3GP.','METOJECT PEN 20mg/0.4mL solution for injection prefilled pen'),('methotrexate',1,'h3GQ.','METHOTREXATE 20mg/0.4mL solution for injection prefilled pen'),('methotrexate',1,'h3GR.','METOJECT PEN 22.5mg/0.45mL soln for injection prefilled pen'),('methotrexate',1,'h3GS.','METHOTREXATE 22.5mg/0.45mL soln for injection prefilled pen'),('methotrexate',1,'h3GT.','METOJECT PEN 25mg/0.5mL solution for injection prefilled pen'),('methotrexate',1,'h3GU.','METHOTREXATE 25mg/0.5mL solution for injection prefilled pen'),('methotrexate',1,'h3GV.','METOJECT PEN 27.5mg/0.55mL soln for injection prefilled pen'),('methotrexate',1,'h3GW.','METHOTREXATE 27.5mg/0.55mL soln for injection prefilled pen'),('methotrexate',1,'h3GX.','METOJECT PEN 30mg/0.6mL solution for injection prefilled pen'),('methotrexate',1,'h3GY.','METHOTREXATE 30mg/0.6mL solution for injection prefilled pen'),('methotrexate',1,'h3GZ.','METHOTREXATE 2mg/mL oral solution'),('methotrexate',1,'x00Oq','Methotrexate 375mg/30mL infusion'),('methotrexate',1,'x00Or','Methotrexate 750mg/60mL infusion')

IF OBJECT_ID('tempdb..#codessnomed') IS NOT NULL DROP TABLE #codessnomed;
CREATE TABLE #codessnomed (
  [concept] [varchar](255) NOT NULL,
  [version] INT NOT NULL,
	[code] [varchar](20) COLLATE Latin1_General_CS_AS NOT NULL,
	[description] [varchar](255) NULL
) ON [PRIMARY];

INSERT INTO #codessnomed
VALUES ('hypertension',1,'153931000119109','Acute combined systolic and diastolic heart failure'),('hypertension',1,'10633002','Acute congestive heart failure'),('hypertension',1,'49584005','Acute cor pulmonale'),('hypertension',1,'443343001','Acute diastolic heart failure'),('hypertension',1,'698296002','Acute exacerbation of chronic congestive heart failure'),('hypertension',1,'56675007','Acute heart failure'),('hypertension',1,'195114002','Acute left ventricular failure'),('hypertension',1,'74960003','Acute left-sided congestive heart failure'),('hypertension',1,'364006','Acute left-sided heart failure'),('hypertension',1,'153951000119103','Acute on chronic combined systolic and diastolic heart failure'),('hypertension',1,'443344007','Acute on chronic diastolic heart failure'),('hypertension',1,'443253003','Acute on chronic systolic heart failure'),('hypertension',1,'80479009','Acute right-sided congestive heart failure'),('hypertension',1,'359617009','Acute right-sided heart failure'),('hypertension',1,'443254009','Acute systolic heart failure'),('hypertension',1,'78862003','Ayerzas syndrome'),('hypertension',1,'194767001','Benign hypertensive heart disease with congestive cardiac failure'),('hypertension',1,'13839000','Bernheims syndrome'),('hypertension',1,'92506005','Biventricular congestive heart failure'),('hypertension',1,'71892000','Cardiac asthma'),('hypertension',1,'410431009','Cardiorespiratory failure'),('hypertension',1,'153941000119100','Chronic combined systolic and diastolic heart failure'),('hypertension',1,'88805009','Chronic congestive heart failure'),('hypertension',1,'79955004','Chronic cor pulmonale'),('hypertension',1,'441530006','Chronic diastolic heart failure'),('hypertension',1,'48447003','Chronic heart failure'),('hypertension',1,'5375005','Chronic left-sided congestive heart failure'),('hypertension',1,'111283005','Chronic left-sided heart failure'),('hypertension',1,'66989003','Chronic right-sided congestive heart failure'),('hypertension',1,'10335000','Chronic right-sided heart failure'),('hypertension',1,'441481004','Chronic systolic heart failure'),('hypertension',1,'195112003','Compensated cardiac failure'),('hypertension',1,'206586007','Congenital cardiac failure'),('hypertension',1,'42343007','Congestive heart failure'),('hypertension',1,'72481000119103','Congestive heart failure as early postoperative complication'),('hypertension',1,'101281000119107','Congestive heart failure due to cardiomyopathy'),('hypertension',1,'426263006','Congestive heart failure due to left ventricular systolic dysfunction'),('hypertension',1,'426611007','Congestive heart failure due to valvular disease'),('hypertension',1,'717840005','Congestive heart failure stage B'),('hypertension',1,'15629591000119103','Congestive heart failure stage B due to ischaemic cardiomyopathy'),('hypertension',1,'67441000119101','Congestive heart failure stage C'),('hypertension',1,'15629541000119106','Congestive heart failure stage C due to ischaemic cardiomyopathy'),('hypertension',1,'67431000119105','Congestive heart failure stage D'),('hypertension',1,'23341000119109','Congestive heart failure with right heart failure'),('hypertension',1,'82523003','Congestive rheumatic heart failure'),('hypertension',1,'83291003','Cor pulmonale'),('hypertension',1,'195111005','Decompensated cardiac failure'),('hypertension',1,'424404003','Decompensated chronic heart failure'),('hypertension',1,'371862006','Depression of left ventricular systolic function'),('hypertension',1,'418304008','Diastolic heart failure'),('hypertension',1,'120891000119109','Diastolic heart failure stage C'),('hypertension',1,'120881000119106','Diastolic heart failure stage D'),('hypertension',1,'96311000119109','Exacerbation of congestive heart failure'),('hypertension',1,'84114007','Heart failure'),('hypertension',1,'233924009','Heart failure as a complication of care'),('hypertension',1,'471880001','Heart failure due to end stage congenital heart disease'),('hypertension',1,'446221000','Heart failure with normal ejection fraction'),('hypertension',1,'703272007','Heart failure with reduced ejection fraction'),('hypertension',1,'703275009','Heart failure with reduced ejection fraction due to cardiomyopathy'),('hypertension',1,'703273002','Heart failure with reduced ejection fraction due to coronary artery disease'),('hypertension',1,'703276005','Heart failure with reduced ejection fraction due to heart valve disease'),('hypertension',1,'703274008','Heart failure with reduced ejection fraction due to myocarditis'),('hypertension',1,'10091002','High output heart failure'),('hypertension',1,'15781000119107','Hypertensive heart AND chronic kidney disease with congestive heart failure'),('hypertension',1,'194779001','Hypertensive heart and renal disease with (congestive) heart failure'),('hypertension',1,'194781004','Hypertensive heart and renal disease with both (congestive) heart failure and renal failure'),('hypertension',1,'5148006','Hypertensive heart disease with congestive heart failure'),('hypertension',1,'46113002','Hypertensive heart failure'),('hypertension',1,'275514001','Impaired left ventricular function'),('hypertension',1,'85232009','Left heart failure'),('hypertension',1,'44088000','Low cardiac output syndrome'),('hypertension',1,'25544003','Low output heart failure'),('hypertension',1,'83105008','Malignant hypertensive heart disease with congestive heart failure'),('hypertension',1,'314206003','Refractory heart failure'),('hypertension',1,'43736008','Rheumatic left ventricular failure'),('hypertension',1,'128404006','Right heart failure'),('hypertension',1,'426012001','Right heart failure due to pulmonary hypertension'),('hypertension',1,'44313006','Right heart failure secondary to left heart failure'),('hypertension',1,'367363000','Right ventricular failure'),('hypertension',1,'15964701000119109','Saddle embolus of pulmonary artery with acute cor pulmonale'),('hypertension',1,'698594003','Symptomatic congestive heart failure'),('hypertension',1,'417996009','Systolic heart failure'),('hypertension',1,'120861000119102','Systolic heart failure stage C'),('hypertension',1,'15629741000119102','Systolic heart failure stage C due to ischaemic cardiomyopathy'),('hypertension',1,'120851000119104','Systolic heart failure stage D');
INSERT INTO #codessnomed
VALUES ('methotrexate',1,'19954111000001103','Ebetrex 10mg/1ml solution for injection pre-filled syringes (Sandoz Ltd)'),('methotrexate',1,'19954411000001108','Ebetrex 15mg/1.5ml solution for injection pre-filled syringes (Sandoz Ltd)'),('methotrexate',1,'19956011000001109','Ebetrex 20mg/1ml solution for injection pre-filled syringes (Sandoz Ltd)'),('methotrexate',1,'19955711000001103','Ebetrex 25mg/1.25ml solution for injection pre-filled syringes (Sandoz Ltd)'),('methotrexate',1,'19972411000001103','Ebetrex 30mg/1.5ml solution for injection pre-filled syringes (Sandoz Ltd)'),('methotrexate',1,'19953911000001102','Ebetrex 7.5mg/0.75ml solution for injection pre-filled syringes (Sandoz Ltd)'),('methotrexate',1,'34871011000001105','Jylamvo 2mg/ml oral solution (Intrapharm Laboratories Ltd)'),('methotrexate',1,'322011000001106','Maxtrex 10mg tablets (Pfizer Ltd)'),('methotrexate',1,'644711000001108','Maxtrex 2.5mg tablets (Pfizer Ltd)'),('methotrexate',1,'34776911000001102','Methofill 10mg/0.2ml solution for injection pre-filled injector (Accord Healthcare Ltd)'),('methotrexate',1,'34777311000001100','Methofill 12.5mg/0.25ml solution for injection pre-filled injector (Accord Healthcare Ltd)'),('methotrexate',1,'34777111000001102','Methofill 15mg/0.3ml solution for injection pre-filled injector (Accord Healthcare Ltd)'),('methotrexate',1,'34777611000001105','Methofill 17.5mg/0.35ml solution for injection pre-filled injector (Accord Healthcare Ltd)'),('methotrexate',1,'34777811000001109','Methofill 20mg/0.4ml solution for injection pre-filled injector (Accord Healthcare Ltd)'),('methotrexate',1,'34778011000001102','Methofill 22.5mg/0.45ml solution for injection pre-filled injector (Accord Healthcare Ltd)'),('methotrexate',1,'34778211000001107','Methofill 25mg/0.5ml solution for injection pre-filled injector (Accord Healthcare Ltd)'),('methotrexate',1,'34778411000001106','Methofill 27.5mg/0.55ml solution for injection pre-filled injector (Accord Healthcare Ltd)'),('methotrexate',1,'34778611000001109','Methofill 30mg/0.6ml solution for injection pre-filled injector (Accord Healthcare Ltd)'),('methotrexate',1,'34776411000001105','Methofill 7.5mg/0.15ml solution for injection pre-filled injector (Accord Healthcare Ltd)'),('methotrexate',1,'68887009','Methotrexate'),('methotrexate',1,'769892005','Methotrexate (as methotrexate sodium) 1 g/10 mL solution for injection vial'),('methotrexate',1,'769898009','Methotrexate (as methotrexate sodium) 1 g/40 mL solution for injection vial'),('methotrexate',1,'769899001','Methotrexate (as methotrexate sodium) 200 mg/8 mL solution for injection vial'),('methotrexate',1,'769895007','Methotrexate (as methotrexate sodium) 5 g/200 mL solution for injection vial'),('methotrexate',1,'769893000','Methotrexate (as methotrexate sodium) 5 g/50 mL solution for injection vial'),('methotrexate',1,'769894006','Methotrexate (as methotrexate sodium) 5 mg/2 mL solution for injection vial'),('methotrexate',1,'769897004','Methotrexate (as methotrexate sodium) 50 mg/2 mL solution for injection vial'),('methotrexate',1,'769896008','Methotrexate (as methotrexate sodium) 500 mg/20 mL solution for injection vial'),('methotrexate',1,'326875008','Methotrexate 10mg tablets'),('methotrexate',1,'928011000001103','Methotrexate 10mg tablets (A A H Pharmaceuticals Ltd)'),('methotrexate',1,'136411000001105','Methotrexate 10mg tablets (Alliance Healthcare (Distribution) Ltd)'),('methotrexate',1,'24381411000001107','Methotrexate 10mg tablets (DE Pharmaceuticals)'),('methotrexate',1,'24135711000001100','Methotrexate 10mg tablets (Morningside Healthcare Ltd)'),('methotrexate',1,'14963911000001107','Methotrexate 10mg tablets (Orion Pharma (UK) Ltd)'),('methotrexate',1,'191111000001100','Methotrexate 10mg tablets (Pfizer Ltd)'),('methotrexate',1,'20310811000001101','Methotrexate 10mg tablets (Sandoz Ltd)'),('methotrexate',1,'15109411000001107','Methotrexate 10mg tablets (Sigma Pharmaceuticals Plc)'),('methotrexate',1,'22222111000001103','Methotrexate 10mg tablets (Teva UK Ltd)'),('methotrexate',1,'21796511000001106','Methotrexate 10mg tablets (Waymade Healthcare Plc)'),('methotrexate',1,'11026611000001103','Methotrexate 10mg tablets (Wockhardt UK Ltd)'),('methotrexate',1,'24594311000001100','Methotrexate 10mg/0.2ml solution for injection pre-filled disposable devices'),('methotrexate',1,'15517911000001104','Methotrexate 10mg/0.2ml solution for injection pre-filled syringes'),('methotrexate',1,'34167711000001101','Methotrexate 10mg/0.4ml solution for injection pre-filled disposable devices'),('methotrexate',1,'9468211000001108','Methotrexate 10mg/0.4ml solution for injection pre-filled syringes'),('methotrexate',1,'9455911000001104','Methotrexate 10mg/0.4ml solution for injection pre-filled syringes (Special Order)'),('methotrexate',1,'10675611000001107','Methotrexate 10mg/1ml solution for injection pre-filled syringes'),('methotrexate',1,'8664911000001105','Methotrexate 10mg/5ml oral solution'),('methotrexate',1,'8618111000001102','Methotrexate 10mg/5ml oral solution (Special Order)'),('methotrexate',1,'8665011000001105','Methotrexate 10mg/5ml oral suspension'),('methotrexate',1,'8618811000001109','Methotrexate 10mg/5ml oral suspension (Special Order)'),('methotrexate',1,'24594411000001107','Methotrexate 12.5mg/0.25ml solution for injection pre-filled disposable devices'),('methotrexate',1,'19231311000001104','Methotrexate 12.5mg/0.25ml solution for injection pre-filled syringes'),('methotrexate',1,'34167811000001109','Methotrexate 12.5mg/0.5ml solution for injection pre-filled disposable devices'),('methotrexate',1,'9468311000001100','Methotrexate 12.5mg/0.5ml solution for injection pre-filled syringes'),('methotrexate',1,'9455211000001108','Methotrexate 12.5mg/0.5ml solution for injection pre-filled syringes (Special Order)'),('methotrexate',1,'8665111000001106','Methotrexate 12.5mg/5ml oral solution'),('methotrexate',1,'8619311000001106','Methotrexate 12.5mg/5ml oral solution (Special Order)'),('methotrexate',1,'8665211000001100','Methotrexate 12.5mg/5ml oral suspension'),('methotrexate',1,'8619611000001101','Methotrexate 12.5mg/5ml oral suspension (Special Order)'),('methotrexate',1,'12813911000001109','Methotrexate 12mg/5ml oral solution'),('methotrexate',1,'12794011000001105','Methotrexate 12mg/5ml oral solution (Special Order)'),('methotrexate',1,'12814011000001107','Methotrexate 12mg/5ml oral suspension'),('methotrexate',1,'12793711000001105','Methotrexate 12mg/5ml oral suspension (Special Order)'),('methotrexate',1,'374444008','Methotrexate 15 mg oral tablet'),('methotrexate',1,'24594511000001106','Methotrexate 15mg/0.3ml solution for injection pre-filled disposable devices'),('methotrexate',1,'15518011000001102','Methotrexate 15mg/0.3ml solution for injection pre-filled syringes'),('methotrexate',1,'34167911000001104','Methotrexate 15mg/0.6ml solution for injection pre-filled disposable devices'),('methotrexate',1,'9468411000001107','Methotrexate 15mg/0.6ml solution for injection pre-filled syringes'),('methotrexate',1,'9454211000001107','Methotrexate 15mg/0.6ml solution for injection pre-filled syringes (Special Order)'),('methotrexate',1,'10675711000001103','Methotrexate 15mg/1.5ml solution for injection pre-filled syringes'),('methotrexate',1,'8665311000001108','Methotrexate 15mg/5ml oral solution'),('methotrexate',1,'8619911000001107','Methotrexate 15mg/5ml oral solution (Special Order)'),('methotrexate',1,'8665411000001101','Methotrexate 15mg/5ml oral suspension'),('methotrexate',1,'8620311000001107','Methotrexate 15mg/5ml oral suspension (Special Order)'),('methotrexate',1,'24594611000001105','Methotrexate 17.5mg/0.35ml solution for injection pre-filled disposable devices'),('methotrexate',1,'19231411000001106','Methotrexate 17.5mg/0.35ml solution for injection pre-filled syringes'),('methotrexate',1,'34168011000001102','Methotrexate 17.5mg/0.7ml solution for injection pre-filled disposable devices'),('methotrexate',1,'9468511000001106','Methotrexate 17.5mg/0.7ml solution for injection pre-filled syringes'),('methotrexate',1,'9453611000001106','Methotrexate 17.5mg/0.7ml solution for injection pre-filled syringes (Special Order)'),('methotrexate',1,'12814111000001108','Methotrexate 17.5mg/5ml oral solution'),('methotrexate',1,'12794611000001103','Methotrexate 17.5mg/5ml oral solution (Special Order)'),('methotrexate',1,'12814211000001102','Methotrexate 17.5mg/5ml oral suspension'),('methotrexate',1,'12794311000001108','Methotrexate 17.5mg/5ml oral suspension (Special Order)'),('methotrexate',1,'12814311000001105','Methotrexate 18mg/5ml oral solution'),('methotrexate',1,'12796111000001104','Methotrexate 18mg/5ml oral solution (Special Order)'),('methotrexate',1,'12814411000001103','Methotrexate 18mg/5ml oral suspension'),('methotrexate',1,'12795811000001103','Methotrexate 18mg/5ml oral suspension (Special Order)'),('methotrexate',1,'36032911000001108','Methotrexate 1g/10ml solution for injection vials'),('methotrexate',1,'3618611000001106','Methotrexate 1g/10ml solution for injection vials (A A H Pharmaceuticals Ltd)'),('methotrexate',1,'3619511000001101','Methotrexate 1g/10ml solution for injection vials (Alliance Healthcare (Distribution) Ltd)'),('methotrexate',1,'3619211000001104','Methotrexate 1g/10ml solution for injection vials (Pfizer Ltd)'),('methotrexate',1,'9561911000001100','Methotrexate 1g/10ml solution for injection vials (Wockhardt UK Ltd)'),('methotrexate',1,'36033011000001100','Methotrexate 1g/40ml solution for injection vials'),('methotrexate',1,'3624511000001106','Methotrexate 1g/40ml solution for injection vials (A A H Pharmaceuticals Ltd)'),('methotrexate',1,'27951711000001108','Methotrexate 1g/40ml solution for injection vials (Accord Healthcare Ltd)'),('methotrexate',1,'3625011000001104','Methotrexate 1g/40ml solution for injection vials (Advanz Pharma)'),('methotrexate',1,'3624711000001101','Methotrexate 1g/40ml solution for injection vials (Alliance Healthcare (Distribution) Ltd)'),
('methotrexate',1,'11091011000001108','Methotrexate 1g/40ml solution for injection vials (Teva UK Ltd)'),('methotrexate',1,'12814511000001104','Methotrexate 1mg/5ml oral solution'),('methotrexate',1,'12796711000001103','Methotrexate 1mg/5ml oral solution (Special Order)'),('methotrexate',1,'12814611000001100','Methotrexate 1mg/5ml oral suspension'),('methotrexate',1,'12796411000001109','Methotrexate 1mg/5ml oral suspension (Special Order)'),('methotrexate',1,'326874007','Methotrexate 2.5mg tablets'),('methotrexate',1,'201811000001107','Methotrexate 2.5mg tablets (A A H Pharmaceuticals Ltd)'),('methotrexate',1,'683611000001105','Methotrexate 2.5mg tablets (Advanz Pharma)'),('methotrexate',1,'706911000001103','Methotrexate 2.5mg tablets (Alliance Healthcare (Distribution) Ltd)'),('methotrexate',1,'34956611000001101','Methotrexate 2.5mg tablets (Almus Pharmaceuticals Ltd)'),('methotrexate',1,'24381611000001105','Methotrexate 2.5mg tablets (DE Pharmaceuticals)'),('methotrexate',1,'167911000001107','Methotrexate 2.5mg tablets (Kent Pharmaceuticals Ltd)'),('methotrexate',1,'24136011000001106','Methotrexate 2.5mg tablets (Morningside Healthcare Ltd)'),('methotrexate',1,'14962511000001107','Methotrexate 2.5mg tablets (Orion Pharma (UK) Ltd)'),('methotrexate',1,'383711000001107','Methotrexate 2.5mg tablets (Pfizer Ltd)'),('methotrexate',1,'20310611000001100','Methotrexate 2.5mg tablets (Sandoz Ltd)'),('methotrexate',1,'14709211000001105','Methotrexate 2.5mg tablets (Sigma Pharmaceuticals Plc)'),('methotrexate',1,'29918911000001101','Methotrexate 2.5mg tablets (Sigma Pharmaceuticals Plc)'),('methotrexate',1,'22222311000001101','Methotrexate 2.5mg tablets (Teva UK Ltd)'),('methotrexate',1,'14946711000001105','Methotrexate 2.5mg tablets (Waymade Healthcare Plc)'),('methotrexate',1,'21796211000001108','Methotrexate 2.5mg tablets (Waymade Healthcare Plc)'),('methotrexate',1,'11026411000001101','Methotrexate 2.5mg tablets (Wockhardt UK Ltd)'),('methotrexate',1,'8665611000001103','Methotrexate 2.5mg/5ml oral solution'),('methotrexate',1,'8622711000001105','Methotrexate 2.5mg/5ml oral solution (Special Order)'),('methotrexate',1,'8665711000001107','Methotrexate 2.5mg/5ml oral suspension'),('methotrexate',1,'8624211000001107','Methotrexate 2.5mg/5ml oral suspension (Special Order)'),('methotrexate',1,'36033111000001104','Methotrexate 200mg/8ml solution for injection vials'),('methotrexate',1,'3621611000001108','Methotrexate 200mg/8ml solution for injection vials (A A H Pharmaceuticals Ltd)'),('methotrexate',1,'3621811000001107','Methotrexate 200mg/8ml solution for injection vials (Advanz Pharma)'),('methotrexate',1,'3622011000001109','Methotrexate 200mg/8ml solution for injection vials (Alliance Healthcare (Distribution) Ltd)'),('methotrexate',1,'24594711000001101','Methotrexate 20mg/0.4ml solution for injection pre-filled disposable devices'),('methotrexate',1,'15518111000001101','Methotrexate 20mg/0.4ml solution for injection pre-filled syringes'),('methotrexate',1,'34168111000001101','Methotrexate 20mg/0.8ml solution for injection pre-filled disposable devices'),('methotrexate',1,'9468611000001105','Methotrexate 20mg/0.8ml solution for injection pre-filled syringes'),('methotrexate',1,'9453111000001103','Methotrexate 20mg/0.8ml solution for injection pre-filled syringes (Special Order)'),('methotrexate',1,'19976011000001106','Methotrexate 20mg/1ml solution for injection pre-filled syringes'),('methotrexate',1,'10675811000001106','Methotrexate 20mg/2ml solution for injection pre-filled syringes'),('methotrexate',1,'12814711000001109','Methotrexate 20mg/5ml oral solution'),('methotrexate',1,'12798611000001108','Methotrexate 20mg/5ml oral solution (Special Order)'),('methotrexate',1,'12814811000001101','Methotrexate 20mg/5ml oral suspension'),('methotrexate',1,'12798211000001106','Methotrexate 20mg/5ml oral suspension (Special Order)'),('methotrexate',1,'24594811000001109','Methotrexate 22.5mg/0.45ml solution for injection pre-filled disposable devices'),('methotrexate',1,'19231511000001105','Methotrexate 22.5mg/0.45ml solution for injection pre-filled syringes'),('methotrexate',1,'34168211000001107','Methotrexate 22.5mg/0.9ml solution for injection pre-filled disposable devices'),('methotrexate',1,'9468711000001101','Methotrexate 22.5mg/0.9ml solution for injection pre-filled syringes'),('methotrexate',1,'9452811000001102','Methotrexate 22.5mg/0.9ml solution for injection pre-filled syringes (Special Order)'),('methotrexate',1,'12814911000001106','Methotrexate 22.5mg/5ml oral solution'),('methotrexate',1,'12800111000001102','Methotrexate 22.5mg/5ml oral solution (Special Order)'),('methotrexate',1,'12815011000001106','Methotrexate 22.5mg/5ml oral suspension'),('methotrexate',1,'12799711000001108','Methotrexate 22.5mg/5ml oral suspension (Special Order)'),('methotrexate',1,'24594911000001104','Methotrexate 25mg/0.5ml solution for injection pre-filled disposable devices'),('methotrexate',1,'15518211000001107','Methotrexate 25mg/0.5ml solution for injection pre-filled syringes'),('methotrexate',1,'19976111000001107','Methotrexate 25mg/1.25ml solution for injection pre-filled syringes'),('methotrexate',1,'34168311000001104','Methotrexate 25mg/1ml solution for injection pre-filled disposable devices'),('methotrexate',1,'9468811000001109','Methotrexate 25mg/1ml solution for injection pre-filled syringes'),('methotrexate',1,'9452311000001106','Methotrexate 25mg/1ml solution for injection pre-filled syringes (Special Order)'),('methotrexate',1,'10675911000001101','Methotrexate 25mg/2.5ml solution for injection pre-filled syringes'),('methotrexate',1,'14967911000001103','Methotrexate 25mg/3ml solution for injection pre-filled syringes'),('methotrexate',1,'14966611000001107','Methotrexate 25mg/3ml solution for injection pre-filled syringes (Special Order)'),('methotrexate',1,'12816911000001103','Methotrexate 25mg/5ml oral solution'),('methotrexate',1,'12800911000001104','Methotrexate 25mg/5ml oral solution (Special Order)'),('methotrexate',1,'12817011000001104','Methotrexate 25mg/5ml oral suspension'),('methotrexate',1,'12800611000001105','Methotrexate 25mg/5ml oral suspension (Special Order)'),('methotrexate',1,'766413008','Methotrexate 25mg/mL conventional release solution for injection'),('methotrexate',1,'24595011000001104','Methotrexate 27.5mg/0.55ml solution for injection pre-filled disposable devices'),('methotrexate',1,'19231611000001109','Methotrexate 27.5mg/0.55ml solution for injection pre-filled syringes'),('methotrexate',1,'9468911000001104','Methotrexate 27.5mg/1.1ml solution for injection pre-filled syringes'),('methotrexate',1,'9451611000001107','Methotrexate 27.5mg/1.1ml solution for injection pre-filled syringes (Special Order)'),('methotrexate',1,'30799911000001104','Methotrexate 2mg/ml oral solution sugar free'),('methotrexate',1,'31065011000001106','Methotrexate 2mg/ml oral solution sugar free (A A H Pharmaceuticals Ltd)'),('methotrexate',1,'30985211000001103','Methotrexate 2mg/ml oral solution sugar free (Alliance Healthcare (Distribution) Ltd)'),('methotrexate',1,'30595111000001100','Methotrexate 2mg/ml oral solution sugar free (Rosemont Pharmaceuticals Ltd)'),('methotrexate',1,'12817111000001103','Methotrexate 3.75mg/5ml oral solution'),('methotrexate',1,'12801511000001104','Methotrexate 3.75mg/5ml oral solution (Special Order)'),('methotrexate',1,'12817211000001109','Methotrexate 3.75mg/5ml oral suspension'),('methotrexate',1,'12801211000001102','Methotrexate 3.75mg/5ml oral suspension (Special Order)'),('methotrexate',1,'24595111000001103','Methotrexate 30mg/0.6ml solution for injection pre-filled disposable devices'),('methotrexate',1,'18245711000001104','Methotrexate 30mg/0.6ml solution for injection pre-filled syringes'),('methotrexate',1,'9469011000001108','Methotrexate 30mg/1.2ml solution for injection pre-filled syringes'),('methotrexate',1,'9450111000001105','Methotrexate 30mg/1.2ml solution for injection pre-filled syringes (Special Order)'),('methotrexate',1,'19976211000001101','Methotrexate 30mg/1.5ml solution for injection pre-filled syringes'),('methotrexate',1,'9469111000001109','Methotrexate 32.5mg/1.3ml solution for injection pre-filled syringes'),('methotrexate',1,'9449511000001107','Methotrexate 32.5mg/1.3ml solution for injection pre-filled syringes (Special Order)'),('methotrexate',1,'9469211000001103','Methotrexate 35mg/1.4ml solution for injection pre-filled syringes'),('methotrexate',1,'9448511000001101','Methotrexate 35mg/1.4ml solution for injection pre-filled syringes (Special Order)'),('methotrexate',1,'12817311000001101','Methotrexate 4mg/5ml oral solution'),('methotrexate',1,'12802211000001109','Methotrexate 4mg/5ml oral solution (Special Order)'),('methotrexate',1,'12817411000001108','Methotrexate 4mg/5ml oral suspension'),('methotrexate',1,'12801911000001106','Methotrexate 4mg/5ml oral suspension (Special Order)'),('methotrexate',1,'374442007','Methotrexate 5 mg oral tablet'),('methotrexate',1,'36033211000001105','Methotrexate 500mg/20ml solution for injection vials'),('methotrexate',1,'3622611000001102','Methotrexate 500mg/20ml solution for injection vials (A A H Pharmaceuticals Ltd)'),('methotrexate',1,'27952411000001107','Methotrexate 500mg/20ml solution for injection vials (Accord Healthcare Ltd)'),('methotrexate',1,'3623611000001107','Methotrexate 500mg/20ml solution for injection vials (Advanz Pharma)'),('methotrexate',1,'3623211000001105','Methotrexate 500mg/20ml solution for injection vials (Alliance Healthcare (Distribution) Ltd)'),('methotrexate',1,'14966811000001106','Methotrexate 500mg/20ml solution for injection vials (Hameln Pharmaceuticals Ltd)'),('methotrexate',1,'3622911000001108','Methotrexate 500mg/20ml solution for injection vials (Pfizer Ltd)'),('methotrexate',1,'10988211000001107','Methotrexate 500mg/20ml solution for injection vials (Teva UK Ltd)'),('methotrexate',1,'9469311000001106','Methotrexate 50mg/2ml solution for injection pre-filled syringes'),
('methotrexate',1,'9448011000001109','Methotrexate 50mg/2ml solution for injection pre-filled syringes (Special Order)'),('methotrexate',1,'36033311000001102','Methotrexate 50mg/2ml solution for injection vials'),('methotrexate',1,'3610011000001101','Methotrexate 50mg/2ml solution for injection vials (A A H Pharmaceuticals Ltd)'),('methotrexate',1,'28991611000001102','Methotrexate 50mg/2ml solution for injection vials (Accord Healthcare Ltd)'),('methotrexate',1,'3615611000001100','Methotrexate 50mg/2ml solution for injection vials (Advanz Pharma)'),('methotrexate',1,'3613311000001109','Methotrexate 50mg/2ml solution for injection vials (Alliance Healthcare (Distribution) Ltd)'),('methotrexate',1,'15138411000001109','Methotrexate 50mg/2ml solution for injection vials (Hameln Pharmaceuticals Ltd)'),('methotrexate',1,'3612811000001108','Methotrexate 50mg/2ml solution for injection vials (Pfizer Ltd)'),('methotrexate',1,'10988011000001102','Methotrexate 50mg/2ml solution for injection vials (Teva UK Ltd)'),('methotrexate',1,'12817511000001107','Methotrexate 50mg/5ml oral solution'),('methotrexate',1,'12803011000001108','Methotrexate 50mg/5ml oral solution (Special Order)'),('methotrexate',1,'12815111000001107','Methotrexate 50mg/5ml oral suspension'),('methotrexate',1,'12802611000001106','Methotrexate 50mg/5ml oral suspension (Special Order)'),('methotrexate',1,'36033411000001109','Methotrexate 5g/200ml solution for infusion vials'),('methotrexate',1,'3620611000001103','Methotrexate 5g/200ml solution for infusion vials (A A H Pharmaceuticals Ltd)'),('methotrexate',1,'3621111000001100','Methotrexate 5g/200ml solution for infusion vials (Advanz Pharma)'),('methotrexate',1,'3620811000001104','Methotrexate 5g/200ml solution for infusion vials (Alliance Healthcare (Distribution) Ltd)'),('methotrexate',1,'36033511000001108','Methotrexate 5g/50ml solution for infusion vials'),('methotrexate',1,'3615811000001101','Methotrexate 5g/50ml solution for infusion vials (A A H Pharmaceuticals Ltd)'),('methotrexate',1,'3616911000001104','Methotrexate 5g/50ml solution for infusion vials (Alliance Healthcare (Distribution) Ltd)'),('methotrexate',1,'3616411000001107','Methotrexate 5g/50ml solution for infusion vials (Pfizer Ltd)'),('methotrexate',1,'9562111000001108','Methotrexate 5g/50ml solution for infusion vials (Wockhardt UK Ltd)'),('methotrexate',1,'9469411000001104','Methotrexate 5mg/0.2ml solution for injection pre-filled syringes'),('methotrexate',1,'9457411000001101','Methotrexate 5mg/0.2ml solution for injection pre-filled syringes (Special Order)'),('methotrexate',1,'36033611000001107','Methotrexate 5mg/2ml solution for injection vials'),('methotrexate',1,'3612511000001105','Methotrexate 5mg/2ml solution for injection vials (A A H Pharmaceuticals Ltd)'),('methotrexate',1,'3614911000001107','Methotrexate 5mg/2ml solution for injection vials (Alliance Healthcare (Distribution) Ltd)'),('methotrexate',1,'3614611000001101','Methotrexate 5mg/2ml solution for injection vials (Pfizer Ltd)'),('methotrexate',1,'8665811000001104','Methotrexate 5mg/5ml oral solution'),('methotrexate',1,'8625911000001104','Methotrexate 5mg/5ml oral solution (Special Order)'),('methotrexate',1,'8665911000001109','Methotrexate 5mg/5ml oral suspension'),('methotrexate',1,'8626511000001104','Methotrexate 5mg/5ml oral suspension (Special Order)'),('methotrexate',1,'12815211000001101','Methotrexate 6mg/5ml oral solution'),('methotrexate',1,'12803611000001101','Methotrexate 6mg/5ml oral solution (Special Order)'),('methotrexate',1,'12815311000001109','Methotrexate 6mg/5ml oral suspension'),('methotrexate',1,'12803311000001106','Methotrexate 6mg/5ml oral suspension (Special Order)'),('methotrexate',1,'374443002','Methotrexate 7.5 mg oral tablet'),('methotrexate',1,'24595211000001109','Methotrexate 7.5mg/0.15ml solution for injection pre-filled disposable devices'),('methotrexate',1,'15518311000001104','Methotrexate 7.5mg/0.15ml solution for injection pre-filled syringes'),('methotrexate',1,'34168411000001106','Methotrexate 7.5mg/0.3ml solution for injection pre-filled disposable devices'),('methotrexate',1,'9469511000001100','Methotrexate 7.5mg/0.3ml solution for injection pre-filled syringes'),('methotrexate',1,'9456611000001100','Methotrexate 7.5mg/0.3ml solution for injection pre-filled syringes (Special Order)'),('methotrexate',1,'10676011000001109','Methotrexate 7.5mg/0.75ml solution for injection pre-filled syringes'),('methotrexate',1,'8666011000001101','Methotrexate 7.5mg/5ml oral solution'),('methotrexate',1,'8625811000001109','Methotrexate 7.5mg/5ml oral solution (Special Order)'),('methotrexate',1,'8666111000001100','Methotrexate 7.5mg/5ml oral suspension'),('methotrexate',1,'8626411000001103','Methotrexate 7.5mg/5ml oral suspension (Special Order)'),('methotrexate',1,'12815411000001102','Methotrexate 750micrograms/5ml oral solution'),('methotrexate',1,'12804611000001103','Methotrexate 750micrograms/5ml oral solution (Special Order)'),('methotrexate',1,'12815511000001103','Methotrexate 750micrograms/5ml oral suspension'),('methotrexate',1,'12804011000001105','Methotrexate 750micrograms/5ml oral suspension (Special Order)'),('methotrexate',1,'12815611000001104','Methotrexate 7mg/5ml oral solution'),('methotrexate',1,'12805711000001106','Methotrexate 7mg/5ml oral solution (Special Order)'),('methotrexate',1,'12815711000001108','Methotrexate 7mg/5ml oral suspension'),('methotrexate',1,'12805111000001105','Methotrexate 7mg/5ml oral suspension (Special Order)'),('methotrexate',1,'12815811000001100','Methotrexate 8mg/5ml oral solution'),('methotrexate',1,'12806611000001107','Methotrexate 8mg/5ml oral solution (Special Order)'),('methotrexate',1,'12815911000001105','Methotrexate 8mg/5ml oral suspension'),('methotrexate',1,'12806311000001102','Methotrexate 8mg/5ml oral suspension (Special Order)'),('methotrexate',1,'714206006','Methotrexate in oral dosage form'),('methotrexate',1,'714204009','Methotrexate in parenteral dosage form'),('methotrexate',1,'15513411000001100','Metoject 10mg/0.2ml solution for injection pre-filled syringes (medac UK)'),('methotrexate',1,'10672911000001109','Metoject 10mg/1ml solution for injection pre-filled syringes (medac UK)'),('methotrexate',1,'19224611000001108','Metoject 12.5mg/0.25ml solution for injection pre-filled syringes (medac UK)'),('methotrexate',1,'15513711000001106','Metoject 15mg/0.3ml solution for injection pre-filled syringes (medac UK)'),('methotrexate',1,'10673211000001106','Metoject 15mg/1.5ml solution for injection pre-filled syringes (medac UK)'),('methotrexate',1,'19225111000001101','Metoject 17.5mg/0.35ml solution for injection pre-filled syringes (medac UK)'),('methotrexate',1,'15514311000001109','Metoject 20mg/0.4ml solution for injection pre-filled syringes (medac UK)'),('methotrexate',1,'10673511000001109','Metoject 20mg/2ml solution for injection pre-filled syringes (medac UK)'),('methotrexate',1,'19225411000001106','Metoject 22.5mg/0.45ml solution for injection pre-filled syringes (medac UK)'),('methotrexate',1,'15514011000001106','Metoject 25mg/0.5ml solution for injection pre-filled syringes (medac UK)'),('methotrexate',1,'10674011000001104','Metoject 25mg/2.5ml solution for injection pre-filled syringes (medac UK)'),('methotrexate',1,'19225811000001108','Metoject 27.5mg/0.55ml solution for injection pre-filled syringes (medac UK)'),('methotrexate',1,'18208411000001106','Metoject 30mg/0.6ml solution for injection pre-filled syringes (medac UK)'),('methotrexate',1,'15513111000001105','Metoject 7.5mg/0.15ml solution for injection pre-filled syringes (medac UK)'),('methotrexate',1,'10672611000001103','Metoject 7.5mg/0.75ml solution for injection pre-filled syringes (medac UK)'),('methotrexate',1,'24590211000001100','Metoject PEN 10mg/0.2ml solution for injection pre-filled pen (medac UK)'),('methotrexate',1,'24589911000001102','Metoject PEN 12.5mg/0.25ml solution for injection pre-filled pen (medac UK)'),('methotrexate',1,'24589611000001108','Metoject PEN 15mg/0.3ml solution for injection pre-filled pen (medac UK)'),('methotrexate',1,'24591111000001100','Metoject PEN 17.5mg/0.35ml solution for injection pre-filled pen (medac UK)'),('methotrexate',1,'24590811000001104','Metoject PEN 20mg/0.4ml solution for injection pre-filled pen (medac UK)'),('methotrexate',1,'24590411000001101','Metoject PEN 22.5mg/0.45ml solution for injection pre-filled pen (medac UK)'),('methotrexate',1,'24589311000001103','Metoject PEN 25mg/0.5ml solution for injection pre-filled pen (medac UK)'),('methotrexate',1,'24589011000001101','Metoject PEN 27.5mg/0.55ml solution for injection pre-filled pen (medac UK)'),('methotrexate',1,'24588711000001108','Metoject PEN 30mg/0.6ml solution for injection pre-filled pen (medac UK)'),('methotrexate',1,'24588411000001102','Metoject PEN 7.5mg/0.15ml solution for injection pre-filled pen (medac UK)'),('methotrexate',1,'34162611000001107','Nordimet 10mg/0.4ml solution for injection pre-filled pens (Nordic Pharma Ltd)'),('methotrexate',1,'34162911000001101','Nordimet 12.5mg/0.5ml solution for injection pre-filled pens (Nordic Pharma Ltd)'),('methotrexate',1,'34163211000001104','Nordimet 15mg/0.6ml solution for injection pre-filled pens (Nordic Pharma Ltd)'),('methotrexate',1,'34163511000001101','Nordimet 17.5mg/0.7ml solution for injection pre-filled pens (Nordic Pharma Ltd)'),('methotrexate',1,'34163811000001103','Nordimet 20mg/0.8ml solution for injection pre-filled pens (Nordic Pharma Ltd)'),('methotrexate',1,'34164111000001107','Nordimet 22.5mg/0.9ml solution for injection pre-filled pens (Nordic Pharma Ltd)'),('methotrexate',1,'34164411000001102','Nordimet 25mg/1ml solution for injection pre-filled pens (Nordic Pharma Ltd)'),('methotrexate',1,'34161711000001105','Nordimet 7.5mg/0.3ml solution for injection pre-filled pens (Nordic Pharma Ltd)'),('methotrexate',1,'31407911000001106','Zlatal 10mg/0.4ml solution for injection pre-filled syringes (Nordic Pharma Ltd)'),
('methotrexate',1,'31409011000001103','Zlatal 12.5mg/0.5ml solution for injection pre-filled syringes (Nordic Pharma Ltd)'),('methotrexate',1,'31409611000001105','Zlatal 15mg/0.6ml solution for injection pre-filled syringes (Nordic Pharma Ltd)'),('methotrexate',1,'31410211000001104','Zlatal 17.5mg/0.7ml solution for injection pre-filled syringes (Nordic Pharma Ltd)'),('methotrexate',1,'31406711000001106','Zlatal 20mg/0.8ml solution for injection pre-filled syringes (Nordic Pharma Ltd)'),('methotrexate',1,'31407211000001102','Zlatal 22.5mg/0.9ml solution for injection pre-filled syringes (Nordic Pharma Ltd)'),('methotrexate',1,'31407411000001103','Zlatal 25mg/1ml solution for injection pre-filled syringes (Nordic Pharma Ltd)'),('methotrexate',1,'31408511000001100','Zlatal 7.5mg/0.3ml solution for injection pre-filled syringes (Nordic Pharma Ltd)')

IF OBJECT_ID('tempdb..#codesemis') IS NOT NULL DROP TABLE #codesemis;
CREATE TABLE #codesemis (
  [concept] [varchar](255) NOT NULL,
  [version] INT NOT NULL,
	[code] [varchar](20) COLLATE Latin1_General_CS_AS NOT NULL,
	[description] [varchar](255) NULL
) ON [PRIMARY];

INSERT INTO #codesemis
VALUES ('methotrexate',1,'EMTA3515','Emtexate  Tablets  10 mg'),('methotrexate',1,'MATA3882','Maxtrex  Tablets  10 mg'),('methotrexate',1,'MATA3883','Maxtrex  Tablets  2.5 mg'),('methotrexate',1,'META3900','Methotrexate  Tablets  2.5 mg'),('methotrexate',1,'META5136','Methotrexate  Tablets  10 mg'),('methotrexate',1,'MEIN18088EMIS','Methotrexate  Injection  5 grams/200 ml vial'),('methotrexate',1,'MEIN18089EMIS','Methotrexate  Injection  5 mg/2 ml vial'),('methotrexate',1,'MEIN18090EMIS','Methotrexate  Injection  50 mg/2 ml vial'),('methotrexate',1,'MEIN21800NEMIS','Methotrexate 15mg/1.5ml solution for injection pre-filled syringes'),('methotrexate',1,'MEIN21802NEMIS','Methotrexate 25mg/2.5ml solution for injection pre-filled syringes'),('methotrexate',1,'MEIN22304NEMIS','Methotrexate 15mg/0.6ml solution for injection pre-filled syringes'),('methotrexate',1,'MEIN3551NEMIS','Methotrexate 1g/10ml solution for injection vials'),('methotrexate',1,'MEIN36535NEMIS','Methotrexate 15mg/0.3ml solution for injection pre-filled syringes'),('methotrexate',1,'MEIN51051NEMIS','Methotrexate 12.5mg/0.25ml solution for injection pre-filled syringes'),('methotrexate',1,'MEIN90725NEMIS','Methotrexate 12.5mg/0.25ml solution for injection pre-filled disposable devices'),('methotrexate',1,'MEIN90728NEMIS','Methotrexate 20mg/0.4ml solution for injection pre-filled disposable devices'),('methotrexate',1,'MEOR12018NEMIS','Methotrexate  Oral Suspension  2.5 mg/5 ml'),('methotrexate',1,'MEOR14798NEMIS','Methotrexate 15mg/5ml oral solution'),('methotrexate',1,'MEOR15494NEMIS','Methotrexate 10mg/5ml oral solution')


IF OBJECT_ID('tempdb..#TempRefCodes') IS NOT NULL DROP TABLE #TempRefCodes;
CREATE TABLE #TempRefCodes (FK_Reference_Coding_ID BIGINT NOT NULL, concept VARCHAR(255) NOT NULL, version INT NOT NULL);

-- Read v2 codes
INSERT INTO #TempRefCodes
SELECT PK_Reference_Coding_ID, dcr.concept, dcr.[version]
FROM [SharedCare].[Reference_Coding] rc
INNER JOIN #codesreadv2 dcr on dcr.code = rc.MainCode
WHERE CodingType='ReadCodeV2'
and PK_Reference_Coding_ID != -1;

-- CTV3 codes
INSERT INTO #TempRefCodes
SELECT PK_Reference_Coding_ID, dcc.concept, dcc.[version]
FROM [SharedCare].[Reference_Coding] rc
INNER JOIN #codesctv3 dcc on dcc.code = rc.MainCode
WHERE CodingType='CTV3'
and PK_Reference_Coding_ID != -1;

-- EMIS codes with a FK Reference Coding ID
INSERT INTO #TempRefCodes
SELECT FK_Reference_Coding_ID, ce.concept, ce.[version]
FROM [SharedCare].[Reference_Local_Code] rlc
INNER JOIN #codesemis ce on ce.code = rlc.LocalCode
WHERE FK_Reference_Coding_ID != -1;

IF OBJECT_ID('tempdb..#TempSNOMEDRefCodes') IS NOT NULL DROP TABLE #TempSNOMEDRefCodes;
CREATE TABLE #TempSNOMEDRefCodes (FK_Reference_SnomedCT_ID BIGINT NOT NULL, concept VARCHAR(255) NOT NULL, [version] INT NOT NULL);

-- SNOMED codes
INSERT INTO #TempSNOMEDRefCodes
SELECT PK_Reference_SnomedCT_ID, dcs.concept, dcs.[version]
FROM SharedCare.Reference_SnomedCT rs
INNER JOIN #codessnomed dcs on dcs.code = rs.ConceptID;

-- EMIS codes with a FK SNOMED ID but without a FK Reference Coding ID
INSERT INTO #TempSNOMEDRefCodes
SELECT FK_Reference_SnomedCT_ID, ce.concept, ce.[version]
FROM [SharedCare].[Reference_Local_Code] rlc
INNER JOIN #codesemis ce on ce.code = rlc.LocalCode
WHERE FK_Reference_Coding_ID = -1
AND FK_Reference_SnomedCT_ID != -1;

-- De-duped tables
IF OBJECT_ID('tempdb..#CodeSets') IS NOT NULL DROP TABLE #CodeSets;
CREATE TABLE #CodeSets (FK_Reference_Coding_ID BIGINT NOT NULL, concept VARCHAR(255) NOT NULL);

IF OBJECT_ID('tempdb..#SnomedSets') IS NOT NULL DROP TABLE #SnomedSets;
CREATE TABLE #SnomedSets (FK_Reference_SnomedCT_ID BIGINT NOT NULL, concept VARCHAR(255) NOT NULL);

IF OBJECT_ID('tempdb..#VersionedCodeSets') IS NOT NULL DROP TABLE #VersionedCodeSets;
CREATE TABLE #VersionedCodeSets (FK_Reference_Coding_ID BIGINT NOT NULL, Concept VARCHAR(255), [Version] INT);

IF OBJECT_ID('tempdb..#VersionedSnomedSets') IS NOT NULL DROP TABLE #VersionedSnomedSets;
CREATE TABLE #VersionedSnomedSets (FK_Reference_SnomedCT_ID BIGINT NOT NULL, Concept VARCHAR(255), [Version] INT);

INSERT INTO #VersionedCodeSets
SELECT DISTINCT * FROM #TempRefCodes;

INSERT INTO #VersionedSnomedSets
SELECT DISTINCT * FROM #TempSNOMEDRefCodes;

INSERT INTO #CodeSets
SELECT FK_Reference_Coding_ID, c.concept
FROM #VersionedCodeSets c
INNER JOIN (
  SELECT concept, MAX(version) AS maxVersion FROM #VersionedCodeSets
  GROUP BY concept)
sub ON sub.concept = c.concept AND c.version = sub.maxVersion;

INSERT INTO #SnomedSets
SELECT FK_Reference_SnomedCT_ID, c.concept
FROM #VersionedSnomedSets c
INNER JOIN (
  SELECT concept, MAX(version) AS maxVersion FROM #VersionedSnomedSets
  GROUP BY concept)
sub ON sub.concept = c.concept AND c.version = sub.maxVersion;
